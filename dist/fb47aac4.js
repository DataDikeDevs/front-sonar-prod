import{Q as B,a as C,b as ve}from"./ecaf8470.js";import{P as wl,S as Ln,T as In,r as M,a_ as ai,e as te,w as be,U as ye,W as kl,ak as pl,b4 as ii,dM as oi,n as K,k as W,ag as gl,j as O,a9 as Ze,bv as Cn,_ as Te,o as f,f as p,g as a,s as ue,D as Re,h as l,p as m,t as F,Q as E,i as g,d4 as cs,bG as Il,v as me,M as Le,d$ as Ls,A as qe,m as I,G as ge,q as G,x as ce,B as lt,F as at,bc as fs,I as ze,l as de,a3 as St,b3 as ri,au as di,e0 as ui,aY as ci,aQ as fi,aS as mi,aZ as pi,e1 as gi,aR as hi,b0 as ms,e2 as yi,aq as bi,K as Me,a5 as mt,H as _,bO as vi,E as qt,b as Rt,a6 as wi,bC as ki,bD as zl,bE as Tn,bF as xn,e3 as _i,aa as Is,bN as zt,V as Bn,a as Ae,a4 as Be,e4 as Si,C as Bs,z as Hs,e5 as Fs,u as Hn,e6 as Ql,c9 as Vi,ad as js,aw as Ks,az as zs,b7 as Ci,aD as Qs,O as Ws,bz as An,bM as Xe,bP as Ti,ab as xi,bB as Ai,ac as Oi,bR as Gs,aX as Js,e7 as ps,e8 as Ht,bp as gs,aB as qi,bf as $i,bg as gn,e9 as Ri,X as ql,aV as hs,bh as Di,ea as Ui,a8 as Fn,cd as Pi,eb as Ei,bm as Mi,ec as Ni,cb as ys,ed as Li,ee as Ii,ce as Bi,ef as bs,bQ as Hi}from"./5ab24b2e.js";import{C as R,Q as Se}from"./cf5c9d2e.js";import{a as j,b as Ne,Q as Qe,f as Xt,g as Fi}from"./f74f6403.js";import{u as oe,Q as et,b as nt,a as J,g as Ke,d as _l,c as dt,e as Zl,f as Ct,h as ji}from"./f0e6a650.js";import{b as De,a as pe,B as Ys,n as Ve,d as At,K as Xs,Q as pt,o as Ki,L as zi,g as Qi}from"./2f13d940.js";import{T as Fe,m as it}from"./6f88213c.js";import{t as Zs,C as ea,Q as en,v as jn,w as ta,x as Wi,y as Gi,z as la,e as na,B as On,F as Ji,G as Yi,H as Xi,I as Zi,f as eo,J as to,u as qn,K as lo,L as no,N as ol,E as so,D as ao,M as io,j as oo,k as ro,W as uo,l as co,S as fo,A as vs,P as mo,O as Wl,R as sa,T as po,U as go,a as ho,r as yo,q as bo,s as vo,b as wo}from"./bd63a470.js";import{u as Ie}from"./996a7403.js";import{v as ko,w as _o,x as aa,u as tn,y as So,z as Vo,A as Co,q as ia,t as oa,B as ra,C as da,_ as To,c as Kn,Q as Zt,S as xo,k as hl,D as Ao,E as Oo,F as qo,b as ln,m as $o,G as Ro,H as Do,I as Uo,g as ua,J as Po,K as Eo,L as Mo,M as No,T as hn}from"./1914f3e5.js";import{Q as ct}from"./b10e6aed.js";import{I as He}from"./3d55f282.js";import{e as yl}from"./14d147f0.js";import{e as ot,Q as Lo,b as zn,U as Bl,l as Io,a as Qn,S as rl,c as Bo,E as Ho}from"./a3499d7e.js";import{c as ca,b as fa,a as ma,W as pa}from"./36cdb1ed.js";import{d as Fo}from"./b24520dc.js";import{getBaseUrl as ga}from"./1f4fe988.js";import{a as jo,Q as Ko}from"./e97ed4ea.js";const zo=["none","strict","leaf","leaf-filtered"];var nn=wl({name:"QTree",props:{...Ln,nodes:{type:Array,required:!0},nodeKey:{type:String,required:!0},labelKey:{type:String,default:"label"},childrenKey:{type:String,default:"children"},dense:Boolean,color:String,controlColor:String,textColor:String,selectedColor:String,icon:String,tickStrategy:{type:String,default:"none",validator:t=>zo.includes(t)},ticked:Array,expanded:Array,selected:{},noSelectionUnset:Boolean,defaultExpandAll:Boolean,accordion:Boolean,filter:String,filterMethod:Function,duration:{},noConnectors:Boolean,noTransition:Boolean,noNodesLabel:String,noResultsLabel:String},emits:["update:expanded","update:ticked","update:selected","lazyLoad","afterShow","afterHide"],setup(t,{slots:e,emit:s}){const{proxy:n}=kl(),{$q:i}=n,d=In(t,i),o=M({}),r=M(t.ticked||[]),u=M(t.expanded||[]);let c={};ai(()=>{c={}});const b=te(()=>`q-tree q-tree--${t.dense===!0?"dense":"standard"}`+(t.noConnectors===!0?" q-tree--no-connectors":"")+(d.value===!0?" q-tree--dark":"")+(t.color!==void 0?` text-${t.color}`:"")),y=te(()=>t.selected!==void 0),w=te(()=>t.icon||i.iconSet.tree.icon),k=te(()=>t.controlColor||t.color),x=te(()=>t.textColor!==void 0?` text-${t.textColor}`:""),h=te(()=>{const Q=t.selectedColor||t.color;return Q?` text-${Q}`:""}),V=te(()=>t.filterMethod!==void 0?t.filterMethod:(Q,ae)=>{const z=ae.toLowerCase();return Q[t.labelKey]&&Q[t.labelKey].toLowerCase().indexOf(z)!==-1}),D=te(()=>{const Q={},ae=(z,he)=>{const ie=z.tickStrategy||(he?he.tickStrategy:t.tickStrategy),_e=z[t.nodeKey],Pe=z[t.childrenKey]&&Array.isArray(z[t.childrenKey])&&z[t.childrenKey].length!==0,gt=z.disabled!==!0&&y.value===!0&&z.selectable!==!1,Ye=z.disabled!==!0&&z.expandable!==!1,Dt=ie!=="none",ht=ie==="strict",tt=ie==="leaf-filtered",st=ie==="leaf"||ie==="leaf-filtered";let kt=z.disabled!==!0&&z.tickable!==!1;st===!0&&kt===!0&&he&&he.tickable!==!0&&(kt=!1);let yt=z.lazy;yt===!0&&o.value[_e]!==void 0&&Array.isArray(z[t.childrenKey])===!0&&(yt=o.value[_e]);const xe={key:_e,parent:he,isParent:Pe,lazy:yt,disabled:z.disabled,link:z.disabled!==!0&&(gt===!0||Ye===!0&&(Pe===!0||yt===!0)),children:[],matchesFilter:t.filter?V.value(z,t.filter):!0,selected:_e===t.selected&&gt===!0,selectable:gt,expanded:Pe===!0?u.value.includes(_e):!1,expandable:Ye,noTick:z.noTick===!0||ht!==!0&&yt&&yt!=="loaded",tickable:kt,tickStrategy:ie,hasTicking:Dt,strictTicking:ht,leafFilteredTicking:tt,leafTicking:st,ticked:ht===!0?r.value.includes(_e):Pe===!0?!1:r.value.includes(_e)};if(Q[_e]=xe,Pe===!0&&(xe.children=z[t.childrenKey].map(re=>ae(re,xe)),t.filter&&(xe.matchesFilter!==!0?xe.matchesFilter=xe.children.some(re=>re.matchesFilter):xe.noTick!==!0&&xe.disabled!==!0&&xe.tickable===!0&&tt===!0&&xe.children.every(re=>re.matchesFilter!==!0||re.noTick===!0||re.tickable!==!0)===!0&&(xe.tickable=!1)),xe.matchesFilter===!0&&(xe.noTick!==!0&&ht!==!0&&xe.children.every(re=>re.noTick)===!0&&(xe.noTick=!0),st))){if(xe.ticked=!1,xe.indeterminate=xe.children.some(re=>re.indeterminate===!0),xe.tickable=xe.tickable===!0&&xe.children.some(re=>re.tickable),xe.indeterminate!==!0){const re=xe.children.reduce((se,ke)=>ke.ticked===!0?se+1:se,0);re===xe.children.length?xe.ticked=!0:re>0&&(xe.indeterminate=!0)}xe.indeterminate===!0&&(xe.indeterminateNextState=xe.children.every(re=>re.tickable!==!0||re.ticked!==!0))}return xe};return t.nodes.forEach(z=>ae(z,null)),Q});be(()=>t.ticked,Q=>{r.value=Q}),be(()=>t.expanded,Q=>{u.value=Q});function T(Q){const ae=[].reduce,z=(he,ie)=>{if(he||!ie)return he;if(Array.isArray(ie)===!0)return ae.call(Object(ie),z,he);if(ie[t.nodeKey]===Q)return ie;if(ie[t.childrenKey])return z(null,ie[t.childrenKey])};return z(null,t.nodes)}function A(){return r.value.map(Q=>T(Q))}function N(){return u.value.map(Q=>T(Q))}function S(Q){return Q&&D.value[Q]?D.value[Q].expanded:!1}function q(){t.expanded!==void 0?s("update:expanded",[]):u.value=[]}function P(){const Q=[],ae=z=>{z[t.childrenKey]&&z[t.childrenKey].length!==0&&z.expandable!==!1&&z.disabled!==!0&&(Q.push(z[t.nodeKey]),z[t.childrenKey].forEach(ae))};t.nodes.forEach(ae),t.expanded!==void 0?s("update:expanded",Q):u.value=Q}function H(Q,ae,z=T(Q),he=D.value[Q]){if(he.lazy&&he.lazy!=="loaded"){if(he.lazy==="loading")return;o.value[Q]="loading",Array.isArray(z[t.childrenKey])!==!0&&(z[t.childrenKey]=[]),s("lazyLoad",{node:z,key:Q,done:ie=>{o.value[Q]="loaded",z[t.childrenKey]=Array.isArray(ie)===!0?ie:[],pl(()=>{const _e=D.value[Q];_e&&_e.isParent===!0&&L(Q,!0)})},fail:()=>{delete o.value[Q],z[t.childrenKey].length===0&&delete z[t.childrenKey]}})}else he.isParent===!0&&he.expandable===!0&&L(Q,ae)}function L(Q,ae){let z=u.value;const he=t.expanded!==void 0;if(he===!0&&(z=z.slice()),ae){if(t.accordion&&D.value[Q]){const ie=[];D.value[Q].parent?D.value[Q].parent.children.forEach(_e=>{_e.key!==Q&&_e.expandable===!0&&ie.push(_e.key)}):t.nodes.forEach(_e=>{const Pe=_e[t.nodeKey];Pe!==Q&&ie.push(Pe)}),ie.length!==0&&(z=z.filter(_e=>ie.includes(_e)===!1))}z=z.concat([Q]).filter((ie,_e,Pe)=>Pe.indexOf(ie)===_e)}else z=z.filter(ie=>ie!==Q);he===!0?s("update:expanded",z):u.value=z}function Z(Q){return Q&&D.value[Q]?D.value[Q].ticked:!1}function fe(Q,ae){let z=r.value;const he=t.ticked!==void 0;he===!0&&(z=z.slice()),ae?z=z.concat(Q).filter((ie,_e,Pe)=>Pe.indexOf(ie)===_e):z=z.filter(ie=>Q.includes(ie)===!1),he===!0&&s("update:ticked",z)}function le(Q,ae,z){const he={tree:n,node:Q,key:z,color:t.color,dark:d.value};return Cn(he,"expanded",()=>ae.expanded,ie=>{ie!==ae.expanded&&H(z,ie)}),Cn(he,"ticked",()=>ae.ticked,ie=>{ie!==ae.ticked&&fe([z],ie)}),he}function Y(Q){return(t.filter?Q.filter(ae=>D.value[ae[t.nodeKey]].matchesFilter):Q).map(ae=>v(ae))}function X(Q){if(Q.icon!==void 0)return ye(K,{class:"q-tree__icon q-mr-sm",name:Q.icon,color:Q.iconColor});const ae=Q.img||Q.avatar;if(ae)return ye("img",{class:`q-tree__${Q.img?"img":"avatar"} q-mr-sm`,src:ae})}function ne(){s("afterShow")}function $(){s("afterHide")}function v(Q){const ae=Q[t.nodeKey],z=D.value[ae],he=Q.header&&e[`header-${Q.header}`]||e["default-header"],ie=z.isParent===!0?Y(Q[t.childrenKey]):[],_e=ie.length!==0||z.lazy&&z.lazy!=="loaded";let Pe=Q.body&&e[`body-${Q.body}`]||e["default-body"];const gt=he!==void 0||Pe!==void 0?le(Q,z,ae):null;return Pe!==void 0&&(Pe=ye("div",{class:"q-tree__node-body relative-position"},[ye("div",{class:x.value},[Pe(gt)])])),ye("div",{key:ae,class:`q-tree__node relative-position q-tree__node--${_e===!0?"parent":"child"}`},[ye("div",{class:"q-tree__node-header relative-position row no-wrap items-center"+(z.link===!0?" q-tree__node--link q-hoverable q-focusable":"")+(z.selected===!0?" q-tree__node--selected":"")+(z.disabled===!0?" q-tree__node--disabled":""),tabindex:z.link===!0?0:-1,ariaExpanded:ie.length>0?z.expanded:null,role:"treeitem",onClick:Ye=>{Ce(Q,z,Ye)},onKeypress(Ye){ii(Ye)!==!0&&(Ye.keyCode===13?Ce(Q,z,Ye,!0):Ye.keyCode===32&&$e(Q,z,Ye,!0))}},[ye("div",{class:"q-focus-helper",tabindex:-1,ref:Ye=>{c[z.key]=Ye}}),z.lazy==="loading"?ye(oi,{class:"q-tree__spinner",color:k.value}):_e===!0?ye(K,{class:"q-tree__arrow"+(z.expanded===!0?" q-tree__arrow--rotate":""),name:w.value,onClick(Ye){$e(Q,z,Ye)}}):null,z.hasTicking===!0&&z.noTick!==!0?ye(W,{class:"q-tree__tickbox",modelValue:z.indeterminate===!0?null:z.ticked,color:k.value,dark:d.value,dense:!0,keepColor:!0,disable:z.tickable!==!0,onKeydown:gl,"onUpdate:modelValue":Ye=>{je(z,Ye)}}):null,ye("div",{class:"q-tree__node-header-content col row no-wrap items-center"+(z.selected===!0?h.value:x.value)},[he?he(gt):[X(Q),ye("div",Q[t.labelKey])]])]),_e===!0?t.noTransition===!0?z.expanded===!0?ye("div",{class:"q-tree__node-collapsible"+x.value,key:`${ae}__q`},[Pe,ye("div",{class:"q-tree__children"+(z.disabled===!0?" q-tree__node--disabled":""),role:"group"},ie)]):null:ye(Zs,{duration:t.duration,onShow:ne,onHide:$},()=>O(ye("div",{class:"q-tree__node-collapsible"+x.value,key:`${ae}__q`},[Pe,ye("div",{class:"q-tree__children"+(z.disabled===!0?" q-tree__node--disabled":""),role:"group"},ie)]),[[Ze,z.expanded]])):Pe])}function U(Q){const ae=c[Q];ae&&ae.focus()}function Ce(Q,ae,z,he){he!==!0&&ae.selectable!==!1&&U(ae.key),y.value&&ae.selectable?t.noSelectionUnset===!1?s("update:selected",ae.key!==t.selected?ae.key:null):ae.key!==t.selected&&s("update:selected",ae.key===void 0?null:ae.key):$e(Q,ae,z,he),typeof Q.handler=="function"&&Q.handler(Q)}function $e(Q,ae,z,he){z!==void 0&&gl(z),he!==!0&&ae.selectable!==!1&&U(ae.key),H(ae.key,!ae.expanded,Q,ae)}function je(Q,ae){if(Q.indeterminate===!0&&(ae=Q.indeterminateNextState),Q.strictTicking)fe([Q.key],ae);else if(Q.leafTicking){const z=[],he=ie=>{ie.isParent?(ae!==!0&&ie.noTick!==!0&&ie.tickable===!0&&z.push(ie.key),ie.leafTicking===!0&&ie.children.forEach(he)):ie.noTick!==!0&&ie.tickable===!0&&(ie.leafFilteredTicking!==!0||ie.matchesFilter===!0)&&z.push(ie.key)};he(Q),fe(z,ae)}}return t.defaultExpandAll===!0&&P(),Object.assign(n,{getNodeByKey:T,getTickedNodes:A,getExpandedNodes:N,isExpanded:S,collapseAll:q,expandAll:P,setExpanded:H,isTicked:Z,setTicked:fe}),()=>{const Q=Y(t.nodes);return ye("div",{class:b.value,role:"tree"},Q.length===0?t.filter?t.noResultsLabel||i.lang.tree.noResults:t.noNodesLabel||i.lang.tree.noNodes:Q)}}});const Qo={name:"DialogWrapper",emits:[...oe.emits],props:{vuecomponent:{},title:String,width:{type:String,default:"50"},height:{type:String,default:"50"},noCard:{type:Boolean,default:!1},componentProps:Object,dialogProps:Object},inheritAttrs:!1,setup(){const{dialogRef:t,onDialogHide:e,onDialogOK:s,onDialogCancel:n}=oe();return{dialogRef:t,onDialogHide:e,onDialogOK:s,onDialogCancel:n}}};function Wo(t,e,s,n,i,d){return f(),p(me,Il({ref:"dialogRef",onHide:n.onDialogHide},s.dialogProps),{default:a(()=>[s.noCard?(f(),p(cs(s.vuecomponent),Il({key:1,class:"q-dialog-plugin"},{...t.$attrs,...s.componentProps}),null,16)):(f(),p(ue,{key:0,class:"q-dialog-plugin",style:Re(`min-width: ${s.width}vw`)},{default:a(()=>[l(De,null,{default:a(()=>[m(F(s.title)+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{"content-class":"bg-white text-primary"},{default:a(()=>e[0]||(e[0]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),g("div",{class:"scroll",style:Re(`height: ${s.height}vh`)},[(f(),p(cs(s.vuecomponent),Il({...t.$attrs,...s.componentProps},{onClose:n.onDialogOK,onHide:n.onDialogHide}),null,16,["onClose","onHide"]))],4)]),_:1},8,["style"]))]),_:1},16,["onHide"])}var $n=Te(Qo,[["render",Wo]]);const Go={name:"ClientsForm",emits:[...oe.emits],components:{CustomField:ea},props:{client:Object},setup(t){const{dialogRef:e,onDialogOK:s,onDialogHide:n}=oe(),i=t.client?M(Object.assign({},t.client)):M({name:""}),d=M({name:""}),o=M({}),r=M([]),u=M(!1);async function c(){u.value=!0;const y={client:i.value,site:d.value,custom_fields:Ls(r.value,o.value)};try{const w=t.client?await ko(t.client.id,y):await _o(y);Ve(w),s()}catch(w){console.error(w)}u.value=!1}async function b(){u.value=!0;const y=await aa(t.client.id);for(let w of r.value){const k=y.custom_fields.find(x=>x.field===w.id);w.type==="multiple"?k?o.value[w.name]=k.value:o.value[w.name]=[]:w.type==="checkbox"?k?o.value[w.name]=k.value:o.value[w.name]=!1:k?o.value[w.name]=k.value:o.value[w.name]=""}u.value=!1}return Le(async()=>{const y=await Ys({model:"client"});r.value=y.filter(w=>!w.hide_in_ui),t.client&&b()}),{state:i,site:d,customFields:r,custom_fields:o,loading:u,submit:c,dialogRef:e,onDialogHide:n}}},Jo={class:"card-header ac jsb"},Yo={class:"text-h6"},Xo={key:1,class:"q-pl-sm text-h6"},Zo={class:"card-footer ac je gap-1"},er={type:"button",class:"btn btn-secondary"};function tr(t,e,s,n,i,d){const o=qe("CustomField");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{width:"40vw"}},{default:a(()=>[g("div",Jo,[g("div",Yo,F(s.client?`Editing ${s.client.name}`:"Adding Client"),1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[2]||(e[2]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(ct,{onSubmit:n.submit},{default:a(()=>[l(I,null,{default:a(()=>[l(ge,{outlined:"",dense:"",modelValue:n.state.name,"onUpdate:modelValue":e[0]||(e[0]=r=>n.state.name=r),label:"Name",rules:[r=>r&&r.length>0||"*Required"]},null,8,["modelValue","rules"])]),_:1}),s.client?G("",!0):(f(),p(I,{key:0},{default:a(()=>[l(ge,{rules:[r=>!!r||"*Required"],outlined:"",dense:"",modelValue:n.site.name,"onUpdate:modelValue":e[1]||(e[1]=r=>n.site.name=r),label:"Default first site"},null,8,["rules","modelValue"])]),_:1})),n.customFields.length>0?(f(),ce("div",Xo," Custom Fields ")):G("",!0),(f(!0),ce(at,null,lt(n.customFields,r=>(f(),p(I,{key:r.id},{default:a(()=>[l(o,{modelValue:n.custom_fields[r.name],"onUpdate:modelValue":u=>n.custom_fields[r.name]=u,field:r},null,8,["modelValue","onUpdate:modelValue","field"])]),_:2},1024))),128)),g("div",Zo,[e[4]||(e[4]=g("button",{type:"submit",class:"btn btn-primary"},"Save",-1)),O((f(),ce("button",er,e[3]||(e[3]=[m(" Cancel ")]))),[[R]])])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var Rn=Te(Go,[["render",tr]]);const lr={name:"SitesForm",emits:[...oe.emits],components:{CustomField:ea,TacticalDropdown:Fe},props:{site:Object,client:Number},setup(t){const e=Ie(),{dialogRef:s,onDialogOK:n,onDialogHide:i}=oe(),{clientOptions:d}=tn(!0),o=t.site?M(Object.assign({},t.site)):M({client:t.client,name:""}),r=M({}),u=M([]),c=M(!1);async function b(){c.value=!0;const w={site:o.value,custom_fields:Ls(u.value,r.value)};try{const k=t.site?await So(t.site.id,w):await Vo(w);Ve(k),n()}catch(k){console.error(k)}c.value=!1}async function y(){c.value=!0;const w=await Co(t.site.id);for(let k of u.value){const x=w.custom_fields.find(h=>h.field===k.id);k.type==="multiple"?x?r.value[k.name]=x.value:r.value[k.name]=[]:k.type==="checkbox"?x?r.value[k.name]=x.value:r.value[k.name]=!1:x?r.value[k.name]=x.value:r.value[k.name]=""}c.value=!1}return Le(async()=>{e.loading.show();try{const w=await Ys({model:"site"});u.value=w.filter(k=>!k.hide_in_ui),t.site&&y()}catch(w){console.error(w)}e.loading.hide()}),{state:o,loading:c,custom_fields:r,customFields:u,clientOptions:d,submit:b,dialogRef:s,onDialogHide:i}}},nr={class:"card-header ac jsb"},sr={class:"text-h6"},ar={key:0,class:"q-pl-sm text-h6"},ir={class:"card-footer ac je gap-1"},or={type:"button",class:"btn btn-secondary"};function rr(t,e,s,n,i,d){const o=qe("tactical-dropdown"),r=qe("CustomField");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{width:"60vw"}},{default:a(()=>[g("div",nr,[g("div",sr,F(s.site?`Editing ${s.site.name}`:"Adding Site"),1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[2]||(e[2]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(ct,{onSubmit:n.submit},{default:a(()=>[l(I,null,{default:a(()=>[l(o,{modelValue:n.state.client,"onUpdate:modelValue":e[0]||(e[0]=u=>n.state.client=u),label:"Client",options:n.clientOptions,outlined:"",mapOptions:"",rules:[u=>!!u||"Client is required"],filterable:""},null,8,["modelValue","options","rules"])]),_:1}),l(I,null,{default:a(()=>[l(ge,{rules:[u=>!!u||"Name is required"],outlined:"",dense:"",modelValue:n.state.name,"onUpdate:modelValue":e[1]||(e[1]=u=>n.state.name=u),label:"Name"},null,8,["rules","modelValue"])]),_:1}),n.customFields.length>0?(f(),ce("div",ar," Custom Fields ")):G("",!0),(f(!0),ce(at,null,lt(n.customFields,u=>(f(),p(I,{key:u.id},{default:a(()=>[l(r,{modelValue:n.custom_fields[u.name],"onUpdate:modelValue":c=>n.custom_fields[u.name]=c,field:u},null,8,["modelValue","onUpdate:modelValue","field"])]),_:2},1024))),128)),g("div",ir,[O((f(),ce("button",or,e[3]||(e[3]=[m(" Cancel ")]))),[[R]]),e[4]||(e[4]=g("button",{type:"submit",class:"btn btn-primary"},"Save",-1))])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var Gl=Te(lr,[["render",rr]]);const dr={name:"DeleteClient",emits:[...oe.emits],components:{TacticalDropdown:Fe},props:{object:!Object,type:!String},setup(t){const e=Ie(),{dialogRef:s,onDialogOK:n,onDialogHide:i}=oe(),d=M(!1),o=M(null),r=M([]);function u(){e.dialog({title:"Are you sure?",message:`Deleting ${t.type} ${t.object.name}. ${t.object.agent_count} agents will be moved to the selected site`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{d.value=!0;try{const b=t.type==="client"?await ia(t.object.id,{move_to_site:o.value}):await oa(t.object.id,{move_to_site:o.value});Ve(b),n()}catch(b){console.error(b)}d.value=!1})}async function c(){e.loading.show();const b=await ra();e.loading.hide(),t.type==="client"?r.value=Object.freeze(fs(b.filter(y=>y.id!==t.object.id))):(b.forEach(y=>y.sites=y.sites.filter(w=>w.id!==t.object.id)),r.value=Object.freeze(fs(b)))}return Le(c),{site:o,loading:d,siteOptions:r,submit:u,dialogRef:s,onDialogHide:i,onDialogOK:n}}};function ur(t,e,s,n,i,d){const o=qe("tactical-dropdown");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin"},{default:a(()=>[l(De,null,{default:a(()=>[m(" Delete "+F(s.object.name)+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[1]||(e[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(ct,{onSubmit:n.submit},{default:a(()=>[n.siteOptions.length===0?(f(),p(I,{key:0},{default:a(()=>e[2]||(e[2]=[m(" There are no valid sites to move agents to. Add another site and try again ")])),_:1})):G("",!0),n.siteOptions.length>0?(f(),p(I,{key:1},{default:a(()=>[l(o,{label:"Site to move agents to",outlined:"",modelValue:n.site,"onUpdate:modelValue":e[0]||(e[0]=r=>n.site=r),options:n.siteOptions,mapOptions:"",rules:[r=>!!r||"Select the site that the agents should be moved to"],hint:"The client you are deleting has agents assigned to it. Select a Site below to move the agents to.",filterable:""},null,8,["modelValue","options","rules"])]),_:1})):G("",!0),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",push:"",label:"Cancel"},null,512),[[R]]),l(E,{loading:n.loading,disable:n.siteOptions.length===0,dense:"",flat:"",push:"",label:"Move",color:"primary",type:"submit"},null,8,["loading","disable"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var ha=Te(dr,[["render",ur]]);const cr=[{name:"name",label:"Name",field:"name",align:"left"},{name:"agent_count",label:"Total Agents",field:"agent_count",align:"left"}],fr={name:"SitesTable",emits:[...oe.emits],props:{client:!Object},setup(t){const e=Ie(),{dialogRef:s,onDialogHide:n}=oe(),i=M([]),d=M(!1);async function o(){d.value=!0;const b=await aa(t.client.id);i.value=b.sites,d.value=!1}function r(b){b.agent_count>0?e.dialog({component:ha,componentProps:{object:b,type:"site"}}).onOk(o):e.dialog({title:"Are you sure?",message:`Delete site: ${b.name}.`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{d.value=!0;try{const y=await oa(b.id);Ve(y),await o()}catch(y){console.error(y)}d.value=!1})}function u(b){e.dialog({component:Gl,componentProps:{site:b}}).onOk(o)}function c(){e.dialog({component:Gl,componentProps:{client:t.client.id}}).onOk(o)}return Le(o),{sites:i,loading:d,columns:cr,getSites:o,showSiteDeleteModal:r,showEditSite:u,showAddSite:c,dialogRef:s,onDialogHide:n}}};function mr(t,e,s,n,i,d){return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{width:"60vw"}},{default:a(()=>[g("div",null,[l(E,{onClick:n.getSites,class:"q-mr-sm",dense:"",flat:"",push:"",icon:"refresh"},null,8,["onClick"]),m("Sites for "+F(s.client.name)+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[0]||(e[0]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(et,{dense:"",rows:n.sites,columns:n.columns,pagination:{rowsPerPage:0,sortBy:"name",descending:!1},"row-key":"id","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0],"no-data-label":"No Sites","table-class":{"table-bgcolor":!t.$q.dark.isActive,"table-bgcolor-dark":t.$q.dark.isActive},class:"settings-tbl-sticky",style:{height:"65vh"},loading:n.loading},{top:a(()=>[l(E,{label:"New",dense:"",flat:"",push:"",unelevated:"","no-caps":"",icon:"add",onClick:n.showAddSite},null,8,["onClick"])]),loading:a(()=>[l(en,{showing:"",color:"primary"})]),body:a(o=>[l(nt,{props:o,class:"cursor-pointer",onDblclick:r=>n.showEditSite(o.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:r=>n.showEditSite(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[1]||(e[1]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:r=>n.showSiteDeleteModal(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[2]||(e[2]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[3]||(e[3]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.name),1)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.agent_count),1)]),_:2},1024)]),_:2},1032,["props","onDblclick"])]),_:1},8,["rows","columns","table-class","loading"])]),_:1})]),_:1},8,["onHide"])}var pr=Te(fr,[["render",mr]]);const gr=[{name:"name",label:"Name",field:"name",align:"left"},{name:"sites",label:"Sites",field:"sites",align:"left"},{name:"agent_count",label:"Total Agents",field:"agent_count",align:"left"}],hr={name:"ClientsManager",emits:[...oe.emits],setup(){const t=Ie(),{dialogRef:e,onDialogHide:s}=oe(),n=M([]),i=M(!1);async function d(){i.value=!0,n.value=await ra(),i.value=!1}function o(y){y.agent_count>0?t.dialog({component:ha,componentProps:{object:y,type:"client"}}).onOk(d):t.dialog({title:"Are you sure?",message:`Delete client: ${y.name}.`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{i.value=!0;try{const w=await ia(y.id);Ve(w),await d()}catch(w){console.error(w)}i.value=!1})}function r(y){t.dialog({component:Rn,componentProps:{client:y}}).onOk(d)}function u(){t.dialog({component:Rn}).onOk(d)}function c(y){t.dialog({component:Gl,componentProps:{client:y.id}}).onOk(d)}function b(y){t.dialog({component:pr,componentProps:{client:y}})}return Le(d),{clients:n,loading:i,columns:gr,getClients:d,showClientDeleteModal:o,showEditClient:r,showAddClient:u,showAddSite:c,showSitesTable:b,dialogRef:e,onDialogHide:s}},components:{Icon:He}},yr={class:"card-header ac jsb"},br=["onClick"];function vr(t,e,s,n,i,d){const o=qe("Icon");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{width:"70vw"}},{default:a(()=>[g("div",yr,[e[2]||(e[2]=g("div",{class:"text-h6"},"Clients Manager",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[1]||(e[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(et,{rows:n.clients,columns:n.columns,"table-class":{"table-bgcolor":!t.$q.dark.isActive,"table-bgcolor-dark":t.$q.dark.isActive},class:"settings-tbl-sticky",style:{height:"70vh"},pagination:{rowsPerPage:0,sortBy:"name",descending:!1},dense:"","row-key":"id","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0],"no-data-label":"No Clients",loading:n.loading},{top:a(()=>[g("button",{class:"btn btn-primary ml-2",onClick:e[0]||(e[0]=(...r)=>n.showAddClient&&n.showAddClient(...r))},[l(o,{icon:"lucide:plus",class:"mr-2",width:"20",height:"20"}),e[3]||(e[3]=m(" New "))])]),loading:a(()=>[l(en,{showing:"",color:"primary"})]),body:a(r=>[l(nt,{props:r,class:"cursor-pointer",onDblclick:u=>n.showEditClient(r.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:u=>n.showEditClient(r.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[4]||(e[4]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:u=>n.showClientDeleteModal(r.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[5]||(e[5]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:u=>n.showAddSite(r.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"add"})]),_:1}),l(C,null,{default:a(()=>e[6]||(e[6]=[m("Add Site")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[7]||(e[7]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),l(J,null,{default:a(()=>[m(F(r.row.name),1)]),_:2},1024),l(J,null,{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},class:"text-primary",onClick:u=>n.showSitesTable(r.row)},"Show Sites ("+F(r.row.sites.length)+")",9,br)]),_:2},1024),l(J,null,{default:a(()=>[m(F(r.row.agent_count),1)]),_:2},1024)]),_:2},1032,["props","onDblclick"])]),_:1},8,["rows","columns","table-class","loading"])]),_:1})]),_:1},8,["onHide"])}var wr=Te(hr,[["render",vr]]);const kr={name:"UpdateAgents",emits:["close"],mixins:[it],data(){return{versions:[],version:null,agents:[],group:[],selectAll:!1}},methods:{selectAllAction(){this.selectAll?this.group=this.agentIds:this.group=[]},getVersions(){this.$q.loading.show(),this.$axios.get("/agents/versions/").then(t=>{this.versions=t.data.versions,this.version=t.data.versions[0],this.agents=t.data.agents,this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},update(){const t={agent_ids:this.group};this.$axios.post("/agents/update/",t).then(()=>{this.$emit("close"),this.notifySuccess("Agents will now be updated")})}},computed:{agentIds(){return this.agents.map(t=>t.agent_id)},agentOptions(){const t=[];for(let e of Object.values(this.agents)){let s={};s.label=`${e.hostname} (${e.client} > ${e.site})`,s.value=e.agent_id,t.push(s)}return t.sort((e,s)=>e.label.localeCompare(s.label))}},mounted(){this.getVersions()}},_r={class:"card-header ac jsb"};function Sr(t,e,s,n,i,d){return f(),p(ue,null,{default:a(()=>[g("div",_r,[e[4]||(e[4]=g("div",{class:"text-h6"},"Update Agents",-1)),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[3]||(e[3]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(de),e[8]||(e[8]=g("div",{class:"bg-blue-200 text-blue-700 p-2 rounded-md text-sm"}," Agents will automatically self update at 35 min past the hour, every hour. Use this tool to manually trigger an agent update cycle. ",-1)),l(I,null,{default:a(()=>[e[5]||(e[5]=m(" Select Version ")),l(Qe,{square:"",disable:"",dense:"","options-dense":"",outlined:"",modelValue:i.version,"onUpdate:modelValue":e[0]||(e[0]=o=>i.version=o),options:i.versions},null,8,["modelValue","options"])]),_:1}),O(l(I,null,{default:a(()=>[e[6]||(e[6]=m(" Select Agent ")),e[7]||(e[7]=g("br",null,null,-1)),l(de),l(W,{modelValue:i.selectAll,"onUpdate:modelValue":[e[1]||(e[1]=o=>i.selectAll=o),d.selectAllAction],label:"Select All"},null,8,["modelValue","onUpdate:modelValue"]),O(l(E,{label:"Update",color:"primary",onClick:d.update,class:"q-ml-xl"},null,8,["onClick"]),[[Ze,i.group.length!==0]]),l(de),l(St,{modelValue:i.group,"onUpdate:modelValue":e[2]||(e[2]=o=>i.group=o),options:d.agentOptions,color:"green",type:"checkbox",style:{"max-height":"60vh","max-width":"40vw"},class:"scroll"},null,8,["modelValue","options"])]),_:1},512),[[Ze,i.version!==null]])]),_:1})}var Vr=Te(kr,[["render",Sr]]);function Ft(t,e,s,n){const i=[];return t.forEach(d=>{n(d)===!0?i.push(d):e.push({failedPropValidation:s,file:d})}),i}function $l(t){t&&t.dataTransfer&&(t.dataTransfer.dropEffect="copy"),gl(t)}const Cr={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},Tr=["rejected"];function xr({editable:t,dnd:e,getFileInput:s,addFilesToQueue:n}){const{props:i,emit:d,proxy:o}=kl(),r=M(null),u=te(()=>i.accept!==void 0?i.accept.split(",").map(T=>(T=T.trim(),T==="*"?"*/":(T.endsWith("/*")&&(T=T.slice(0,T.length-1)),T.toUpperCase()))):null),c=te(()=>parseInt(i.maxFiles,10)),b=te(()=>parseInt(i.maxTotalSize,10));function y(T){if(t.value)if(T!==Object(T)&&(T={target:null}),T.target!==null&&T.target.matches('input[type="file"]')===!0)T.clientX===0&&T.clientY===0&&ri(T);else{const A=s();A&&A!==T.target&&A.click(T)}}function w(T){t.value&&T&&n(null,T)}function k(T,A,N,S){let q=Array.from(A||T.target.files);const P=[],H=()=>{P.length!==0&&d("rejected",P)};if(i.accept!==void 0&&u.value.indexOf("*/")===-1&&(q=Ft(q,P,"accept",L=>u.value.some(Z=>L.type.toUpperCase().startsWith(Z)||L.name.toUpperCase().endsWith(Z))),q.length===0))return H();if(i.maxFileSize!==void 0){const L=parseInt(i.maxFileSize,10);if(q=Ft(q,P,"max-file-size",Z=>Z.size<=L),q.length===0)return H()}if(i.multiple!==!0&&q.length!==0&&(q=[q[0]]),q.forEach(L=>{L.__key=L.webkitRelativePath+L.lastModified+L.name+L.size}),S===!0){const L=N.map(Z=>Z.__key);q=Ft(q,P,"duplicate",Z=>L.includes(Z.__key)===!1)}if(q.length===0)return H();if(i.maxTotalSize!==void 0){let L=S===!0?N.reduce((Z,fe)=>Z+fe.size,0):0;if(q=Ft(q,P,"max-total-size",Z=>(L+=Z.size,L<=b.value)),q.length===0)return H()}if(typeof i.filter=="function"){const L=i.filter(q);q=Ft(q,P,"filter",Z=>L.includes(Z))}if(i.maxFiles!==void 0){let L=S===!0?N.length:0;if(q=Ft(q,P,"max-files",()=>(L++,L<=c.value)),q.length===0)return H()}if(H(),q.length!==0)return q}function x(T){$l(T),e.value!==!0&&(e.value=!0)}function h(T){gl(T),(T.relatedTarget!==null||di.is.safari!==!0?T.relatedTarget!==r.value:document.elementsFromPoint(T.clientX,T.clientY).includes(r.value)===!1)===!0&&(e.value=!1)}function V(T){$l(T);const A=T.dataTransfer.files;A.length!==0&&n(null,A),e.value=!1}function D(T){if(e.value===!0)return ye("div",{ref:r,class:`q-${T}__dnd absolute-full`,onDragenter:$l,onDragover:$l,onDragleave:h,onDrop:V})}return Object.assign(o,{pickFiles:y,addFiles:w}),{pickFiles:y,addFiles:w,onDragover:x,onDragleave:h,processFiles:k,getDndNode:D,maxFilesNumber:c,maxTotalSizeNumber:b}}var Wn=wl({name:"QFile",inheritAttrs:!1,props:{...ui,...ci,...Cr,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...fi,...Tr],setup(t,{slots:e,emit:s,attrs:n}){const{proxy:i}=kl(),d=mi(),o=M(null),r=M(!1),u=pi(t),{pickFiles:c,onDragover:b,onDragleave:y,processFiles:w,getDndNode:k}=xr({editable:d.editable,dnd:r,getFileInput:le,addFilesToQueue:Y}),x=gi(t),h=te(()=>Object(t.modelValue)===t.modelValue?"length"in t.modelValue?Array.from(t.modelValue):[t.modelValue]:[]),V=te(()=>ms(h.value)),D=te(()=>h.value.map(v=>v.name).join(", ")),T=te(()=>yi(h.value.reduce((v,U)=>v+U.size,0))),A=te(()=>({totalSize:T.value,filesNumber:h.value.length,maxFiles:t.maxFiles})),N=te(()=>({tabindex:-1,type:"file",title:"",accept:t.accept,capture:t.capture,name:u.value,...n,id:d.targetUid.value,disabled:d.editable.value!==!0})),S=te(()=>"q-file q-field--auto-height"+(r.value===!0?" q-file--dnd":"")),q=te(()=>t.multiple===!0&&t.append===!0);function P(v){const U=h.value.slice();U.splice(v,1),L(U)}function H(v){const U=h.value.indexOf(v);U!==-1&&P(U)}function L(v){s("update:modelValue",t.multiple===!0?v:v[0])}function Z(v){v.keyCode===13&&bi(v)}function fe(v){(v.keyCode===13||v.keyCode===32)&&c(v)}function le(){return o.value}function Y(v,U){const Ce=w(v,U,h.value,q.value),$e=le();$e!=null&&($e.value=""),Ce!==void 0&&((t.multiple===!0?t.modelValue&&Ce.every(je=>h.value.includes(je)):t.modelValue===Ce[0])||L(q.value===!0?h.value.concat(Ce):Ce))}function X(){return[ye("input",{class:[t.inputClass,"q-file__filler"],style:t.inputStyle})]}function ne(){if(e.file!==void 0)return h.value.length===0?X():h.value.map((U,Ce)=>e.file({index:Ce,file:U,ref:this}));if(e.selected!==void 0)return h.value.length===0?X():e.selected({files:h.value,ref:this});if(t.useChips===!0)return h.value.length===0?X():h.value.map((U,Ce)=>ye(Xt,{key:"file-"+Ce,removable:d.editable.value,dense:!0,textColor:t.color,tabindex:t.tabindex,onRemove:()=>{P(Ce)}},()=>ye("span",{class:"ellipsis",textContent:U.name})));const v=t.displayValue!==void 0?t.displayValue:D.value;return v.length!==0?[ye("div",{class:t.inputClass,style:t.inputStyle,textContent:v})]:X()}function $(){const v={ref:o,...N.value,...x.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:Y};return t.multiple===!0&&(v.multiple=!0),ye("input",v)}return Object.assign(d,{fieldClass:S,emitValue:L,hasValue:V,inputRef:o,innerValue:h,floatingLabel:te(()=>V.value===!0||ms(t.displayValue)),computedCounter:te(()=>{if(t.counterLabel!==void 0)return t.counterLabel(A.value);const v=t.maxFiles;return`${h.value.length}${v!==void 0?" / "+v:""} (${T.value})`}),getControlChild:()=>k("file"),getControl:()=>{const v={ref:d.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:t.tabindex};return d.editable.value===!0&&Object.assign(v,{onDragover:b,onDragleave:y,onKeydown:Z,onKeyup:fe}),ye("div",v,[$()].concat(ne()))}}),Object.assign(i,{removeAtIndex:P,removeFile:H,getNativeElement:()=>o.value}),Cn(i,"nativeEl",()=>o.value),hi(d)}});const Ar={components:{TacticalDropdown:Fe},name:"ScriptModal",emits:[...oe.emits],props:{categories:!Array},setup(){const{dialogRef:t,onDialogHide:e,onDialogOK:s}=oe(),n=M({}),i=M(null),d=M(!1);be(i,r=>{if(r){const u=new FileReader;u.onloadend=()=>{n.value.script_body=u.result},u.readAsText(i.value)}else n.value.script_body=""});async function o(){d.value=!0;let r="";try{r=await ta(n.value),s(),Ve(r)}catch(u){console.error(u)}d.value=!1}return{script:n,file:i,loading:d,shellOptions:jn,agentPlatformOptions:da,submitForm:o,dialogRef:t,onDialogHide:e}}};function Or(t,e,s,n,i,d){const o=qe("tactical-dropdown");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{width:"40vw"}},{default:a(()=>[l(De,null,{default:a(()=>[e[10]||(e[10]=m(" Add Script ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[9]||(e[9]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(ct,{id:"scriptUploadForm",onSubmit:n.submitForm},{default:a(()=>[l(I,null,{default:a(()=>[l(ge,{label:"Name",outlined:"",dense:"",modelValue:n.script.name,"onUpdate:modelValue":e[0]||(e[0]=r=>n.script.name=r),rules:[r=>!!r||"*Required"]},null,8,["modelValue","rules"])]),_:1}),l(I,null,{default:a(()=>[l(ge,{label:"Description",outlined:"",dense:"",modelValue:n.script.description,"onUpdate:modelValue":e[1]||(e[1]=r=>n.script.description=r)},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(o,{modelValue:n.script.category,"onUpdate:modelValue":e[2]||(e[2]=r=>n.script.category=r),options:s.categories,label:"Category",hint:"Press Enter or Tab when adding a new value",outlined:"",filterable:"",clearable:"","new-value-mode":"add-unique"},null,8,["modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[l(Wn,{label:"Script Upload",modelValue:n.file,"onUpdate:modelValue":e[3]||(e[3]=r=>n.file=r),filled:"",dense:"",counter:""},{prepend:a(()=>[l(K,{name:"attach_file"})]),_:1},8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(o,{modelValue:n.script.shell,"onUpdate:modelValue":e[4]||(e[4]=r=>n.script.shell=r),options:n.shellOptions,label:"Type",outlined:"",mapOptions:""},null,8,["modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[l(o,{modelValue:n.script.supported_platforms,"onUpdate:modelValue":e[5]||(e[5]=r=>n.script.supported_platforms=r),options:n.agentPlatformOptions,label:"Supported Platforms (All supported if blank)",clearable:"",mapOptions:"",filled:"",multiple:""},null,8,["modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[l(o,{modelValue:n.script.args,"onUpdate:modelValue":e[6]||(e[6]=r=>n.script.args=r),label:"Script Arguments",placeholder:"(press Enter after typing each argument)",filled:"","use-input":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add"},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(o,{modelValue:n.script.env_vars,"onUpdate:modelValue":e[7]||(e[7]=r=>n.script.env_vars=r),label:"Environment Variables",placeholder:"(press Enter after typing each key=value pair)",filled:"","use-input":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add"},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(ge,{label:"Default Timeout",type:"number",outlined:"",dense:"",modelValue:n.script.default_timeout,"onUpdate:modelValue":e[8]||(e[8]=r=>n.script.default_timeout=r),modelModifiers:{number:!0},rules:[r=>r>=5||"Minimum is 5"]},null,8,["modelValue","rules"])]),_:1}),l(ze,null,{default:a(()=>[l(pe),O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{loading:n.loading,dense:"",flat:"",label:"Add",color:"primary",type:"submit"},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var qr=Te(Ar,[["render",Or]]);const $r={name:"TestScriptModal",components:{ScriptOutputCopyClip:To},emits:[...oe.emits],props:{script:!Object,agent:!String,ctx:!String},setup(t){const{dialogRef:e,onDialogHide:s}=oe(),n=M({execution_time:"",retcode:"",stdout:"",stderr:""}),i=M(!1);async function d(){i.value=!0;const o={code:t.script.script_body,timeout:t.script.default_timeout,args:t.script.args,shell:t.script.shell,run_as_user:t.script.run_as_user,env_vars:t.script.env_vars};try{t.ctx==="server"?n.value=await Wi(o):n.value=await Gi(t.agent,o)}catch(r){console.error(r)}i.value=!1}return Le(d),{ret:n,loading:i,runTestScript:d,dialogRef:e,onDialogHide:s}}},Rr={key:0},Dr={key:1};function Ur(t,e,s,n,i,d){const o=qe("script-output-copy-clip");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{"min-width":"65vw"}},{default:a(()=>[l(De,null,{default:a(()=>[e[1]||(e[1]=m(" Script Test ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[0]||(e[0]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(I,{style:{height:"70vh"},class:"scroll"},{default:a(()=>[g("div",null,[e[2]||(e[2]=m(" Run Time: ")),g("code",null,F(n.ret.execution_time)+" seconds",1),e[3]||(e[3]=g("br",null,null,-1)),e[4]||(e[4]=m("Return Code: ")),g("code",null,F(n.ret.retcode),1),e[5]||(e[5]=g("br",null,null,-1))]),e[6]||(e[6]=g("br",null,null,-1)),n.ret.stdout?(f(),ce("div",Rr,[l(o,{label:"Standard Output",data:n.ret.stdout},null,8,["data"]),l(de),g("pre",null,F(n.ret.stdout),1)])):G("",!0),n.ret.stderr?(f(),ce("div",Dr,[l(o,{label:"Standard Error",data:n.ret.stderr},null,8,["data"]),l(de),g("pre",null,F(n.ret.stderr),1)])):G("",!0),l(en,{showing:n.loading},null,8,["showing"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var Pr=Te($r,[["render",Ur]]);function ya(){return new Worker("/assets/ts.worker.50434d37.js",{type:"module"})}const Er={class:"q-pr-sm"},Mr={class:"row q-pa-sm"},Nr={class:"q-gutter-sm q-pr-sm"},Rl=Me({__name:"ScriptFormModal",props:{script:{},categories:{},readonly:{type:Boolean,default:!1},clone:{type:Boolean,default:!1}},emits:[...oe.emits],setup(t){self.MonacoEnvironment={getWorker:function(le,Y){switch(Y){case"json":return new pa;case"css":case"scss":case"less":return new ma;case"html":case"handlebars":case"razor":return new fa;case"typescript":case"javascript":return new ya;default:return new ca}}};const e=t,{dialogRef:s,onDialogHide:n,onDialogOK:i}=oe(),d=Ie(),o=Rt(),r=te(()=>o.state.openAIIntegrationEnabled),{agent:u,agentOptions:c,getAgentOptions:b}=Kn(),y=te(()=>o.state.hosted),w=te(()=>o.state.server_scripts_enabled),k=e.script?mt(Object.assign({},{...e.script,script_body:""})):mt({name:"",shell:"powershell",default_timeout:90,args:[],script_body:"",run_as_user:!1,env_vars:[]});e.clone&&(k.name=`(Copy) ${k.name}`);const x=M(!1),h=M(!1),V=te(()=>k.shell==="shell"||k.shell==="python"?!k.script_body.startsWith("#!"):!1),D=te(()=>e.script?e.readonly?`Viewing ${k.name}`:e.clone?`Copying ${k.name}`:`Editing ${k.name}`:"Adding new script"),T=te(()=>{switch(k.shell){case"cmd":return"bat";case"powershell":return"powershell";case"python":return"python";case"shell":case"nushell":return"shell";case"deno":return"typescript";default:return""}});async function A(){x.value=!0;let le="";try{e.script&&!e.clone?le=await On(k):le=await ta(k),i(),Ve(le)}catch(Y){console.error(Y)}x.value=!1}function N(le){if(le==="server"&&!k.script_body.startsWith("#!")){At("A shebang is required at the top of the script to specify the interpreter's path. Please ensure your script begins with a shebang line.",7e3);return}d.dialog({component:Pr,componentProps:{script:{...k},agent:u.value,ctx:le}})}const S=M(null);let q;function P(){var le=ot.createModel(k.script_body,T.value);const Y=d.dark.isActive?"vs-dark":"vs-light";q=ot.create(S.value,{readOnly:e.readonly,automaticLayout:!0,model:le,theme:Y}),q.onDidChangeModelContent(()=>{k.script_body=q.getValue()}),e.script?la(k.id,{with_snippets:e.readonly}).then(X=>{k.script_body=X.code,q.setValue(X.code),be(()=>k.script_body,()=>{Z.value=!0})}):be(()=>k.script_body,()=>{Z.value=!0}),be(T,()=>{ot.setModelLanguage(le,T.value)})}function H(){q.getModel()?.dispose(),q.dispose(),n()}function L(){d.dialog({title:"Ask ChatGPT what you need!",prompt:{model:`${T.value} code that `,type:"text"},cancel:!0,persistent:!0}).onOk(async le=>{const Y=await Xs({prompt:le});k.script_body=Y})}const Z=M(!1);function fe(){Z.value?d.dialog({title:"You have unsaved changes. Are you sure you want to close?",cancel:!0,ok:!0}).onOk(async()=>{H()}):H()}return Le(async()=>{h.value=!0,await b(),h.value=!1}),(le,Y)=>(f(),p(me,{ref_key:"dialogRef",ref:s,maximized:"","no-esc-dismiss":"",onHide:_(n),onShow:P,onBeforeHide:H,onKeydown:vi(qt(fe,["stop"]),["esc"])},{default:a(()=>[l(ue,{class:"q-dialog-plugin"},{default:a(()=>[l(De,null,{default:a(()=>[g("span",Er,F(D.value),1),!_(k)&&r.value?(f(),p(E,{key:0,size:"xs",disable:x.value,dense:"",label:"Generate Script",color:"primary","no-caps":"",onClick:L},null,8,["disable"])):G("",!0),l(pe),l(E,{dense:"",flat:"",icon:"close",onClick:fe},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>Y[13]||(Y[13]=[m("Close")])),_:1})]),_:1})]),_:1}),_(k).script_body&&V.value?(f(),p(Lo,{key:0,dense:"","inline-actions":"",class:"text-black bg-warning"},{avatar:a(()=>[l(K,{class:"text-center",name:"warning",color:"black"})]),default:a(()=>[Y[14]||(Y[14]=m("Shell/Python scripts on Linux/Mac need a shebang at the top of the script e.g. ")),Y[15]||(Y[15]=g("code",null,"#!/bin/bash",-1)),Y[16]||(Y[16]=m(" or ")),Y[17]||(Y[17]=g("code",null,"#!/usr/bin/python3",-1)),Y[18]||(Y[18]=g("br",null,null,-1)),Y[19]||(Y[19]=m("Add one to get rid of this warning. Ignore if windows. "))]),_:1})):G("",!0),g("div",Mr,[l(zn,{"thumb-style":{right:"4px",borderRadius:"5px",width:"5px",opacity:"0.75"},"bar-style":{right:"2px",borderRadius:"9px",width:"9px",opacity:"0.2"},class:"col-4 q-mb-none q-pb-none",style:Re({height:`${_(d).screen.height-106}px`})},{default:a(()=>[g("div",Nr,[l(ge,{filled:"",dense:"",readonly:le.readonly,modelValue:_(k).name,"onUpdate:modelValue":Y[0]||(Y[0]=X=>_(k).name=X),label:"Name",rules:[X=>!!X||"*Required"],"hide-bottom-space":""},null,8,["readonly","modelValue","rules"]),l(ge,{filled:"",dense:"",readonly:le.readonly,modelValue:_(k).description,"onUpdate:modelValue":Y[1]||(Y[1]=X=>_(k).description=X),label:"Description",type:"textarea",rows:"2"},null,8,["readonly","modelValue"]),l(Qe,{readonly:le.readonly,"options-dense":"",filled:"",dense:"",modelValue:_(k).shell,"onUpdate:modelValue":Y[2]||(Y[2]=X=>_(k).shell=X),options:_(jn),"emit-value":"","map-options":"",label:"Shell Type"},null,8,["readonly","modelValue","options"]),l(Fe,{modelValue:_(k).supported_platforms,"onUpdate:modelValue":Y[3]||(Y[3]=X=>_(k).supported_platforms=X),options:_(da),label:"Supported Platforms (All supported if blank)",clearable:"",mapOptions:"",filled:"",multiple:"",readonly:le.readonly},null,8,["modelValue","options","readonly"]),l(Fe,{filled:"",modelValue:_(k).category,"onUpdate:modelValue":Y[4]||(Y[4]=X=>_(k).category=X),options:le.categories,"use-input":"",clearable:"","new-value-mode":"add-unique",filterable:"",label:"Category",readonly:le.readonly,"hide-bottom-space":""},null,8,["modelValue","options","readonly"]),l(Fe,{modelValue:_(k).args,"onUpdate:modelValue":Y[5]||(Y[5]=X=>_(k).args=X),label:"Script Arguments (press Enter after typing each argument)",filled:"","use-input":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add",readonly:le.readonly},null,8,["modelValue","readonly"]),l(Fe,{modelValue:_(k).env_vars,"onUpdate:modelValue":Y[6]||(Y[6]=X=>_(k).env_vars=X),label:_(na),filled:"","use-input":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add",readonly:le.readonly},null,8,["modelValue","label","readonly"]),l(ge,{type:"number",filled:"",dense:"",readonly:le.readonly,modelValue:_(k).default_timeout,"onUpdate:modelValue":Y[7]||(Y[7]=X=>_(k).default_timeout=X),modelModifiers:{number:!0},label:"Timeout (seconds)",rules:[X=>X>=5||"Minimum is 5"],"hide-bottom-space":""},null,8,["readonly","modelValue","rules"]),l(W,{modelValue:_(k).run_as_user,"onUpdate:modelValue":Y[8]||(Y[8]=X=>_(k).run_as_user=X),label:"Run As User (Windows only)"},{default:a(()=>[l(j,null,{default:a(()=>Y[20]||(Y[20]=[m("Setting this value on the script model will always override any 'Run As User' checkboxes in the UI and force this script to always be run in the context of the logged in user. If no user is logged in, the script will run as SYSTEM. ")])),_:1})]),_:1},8,["modelValue"]),l(ge,{label:"Syntax",type:"textarea",style:{height:"150px","overflow-y":"auto",resize:"none"},modelValue:_(k).syntax,"onUpdate:modelValue":Y[9]||(Y[9]=X=>_(k).syntax=X),dense:"",filled:"",readonly:le.readonly},null,8,["modelValue","readonly"])])]),_:1},8,["style"]),g("div",{ref_key:"scriptEditor",ref:S,class:"col-8 q-mb-none q-pb-none",style:Re({height:`${_(d).screen.height-106}px`})},null,4)]),l(ze,null,{default:a(()=>[l(Fe,{style:{width:"450px"},dense:"",loading:h.value,filled:"",modelValue:_(u),"onUpdate:modelValue":Y[12]||(Y[12]=X=>wi(u)?u.value=X:null),options:_(c),label:"Agent to run test script on",mapOptions:"",filterable:""},{after:a(()=>[l(E,{size:"md",color:"primary",dense:"",flat:"",label:"Test Script",disable:!_(u)||!_(k).script_body||!_(k).default_timeout,onClick:Y[10]||(Y[10]=X=>N("agent"))},null,8,["disable"]),y.value?G("",!0):(f(),p(E,{key:0,size:"md",color:"secondary",dense:"",flat:"",label:"Test on Server",disable:!_(k).script_body||!_(k).default_timeout||!w.value,onClick:Y[11]||(Y[11]=X=>N("server"))},null,8,["disable"]))]),_:1},8,["loading","modelValue","options"]),l(pe),l(E,{dense:"",flat:"",label:"Cancel",onClick:fe}),le.readonly?G("",!0):(f(),p(E,{key:0,loading:x.value,dense:"",flat:"",label:"Save",color:"primary",onClick:A},null,8,["loading"]))]),_:1})]),_:1})]),_:1},8,["onHide","onKeydown"]))}}),Lr={class:"q-pr-sm"},Ir={class:"row"},ws=Me({__name:"ScriptSnippetFormModal",props:{snippet:{}},emits:[...oe.emits],setup(t){self.MonacoEnvironment={getWorker:function(T,A){switch(A){case"json":return new pa;case"css":case"scss":case"less":return new ma;case"html":case"handlebars":case"razor":return new fa;case"typescript":case"javascript":return new ya;default:return new ca}}};const e=t,{dialogRef:s,onDialogHide:n,onDialogOK:i}=oe(),d=Ie(),o=Rt(),r=te(()=>o.state.openAIIntegrationEnabled),u=e.snippet?mt(Object.assign({},e.snippet)):mt({name:"",code:"",shell:"powershell"}),c=M(!1),b=te(()=>e.snippet?`Editing ${u.name}`:"Adding New Script Snippet"),y=te(()=>{switch(u.shell){case"cmd":return"bat";case"powershell":return"powershell";case"python":return"python";case"shell":case"nushell":return"shell";case"deno":return"typescript";default:return""}});async function w(){c.value=!0;try{const T=e.snippet?await Ji(u):await Yi(u);i(),Ve(T)}catch(T){console.error(T)}c.value=!1}const k=M(null);let x;function h(){var T=ot.createModel(u.code,y.value);const A=d.dark.isActive?"vs-dark":"vs-light";x=ot.create(k.value,{automaticLayout:!0,model:T,theme:A}),x.onDidChangeModelContent(()=>{u.code=x.getValue()}),be(y,()=>{ot.setModelLanguage(T,y.value)})}function V(){x.getModel()?.dispose(),x.dispose(),n()}function D(){d.dialog({title:"Ask ChatGPT what you need!",prompt:{model:`${y.value} code that `,type:"text"},cancel:!0,persistent:!0}).onOk(async T=>{const A=await Xs({prompt:T});u.code=A})}return(T,A)=>(f(),p(me,{ref_key:"dialogRef",ref:s,maximized:"",onHide:_(n),onShow:h,onBeforeHide:V},{default:a(()=>[l(ue,{class:"q-dialog-plugin"},{default:a(()=>[l(De,null,{default:a(()=>[g("span",Lr,F(b.value),1),!_(u)&&r.value?(f(),p(E,{key:0,disable:c.value,dense:"",size:"xs",label:"Generate Script",color:"primary","no-caps":"",onClick:D},null,8,["disable"])):G("",!0),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>A[3]||(A[3]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),g("div",Ir,[l(ge,{rules:[N=>!!N||"*Required"],class:"q-pa-sm col-4",modelValue:_(u).name,"onUpdate:modelValue":A[0]||(A[0]=N=>_(u).name=N),label:"Name",filled:"",dense:""},null,8,["rules","modelValue"]),l(Qe,{modelValue:_(u).shell,"onUpdate:modelValue":A[1]||(A[1]=N=>_(u).shell=N),options:_(jn),class:"q-pa-sm col-2",label:"Shell Type","options-dense":"",filled:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options"]),l(ge,{class:"q-pa-sm col-6",filled:"",dense:"",modelValue:_(u).desc,"onUpdate:modelValue":A[2]||(A[2]=N=>_(u).desc=N),label:"Description"},null,8,["modelValue"])]),g("div",{ref_key:"snippetEditor",ref:k,style:Re({height:`${_(d).screen.height-132}px`})},null,4),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{loading:c.value,dense:"",flat:"",label:"Save",color:"primary",onClick:w},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),Br=[{name:"shell",label:"Shell",field:"shell",align:"left",sortable:!0},{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"desc",label:"Description",field:"description",align:"left",sortable:!1}],Hr={name:"ScriptSnippetManager",emits:[...oe.emits],setup(){const{dialogRef:t,onDialogHide:e}=oe(),s=Ie(),n=M([]);async function i(){o.value=!0;try{n.value=await Xi()}catch(c){console.error(c)}o.value=!1}function d(c){s.dialog({title:`Delete script snippet: ${c.name}?`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{o.value=!0;try{const b=await Zi(c.id);Ve(b),i()}catch{}o.value=!1})}const o=M(!1);function r(){s.dialog({component:ws}).onOk(()=>{i()})}function u(c){s.dialog({component:ws,componentProps:{snippet:c}}).onOk(i)}return Le(i),{snippets:n,loading:o,columns:Br,getSnippets:i,deleteSnippet:d,newSnippetModal:r,editSnippetModal:u,dialogRef:t,onDialogHide:e}}};function Fr(t,e,s,n,i,d){return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:Re({width:`${t.$q.screen.width-300}px`,"max-width":`${t.$q.screen.width-300}px`,height:`${t.$q.screen.height-300}px`,"max-height":`${t.$q.screen.height-300}px`})},{default:a(()=>[l(De,null,{default:a(()=>[l(E,{onClick:n.getSnippets,class:"q-mr-sm",dense:"",flat:"",push:"",icon:"refresh"},null,8,["onClick"]),e[1]||(e[1]=m("Script Snippets ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[0]||(e[0]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(et,{dense:"","table-class":{"table-bgcolor":!t.$q.dark.isActive,"table-bgcolor-dark":t.$q.dark.isActive},style:Re({"max-height":`${t.$q.screen.height-300-32}px`}),class:"tbl-sticky",rows:n.snippets,columns:n.columns,loading:n.loading,pagination:{rowsPerPage:0,sortBy:"name",descending:!0},"row-key":"id","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0]},{top:a(()=>[l(E,{dense:"",flat:"","no-caps":"",icon:"add",label:"New",onClick:n.newSnippetModal},null,8,["onClick"])]),"header-cell-shell":a(o=>[l(Ke,{props:o,"auto-width":""},{default:a(()=>e[2]||(e[2]=[m(" Shell ")])),_:2},1032,["props"])]),body:a(o=>[l(nt,{props:o,onDblclick:r=>n.editSnippetModal(o.row),class:"cursor-pointer"},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:r=>n.editSnippetModal(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[3]||(e[3]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:r=>n.deleteSnippet(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[4]||(e[4]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[5]||(e[5]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),l(J,null,{default:a(()=>[o.row.shell==="powershell"?(f(),p(K,{key:0,name:"mdi-powershell",color:"primary",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[6]||(e[6]=[m(" Powershell ")])),_:1})]),_:1})):o.row.shell==="python"?(f(),p(K,{key:1,name:"mdi-language-python",color:"primary",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[7]||(e[7]=[m(" Python ")])),_:1})]),_:1})):o.row.shell==="cmd"?(f(),p(K,{key:2,name:"mdi-microsoft-windows",color:"primary",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[8]||(e[8]=[m(" Batch ")])),_:1})]),_:1})):o.row.shell==="shell"?(f(),p(K,{key:3,name:"mdi-bash",color:"primary",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[9]||(e[9]=[m(" Shell ")])),_:1})]),_:1})):o.row.shell==="nushell"?(f(),p(K,{key:4,name:"mdi-nushell",color:"primary",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[10]||(e[10]=[m(" Nushell ")])),_:1})]),_:1})):o.row.shell==="deno"?(f(),p(K,{key:5,name:"mdi-typescript",color:"primary",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[11]||(e[11]=[m(" Deno ")])),_:1})]),_:1})):G("",!0)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.name),1)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.desc),1)]),_:2},1024)]),_:2},1032,["props","onDblclick"])]),_:1},8,["table-class","style","rows","columns","loading"])]),_:1},8,["style"])]),_:1},8,["onHide"])}var jr=Te(Hr,[["render",Fr]]);const Kr=Me({inheritAttrs:!1}),zr=Me({...Kr,__name:"TacticalTable",props:{columns:{},columnSelect:{type:Boolean,default:!1},excludeColumns:{default:()=>["columnSelect"]}},setup(t){const e=t,s=Object.assign([],e.columns);e.columnSelect&&s.push({name:"columnSelect",label:"Column Select",field:"columnSelect"});const n=M(s.map(d=>d.name)),i=M(s.filter(d=>!e.excludeColumns.includes(d.name)).map(d=>({label:d.label,value:d.name})));return(d,o)=>(f(),p(et,Il({columns:_(s),"visible-columns":n.value,"table-class":{"table-bgcolor":!d.$q.dark.isActive,"table-bgcolor-dark":d.$q.dark.isActive,"column-bgcolor-dark":d.$q.dark.isActive&&d.columnSelect,"column-bgcolor":!d.$q.dark.isActive&&d.columnSelect,"sticky-header-right-column":d.columnSelect,"tbl-sticky":!d.columnSelect}},d.$attrs),ki({"header-cell-columnSelect":a(r=>[l(Ke,{props:r,"auto-width":""},{default:a(()=>[l(E,{dense:"",flat:"",icon:"more_horiz"},{default:a(()=>[l(Ne,null,{default:a(()=>[l(St,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=u=>n.value=u),options:i.value,type:"checkbox"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:2},1032,["props"])]),_:2},[lt(d.$slots,(r,u)=>({name:u,fn:a(c=>[zl(d.$slots,u,Tn(xn(c||{})))])}))]),1040,["columns","visible-columns","table-class"]))}}),Qr=[{name:"favorite",label:"Favorites",field:"favorite",align:"left",sortable:!0},{name:"shell",label:"Shell",field:"shell",align:"left",sortable:!0},{name:"supported_platforms",label:"Platforms",field:"supported_platforms",align:"left",sortable:!0},{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"args",label:"Default Args",field:"args",align:"left",sortable:!0},{name:"category",label:"Category",field:"category",align:"left",sortable:!0},{name:"desc",label:"Description",field:"description",align:"left",sortable:!1},{name:"default_timeout",label:"Default Timeout (seconds)",field:"default_timeout",align:"left",sortable:!0}],Wr={name:"ScriptManager",components:{TacticalTable:zr,Icon:He},emits:[...oe.emits],setup(){const t=Rt(),e=te(()=>t.state.showCommunityScripts),{dialogRef:s,onDialogHide:n}=oe(),i=Ie(),d=M([]),o=M(!1);async function r(){h.value=!0;try{d.value=await eo({showHiddenScripts:!0})}catch(L){console.error(L)}h.value=!1}async function u(L){h.value=!0;const Z=L.favorite?"Policy was removed as a favorite!":"Policy was favorited!";try{await On({id:L.id,favorite:!L.favorite}),await r(),Ve(Z)}catch{}h.value=!1}async function c(L){h.value=!0;const Z=L.hidden?"Policy was unhidden!":"Policy was hidden!";try{await On({id:L.id,hidden:!L.hidden}),await r(),Ve(Z)}catch{}h.value=!1}function b(L){i.dialog({title:`Delete script: ${L.name}?`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{h.value=!0;try{const Z=await to(L.id);Ve(Z),r()}catch{}h.value=!1})}async function y(L){h.value=!0;try{const{code:Z,filename:fe}=await la(L.id);yl(fe,new Blob([Z]),{mimeType:"text/plain;charset=utf-8"})}catch(Z){console.error(Z)}h.value=!1}const w=M(""),k=M(!0),x=M([]),h=M(!1),V=te(()=>o.value?e.value?d.value:d.value.filter(L=>L.script_type!=="builtin"):e.value?d.value.filter(L=>!L.hidden):d.value.filter(L=>L.script_type!=="builtin"&&!L.hidden)),D=te(()=>{let L=[];return V.value.forEach(Z=>{!!Z.category&&!L.includes(Z.category)&&L.push(Z.category)}),L}),T=te(()=>{if(k.value||V.value.length===0)return[];{let L=[],Z=Object.assign([],V.value),fe=Object.assign([],D.value);fe.push("Unassigned");const le=fe.sort(),Y=Z.sort(function(X,ne){const $=X.name.toUpperCase(),v=ne.name.toUpperCase();return $<v?-1:$>v?1:0});return le.forEach(X=>{let ne={icon:"folder",iconColor:"yellow-9",label:X,selectable:!1,id:X,children:[]};for(let $=0;$<Y.length;$++)Y[$].category===X?ne.children.push({label:Y[$].name,header:"script",...Y[$]}):X==="Unassigned"&&!Y[$].category&&ne.children.push({label:Y[$].name,header:"script",...Y[$]});L.push(ne)}),L}});be(k,()=>{x.value=[]});function A(L){i.dialog({component:Rl,componentProps:{script:L,readonly:!0}})}function N(){i.dialog({component:Rl,componentProps:{categories:D.value,readonly:!1}}).onOk(()=>{r()})}function S(L){i.dialog({component:Rl,componentProps:{script:L,categories:D.value,readonly:!1}}).onOk(()=>{r()})}function q(L){i.dialog({component:Rl,componentProps:{script:L,categories:D.value,readonly:!1,clone:!0}}).onOk(()=>{r()})}function P(){i.dialog({component:qr,componentProps:{categories:D.value}}).onOk(()=>{r()})}function H(){i.dialog({component:jr})}return Le(r),{search:w,tableView:k,expanded:x,loading:h,showCommunityScripts:e,showHiddenScripts:o,trmmLogo:_i,visibleScripts:V,columns:Qr,getScripts:r,deleteScript:b,favoriteScript:u,hideScript:c,exportScript:y,viewCodeModal:A,newScriptModal:N,editScriptModal:S,cloneScriptModal:q,uploadScriptModal:P,ScriptSnippetModal:H,tree:T,setShowCommunityScripts:L=>t.dispatch("setShowCommunityScripts",L),truncateText:Is,capitalize:zt,dialogRef:s,onDialogHide:n}}},Gr={class:"card-header ac jsb"},Jr={class:"row ac ps-3"},Yr=["onDblclick"],Xr=["src"],Zr={class:"q-pl-xs"},ed=["src"],td={key:0};function ld(t,e,s,n,i,d){const o=qe("Icon"),r=qe("tactical-table");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",id:"script-manager-card",style:Re({width:`${t.$q.screen.width-100}px`,"max-width":`${t.$q.screen.width-100}px`,height:`${t.$q.screen.height-100}px`,"max-height":`${t.$q.screen.height-100}px`})},{default:a(()=>[g("div",Gr,[e[7]||(e[7]=g("div",{class:"text-h6"},"Policies Manager",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[6]||(e[6]=[m("Close")])),_:1})]),_:1})),[[R]])]),g("div",Jr,[l(Zt,{class:"btn btn-primary btn-sm",icon:"add",label:"New","no-caps":"",dense:"",flat:""},{default:a(()=>[l(Se,{dense:""},{default:a(()=>[O((f(),p(B,{class:"headers-item",clickable:"",onClick:n.newScriptModal},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(o,{icon:"lucide:plus",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>e[8]||(e[8]=[m("New Policy")])),_:1})]),_:1})]),_:1},8,["onClick"])),[[R]]),O((f(),p(B,{class:"headers-item",clickable:"",onClick:n.uploadScriptModal},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(o,{icon:"lucide:upload",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>e[9]||(e[9]=[m("Upload Policy")])),_:1})]),_:1})]),_:1},8,["onClick"])),[[R]])]),_:1})]),_:1}),g("button",{class:"btn btn-none-primary ac gap-2",onClick:e[0]||(e[0]=(...u)=>n.ScriptSnippetModal&&n.ScriptSnippetModal(...u))},[l(o,{icon:"lucide:code",class:"icon",width:"20",height:"20"}),e[10]||(e[10]=g("span",null,"Policy Snippets",-1))]),g("button",{class:"btn btn-none-primary ac gap-2",onClick:e[1]||(e[1]=u=>n.tableView=!n.tableView)},[l(o,{icon:"lucide:folder",class:"icon",width:"20",height:"20"}),g("span",null,F(n.tableView?"Folder View":"Table View"),1)]),g("button",{class:"btn btn-none-primary ac gap-2",onClick:e[2]||(e[2]=u=>n.setShowCommunityScripts(!n.showCommunityScripts))},[l(o,{icon:n.showCommunityScripts?"lucide:eye-off":"lucide:eye",class:"icon",width:"20",height:"20"},null,8,["icon"]),g("span",null,F(n.showCommunityScripts?"Hide Community Policies":"Show Community Policies"),1)]),g("button",{class:"btn btn-none-primary ac gap-2",onClick:e[3]||(e[3]=u=>n.showHiddenScripts=!n.showHiddenScripts)},[l(o,{icon:n.showHiddenScripts?"lucide:eye-off":"lucide:eye",class:"icon",width:"20",height:"20"},null,8,["icon"]),g("span",null,F(n.showHiddenScripts?"Hide Hidden Policies":"Show Hidden Policies"),1)]),l(pe),l(ge,{modelValue:n.search,"onUpdate:modelValue":e[4]||(e[4]=u=>n.search=u),style:{width:"300px"},label:"Search",dense:"",outlined:"",clearable:"",class:"q-pr-md q-pb-xs"},{prepend:a(()=>[l(K,{name:"search",color:"primary"})]),_:1},8,["modelValue"])]),n.tableView?G("",!0):(f(),ce("div",{key:0,class:"scroll q-pl-xs mt-1",style:Re({"max-height":`${t.$q.screen.height-182}px`,"min-height":`${t.$q.screen.height-382}px`})},[l(nn,{ref:"folderTree",nodes:n.tree,filter:n.search,"no-connectors":"","node-key":"id",expanded:n.expanded,"onUpdate:expanded":e[5]||(e[5]=u=>n.expanded=u),"no-results-label":"No Policy Found","no-nodes-label":"No Policy Found"},{"header-script":a(u=>[g("div",{class:"cursor-pointer",onDblclick:c=>u.node.script_type==="builtin"?n.viewCodeModal(u.node):n.editScriptModal(u.node)},[u.node.favorite?(f(),p(K,{key:0,color:"yellow-8",name:"star",size:"sm",class:"q-px-sm"})):(f(),p(K,{key:1,color:"yellow-8",name:"star_outline",size:"sm",class:"q-px-sm"})),u.node.shell==="powershell"?(f(),p(K,{key:2,name:"mdi-powershell",color:"primary"},{default:a(()=>[l(j,null,{default:a(()=>e[11]||(e[11]=[m(" Powershell ")])),_:1})]),_:1})):u.node.shell==="python"?(f(),p(K,{key:3,name:"mdi-language-python",color:"primary"},{default:a(()=>[l(j,null,{default:a(()=>e[12]||(e[12]=[m(" Python ")])),_:1})]),_:1})):u.node.shell==="cmd"?(f(),p(K,{key:4,name:"mdi-microsoft-windows",color:"primary"},{default:a(()=>[l(j,null,{default:a(()=>e[13]||(e[13]=[m(" Batch ")])),_:1})]),_:1})):u.node.shell==="shell"?(f(),p(K,{key:5,name:"mdi-bash",color:"primary"},{default:a(()=>[l(j,null,{default:a(()=>e[14]||(e[14]=[m(" Shell ")])),_:1})]),_:1})):u.node.shell==="nushell"?(f(),p(K,{key:6,name:"mdi-code-greater-than",color:"primary"},{default:a(()=>[l(j,null,{default:a(()=>e[15]||(e[15]=[m(" Nushell ")])),_:1})]),_:1})):u.node.shell==="deno"?(f(),p(K,{key:7,name:"mdi-language-typescript",color:"primary"},{default:a(()=>[l(j,null,{default:a(()=>e[16]||(e[16]=[m(" Deno ")])),_:1})]),_:1})):G("",!0),u.node.script_type==="builtin"?(f(),ce("img",{key:8,class:"vertical-middle",src:n.trmmLogo,style:{height:"20px","max-width":"20px"}},null,8,Xr)):G("",!0),g("span",{class:"q-pl-xs text-weight-bold",style:Re({color:u.node.hidden?"grey":""})},F(u.node.name),5),g("span",Zr,F(u.node.description),1)],40,Yr),l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:c=>n.viewCodeModal(u.node)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"remove_red_eye"})]),_:1}),l(C,null,{default:a(()=>e[17]||(e[17]=[m("View Code")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:c=>n.cloneScriptModal(u.node)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"content_copy"})]),_:1}),l(C,null,{default:a(()=>e[18]||(e[18]=[m("Clone")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:c=>n.editScriptModal(u.node),disable:u.node.script_type==="builtin"},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[19]||(e[19]=[m("Edit")])),_:1})]),_:2},1032,["onClick","disable"])),[[R]]),O((f(),p(B,{clickable:"",onClick:c=>n.deleteScript(u.node),disable:u.node.script_type==="builtin"},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[20]||(e[20]=[m("Delete")])),_:1})]),_:2},1032,["onClick","disable"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:c=>n.favoriteScript(u.node)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"star"})]),_:1}),l(C,null,{default:a(()=>[m(F(u.node.favorite?"Remove as Favorite":"Add as Favorite"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:c=>n.exportScript(u.node)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"cloud_download"})]),_:1}),l(C,null,{default:a(()=>e[21]||(e[21]=[m("Download Policy")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:c=>n.hideScript(u.node)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:u.node.hidden?"visibility":"visibility_off"},null,8,["name"])]),_:2},1024),l(C,null,{default:a(()=>[m(F(u.node.hidden?"Show Policy":"Hide Policy"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[22]||(e[22]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024)]),_:1},8,["nodes","filter","expanded"])],4)),n.tableView?(f(),p(r,{key:1,dense:"",style:Re({"max-height":`${t.$q.screen.height-182}px`}),rows:n.visibleScripts,columns:n.columns,loading:n.loading,pagination:{rowsPerPage:0,sortBy:"favorite",descending:!0},filter:n.search,"row-key":"id","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0],"column-select":""},{"header-cell-favorite":a(u=>[l(Ke,{props:u,"auto-width":""},{default:a(()=>[l(K,{name:"star",color:"yellow-8",size:"sm"})]),_:2},1032,["props"])]),"header-cell-shell":a(u=>[l(Ke,{props:u,"auto-width":""},{default:a(()=>e[23]||(e[23]=[m(" Shell ")])),_:2},1032,["props"])]),"no-data":a(()=>e[24]||(e[24]=[m(" No Policies Found ")])),body:a(u=>[l(nt,{props:u,onDblclick:c=>u.row.script_type==="builtin"?n.viewCodeModal(u.row):n.editScriptModal(u.row),class:"cursor-pointer"},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:c=>n.viewCodeModal(u.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"remove_red_eye"})]),_:1}),l(C,null,{default:a(()=>e[25]||(e[25]=[m("View Code")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:c=>n.cloneScriptModal(u.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"content_copy"})]),_:1}),l(C,null,{default:a(()=>e[26]||(e[26]=[m("Clone")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:c=>n.editScriptModal(u.row),disable:u.row.script_type==="builtin"},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[27]||(e[27]=[m("Edit")])),_:1})]),_:2},1032,["onClick","disable"])),[[R]]),O((f(),p(B,{clickable:"",onClick:c=>n.deleteScript(u.row),disable:u.row.script_type==="builtin"},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[28]||(e[28]=[m("Delete")])),_:1})]),_:2},1032,["onClick","disable"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:c=>n.favoriteScript(u.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"star"})]),_:1}),l(C,null,{default:a(()=>[m(F(u.row.favorite?"Remove as Favorite":"Add as Favorite"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:c=>n.exportScript(u.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"cloud_download"})]),_:1}),l(C,null,{default:a(()=>e[29]||(e[29]=[m("Download Policy")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:c=>n.hideScript(u.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:u.row.hidden?"visibility":"visibility_off"},null,8,["name"])]),_:2},1024),l(C,null,{default:a(()=>[m(F(u.row.hidden?"Show Policy":"Hide Policy"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[30]||(e[30]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),l(J,{key:"favorite",props:u},{default:a(()=>[u.row.favorite?(f(),p(K,{key:0,color:"yellow-8",name:"star",size:"sm"})):G("",!0)]),_:2},1032,["props"]),l(J,{key:"shell",props:u},{default:a(()=>[u.row.shell==="powershell"?(f(),p(K,{key:0,name:"mdi-powershell",color:"primary",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[31]||(e[31]=[m(" Powershell ")])),_:1})]),_:1})):u.row.shell==="python"?(f(),p(K,{key:1,name:"mdi-language-python",color:"primary",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[32]||(e[32]=[m(" Python ")])),_:1})]),_:1})):u.row.shell==="cmd"?(f(),p(K,{key:2,name:"mdi-microsoft-windows",color:"primary",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[33]||(e[33]=[m(" Batch ")])),_:1})]),_:1})):u.row.shell==="shell"?(f(),p(K,{key:3,size:"sm",name:"mdi-bash",color:"primary"},{default:a(()=>[l(j,null,{default:a(()=>e[34]||(e[34]=[m(" Shell ")])),_:1})]),_:1})):u.row.shell==="nushell"?(f(),p(K,{key:4,size:"sm",name:"mdi-code-greater-than",color:"primary"},{default:a(()=>[l(j,null,{default:a(()=>e[35]||(e[35]=[m(" Nushell ")])),_:1})]),_:1})):u.row.shell==="deno"?(f(),p(K,{key:5,size:"sm",name:"mdi-language-typescript",color:"primary"},{default:a(()=>[l(j,null,{default:a(()=>e[36]||(e[36]=[m(" Deno ")])),_:1})]),_:1})):G("",!0)]),_:2},1032,["props"]),l(J,{key:"supported_platforms",props:u},{default:a(()=>[!u.row.supported_platforms||u.row.supported_platforms.length===0?(f(),p(pt,{key:0},{default:a(()=>e[37]||(e[37]=[m("All")])),_:1})):(f(!0),ce(at,{key:1},lt(u.row.supported_platforms,c=>(f(),p(pt,{key:c,color:"primary",class:"p-1 m-1"},{default:a(()=>[m(F(n.capitalize(c)),1)]),_:2},1024))),128))]),_:2},1032,["props"]),l(J,{key:"name",props:u,style:Re({color:u.row.hidden?"grey":""})},{default:a(()=>[u.row.script_type==="builtin"?(f(),ce("img",{key:0,src:n.trmmLogo,style:{height:"20px","max-width":"20px"}},null,8,ed)):G("",!0),m(" "+F(n.truncateText(u.row.name,50))+" ",1),u.row.name.length>=50?(f(),p(j,{key:1,style:{"font-size":"12px"}},{default:a(()=>[m(F(u.row.name),1)]),_:2},1024)):G("",!0),l(j,{delay:600},{default:a(()=>[m("ID: "+F(u.row.id),1)]),_:2},1024)]),_:2},1032,["props","style"]),l(J,{key:"args",props:u},{default:a(()=>[u.row.args.length>0?(f(),ce("span",td,[m(F(n.truncateText(u.row.args.toString(),30))+" ",1),u.row.args.toString().length>=30?(f(),p(j,{key:0,style:{"font-size":"12px"}},{default:a(()=>[m(F(u.row.args),1)]),_:2},1024)):G("",!0)])):G("",!0)]),_:2},1032,["props"]),l(J,{key:"category",props:u},{default:a(()=>[m(F(u.row.category),1)]),_:2},1032,["props"]),l(J,{key:"desc",props:u},{default:a(()=>[m(F(n.truncateText(u.row.description,30))+" ",1),u.row.description.length>=30?(f(),p(j,{key:0,style:{"font-size":"12px"}},{default:a(()=>[m(F(u.row.description),1)]),_:2},1024)):G("",!0)]),_:2},1032,["props"]),l(J,{key:"default_timeout",props:u},{default:a(()=>[m(F(u.row.default_timeout),1)]),_:2},1032,["props"]),l(J)]),_:2},1032,["props","onDblclick"])]),_:1},8,["style","rows","columns","loading","filter"])):G("",!0)]),_:1},8,["style"])]),_:1},8,["onHide"])}var nd=Te(Wr,[["render",ld]]),sd=wl({name:"QStepperNavigation",setup(t,{slots:e}){return()=>ye("div",{class:"q-stepper__nav"},Bn(e.default))}});async function ad(t,e){const{data:s}=await Ae.put(`alerts/templates/${t}/`,e);return s}async function id(t){const{data:e}=await Ae.post("alerts/templates/",t);return e}const od={class:"col-4 q-mb-sm"},rd={class:"col-3 q-mb-sm"},dd={class:"col-4 q-mb-md"},ud={class:"col-3 q-mb-sm"},cd={class:"q-pl-md text-subtitle1"},fd={style:{"text-decoration":"underline",cursor:"help"}},md={class:"q-pl-md text-subtitle1"},pd={style:{"text-decoration":"underline",cursor:"help"}},gd={class:"q-pl-md text-subtitle1"},hd={style:{"text-decoration":"underline",cursor:"help"}},yd={class:"q-pl-md text-subtitle1"},bd={style:{"text-decoration":"underline",cursor:"help"}},vd={class:"q-pl-md text-subtitle1"},wd={style:{"text-decoration":"underline",cursor:"help"}},kd={class:"q-pl-md text-subtitle1"},_d={style:{"text-decoration":"underline",cursor:"help"}},Sd={class:"q-pl-md text-subtitle1"},Vd={style:{"text-decoration":"underline",cursor:"help"}},Cd={class:"q-pl-md text-subtitle1"},Td={style:{"text-decoration":"underline",cursor:"help"}},xd={class:"q-pl-md text-subtitle1"},Ad={style:{"text-decoration":"underline",cursor:"help"}},ks=Me({__name:"AlertTemplateForm",props:{alertTemplate:{}},emits:[...oe.emits],setup(t){const e=Rt(),s=te(()=>e.state.hosted),n=te(()=>e.state.server_scripts_enabled),i=t,{dialogRef:d,onDialogHide:o,onDialogOK:r}=oe(),u=Ie(),c=M(1),{script:b,defaultArgs:y,defaultEnvVars:w,defaultTimeout:k,serverScriptOptions:x,scriptOptions:h}=qn({script:i.alertTemplate?.action,onMount:!0}),{script:V,defaultArgs:D,defaultEnvVars:T,defaultTimeout:A}=qn({script:i.alertTemplate?.resolved_action,onMount:!0}),{restActionOptions:N}=lo({onMount:!0}),S=i.alertTemplate?mt(Object.assign({},{...i.alertTemplate})):mt({id:0,name:"",is_active:!0,action_type:"script",action:b,action_rest:void 0,action_args:y,action_env_vars:w,action_timeout:k,resolved_action_type:"script",resolved_action:V,resolved_action_rest:void 0,resolved_action_args:D,resolved_action_env_vars:T,resolved_action_timeout:A,email_recipients:[],email_from:"",text_recipients:[],agent_email_on_resolved:!1,agent_text_on_resolved:!1,agent_always_email:null,agent_always_text:null,agent_always_alert:null,agent_periodic_alert_days:0,agent_script_actions:!0,check_email_alert_severity:[],check_text_alert_severity:[],check_dashboard_alert_severity:[],check_email_on_resolved:!1,check_text_on_resolved:!1,check_always_email:null,check_always_text:null,check_always_alert:null,check_periodic_alert_days:0,check_script_actions:!0,task_email_alert_severity:[],task_text_alert_severity:[],task_dashboard_alert_severity:[],task_email_on_resolved:!1,task_text_on_resolved:!1,task_always_email:null,task_always_text:null,task_always_alert:null,task_periodic_alert_days:0,task_script_actions:!0});be(()=>S.action_type,()=>{S.action_rest=void 0,S.action=void 0,S.action_args=[],S.action_env_vars=[],S.action_timeout=30}),be(()=>S.resolved_action_type,()=>{S.resolved_action_rest=void 0,S.resolved_action=void 0,S.resolved_action_args=[],S.resolved_action_env_vars=[],S.resolved_action_timeout=30}),i.alertTemplate&&(be(()=>S.action,$=>{$&&(b.value=$,pl(()=>{S.action_args=y.value,S.action_env_vars=w.value,S.action_timeout=k.value}))}),be(()=>S.resolved_action,$=>{$&&(V.value=$,pl(()=>{S.resolved_action_args=D.value,S.resolved_action_env_vars=T.value,S.resolved_action_timeout=A.value}))}));const q=[{label:"Error",value:"error"},{label:"Warning",value:"warning"},{label:"Informational",value:"info"}],P=[{label:"Send a Web Hook",value:"rest"},{label:"Run script on Agent",value:"script"},{label:"Run script on TRMM Server",value:"server"}],H=te(()=>s.value?P.filter(v=>v.value!=="server"):P.map(v=>!n.value&&v.value==="server"?{...v,disable:!0}:v)),L=M(null);function Z(){u.dialog({title:"Add email",prompt:{model:"",isValid:$=>Si($),type:"email"},cancel:!0,ok:{label:"Add",color:"primary"},persistent:!1}).onOk($=>{S.email_recipients.push($)})}function fe(){u.dialog({title:"Add number",message:"Use E.164 format: must have the <b>+</b> symbol and <span class='text-red'>country code</span>, followed by the <span class='text-green'>phone number</span> e.g. <b>+<span class='text-red'>1</span><span class='text-green'>2131231234</span></b>",prompt:{model:""},html:!0,cancel:!0,ok:{label:"Add",color:"primary"},persistent:!1}).onOk($=>{S.text_recipients.push($)})}function le($){const v=S.email_recipients.filter(U=>U!==$);S.email_recipients=v}function Y($){const v=S.text_recipients.filter(U=>U!==$);S.text_recipients=v}const X=M(!1);async function ne(){if(!S.name){At("Name needs to be set");return}if(X.value=!0,i.alertTemplate)try{await ad(S.id,S),Ve("Alert Template edited!"),r()}catch{}finally{X.value=!1}else try{await id(S),Ve("Alert Template edited!"),r()}catch{}finally{X.value=!1}}return($,v)=>(f(),p(me,{ref_key:"dialogRef",ref:d,onHide:_(o)},{default:a(()=>[l(ue,{style:{width:"90vw","max-width":"90vw"}},{default:a(()=>[l(De,null,{default:a(()=>[m(F($.alertTemplate?"Edit Alert Template":"Add Alert Template")+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>v[47]||(v[47]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(no,{modelValue:c.value,"onUpdate:modelValue":v[46]||(v[46]=U=>c.value=U),ref_key:"stepper",ref:L,"alternative-labels":"","header-nav":"",color:"primary",animated:""},{navigation:a(()=>[l(sd,{class:"row"},{default:a(()=>[c.value>1?(f(),p(E,{key:0,flat:"",color:"primary",onClick:v[44]||(v[44]=U=>L.value?.previous()),label:"Back",class:"q-mr-xs"})):G("",!0),c.value<5?(f(),p(E,{key:1,onClick:v[45]||(v[45]=U=>L.value?.next()),color:"primary",label:"Next"})):G("",!0),l(pe),l(E,{onClick:ne,color:"primary",label:"Submit",loading:X.value},null,8,["loading"])]),_:1})]),default:a(()=>[l(ol,{name:1,error:!_(S).name&&c.value>1,title:"General Settings",icon:"settings"},{default:a(()=>[l(ue,{flat:""},{default:a(()=>[l(I,null,{default:a(()=>[l(ge,{label:"Name",class:"q-mb-none",outlined:"",dense:"",modelValue:_(S).name,"onUpdate:modelValue":v[0]||(v[0]=U=>_(S).name=U),rules:[U=>!!U||"*Required"]},null,8,["modelValue","rules"])]),_:1}),l(I,null,{default:a(()=>[l(Be,{modelValue:_(S).is_active,"onUpdate:modelValue":v[1]||(v[1]=U=>_(S).is_active=U),color:"green",label:"Enabled","left-label":""},null,8,["modelValue"])]),_:1}),v[54]||(v[54]=g("div",{class:"q-pl-md text-subtitle1"}," Email Settings (Overrides global email settings) ",-1)),l(I,null,{default:a(()=>[l(ge,{label:"Email From address",class:"q-mb-sm",outlined:"",dense:"",modelValue:_(S).email_from,"onUpdate:modelValue":v[2]||(v[2]=U=>_(S).email_from=U)},null,8,["modelValue"])]),_:1}),l(I,{class:"row"},{default:a(()=>[v[49]||(v[49]=g("div",{class:"col-2 q-mb-sm"},"Email recipients",-1)),g("div",od,[_(S).email_recipients.length!==0?(f(),p(Se,{key:0,dense:""},{default:a(()=>[(f(!0),ce(at,null,lt(_(S).email_recipients,U=>(f(),p(B,{key:U,dense:""},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(U),1)]),_:2},1024)]),_:2},1024),l(C,{side:""},{default:a(()=>[l(K,{class:"cursor-pointer",name:"delete",color:"red",onClick:Ce=>le(U)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(f(),p(Se,{key:1},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>v[48]||(v[48]=[m("No recipients")])),_:1})]),_:1})]),_:1}))]),v[50]||(v[50]=g("div",{class:"col-3 q-mb-sm"},null,-1)),g("div",rd,[l(E,{size:"sm",icon:"fas fa-plus",color:"secondary",label:"Add email",onClick:Z})])]),_:1}),v[55]||(v[55]=g("div",{class:"q-pl-md text-subtitle1"}," SMS Settings (Overrides global SMS settings) ",-1)),l(I,{class:"row"},{default:a(()=>[v[52]||(v[52]=g("div",{class:"col-2 q-mb-sm"},"SMS recipients",-1)),g("div",dd,[_(S).text_recipients.length!==0?(f(),p(Se,{key:0,dense:""},{default:a(()=>[(f(!0),ce(at,null,lt(_(S).text_recipients,U=>(f(),p(B,{key:U,dense:""},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(U),1)]),_:2},1024)]),_:2},1024),l(C,{side:""},{default:a(()=>[l(K,{class:"cursor-pointer",name:"delete",color:"red",onClick:Ce=>Y(U)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(f(),p(Se,{key:1},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>v[51]||(v[51]=[m("No recipients")])),_:1})]),_:1})]),_:1}))]),v[53]||(v[53]=g("div",{class:"col-3 q-mb-sm"},null,-1)),g("div",ud,[l(E,{class:"cursor-pointer",size:"sm",icon:"fas fa-plus",color:"secondary",label:"Add sms number",onClick:fe})])]),_:1})]),_:1})]),_:1},8,["error"]),l(ol,{name:2,title:"Alert Actions",icon:"warning"},{default:a(()=>[l(ue,{flat:""},{default:a(()=>[g("div",cd,[g("span",fd,[v[57]||(v[57]=m("Alert Failure Settings ")),l(j,null,{default:a(()=>v[56]||(v[56]=[m(" The selected action will run when an alert is triggered. ")])),_:1})])]),l(I,null,{default:a(()=>[l(St,{modelValue:_(S).action_type,"onUpdate:modelValue":v[3]||(v[3]=U=>_(S).action_type=U),class:"q-pb-sm",options:H.value,dense:"",inline:""},null,8,["modelValue","options"]),_(S).action_type=="script"?(f(),p(Fe,{key:0,class:"q-mb-sm",label:"Failure script",outlined:"",clearable:"",modelValue:_(S).action,"onUpdate:modelValue":v[4]||(v[4]=U=>_(S).action=U),options:_(h),mapOptions:"",filterable:"",rules:[U=>!!U||"*Required"]},null,8,["modelValue","options","rules"])):_(S).action_type=="server"?(f(),p(Fe,{key:1,class:"q-mb-sm",label:"Failure script",outlined:"",clearable:"",modelValue:_(S).action,"onUpdate:modelValue":v[5]||(v[5]=U=>_(S).action=U),options:_(x),mapOptions:"",filterable:""},null,8,["modelValue","options"])):(f(),p(Fe,{key:2,class:"q-mb-sm",label:"Failure Web Hook",outlined:"",clearable:"",modelValue:_(S).action_rest,"onUpdate:modelValue":v[6]||(v[6]=U=>_(S).action_rest=U),options:_(N),mapOptions:"",filterable:""},null,8,["modelValue","options"])),_(S).action_type!=="rest"?(f(),p(Qe,{key:3,class:"q-mb-sm",dense:"",label:"Failure script arguments (press Enter after typing each argument)",filled:"",modelValue:_(S).action_args,"onUpdate:modelValue":v[7]||(v[7]=U=>_(S).action_args=U),"use-input":"","use-chips":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add"},null,8,["modelValue"])):G("",!0),_(S).action_type!=="rest"?(f(),p(Qe,{key:4,class:"q-mb-sm",dense:"",label:"Failure script environment vars (press Enter after typing each key=value pair)",filled:"",modelValue:_(S).action_env_vars,"onUpdate:modelValue":v[8]||(v[8]=U=>_(S).action_env_vars=U),"use-input":"","use-chips":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add"},null,8,["modelValue"])):G("",!0),_(S).action_type!=="rest"?(f(),p(ge,{key:5,class:"q-mb-sm",label:"Failure script timeout (seconds)",outlined:"",type:"number",modelValue:_(S).action_timeout,"onUpdate:modelValue":v[9]||(v[9]=U=>_(S).action_timeout=U),modelModifiers:{number:!0},dense:"",rules:[U=>!!U||"Failure script timeout is required"]},null,8,["modelValue","rules"])):G("",!0)]),_:1}),g("div",md,[g("span",pd,[v[59]||(v[59]=m("Alert Resolved Settings ")),l(j,null,{default:a(()=>v[58]||(v[58]=[m(" The selected action will run when an alert is resolved. ")])),_:1})])]),l(I,null,{default:a(()=>[l(St,{modelValue:_(S).resolved_action_type,"onUpdate:modelValue":v[10]||(v[10]=U=>_(S).resolved_action_type=U),class:"q-pb-sm",options:H.value,dense:"",inline:""},null,8,["modelValue","options"]),_(S).resolved_action_type==="script"?(f(),p(Fe,{key:0,class:"q-mb-sm",label:"Resolved Script",outlined:"",clearable:"",modelValue:_(S).resolved_action,"onUpdate:modelValue":v[11]||(v[11]=U=>_(S).resolved_action=U),options:_(h),mapOptions:"",filterable:""},null,8,["modelValue","options"])):_(S).resolved_action_type==="server"?(f(),p(Fe,{key:1,class:"q-mb-sm",label:"Resolved Script",outlined:"",clearable:"",modelValue:_(S).resolved_action,"onUpdate:modelValue":v[12]||(v[12]=U=>_(S).resolved_action=U),options:_(x),mapOptions:"",filterable:""},null,8,["modelValue","options"])):(f(),p(Fe,{key:2,class:"q-mb-sm",label:"Resolved Web Hook",outlined:"",clearable:"",modelValue:_(S).resolved_action_rest,"onUpdate:modelValue":v[13]||(v[13]=U=>_(S).resolved_action_rest=U),options:_(N),mapOptions:"",filterable:""},null,8,["modelValue","options"])),_(S).resolved_action_type!=="rest"?(f(),p(Qe,{key:3,class:"q-mb-sm",dense:"",label:"Resolved script arguments (press Enter after typing each argument)",filled:"",modelValue:_(S).resolved_action_args,"onUpdate:modelValue":v[14]||(v[14]=U=>_(S).resolved_action_args=U),"use-input":"","use-chips":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add"},null,8,["modelValue"])):G("",!0),_(S).resolved_action_type!=="rest"?(f(),p(Qe,{key:4,class:"q-mb-sm",dense:"",label:"Resolved action environment vars (press Enter after typing each key=value pair)",filled:"",modelValue:_(S).resolved_action_env_vars,"onUpdate:modelValue":v[15]||(v[15]=U=>_(S).resolved_action_env_vars=U),"use-input":"","use-chips":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add"},null,8,["modelValue"])):G("",!0),_(S).resolved_action_type!=="rest"?(f(),p(ge,{key:5,class:"q-mb-sm",label:"Resolved script timeout (seconds)",outlined:"",type:"number",modelValue:_(S).resolved_action_timeout,"onUpdate:modelValue":v[16]||(v[16]=U=>_(S).resolved_action_timeout=U),modelModifiers:{number:!0},dense:"",rules:[U=>!!U||"Resolved script timeout is required"]},null,8,["modelValue","rules"])):G("",!0)]),_:1}),g("div",gd,[g("span",hd,[v[61]||(v[61]=m("Run actions only on ")),l(j,null,{default:a(()=>v[60]||(v[60]=[m(" The selected action will only run on the following types of alerts ")])),_:1})])]),l(I,null,{default:a(()=>[l(Be,{modelValue:_(S).agent_script_actions,"onUpdate:modelValue":v[17]||(v[17]=U=>_(S).agent_script_actions=U),label:"Agents",color:"green","left-label":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).check_script_actions,"onUpdate:modelValue":v[18]||(v[18]=U=>_(S).check_script_actions=U),label:"Checks",color:"green","left-label":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).task_script_actions,"onUpdate:modelValue":v[19]||(v[19]=U=>_(S).task_script_actions=U),label:"Tasks",color:"green","left-label":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(ol,{name:3,title:"Agent Overdue Settings",icon:"devices"},{default:a(()=>[l(ue,{flat:""},{default:a(()=>[g("div",yd,[g("span",bd,[v[63]||(v[63]=m("Alert Failure Settings ")),l(j,null,{default:a(()=>v[62]||(v[62]=[m(" Select what notifications should be sent when an agent is overdue. Enabled will override the agent notification settings and always notify. Not configured will use what notification settings are configured on the agent. Disabled will override the agent notification settings and never notify. ")])),_:1})])]),l(I,null,{default:a(()=>[l(Be,{modelValue:_(S).agent_always_email,"onUpdate:modelValue":v[20]||(v[20]=U=>_(S).agent_always_email=U),label:"Email",color:"green","left-label":"","toggle-indeterminate":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).agent_always_text,"onUpdate:modelValue":v[21]||(v[21]=U=>_(S).agent_always_text=U),label:"Text",color:"green","left-label":"","toggle-indeterminate":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).agent_always_alert,"onUpdate:modelValue":v[22]||(v[22]=U=>_(S).agent_always_alert=U),label:"Dashboard",color:"green","left-label":"","toggle-indeterminate":""},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(ge,{label:"Alert again if not resolved after (days)",outlined:"",type:"number",modelValue:_(S).agent_periodic_alert_days,"onUpdate:modelValue":v[23]||(v[23]=U=>_(S).agent_periodic_alert_days=U),modelModifiers:{number:!0},dense:"",rules:[U=>U>=0||"Periodic days must be 0 or greater"]},null,8,["modelValue","rules"])]),_:1}),g("div",vd,[g("span",wd,[v[65]||(v[65]=m("Alert Resolved Settings ")),l(j,null,{default:a(()=>v[64]||(v[64]=[m(" Select what notifications should be sent when an overdue agent is back online. ")])),_:1})])]),l(I,null,{default:a(()=>[l(Be,{modelValue:_(S).agent_email_on_resolved,"onUpdate:modelValue":v[24]||(v[24]=U=>_(S).agent_email_on_resolved=U),label:"Email",color:"green","left-label":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).agent_text_on_resolved,"onUpdate:modelValue":v[25]||(v[25]=U=>_(S).agent_text_on_resolved=U),label:"Text",color:"green","left-label":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(ol,{name:4,title:"Check Settings",icon:"fas fa-check-double"},{default:a(()=>[l(ue,{flat:""},{default:a(()=>[g("div",kd,[g("span",_d,[v[67]||(v[67]=m("Alert Failure Settings ")),l(j,null,{default:a(()=>v[66]||(v[66]=[m(" Select what notifications are sent when a check fails. Enabled will override the check notification settings and always notify. Not configured will use the notification settings configured on the check. Disabled will override the check notification settings and never notify. ")])),_:1})])]),l(I,null,{default:a(()=>[l(Be,{modelValue:_(S).check_always_email,"onUpdate:modelValue":v[26]||(v[26]=U=>_(S).check_always_email=U),label:"Email",color:"green","left-label":"","toggle-indeterminate":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).check_always_text,"onUpdate:modelValue":v[27]||(v[27]=U=>_(S).check_always_text=U),label:"Text",color:"green","left-label":"","toggle-indeterminate":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).check_always_alert,"onUpdate:modelValue":v[28]||(v[28]=U=>_(S).check_always_alert=U),label:"Dashboard",color:"green","left-label":"","toggle-indeterminate":""},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(Qe,{label:"Only email on alert severity",hint:"Defaults to 'error' and 'warning'",modelValue:_(S).check_email_alert_severity,"onUpdate:modelValue":v[29]||(v[29]=U=>_(S).check_email_alert_severity=U),outlined:"",dense:"","options-dense":"",multiple:"","use-chips":"","emit-value":"","map-options":"",options:q},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(Qe,{label:"Only text on alert severity",hint:"Defaults to 'error' and 'warning'",modelValue:_(S).check_text_alert_severity,"onUpdate:modelValue":v[30]||(v[30]=U=>_(S).check_text_alert_severity=U),outlined:"",dense:"","options-dense":"",multiple:"","use-chips":"","emit-value":"","map-options":"",options:q},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(Qe,{label:"Only show dashboard alert on severity",hint:"Defaults to 'error', 'warning', and 'info'",modelValue:_(S).check_dashboard_alert_severity,"onUpdate:modelValue":v[31]||(v[31]=U=>_(S).check_dashboard_alert_severity=U),outlined:"",dense:"","options-dense":"",multiple:"","use-chips":"","emit-value":"","map-options":"",options:q},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(ge,{label:"Alert again if not resolved after (days)",outlined:"",type:"number",modelValue:_(S).check_periodic_alert_days,"onUpdate:modelValue":v[32]||(v[32]=U=>_(S).check_periodic_alert_days=U),modelModifiers:{number:!0},dense:"",rules:[U=>U>=0||"Periodic days must be 0 or greater"]},null,8,["modelValue","rules"])]),_:1}),g("div",Sd,[g("span",Vd,[v[69]||(v[69]=m("Alert Resolved Settings ")),l(j,null,{default:a(()=>v[68]||(v[68]=[m(" Select what notifications are sent when a failed check is resolved. ")])),_:1})])]),l(I,null,{default:a(()=>[l(Be,{modelValue:_(S).check_email_on_resolved,"onUpdate:modelValue":v[33]||(v[33]=U=>_(S).check_email_on_resolved=U),label:"Email",color:"green","left-label":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).check_text_on_resolved,"onUpdate:modelValue":v[34]||(v[34]=U=>_(S).check_text_on_resolved=U),label:"Text",color:"green","left-label":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(ol,{name:5,title:"Automated Task Settings",icon:"fas fa-tasks"},{default:a(()=>[l(ue,{flat:""},{default:a(()=>[g("div",Cd,[g("span",Td,[v[71]||(v[71]=m("Alert Failure Settings ")),l(j,null,{default:a(()=>v[70]||(v[70]=[m(" Select what notifications are sent when an automated task fails. Enabled will override the task notification settings and always notify. Not configured will use the notification settings configured on the task. Disabled will override the task notification settings and never notify. ")])),_:1})])]),l(I,null,{default:a(()=>[l(Be,{modelValue:_(S).task_always_email,"onUpdate:modelValue":v[35]||(v[35]=U=>_(S).task_always_email=U),label:"Email",color:"green","left-label":"","toggle-indeterminate":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).task_always_text,"onUpdate:modelValue":v[36]||(v[36]=U=>_(S).task_always_text=U),label:"Text",color:"green","left-label":"","toggle-indeterminate":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).task_always_alert,"onUpdate:modelValue":v[37]||(v[37]=U=>_(S).task_always_alert=U),label:"Dashboard",color:"green","left-label":"","toggle-indeterminate":""},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(Qe,{label:"Only email on alert severity",hint:"Defaults to 'error' and 'warning'",modelValue:_(S).task_email_alert_severity,"onUpdate:modelValue":v[38]||(v[38]=U=>_(S).task_email_alert_severity=U),outlined:"",dense:"","options-dense":"",multiple:"","use-chips":"","emit-value":"","map-options":"",options:q},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(Qe,{label:"Only text on alert severity",hint:"Defaults to 'error' and 'warning'",modelValue:_(S).task_text_alert_severity,"onUpdate:modelValue":v[39]||(v[39]=U=>_(S).task_text_alert_severity=U),outlined:"",dense:"","options-dense":"",multiple:"","use-chips":"","emit-value":"","map-options":"",options:q},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(Qe,{label:"Only show dashboard alert on severity",hint:"Defaults to 'error', 'warning', and 'info'",modelValue:_(S).task_dashboard_alert_severity,"onUpdate:modelValue":v[40]||(v[40]=U=>_(S).task_dashboard_alert_severity=U),outlined:"",dense:"","options-dense":"",multiple:"","use-chips":"","emit-value":"","map-options":"",options:q},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(ge,{label:"Alert again if not resolved (days)",outlined:"",type:"number",modelValue:_(S).task_periodic_alert_days,"onUpdate:modelValue":v[41]||(v[41]=U=>_(S).task_periodic_alert_days=U),modelModifiers:{number:!0},dense:"",rules:[U=>U>=0||"Periodic days must be 0 or greater"]},null,8,["modelValue","rules"])]),_:1}),g("div",xd,[g("span",Ad,[v[73]||(v[73]=m("Alert Resolved Settings ")),l(j,null,{default:a(()=>v[72]||(v[72]=[m(" Select what notifications are sent when a failed task is resolved. ")])),_:1})])]),l(I,null,{default:a(()=>[l(Be,{modelValue:_(S).task_email_on_resolved,"onUpdate:modelValue":v[42]||(v[42]=U=>_(S).task_email_on_resolved=U),label:"Email",color:"green","left-label":""},null,8,["modelValue"]),l(Be,{modelValue:_(S).task_text_on_resolved,"onUpdate:modelValue":v[43]||(v[43]=U=>_(S).task_text_on_resolved=U),label:"Text",color:"green","left-label":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["onHide"]))}}),Od={name:"AlertExclusions",components:{TacticalDropdown:Fe},emits:["hide","ok"],props:{template:!Object},mixins:[it],data(){return{localTemplate:{excluded_clients:[],excluded_sites:[],excluded_agents:[],exclude_servers:!1,exclude_workstations:!1},clientOptions:[],siteOptions:[],agentOptions:[]}},methods:{onSubmit(){this.$q.loading.show(),this.$axios.put(`alerts/templates/${this.template.id}/`,this.localTemplate).then(()=>{this.$q.loading.hide(),this.onOk(),this.notifySuccess("Alert Template exclusions added")}).catch(()=>{this.$q.loading.hide()})},getClientsandSites(){this.$q.loading.show(),this.$axios.get("/clients/").then(t=>{this.clientOptions=t.data.map(e=>({label:e.name,value:e.id})),t.data.forEach(e=>{this.siteOptions.push({category:e.name}),e.sites.forEach(s=>this.siteOptions.push({label:s.name,value:s.id}))}),this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},getOptions(){this.getAgentOptions("id").then(t=>this.agentOptions=Object.freeze(t)),this.getClientsandSites()},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")},onOk(){this.$emit("ok"),this.hide()}},created(){this.localTemplate.id=this.template.id,this.localTemplate.excluded_clients=this.template.excluded_clients,this.localTemplate.excluded_sites=this.template.excluded_sites,this.localTemplate.excluded_agents=this.template.excluded_agents,this.localTemplate.exclude_servers=this.template.exclude_servers,this.localTemplate.exclude_workstations=this.template.exclude_workstations,this.getOptions()}};function qd(t,e,s,n,i,d){const o=qe("tactical-dropdown");return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{style:{width:"50vw","max-width":"50vw"}},{default:a(()=>[l(De,null,{default:a(()=>[m(" Alert Exclusions for "+F(s.template.name)+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[5]||(e[5]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(ct,{ref:"form",onSubmit:qt(d.onSubmit,["prevent"])},{default:a(()=>[l(I,null,{default:a(()=>[l(o,{label:"Excluded Clients",outlined:"",multiple:"",modelValue:i.localTemplate.excluded_clients,"onUpdate:modelValue":e[0]||(e[0]=r=>i.localTemplate.excluded_clients=r),options:i.clientOptions,"use-chips":"",mapOptions:"",filterable:""},null,8,["modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[l(o,{label:"Excluded Sites",outlined:"",multiple:"",modelValue:i.localTemplate.excluded_sites,"onUpdate:modelValue":e[1]||(e[1]=r=>i.localTemplate.excluded_sites=r),options:i.siteOptions,"use-chips":"",mapOptions:"",filterable:""},null,8,["modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[l(o,{label:"Excluded Agents",outlined:"",multiple:"",modelValue:i.localTemplate.excluded_agents,"onUpdate:modelValue":e[2]||(e[2]=r=>i.localTemplate.excluded_agents=r),options:i.agentOptions,"use-chips":"",mapOptions:"",filterable:""},null,8,["modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[l(W,{modelValue:i.localTemplate.exclude_workstations,"onUpdate:modelValue":e[3]||(e[3]=r=>i.localTemplate.exclude_workstations=r),label:"Exclude Workstations"},null,8,["modelValue"]),l(W,{modelValue:i.localTemplate.exclude_servers,"onUpdate:modelValue":e[4]||(e[4]=r=>i.localTemplate.exclude_servers=r),label:"Exclude Servers"},null,8,["modelValue"])]),_:1}),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{dense:"",flat:"",label:"Save",color:"primary",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var $d=Te(Od,[["render",qd]]);const Rd={name:"AlertTemplateRelated",emits:["hide","ok","cancel"],props:{template:!Object},data(){return{tab:"policies",related:{},thumbStyle:{right:"2px",borderRadius:"5px",backgroundColor:"#027be3",width:"5px",opacity:.75}}},methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")}},mounted(){this.$q.loading.show(),this.$axios.get(`/alerts/templates/${this.template.id}/related/`).then(t=>{this.$q.loading.hide(),this.related=t.data}).catch(()=>{this.$q.loading.hide()})}};function Dd(t,e,s,n,i,d){return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{style:{width:"60vw"}},{default:a(()=>[l(De,null,{default:a(()=>[m(" Assigned to "+F(s.template.name)+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[2]||(e[2]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(I,null,{default:a(()=>[l(_l,{modelValue:i.tab,"onUpdate:modelValue":e[0]||(e[0]=o=>i.tab=o),dense:"","inline-label":"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":"","no-caps":""},{default:a(()=>[l(dt,{name:"policies",label:"Policies"}),l(dt,{name:"clients",label:"Clients"}),l(dt,{name:"sites",label:"Sites"})]),_:1},8,["modelValue"]),l(de),l(zn,{"thumb-style":i.thumbStyle,style:{height:"50vh"}},{default:a(()=>[l(Zl,{modelValue:i.tab,"onUpdate:modelValue":e[1]||(e[1]=o=>i.tab=o),animated:!1},{default:a(()=>[l(Ct,{name:"policies"},{default:a(()=>[l(Se,{separator:"",padding:""},{default:a(()=>[(f(!0),ce(at,null,lt(i.related.policies,o=>(f(),p(B,{key:o.id},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(o.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(Ct,{name:"clients"},{default:a(()=>[l(Se,{separator:"",padding:""},{default:a(()=>[(f(!0),ce(at,null,lt(i.related.clients,o=>(f(),p(B,{key:o.id},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(o.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),l(Ct,{name:"sites"},{default:a(()=>[l(Se,{separator:"",padding:""},{default:a(()=>[(f(!0),ce(at,null,lt(i.related.sites,o=>(f(),p(B,{key:o.id},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(o.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["thumb-style"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var Ud=Te(Rd,[["render",Dd]]);const Pd={name:"AlertsManager",mixins:[it],emits:["hide","ok","cancel"],data(){return{selectedTemplate:null,templates:[],columns:[{name:"is_active",label:"Active",field:"is_active",align:"left"},{name:"agent_settings",label:"Agent Settings",field:"agent_settings"},{name:"check_settings",label:"Check Settings",field:"check_settings"},{name:"task_settings",label:"Task Settings",field:"task_settings"},{name:"name",label:"Name",field:"name",align:"left"},{name:"applied_to",label:"Applied To",field:"applied_to",align:"left"},{name:"alert_exclusions",label:"Alert Exclusions",field:"alert_exclusions",align:"left"},{name:"action_name",label:"Failure Action",field:"action_name",align:"left"},{name:"resolved_action_name",label:"Resolved Action",field:"resolved_action_name",align:"left"}],pagination:{rowsPerPage:0,sortBy:"name",descending:!0}}},methods:{getTemplates(){this.$q.loading.show(),this.$axios.get("alerts/templates/").then(t=>{this.templates=t.data,this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},clearRow(){this.selectedTemplate=null},refresh(){this.$store.dispatch("refreshDashboard"),this.getTemplates(),this.clearRow()},deleteTemplate(t){this.$q.dialog({title:`Delete alert template ${t.name}?`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(()=>{this.$q.loading.show(),this.$axios.delete(`alerts/templates/${t.id}/`).then(()=>{this.refresh(),this.$q.loading.hide(),this.notifySuccess(`Alert template ${t.name} was deleted!`)}).catch(()=>{this.$q.loading.hide()})})},showEditTemplateModal(t){this.$q.dialog({component:ks,componentProps:{alertTemplate:t}}).onOk(()=>{this.refresh()})},showAddTemplateModal(){this.clearRow(),this.$q.dialog({component:ks}).onOk(()=>{this.refresh()})},showAlertExclusions(t){this.$q.dialog({component:$d,componentProps:{template:t}}).onOk(()=>{this.refresh()})},showTemplateApplied(t){this.$q.dialog({component:Ud,componentProps:{template:t}})},toggleEnabled(t){let e=t.is_active?"Template disabled successfully":"Template enabled successfully";const s={id:t.id,is_active:!t.is_active};this.$axios.put(`alerts/templates/${t.id}/`,s).then(()=>{this.notifySuccess(e),this.$store.dispatch("refreshDashboard")})},rowSelectedClass(t,e){if(e&&e.id===t)return this.$q.dark.isActive?"highlight-dark":"highlight"},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")}},mounted(){this.getTemplates()}},Ed={class:"q-dialog-plugin",style:{width:"90vw","max-width":"90vw"}},Md={class:"card-header ac jsb"},Nd={class:"q-pa-sm",style:{"min-height":"65vh","max-height":"65vh"}},Ld={class:"q-gutter-sm"},Id=["onClick"],Bd=["onClick"];function Hd(t,e,s,n,i,d){return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[g("div",Ed,[l(ue,null,{default:a(()=>[g("div",Md,[e[2]||(e[2]=g("div",{class:"text-h6"},"Alerts Manager",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[1]||(e[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),g("div",Nd,[g("div",Ld,[l(E,{class:"btn btn-primary btn-sm",ref:"new",label:"New",dense:"",flat:"",push:"",unelevated:"","no-caps":"",icon:"add",onClick:d.showAddTemplateModal},null,8,["onClick"])]),l(et,{dense:"",rows:i.templates,columns:i.columns,pagination:i.pagination,"onUpdate:pagination":e[0]||(e[0]=o=>i.pagination=o),"row-key":"id","binary-state-sort":"","hide-pagination":"","virtual-scroll":"","rows-per-page-options":[0],"no-data-label":"No Alert Templates"},{"header-cell-is_active":a(o=>[l(Ke,{props:o,"auto-width":""},{default:a(()=>[l(K,{name:"power_settings_new",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[3]||(e[3]=[m("Enable Template")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-agent_settings":a(o=>[l(Ke,{props:o,"auto-width":""},{default:a(()=>[l(K,{name:"devices",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[4]||(e[4]=[m("Has agent alert settings")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-check_settings":a(o=>[l(Ke,{props:o,"auto-width":""},{default:a(()=>[l(K,{name:"fas fa-check-double",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[5]||(e[5]=[m("Has check alert settings")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-task_settings":a(o=>[l(Ke,{props:o,"auto-width":""},{default:a(()=>[l(K,{name:"fas fa-tasks",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[6]||(e[6]=[m("Has task alert settings")])),_:1})]),_:1})]),_:2},1032,["props"])]),body:a(o=>[l(nt,{props:o,class:Bs(["cursor-pointer",d.rowSelectedClass(o.row.id,i.selectedTemplate)]),onClick:r=>i.selectedTemplate=o.row,onContextmenu:r=>i.selectedTemplate=o.row,onDblclick:r=>d.showEditTemplateModal(o.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:r=>d.showEditTemplateModal(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[7]||(e[7]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:r=>d.deleteTemplate(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[8]||(e[8]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:r=>d.showAlertExclusions(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"rule"})]),_:1}),l(C,null,{default:a(()=>e[9]||(e[9]=[m("Alert Exclusions")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[10]||(e[10]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[r=>d.toggleEnabled(o.row),r=>o.row.is_active=r],modelValue:o.row.is_active},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[o.row.agent_settings?(f(),p(K,{key:0,color:"primary",name:"done",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[11]||(e[11]=[m("Alert template has agent alert settings")])),_:1})]),_:1})):G("",!0)]),_:2},1024),l(J,null,{default:a(()=>[o.row.check_settings?(f(),p(K,{key:0,color:"primary",name:"done",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[12]||(e[12]=[m("Alert template has check alert settings")])),_:1})]),_:1})):G("",!0)]),_:2},1024),l(J,null,{default:a(()=>[o.row.task_settings?(f(),p(K,{key:0,color:"primary",name:"done",size:"sm"},{default:a(()=>[l(j,null,{default:a(()=>e[13]||(e[13]=[m("Alert template has task alert settings")])),_:1})]),_:1})):G("",!0)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.name)+" ",1),o.row.default_template?(f(),p(Xt,{key:0,color:"primary","text-color":"white",size:"sm"},{default:a(()=>e[14]||(e[14]=[m("Default")])),_:1})):G("",!0)]),_:2},1024),l(J,null,{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},class:"text-primary",onClick:r=>d.showTemplateApplied(o.row)},"Show where template is applied ("+F(o.row.applied_count)+")",9,Id)]),_:2},1024),l(J,null,{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},class:"text-primary",onClick:r=>d.showAlertExclusions(o.row)},"Alert Exclusions ("+F(o.row.excluded_agents.length+o.row.excluded_clients.length+o.row.excluded_sites.length)+")",9,Bd)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.action_name),1)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.resolved_action_name),1)]),_:2},1024)]),_:2},1032,["props","class","onClick","onContextmenu","onDblclick"])]),_:1},8,["rows","columns","pagination"])])]),_:1})])]),_:1},8,["onHide"])}var Fd=Te(Pd,[["render",Hd]]);const jd={name:"PolicyForm",emits:["hide","ok","cancel"],mixins:[it],props:{policy:Object,copyPolicy:Object},data(){return{localPolicy:{name:"",desc:"",enforced:!1,active:!1}}},computed:{title(){return this.editing?"Edit Policy":"Add Policy"},editing(){return!!this.policy}},methods:{submit(){this.$q.loading.show();let t={...this.localPolicy};this.editing?this.$axios.put(`/automation/policies/${t.id}/`,t).then(()=>{this.$q.loading.hide(),this.onOk(),this.notifySuccess("Policy edited!")}).catch(()=>{this.$q.loading.hide()}):(this.copyPolicy&&(t.copyId=this.copyPolicy.id),this.$axios.post("/automation/policies/",t).then(()=>{this.$q.loading.hide(),this.onOk(),this.notifySuccess("Policy added. Now you can add Tasks and Checks!")}).catch(()=>{this.$q.loading.hide()}))},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")},onOk(){this.$emit("ok"),this.hide()}},mounted(){this.policy&&(this.localPolicy.id=this.policy.id,this.localPolicy.name=this.policy.name,this.localPolicy.desc=this.policy.desc,this.localPolicy.enforced=this.policy.enforced,this.localPolicy.active=this.policy.active)}},Kd={class:"card-header ac jsb"},zd={class:"text-h6"},Qd={class:"text-subtitle1"},Wd={class:"col-10"},Gd={class:"col-10"},Jd={class:"col-10"},Yd={class:"col-10"},Xd={class:"card-footer ac je gap-2"};function Zd(t,e,s,n,i,d){return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{width:"60vw"}},{default:a(()=>[g("div",Kd,[g("div",zd,F(d.title),1),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[5]||(e[5]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(ct,{onSubmit:d.submit},{default:a(()=>[s.copyPolicy?(f(),p(I,{key:0},{default:a(()=>[g("div",Qd,[e[6]||(e[6]=m(" You are copying checks and tasks from Policy: ")),g("b",null,F(s.copyPolicy.name),1),e[7]||(e[7]=m(" into a new policy. "))])]),_:1})):G("",!0),l(I,{class:"row"},{default:a(()=>[e[8]||(e[8]=g("div",{class:"col-2"},"Name:",-1)),g("div",Wd,[l(ge,{outlined:"",dense:"",modelValue:i.localPolicy.name,"onUpdate:modelValue":e[0]||(e[0]=o=>i.localPolicy.name=o),rules:[o=>!!o||"*Required"]},null,8,["modelValue","rules"])])]),_:1}),l(I,{class:"row"},{default:a(()=>[e[9]||(e[9]=g("div",{class:"col-2"},"Description:",-1)),g("div",Gd,[l(ge,{outlined:"",dense:"",modelValue:i.localPolicy.desc,"onUpdate:modelValue":e[1]||(e[1]=o=>i.localPolicy.desc=o)},null,8,["modelValue"])])]),_:1}),l(I,{class:"row"},{default:a(()=>[e[10]||(e[10]=g("div",{class:"col-2"},"Active:",-1)),g("div",Jd,[l(Be,{modelValue:i.localPolicy.active,"onUpdate:modelValue":e[2]||(e[2]=o=>i.localPolicy.active=o),color:"green"},null,8,["modelValue"])])]),_:1}),l(I,{class:"row"},{default:a(()=>[e[11]||(e[11]=g("div",{class:"col-2"},"Enforced:",-1)),g("div",Yd,[l(Be,{modelValue:i.localPolicy.enforced,"onUpdate:modelValue":e[3]||(e[3]=o=>i.localPolicy.enforced=o),color:"green"},null,8,["modelValue"])])]),_:1}),g("div",Xd,[g("button",{class:"btn btn-secondary",type:"button",onClick:e[4]||(e[4]=o=>t.$emit("close"))}," Cancel "),e[12]||(e[12]=g("button",{class:"btn btn-primary",type:"submit"},"Submit",-1))])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var yn=Te(jd,[["render",Zd]]);const eu={name:"PolicyStatus",emits:["hide","ok","cancel"],props:{item:{required:!0,type:Object},type:{required:!0,type:String,validator:function(t){return["task","check"].includes(t)}}},setup(){const t=Rt();return{formatDate:te(()=>t.getters.formatDate)}},data(){return{data:[],columns:[{name:"agent",label:"Hostname",field:"agent",align:"left",sortable:!0},{name:"statusicon",align:"left"},{name:"status",label:"Status",field:"status",align:"left",sortable:!0},{name:"moreinfo",label:"More Info",field:"more_info",align:"left",sortable:!0},{name:"datetime",label:"Date / Time",field:"last_run",align:"left",sortable:!0}],pagination:{rowsPerPage:0,sortBy:"status",descending:!1}}},computed:{...Hs(["dash_info_color","dash_positive_color","dash_negative_color","dash_warning_color"]),title(){return this.item.readable_desc?this.item.readable_desc+" Status":this.item.name+" Status"}},methods:{getCheckData(){this.$q.loading.show(),this.$axios.get(`/automation/checks/${this.item.id}/status/`).then(t=>{this.$q.loading.hide(),this.data=t.data}).catch(()=>{this.$q.loading.hide()})},getTaskData(){this.$q.loading.show(),this.$axios.get(`/automation/tasks/${this.item.id}/status/`).then(t=>{this.$q.loading.hide(),this.data=t.data}).catch(()=>{this.$q.loading.hide()})},pingInfo(t){this.$q.dialog({title:t.readable_desc,style:"width: 50vw; max-width: 60vw",message:`<pre>${t.more_info}</pre>`,html:!0})},showEventInfo(t){this.$q.dialog({component:so,componentProps:{evtLogData:t}})},showScriptOutput(t){this.$q.dialog({component:xo,componentProps:{scriptInfo:t}})},refresh(){this.type==="task"?this.getTaskData():this.getCheckData()},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")}},mounted(){this.type==="task"?this.getTaskData():this.getCheckData()}},tu=["onClick"],lu=["onClick"],nu=["onClick"];function su(t,e,s,n,i,d){return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{"min-width":"70vw"}},{default:a(()=>[l(De,null,{default:a(()=>[l(E,{ref:"refresh",onClick:d.refresh,class:"q-mr-sm",dense:"",flat:"",push:"",icon:"refresh"},null,8,["onClick"]),m(" "+F(d.title.slice(0,27))+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[1]||(e[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(I,null,{default:a(()=>[l(et,{style:{"max-height":"35vh"},"table-class":{"table-bgcolor":!t.$q.dark.isActive,"table-bgcolor-dark":t.$q.dark.isActive},class:"tabs-tbl-sticky",rows:i.data,columns:i.columns,pagination:i.pagination,"onUpdate:pagination":e[0]||(e[0]=o=>i.pagination=o),"rows-per-page-options":[0],"row-key":"id","binary-state-sort":"",dense:"","virtual-scroll":"","hide-pagination":"","no-data-label":"There are no agents in this policy"},{"header-cell-statusicon":a(o=>[l(Ke,{"auto-width":"",props:o},null,8,["props"])]),body:a(o=>[l(nt,{props:o},{default:a(()=>[l(J,null,{default:a(()=>[m(F(o.row.hostname),1)]),_:2},1024),o.row.status==="passing"?(f(),p(J,{key:0},{default:a(()=>[l(K,{style:{"font-size":"1.3rem"},color:t.dash_positive_color,name:"check_circle"},{default:a(()=>[l(j,null,{default:a(()=>e[2]||(e[2]=[m("Passing")])),_:1})]),_:1},8,["color"])]),_:1})):o.row.status==="failing"?(f(),p(J,{key:1},{default:a(()=>[o.row.alert_severity==="info"?(f(),p(K,{key:0,style:{"font-size":"1.3rem"},color:t.dash_info_color,name:"info"},{default:a(()=>[l(j,null,{default:a(()=>e[3]||(e[3]=[m("Informational")])),_:1})]),_:1},8,["color"])):o.row.alert_severity==="warning"?(f(),p(K,{key:1,style:{"font-size":"1.3rem"},color:t.dash_warning_color,name:"warning"},{default:a(()=>[l(j,null,{default:a(()=>e[4]||(e[4]=[m("Warning")])),_:1})]),_:1},8,["color"])):(f(),p(K,{key:2,style:{"font-size":"1.3rem"},color:t.dash_negative_color,name:"error"},{default:a(()=>[l(j,null,{default:a(()=>e[5]||(e[5]=[m("Error")])),_:1})]),_:1},8,["color"]))]),_:2},1024)):(f(),p(J,{key:2})),o.row.status==="pending"?(f(),p(J,{key:3},{default:a(()=>e[6]||(e[6]=[m("Awaiting First Synchronization")])),_:1})):o.row.sync_status==="notsynced"?(f(),p(J,{key:4},{default:a(()=>e[7]||(e[7]=[m("Will sync on next agent checkin")])),_:1})):o.row.sync_status==="synced"?(f(),p(J,{key:5},{default:a(()=>e[8]||(e[8]=[m("Synced with agent")])),_:1})):o.row.sync_status==="pendingdeletion"?(f(),p(J,{key:6},{default:a(()=>e[9]||(e[9]=[m("Pending deletion on agent")])),_:1})):o.row.sync_status==="initial"?(f(),p(J,{key:7},{default:a(()=>e[10]||(e[10]=[m("Waiting for task creation on agent")])),_:1})):(f(),p(J,{key:8})),o.row.check_type==="ping"?(f(),p(J,{key:9},{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},onClick:r=>d.pingInfo(o.row),class:"ping-cell text-primary"},"output",8,tu)]),_:2},1024)):o.row.check_type==="script"||o.row.retcode||o.row.stdout||o.row.stderr?(f(),p(J,{key:10},{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},onClick:r=>d.showScriptOutput(o.row),class:"script-cell text-primary"},"output",8,lu)]),_:2},1024)):o.row.check_type==="eventlog"?(f(),p(J,{key:11},{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},onClick:r=>d.showEventInfo(o.row),class:"eventlog-cell text-primary"},"output",8,nu)]),_:2},1024)):o.row.check_type==="cpuload"||o.row.check_type==="memory"?(f(),p(J,{key:12},{default:a(()=>[m(F(o.row.history_info),1)]),_:2},1024)):o.row.more_info?(f(),p(J,{key:13},{default:a(()=>[m(F(o.row.more_info),1)]),_:2},1024)):(f(),p(J,{key:14},{default:a(()=>e[11]||(e[11]=[m("Awaiting Output")])),_:1})),l(J,null,{default:a(()=>[m(F(o.row.last_run?n.formatDate(o.row.last_run):"Never"),1)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["table-class","rows","columns","pagination"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var ba=Te(eu,[["render",su]]);const au={name:"PolicyChecksTab",mixins:[it],props:{selectedPolicy:!Number},data(){return{checks:[],columns:[{name:"smsalert",field:"text_alert",align:"left"},{name:"emailalert",field:"email_alert",align:"left"},{name:"dashboardalert",field:"dashboard_alert",align:"left"},{name:"desc",field:"readable_desc",label:"Description",align:"left",sortable:!0},{name:"status",label:"Status",field:"status",align:"left"},{name:"assigned_task",label:"Assigned Tasks",field:"assigned_task",align:"left",sortable:!0}],pagination:{rowsPerPage:0,sortBy:"status",descending:!0}}},watch:{selectedPolicy:function(t,e){t!==e&&this.getChecks()}},computed:{...Hs(["dash_positive_color","dash_warning_color"])},methods:{getChecks(){this.$q.loading.show(),this.$axios.get(`/automation/policies/${this.selectedPolicy}/checks/`).then(t=>{this.checks=t.data,this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},checkAlert(t,e,s){this.$q.loading.show();const n={};e==="Email"?n.email_alert=!s:e==="Text"?n.text_alert=!s:n.dashboard_alert=!s,n.check_alert=!0;const i=s?"disabled":"enabled",d=s?this.dash_warning_color:this.dash_positive_color;this.$axios.put(`/checks/${t}/`,n).then(()=>{this.$q.loading.hide(),this.$q.notify({color:d,icon:"fas fa-check-circle",message:`${e} alerts ${i}`})}).catch(()=>{this.$q.loading.hide()})},deleteCheck(t){this.$q.dialog({title:`Delete ${t.check_type} check?`,ok:{label:"Delete",color:"negative"},cancel:!0}).onOk(()=>{this.$q.loading.show(),this.$axios.delete(`/checks/${t.id}/`).then(()=>{this.getChecks(),this.$q.loading.hide(),this.notifySuccess("Check Deleted!")}).catch(()=>{this.$q.loading.hide()})})},showPolicyStatus(t){this.$q.dialog({component:ba,componentProps:{type:"check",item:t}})},showCheckModal(t,e){let s;if(t==="diskspace")s=ao;else if(t==="memory")s=io;else if(t==="cpuload")s=oo;else if(t==="ping")s=ro;else if(t==="winsvc")s=uo;else if(t==="eventlog")s=co;else if(t==="script")s=fo;else return;this.$q.dialog({component:s,componentProps:{check:e,parent:e?void 0:{policy:this.selectedPolicy}}}).onOk(this.getChecks)}},created(){this.getChecks()}},iu={class:"row"},ou={class:"col-12"},ru={class:"full-width row flex-center q-gutter-sm"},du={key:0},uu={key:1},cu=["onClick"];function fu(t,e,s,n,i,d){return f(),ce("div",iu,[g("div",ou,[s.selectedPolicy?(f(),p(E,{key:0,class:"q-mr-sm",dense:"",flat:"",push:"",onClick:d.getChecks,icon:"refresh"},null,8,["onClick"])):G("",!0),s.selectedPolicy?(f(),p(Zt,{key:1,icon:"add",label:"New","no-caps":"",dense:"",flat:""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:e[0]||(e[0]=o=>d.showCheckModal("diskspace"))},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{size:"xs",name:"far fa-hdd"})]),_:1}),l(C,null,{default:a(()=>e[8]||(e[8]=[m("Disk Space Check")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",onClick:e[1]||(e[1]=o=>d.showCheckModal("ping"))},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{size:"xs",name:"fas fa-network-wired"})]),_:1}),l(C,null,{default:a(()=>e[9]||(e[9]=[m("Ping Check")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",onClick:e[2]||(e[2]=o=>d.showCheckModal("cpuload"))},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{size:"xs",name:"fas fa-microchip"})]),_:1}),l(C,null,{default:a(()=>e[10]||(e[10]=[m("CPU Load Check")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",onClick:e[3]||(e[3]=o=>d.showCheckModal("memory"))},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{size:"xs",name:"fas fa-memory"})]),_:1}),l(C,null,{default:a(()=>e[11]||(e[11]=[m("Memory Check")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",onClick:e[4]||(e[4]=o=>d.showCheckModal("winsvc"))},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{size:"xs",name:"fas fa-cogs"})]),_:1}),l(C,null,{default:a(()=>e[12]||(e[12]=[m("Windows Service Check")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",onClick:e[5]||(e[5]=o=>d.showCheckModal("script"))},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{size:"xs",name:"fas fa-terminal"})]),_:1}),l(C,null,{default:a(()=>e[13]||(e[13]=[m("Script Check")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",onClick:e[6]||(e[6]=o=>d.showCheckModal("eventlog"))},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{size:"xs",name:"fas fa-clipboard-list"})]),_:1}),l(C,null,{default:a(()=>e[14]||(e[14]=[m("Event Log Check")])),_:1})]),_:1})),[[R]])]),_:1})]),_:1})):G("",!0),l(et,{"table-class":{"table-bgcolor":!t.$q.dark.isActive,"table-bgcolor-dark":t.$q.dark.isActive},class:"tabs-tbl-sticky",rows:i.checks,columns:i.columns,pagination:i.pagination,"onUpdate:pagination":e[7]||(e[7]=o=>i.pagination=o),"rows-per-page-options":[0],"row-key":"id","binary-state-sort":"",dense:"","hide-pagination":"","virtual-scroll":""},{"no-data":a(()=>[g("div",ru,[s.selectedPolicy?(f(),ce("span",uu,"There are no checks added to this policy")):(f(),ce("span",du,"Click on a policy to see the checks"))])]),"header-cell-smsalert":a(o=>[l(Ke,{"auto-width":"",props:o},{default:a(()=>[l(K,{name:"phone_android",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[15]||(e[15]=[m("SMS Alert")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-emailalert":a(o=>[l(Ke,{"auto-width":"",props:o},{default:a(()=>[l(K,{name:"email",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[16]||(e[16]=[m("Email Alert")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-dashboardalert":a(o=>[l(Ke,{"auto-width":"",props:o},{default:a(()=>[l(K,{name:"notifications",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[17]||(e[17]=[m("Dashboard Alert")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-statusicon":a(o=>[l(Ke,{"auto-width":"",props:o},null,8,["props"])]),body:a(o=>[l(nt,{props:o,class:"cursor-pointer",onDblclick:r=>d.showCheckModal(o.row.check_type,o.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:r=>d.showCheckModal(o.row.check_type,o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[18]||(e[18]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:r=>d.deleteCheck(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[19]||(e[19]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:r=>d.showPolicyStatus(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"sync"})]),_:1}),l(C,null,{default:a(()=>e[20]||(e[20]=[m("Policy Status")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[21]||(e[21]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[r=>d.checkAlert(o.row.id,"Text",o.row.text_alert),r=>o.row.text_alert=r],modelValue:o.row.text_alert},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[r=>d.checkAlert(o.row.id,"Email",o.row.email_alert),r=>o.row.email_alert=r],modelValue:o.row.email_alert},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[r=>d.checkAlert(o.row.id,"Dashboard",o.row.dashboard_alert),r=>o.row.dashboard_alert=r],modelValue:o.row.dashboard_alert},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.readable_desc),1)]),_:2},1024),l(J,null,{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},onClick:r=>d.showPolicyStatus(o.row),class:"status-cell text-primary"},"See Status",8,cu)]),_:2},1024),o.row.assignedtasks.length>1?(f(),p(J,{key:0},{default:a(()=>[m(F(o.row.assignedtasks.length)+" Tasks",1)]),_:2},1024)):o.row.assignedtasks.length===1?(f(),p(J,{key:1},{default:a(()=>[m(F(o.row.assignedtasks[0].name),1)]),_:2},1024)):(f(),p(J,{key:2}))]),_:2},1032,["props","onDblclick"])]),_:1},8,["table-class","rows","columns","pagination"])])])}var va=Te(au,[["render",fu]]);const mu={name:"PolicyAutomatedTasksTab",mixins:[it],props:{selectedPolicy:!Number},data(){return{tasks:[],columns:[{name:"enabled",align:"left",field:"enabled"},{name:"smsalert",field:"text_alert",align:"left"},{name:"emailalert",field:"email_alert",align:"left"},{name:"dashboardalert",field:"dashboard_alert",align:"left"},{name:"collector",label:"Collector",field:"custom_field",align:"left",sortable:!0},{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"schedule",label:"Schedule",field:"schedule",align:"left",sortable:!0},{name:"status",label:"More Info",field:"more_info",align:"left",sortable:!0},{name:"check_name",label:"Assigned Check",field:"check_name",align:"left",sortable:!0}],pagination:{rowsPerPage:0,sortBy:"name",descending:!1}}},watch:{selectedPolicy:function(t,e){t!==e&&this.getTasks()}},methods:{getTasks(){this.$q.loading.show(),this.$axios.get(`/automation/policies/${this.selectedPolicy}/tasks/`).then(t=>{this.tasks=t.data,this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},editTask(t,e){this.$axios.put(`/tasks/${t.id}/`,e).then(s=>{this.$q.loading.hide(),this.notifySuccess(s.data),this.getTasks()}).catch(()=>{this.$q.loading.hide()})},showAddTask(){this.$q.dialog({component:vs,componentProps:{parent:{policy:this.selectedPolicy}}}).onOk(this.getTasks)},showEditTask(t){this.$q.dialog({component:vs,componentProps:{task:t,parent:{policy:this.selectedPolicy}}}).onOk(this.getTasks)},showStatus(t){this.$q.dialog({component:ba,componentProps:{type:"task",item:t}})},runTask(t){if(!t.enabled){this.notifyError("Task cannot be run when it's disabled. Enable it first.");return}this.$q.loading.show(),this.$axios.post(`/automation/tasks/${t.id}/run/`).then(()=>{this.$q.loading.hide(),this.notifySuccess("The task was initated on all affected agents")}).catch(()=>{this.$q.loading.hide()})},deleteTask(t){this.$q.dialog({title:"Are you sure?",message:`Delete ${t.name} task`,cancel:!0,persistent:!0}).onOk(()=>{this.$q.loading.show(),this.$axios.delete(`/tasks/${t.id}/`).then(()=>{this.getTasks(),this.$q.loading.hide(),this.notifySuccess("Task was deleted successfully")}).catch(()=>{this.$q.loading.hide()})})}},created(){this.getTasks()}},pu={class:"row"},gu={class:"col-12"},hu={class:"full-width row flex-center q-gutter-sm"},yu={key:0},bu={key:1},vu=["onClick"];function wu(t,e,s,n,i,d){return f(),ce("div",pu,[g("div",gu,[s.selectedPolicy?(f(),p(E,{key:0,class:"q-mr-sm",dense:"",flat:"",push:"",onClick:d.getTasks,icon:"refresh"},null,8,["onClick"])):G("",!0),s.selectedPolicy?(f(),p(E,{key:1,icon:"add",label:"Add Task","no-caps":"",dense:"",flat:"",push:"",onClick:d.showAddTask},null,8,["onClick"])):G("",!0),l(et,{"table-class":{"table-bgcolor":!t.$q.dark.isActive,"table-bgcolor-dark":t.$q.dark.isActive},class:"tabs-tbl-sticky",rows:i.tasks,columns:i.columns,"rows-per-page-options":[0],pagination:i.pagination,"onUpdate:pagination":e[0]||(e[0]=o=>i.pagination=o),dense:"","row-key":"id","binary-state-sort":"","hide-pagination":"","virtual-scroll":""},{"no-data":a(()=>[g("div",hu,[s.selectedPolicy?(f(),ce("span",bu,"There are no tasks added to this policy")):(f(),ce("span",yu,"Click on a policy to see the tasks"))])]),"header-cell-enabled":a(o=>[l(Ke,{"auto-width":"",props:o},{default:a(()=>e[1]||(e[1]=[g("small",null,"Enabled",-1)])),_:2},1032,["props"])]),"header-cell-smsalert":a(o=>[l(Ke,{"auto-width":"",props:o},{default:a(()=>[l(K,{name:"phone_android",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[2]||(e[2]=[m("SMS Alert")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-emailalert":a(o=>[l(Ke,{"auto-width":"",props:o},{default:a(()=>[l(K,{name:"email",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[3]||(e[3]=[m("Email Alert")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-dashboardalert":a(o=>[l(Ke,{"auto-width":"",props:o},{default:a(()=>[l(K,{name:"notifications",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[4]||(e[4]=[m("Dashboard Alert")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-collector":a(o=>[l(Ke,{"auto-width":"",props:o},{default:a(()=>[l(K,{name:"mdi-database-arrow-up",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[5]||(e[5]=[m("Collector Task")])),_:1})]),_:1})]),_:2},1032,["props"])]),body:a(o=>[l(nt,{class:"cursor-pointer",onDblclick:r=>d.showEditTask(o.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:r=>d.runTask(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"play_arrow"})]),_:1}),l(C,null,{default:a(()=>e[6]||(e[6]=[m("Run task now")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:r=>d.showEditTask(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[7]||(e[7]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:r=>d.deleteTask(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[8]||(e[8]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:r=>d.showStatus(o.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"sync"})]),_:1}),l(C,null,{default:a(()=>e[9]||(e[9]=[m("Policy Status")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[10]||(e[10]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[r=>d.editTask(o.row,{enabled:!o.row.enabled}),r=>o.row.enabled=r],modelValue:o.row.enabled},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[r=>d.editTask(o.row,{text_alert:!o.row.text_alert}),r=>o.row.text_alert=r],modelValue:o.row.text_alert},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[r=>d.editTask(o.row,{email_alert:!o.row.email_alert}),r=>o.row.email_alert=r],modelValue:o.row.email_alert},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[r=>d.editTask(o.row,{dashboard_alert:!o.row.dashboard_alert}),r=>o.row.dashboard_alert=r],modelValue:o.row.dashboard_alert},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[o.row.custom_field?(f(),p(K,{key:0,style:{"font-size":"1.3rem"},name:"check"},{default:a(()=>[l(j,null,{default:a(()=>e[11]||(e[11]=[m("The task updates a custom field on the agent")])),_:1})]),_:1})):G("",!0)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.name),1)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.schedule),1)]),_:2},1024),l(J,null,{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},onClick:r=>d.showStatus(o.row),class:"status-cell text-primary"},"See Status",8,vu)]),_:2},1024),l(J,null,{default:a(()=>[m(F(o.row.check_name),1)]),_:2},1024)]),_:2},1032,["onDblclick"])]),_:1},8,["table-class","rows","columns","pagination"])])])}var wa=Te(mu,[["render",wu]]);const ku={name:"PolicyOverview",emits:["hide","ok","cancel"],components:{PolicyAutomatedTasksTab:wa,PolicyChecksTab:va},mixins:[it],data(){return{splitterModel:25,selectedPolicyId:null,selectedTab:"checks",clientSiteTree:[]}},methods:{getPolicyTree(){this.$q.loading.show(),this.$axios.get("/automation/policies/overview/").then(t=>{this.processTreeDataFromApi(t.data),this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},processTreeDataFromApi(t){var e=[];let s=0;for(let d of t){var n={};if(n.label=d.name,n.id=s,n.icon="business",n.selectable=!1,n.children=[],n.key=`${s}${d.name}`,s--,d.server_policy){let o="";d.server_policy.active||(o=" (disabled)");const r=d.server_policy.name+" (Servers)"+o;n.children.push({label:r,icon:"policy",id:d.server_policy.id,key:`${d.server_policy.id}${r}`})}if(d.workstation_policy){let o="";d.workstation_policy.active||(o=" (disabled)");const r=d.workstation_policy.name+" (Workstations)"+o;n.children.push({label:r,icon:"policy",id:d.workstation_policy.id,key:`${d.workstation_policy.id}${r}`})}for(let o of d.sites){var i={};if(i.label=o.name,i.id=s,i.icon="apartment",i.selectable=!1,i.key=`${s}${o.name}`,s--,o.server_policy){i.children=[];let r="";o.server_policy.active||(r=" (disabled)");const u=o.server_policy.name+" (Servers)"+r;i.children.push({label:u,icon:"policy",id:o.server_policy.id,key:`${o.server_policy.id}${u}`})}if(o.workstation_policy){i.children=[];let r="";o.workstation_policy.active||(r=" (disabled)");const u=o.workstation_policy.name+" (Workstations)"+r;i.children.push({label:u,icon:"policy",id:o.workstation_policy.id,key:`${o.workstation_policy.id}${u}`})}n.children.push(i)}e.push(n)}this.clientSiteTree=e},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")}},mounted(){this.getPolicyTree()}},_u={class:"card-header ac jsb"},Su={class:"q-pa-md"};function Vu(t,e,s,n,i,d){const o=qe("PolicyChecksTab"),r=qe("PolicyAutomatedTasksTab");return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{width:"90vw","max-width":"90vw"}},{default:a(()=>[g("div",_u,[e[5]||(e[5]=g("div",{class:"text-h6"},"Policy Overview",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[4]||(e[4]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(hl,{modelValue:i.splitterModel,"onUpdate:modelValue":e[3]||(e[3]=u=>i.splitterModel=u),style:{height:"600px"}},{before:a(()=>[g("div",Su,[l(nn,{ref:"tree",nodes:i.clientSiteTree,"node-key":"key","selected-color":"primary",selected:i.selectedPolicyId,"onUpdate:selected":e[0]||(e[0]=u=>i.selectedPolicyId=u)},null,8,["nodes","selected"])])]),after:a(()=>[l(_l,{modelValue:i.selectedTab,"onUpdate:modelValue":e[1]||(e[1]=u=>i.selectedTab=u),dense:"","inline-label":"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":"","no-caps":""},{default:a(()=>[l(dt,{name:"checks",icon:"fas fa-check-double",label:"Checks"}),l(dt,{name:"tasks",icon:"fas fa-tasks",label:"Tasks"})]),_:1},8,["modelValue"]),l(Zl,{modelValue:i.selectedTab,"onUpdate:modelValue":e[2]||(e[2]=u=>i.selectedTab=u),animated:"","transition-prev":"jump-up","transition-next":"jump-up"},{default:a(()=>[l(Ct,{name:"checks"},{default:a(()=>[i.selectedPolicyId?(f(),p(o,{key:0,selectedPolicy:t.$refs.tree.getNodeByKey(i.selectedPolicyId).id},null,8,["selectedPolicy"])):G("",!0)]),_:1}),l(Ct,{name:"tasks"},{default:a(()=>[i.selectedPolicyId?(f(),p(r,{key:0,selectedPolicy:t.$refs.tree.getNodeByKey(i.selectedPolicyId).id},null,8,["selectedPolicy"])):G("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["onHide"])}var Cu=Te(ku,[["render",Vu]]);const Tu={name:"RelationsView",emits:["hide","ok","cancel"],props:{policy:{type:Object,required:!0}},data(){return{tab:"clients",related:{},thumbStyle:{right:"2px",borderRadius:"5px",backgroundColor:"#027be3",width:"5px",opacity:.75}}},methods:{show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")}},mounted(){this.$q.loading.show(),this.$axios.get(`/automation/policies/${this.policy.id}/related/`).then(t=>{this.$q.loading.hide(),this.related=t.data}).catch(()=>{this.$q.loading.hide()})}},xu={key:0,class:"text-body"},Au={key:1,class:"text-body"};function Ou(t,e,s,n,i,d){return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{style:{width:"60vw"}},{default:a(()=>[l(De,null,{default:a(()=>[m(F(s.policy.name)+" Relations ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[2]||(e[2]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),i.related.default_server_policy||i.related.default_workstation_policy?(f(),p(I,{key:0,class:"row items-center"},{default:a(()=>[i.related.default_server_policy?(f(),ce("div",xu,[l(K,{name:"error_outline",color:"info",size:"1.5em"}),e[3]||(e[3]=m("This policy is set as the Default Server Policy. "))])):G("",!0),i.related.default_workstation_policy?(f(),ce("div",Au,[l(K,{name:"error_outline",color:"info",size:"1.5em"}),e[4]||(e[4]=m("This policy is set as the Default Workstation Policy. "))])):G("",!0)]),_:1})):G("",!0),l(I,null,{default:a(()=>[l(_l,{modelValue:i.tab,"onUpdate:modelValue":e[0]||(e[0]=o=>i.tab=o),dense:"","inline-label":"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":"","no-caps":""},{default:a(()=>[l(dt,{name:"clients",label:"Clients"}),l(dt,{name:"sites",label:"Sites"}),l(dt,{name:"agents",label:"Agents"})]),_:1},8,["modelValue"]),l(de),l(zn,{"thumb-style":i.thumbStyle,style:{height:"50vh"}},{default:a(()=>[l(Zl,{modelValue:i.tab,"onUpdate:modelValue":e[1]||(e[1]=o=>i.tab=o),animated:!1},{default:a(()=>[l(Ct,{name:"clients"},{default:a(()=>[l(Se,{separator:"",padding:""},{default:a(()=>[(f(!0),ce(at,null,lt(i.related.server_clients,o=>(f(),p(B,{key:o.id+"servers"},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(o.name),1)]),_:2},1024)]),_:2},1024),l(C,{side:""},{default:a(()=>[l(ve,null,{default:a(()=>e[5]||(e[5]=[g("i",null,"Applied to Servers",-1)])),_:1})]),_:1})]),_:2},1024))),128)),(f(!0),ce(at,null,lt(i.related.workstation_clients,o=>(f(),p(B,{key:o.id+"workstations"},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(o.name),1)]),_:2},1024)]),_:2},1024),l(C,{side:""},{default:a(()=>[l(ve,null,{default:a(()=>e[6]||(e[6]=[g("i",null,"Applied to Workstations",-1)])),_:1})]),_:1})]),_:2},1024))),128))]),_:1})]),_:1}),l(Ct,{name:"sites"},{default:a(()=>[l(Se,{separator:"",padding:""},{default:a(()=>[(f(!0),ce(at,null,lt(i.related.server_sites,o=>(f(),p(B,{key:o.id+"servers"},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(o.name),1)]),_:2},1024),l(ve,{caption:""},{default:a(()=>[m(F(o.client_name),1)]),_:2},1024)]),_:2},1024),l(C,{side:""},{default:a(()=>[l(ve,null,{default:a(()=>e[7]||(e[7]=[g("i",null,"Applied to Servers",-1)])),_:1})]),_:1})]),_:2},1024))),128)),(f(!0),ce(at,null,lt(i.related.workstation_sites,o=>(f(),p(B,{key:o.id+"workstations"},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(o.name),1)]),_:2},1024),l(ve,{caption:""},{default:a(()=>[m(F(o.client_name),1)]),_:2},1024)]),_:2},1024),l(C,{side:""},{default:a(()=>[l(ve,null,{default:a(()=>e[8]||(e[8]=[g("i",null,"Applied to Workstations",-1)])),_:1})]),_:1})]),_:2},1024))),128))]),_:1})]),_:1}),l(Ct,{name:"agents"},{default:a(()=>[l(Se,{separator:"",padding:""},{default:a(()=>[(f(!0),ce(at,null,lt(i.related.agents,o=>(f(),p(B,{key:o.pk},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>[m(F(o.hostname),1)]),_:2},1024),l(ve,{caption:""},{default:a(()=>[g("b",null,F(o.client),1),m(" "+F(o.site),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["thumb-style"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var qu=Te(Tu,[["render",Ou]]);const $u={name:"AlertTemplateAdd",emits:["hide","ok","cancel"],props:{object:!Object,type:{required:!0,type:String,validator:function(t){return["site","client","policy"].includes(t)}}},mixins:[it],data(){return{selectedTemplate:null,options:[]}},methods:{submit(){if(this.object.alert_template===this.selectedTemplate){this.hide();return}this.$q.loading.show();let t="",e={};this.type==="client"?(t=`/clients/${this.object.id}/`,e={client:{id:this.object.id,alert_template:this.selectedTemplate}}):this.type==="site"?(t=`/clients/sites/${this.object.id}/`,e={site:{id:this.object.id,alert_template:this.selectedTemplate}}):this.type==="policy"&&(t=`/automation/policies/${this.object.id}/`,e={id:this.object.id,alert_template:this.selectedTemplate});const s=this.selectedTemplate?"assigned":"removed";this.$axios.put(t,e).then(()=>{this.$q.loading.hide(),this.onOk(),this.notifySuccess(`Alert Template ${s} successfully!`)}).catch(()=>{this.$q.loading.hide()})},getAlertTemplates(){this.$q.loading.show(),this.$axios.get("/alerts/templates/").then(t=>{this.options=t.data.map(e=>({label:e.name,value:e.id})),this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")},onOk(){this.$emit("ok"),this.hide()}},mounted(){this.getAlertTemplates(),this.selectedTemplate=this.object.alert_template}};function Ru(t,e,s,n,i,d){return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{width:"60vw"}},{default:a(()=>[l(De,null,{default:a(()=>[m(" Edit Alert Template assigned to "+F(s.type)+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[1]||(e[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(ct,{onSubmit:qt(d.submit,["prevent"]),ref:"form"},{default:a(()=>[i.options.length>0?(f(),p(I,{key:0},{default:a(()=>[l(Qe,{modelValue:i.selectedTemplate,"onUpdate:modelValue":e[0]||(e[0]=o=>i.selectedTemplate=o),options:i.options,outlined:"",dense:"",clearable:"","emit-value":"","map-options":"",label:t.capitalize(s.type)+" Alert Template"},null,8,["modelValue","options","label"])]),_:1})):(f(),p(I,{key:1},{default:a(()=>e[2]||(e[2]=[m(" No Alert Templates have been setup. Go to Sonar Management > Alerts Management ")])),_:1})),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),i.options.length>0?(f(),p(E,{key:0,flat:"",label:"Submit",color:"primary",type:"submit"})):G("",!0)]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var Du=Te($u,[["render",Ru]]);const Uu={name:"PolicyExclusions",components:{TacticalDropdown:Fe},emits:["hide","ok","cancel"],props:{policy:!Object},mixins:[it],data(){return{localPolicy:{excluded_clients:[],excluded_sites:[],excluded_agents:[]},clientOptions:[],siteOptions:[],agentOptions:[]}},methods:{onSubmit(){this.$axios.put(`automation/policies/${this.policy.id}/`,this.localPolicy).then(()=>{this.$q.loading.hide(),this.onOk(),this.notifySuccess("Policy exclusions added")}).catch(()=>{this.$q.loading.hide()})},getClientsandSites(){this.$q.loading.show(),this.$axios.get("/clients/").then(t=>{this.clientOptions=t.data.map(e=>({label:e.name,value:e.id})),t.data.forEach(e=>{this.siteOptions.push({category:e.name}),e.sites.forEach(s=>this.siteOptions.push({label:s.name,value:s.id}))}),this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},getOptions(){this.getAgentOptions("id").then(t=>this.agentOptions=Object.freeze(t)),this.getClientsandSites()},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")},onOk(){this.$emit("ok"),this.hide()}},created(){this.localPolicy.id=this.policy.id,this.localPolicy.excluded_clients=this.policy.excluded_clients,this.localPolicy.excluded_sites=this.policy.excluded_sites,this.localPolicy.excluded_agents=this.policy.excluded_agents,this.getOptions()}};function Pu(t,e,s,n,i,d){const o=qe("tactical-dropdown");return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{style:{width:"50vw","max-width":"50vw"}},{default:a(()=>[l(De,null,{default:a(()=>[m(" Policy Exclusions for "+F(s.policy.name)+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[3]||(e[3]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(ct,{ref:"form",onSubmit:qt(d.onSubmit,["prevent"])},{default:a(()=>[l(I,null,{default:a(()=>[l(o,{modelValue:i.localPolicy.excluded_clients,"onUpdate:modelValue":e[0]||(e[0]=r=>i.localPolicy.excluded_clients=r),options:i.clientOptions,label:"Excluded Clients",outlined:"",multiple:"",mapOptions:"",filterable:""},null,8,["modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[l(o,{modelValue:i.localPolicy.excluded_sites,"onUpdate:modelValue":e[1]||(e[1]=r=>i.localPolicy.excluded_sites=r),options:i.siteOptions,label:"Excluded Sites",outlined:"",multiple:"",mapOptions:"",filterable:""},null,8,["modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[l(o,{modelValue:i.localPolicy.excluded_agents,"onUpdate:modelValue":e[2]||(e[2]=r=>i.localPolicy.excluded_agents=r),options:i.agentOptions,label:"Excluded Agents",outlined:"",multiple:"",mapOptions:"",filterable:""},null,8,["modelValue","options"])]),_:1}),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{dense:"",flat:"",label:"Save",color:"primary",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var Eu=Te(Uu,[["render",Pu]]);const Mu={name:"AutomationManager",emits:["hide","ok","cancel"],components:{PolicyChecksTab:va,PolicyAutomatedTasksTab:wa,Icon:He},mixins:[it],data(){return{subtab:"checks",policies:[],selectedPolicy:null,columns:[{name:"active",label:"Active",field:"active",align:"left"},{name:"enforced",label:"Enforced",field:"enforced",align:"left"},{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"desc",label:"Description",field:"desc",align:"left"},{name:"relations",label:"Relations",field:"relations",align:"left"},{name:"exclusions",label:"Exclusions",align:"left"},{name:"winupdatepolicy",label:"Patch Policy",field:"winupdatepolicy",align:"left"},{name:"alert_template",label:"Alert Template",field:"alert_template",align:"left"},{name:"actions",label:"Actions",field:"actions",align:"left"}],pagination:{rowsPerPage:0,sortBy:"name",descending:!0}}},methods:{getPolicies(){this.$q.loading.show(),this.$axios.get("/automation/policies/").then(t=>{this.policies=t.data,this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},clearRow(){this.selectedPolicy=null},refresh(){this.getPolicies(),this.clearRow()},deletePolicy(t){this.$q.dialog({title:"Delete policy?",cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(()=>{this.$q.loading.show(),this.$axios.delete(`/automation/policies/${t.id}/`).then(()=>{this.refresh(),this.$q.loading.hide(),this.notifySuccess("Policy was deleted!"),this.$store.dispatch("loadTree")}).catch(()=>{this.$q.loading.hide()})})},showRelations(t){this.$q.dialog({component:qu,componentProps:{policy:t}})},showPolicyOverview(){this.$q.dialog({component:Cu})},showAddPolicyForm(){this.$q.dialog({component:yn}).onOk(()=>{this.refresh()})},showCopyPolicyForm(t){this.$q.dialog({component:yn,componentProps:{copyPolicy:t}}).onOk(()=>{this.refresh()})},showEditPolicyForm(t){this.$q.dialog({component:yn,componentProps:{policy:t}}).onOk(()=>{this.refresh()})},showAlertTemplateAdd(t){this.$q.dialog({component:Du,componentProps:{type:"policy",object:t}}).onOk(()=>{this.refresh()})},showPatchPolicyForm(t){this.$q.dialog({component:$n,componentProps:{title:t.winupdatepolicy.length>0?"Edit Patch Policy":"Add Patch Policy",vuecomponent:mo,componentProps:{policy:t}}}).onOk(()=>{this.refresh()})},showPolicyExclusions(t){this.$q.dialog({component:Eu,componentProps:{policy:t}}).onOk(()=>{this.refresh()})},toggleCheckbox(t,e){this.$q.loading.show();let s="";const n={id:t.id,name:t.name,desc:t.desc};e==="Active"?(s=t.active?"Policy disabled successfully":"Policy enabled successfully",n.active=!t.active):e==="Enforced"&&(s=t.enforced?"Policy enforcement disabled":"Policy enforced successfully",n.enforced=!t.enforced),this.$axios.put(`/automation/policies/${n.id}/`,n).then(()=>{this.refresh(),this.$q.loading.hide(),this.notifySuccess(s)}).catch(()=>{this.$q.loading.hide()})},patchPolicyText(t){return t.winupdatepolicy.length>0?"Modify Patch Policy":"Create Patch Policy"},alertTemplateText(t){return t.alert_template?"Modify Alert Template":"Assign Alert Template"},rowSelectedClass(t,e){if(e&&e.id===t)return this.$q.dark.isActive?"highlight-dark":"highlight"},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")}},mounted(){this.getPolicies()}},Nu={class:"q-dialog-plugin",style:{width:"90vw","max-width":"90vw"}},Lu={class:"card-header ac jsb"},Iu={class:"flex gap-2 mb-2"},Bu={class:"scroll",style:{"min-height":"35vh","max-height":"35vh"}},Hu=["onClick"],Fu=["onClick"],ju=["onClick"],Ku=["onClick"],zu={class:"scroll",style:{"min-height":"25vh","max-height":"25vh"}},Qu={class:"scroll",style:{"min-height":"25vh","max-height":"25vh"}};function Wu(t,e,s,n,i,d){const o=qe("Icon"),r=qe("PolicyChecksTab"),u=qe("PolicyAutomatedTasksTab");return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[g("div",Nu,[l(ue,null,{default:a(()=>[g("div",Lu,[e[6]||(e[6]=g("div",{class:"text-h6"},"Automation Manager",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[5]||(e[5]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(I,null,{default:a(()=>[g("div",Iu,[g("button",{class:"btn btn-primary flex items-center gap-1",onClick:e[0]||(e[0]=(...c)=>d.showAddPolicyForm&&d.showAddPolicyForm(...c))},[l(o,{icon:"lucide:plus",width:"20",height:"20",class:"icon"}),e[7]||(e[7]=m(" New "))]),g("button",{class:"btn btn-out-primary flex items-center gap-1",onClick:e[1]||(e[1]=(...c)=>d.showPolicyOverview&&d.showPolicyOverview(...c))},e[8]||(e[8]=[g("i",{class:"mdi mdi-eye-outline"},null,-1),g("span",null,"Policy Overview",-1)]))]),g("div",Bu,[l(et,{"table-class":{"table-bgcolor":!t.$q.dark.isActive,"table-bgcolor-dark":t.$q.dark.isActive},class:"tabs-tbl-sticky",rows:i.policies,columns:i.columns,pagination:i.pagination,"onUpdate:pagination":e[2]||(e[2]=c=>i.pagination=c),"rows-per-page-options":[0],dense:"","row-key":"id","binary-state-sort":"","hide-pagination":"","virtual-scroll":"","no-data-label":"No Policies"},{"header-cell-active":a(c=>[l(Ke,{props:c,"auto-width":""},{default:a(()=>[l(K,{name:"power_settings_new",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[9]||(e[9]=[m("Enable Policy")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-enforced":a(c=>[l(Ke,{props:c,"auto-width":""},{default:a(()=>[l(K,{name:"security",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[10]||(e[10]=[m("Enforce Policy (Will override Agent tasks/checks)")])),_:1})]),_:1})]),_:2},1032,["props"])]),body:a(c=>[l(nt,{props:c,class:Bs(["cursor-pointer",d.rowSelectedClass(c.row.id,i.selectedPolicy)]),onClick:b=>i.selectedPolicy=c.row,onContextmenu:b=>i.selectedPolicy=c.row,onDblclick:b=>d.showEditPolicyForm(c.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:b=>d.showEditPolicyForm(c.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[11]||(e[11]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:b=>d.showCopyPolicyForm(c.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"content_copy"})]),_:1}),l(C,null,{default:a(()=>e[12]||(e[12]=[m("Copy")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:b=>d.deletePolicy(c.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[13]||(e[13]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:b=>d.showRelations(c.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"account_tree"})]),_:1}),l(C,null,{default:a(()=>e[14]||(e[14]=[m("Show Relations")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:b=>d.showPolicyExclusions(c.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"rule"})]),_:1}),l(C,null,{default:a(()=>e[15]||(e[15]=[m("Policy Exclusions")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:b=>d.showPatchPolicyForm(c.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"system_update"})]),_:1}),l(C,null,{default:a(()=>[m(F(d.patchPolicyText(c.row)),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:b=>d.showAlertTemplateAdd(c.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"warning"})]),_:1}),l(C,null,{default:a(()=>[m(F(d.alertTemplateText(c.row)),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[16]||(e[16]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[b=>d.toggleCheckbox(c.row,"Active"),b=>c.row.active=b],modelValue:c.row.active},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[b=>d.toggleCheckbox(c.row,"Enforced"),b=>c.row.enforced=b],modelValue:c.row.enforced},null,8,["onUpdate:modelValue","modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[m(F(c.row.name)+" ",1),c.row.default_server_policy?(f(),p(Xt,{key:0,color:"primary","text-color":"white",size:"sm"},{default:a(()=>e[17]||(e[17]=[m("Default Server")])),_:1})):G("",!0),c.row.default_workstation_policy?(f(),p(Xt,{key:1,color:"primary","text-color":"white",size:"sm"},{default:a(()=>e[18]||(e[18]=[m("Default Workstation")])),_:1})):G("",!0)]),_:2},1024),l(J,null,{default:a(()=>[m(F(c.row.desc),1)]),_:2},1024),l(J,null,{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},class:"text-primary",onClick:b=>d.showRelations(c.row)},F(`Show Relations (${c.row.agents_count})`),9,Hu)]),_:2},1024),l(J,null,{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},class:"text-primary",onClick:b=>d.showPolicyExclusions(c.row)},F(`Show Policy Exclusions (${c.row.excluded_agents.length+c.row.excluded_clients.length+c.row.excluded_sites.length})`),9,Fu)]),_:2},1024),l(J,null,{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},class:"text-primary",onClick:b=>d.showPatchPolicyForm(c.row)},F(d.patchPolicyText(c.row)),9,ju)]),_:2},1024),l(J,null,{default:a(()=>[g("span",{style:{cursor:"pointer","text-decoration":"underline"},class:"text-primary",onClick:b=>d.showAlertTemplateAdd(c.row)},F(d.alertTemplateText(c.row)),9,Ku)]),_:2},1024),l(J,null,{default:a(()=>[l(K,{name:"content_copy",size:"1.5em",onClick:b=>d.showCopyPolicyForm(c.row)},{default:a(()=>[l(j,null,{default:a(()=>e[19]||(e[19]=[m("Create a copy of this policy")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["props","class","onClick","onContextmenu","onDblclick"])]),_:1},8,["table-class","rows","columns","pagination"])])]),_:1}),l(I,null,{default:a(()=>[l(_l,{modelValue:i.subtab,"onUpdate:modelValue":e[3]||(e[3]=c=>i.subtab=c),dense:"","inline-label":"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","narrow-indicator":"","no-caps":""},{default:a(()=>[l(dt,{name:"checks",icon:"fas fa-check-double",label:"Checks"}),l(dt,{name:"tasks",icon:"fas fa-tasks",label:"Tasks"})]),_:1},8,["modelValue"]),l(de),l(Zl,{modelValue:i.subtab,"onUpdate:modelValue":e[4]||(e[4]=c=>i.subtab=c),animated:!1},{default:a(()=>[l(Ct,{name:"checks"},{default:a(()=>[g("div",zu,[i.selectedPolicy?(f(),p(r,{key:0,selectedPolicy:i.selectedPolicy.id},null,8,["selectedPolicy"])):G("",!0)])]),_:1}),l(Ct,{name:"tasks"},{default:a(()=>[g("div",Qu,[i.selectedPolicy?(f(),p(u,{key:0,selectedPolicy:i.selectedPolicy.id},null,8,["selectedPolicy"])):G("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})])]),_:1},8,["onHide"])}var Gu=Te(Mu,[["render",Wu]]);const Ju={name:"UserForm",emits:["cancel","ok","hide"],mixins:[it],props:{user:!Object},data(){return{localUser:{is_active:!0,block_dashboard_login:!1},roles:[],isPwd:!0}},computed:{disableSave(){return this.user?!!this.localUser.username:!!this.localUser.username&&!!this.localUser.password},title(){return this.user?"Edit User":"Add User"},...Fs(Hn,{logged_in_user:t=>t.username})},methods:{getRoles(){this.$axios.get("/accounts/roles/").then(t=>{this.roles=t.data.map(e=>({label:e.name,value:e.id}))})},onSubmit(){this.$q.loading.show(),delete this.localUser.last_login,this.user?(this.localUser.username===this.logged_in_user&&(delete this.localUser.is_active,delete this.localUser.deny_dashboard_login),this.$axios.put(`/accounts/${this.localUser.id}/users/`,this.localUser).then(()=>{this.$q.loading.hide(),this.onOk(),this.notifySuccess("User edited!")}).catch(()=>{this.$q.loading.hide()})):this.$axios.post("/accounts/users/",this.localUser).then(t=>{this.$q.loading.hide(),this.onOk(),this.notifySuccess(`User ${t.data} was added!`)}).catch(()=>{this.$q.loading.hide()})},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")},onOk(){this.$emit("ok"),this.hide()}},mounted(){this.getRoles(),this.user&&Object.assign(this.localUser,this.user)}},Yu={class:"text-h6"},Xu={class:"col-10"},Zu={class:"col-10"},ec={class:"col-10"},tc={class:"col-10"},lc={class:"col-10"},nc={class:"col-10"},sc={key:0},ac=["disabled"];function ic(t,e,s,n,i,d){return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{style:{"min-width":"85vh"}},{default:a(()=>[l(ct,{ref:"form",onSubmit:d.onSubmit},{default:a(()=>[l(I,{class:"row items-center"},{default:a(()=>[g("div",Yu,F(d.title),1),l(pe),O(l(E,{icon:"close",flat:"",round:"",dense:""},null,512),[[R]])]),_:1}),l(I,{class:"row"},{default:a(()=>[e[9]||(e[9]=g("div",{class:"col-2"},"Username:",-1)),g("div",Xu,[l(ge,{outlined:"",dense:"",modelValue:i.localUser.username,"onUpdate:modelValue":e[0]||(e[0]=o=>i.localUser.username=o),rules:[o=>!!o||"*Required"],class:"q-pa-none"},null,8,["modelValue","rules"])])]),_:1}),s.user?G("",!0):(f(),p(I,{key:0,class:"row"},{default:a(()=>[e[10]||(e[10]=g("div",{class:"col-2"},"Password:",-1)),g("div",Zu,[l(ge,{outlined:"",dense:"",modelValue:i.localUser.password,"onUpdate:modelValue":e[2]||(e[2]=o=>i.localUser.password=o),type:i.isPwd?"password":"text",rules:[o=>!!o||"*Required"],class:"q-pa-none"},{append:a(()=>[l(K,{name:i.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:e[1]||(e[1]=o=>i.isPwd=!i.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"])])]),_:1})),l(I,{class:"row"},{default:a(()=>[e[11]||(e[11]=g("div",{class:"col-2"},"Email:",-1)),g("div",ec,[l(ge,{outlined:"",dense:"",modelValue:i.localUser.email,"onUpdate:modelValue":e[3]||(e[3]=o=>i.localUser.email=o),rules:[o=>t.isValidEmail(o)||"Invalid email"],class:"q-pa-none"},null,8,["modelValue","rules"])])]),_:1}),l(I,{class:"row"},{default:a(()=>[e[12]||(e[12]=g("div",{class:"col-2"},"First Name:",-1)),g("div",tc,[l(ge,{outlined:"",dense:"",modelValue:i.localUser.first_name,"onUpdate:modelValue":e[4]||(e[4]=o=>i.localUser.first_name=o)},null,8,["modelValue"])])]),_:1}),l(I,{class:"row"},{default:a(()=>[e[13]||(e[13]=g("div",{class:"col-2"},"Last Name:",-1)),g("div",lc,[l(ge,{outlined:"",dense:"",modelValue:i.localUser.last_name,"onUpdate:modelValue":e[5]||(e[5]=o=>i.localUser.last_name=o)},null,8,["modelValue"])])]),_:1}),l(I,{class:"row"},{default:a(()=>[e[14]||(e[14]=g("div",{class:"col-2"},"Active:",-1)),g("div",nc,[l(W,{modelValue:i.localUser.is_active,"onUpdate:modelValue":e[6]||(e[6]=o=>i.localUser.is_active=o),disable:i.localUser.username===t.logged_in_user},null,8,["modelValue","disable"])])]),_:1}),l(I,{class:"row"},{default:a(()=>[e[15]||(e[15]=g("div",{class:"col-2"},"Role:",-1)),i.roles.length===0?(f(),ce("span",sc,"No roles have been created. Create some from Settings > Permissions Manager")):(f(),p(Qe,{key:1,"map-options":"","emit-value":"",outlined:"",dense:"","options-dense":"",modelValue:i.localUser.role,"onUpdate:modelValue":e[7]||(e[7]=o=>i.localUser.role=o),options:i.roles,class:"col-10"},null,8,["modelValue","options"]))]),_:1}),l(I,null,{default:a(()=>[l(W,{label:"Deny Dashboard Logins","left-label":"",modelValue:i.localUser.block_dashboard_login,"onUpdate:modelValue":e[8]||(e[8]=o=>i.localUser.block_dashboard_login=o),disable:i.localUser.username===t.logged_in_user},null,8,["modelValue","disable"])]),_:1}),l(I,{class:"card-footer ac je"},{default:a(()=>[g("button",{class:"btn btn-primary",type:"submit",disabled:!d.disableSave}," Save ",8,ac)]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var _s=Te(Ju,[["render",ic]]);const oc={name:"UserResetPasswordForm",emits:["cancel","ok","hide"],mixins:[it],props:{user:!Object},data(){return{password:"",isPwd:!0}},methods:{onSubmit(){this.$q.loading.show();let t={id:this.user.id,password:this.password};this.$axios.post("/accounts/users/reset/",t).then(()=>{this.onOk(),this.$q.loading.hide(),this.notifySuccess("User Password Reset!")}).catch(()=>{this.$q.loading.hide()})},show(){this.$refs.dialog.show()},hide(){this.$refs.dialog.hide()},onHide(){this.$emit("hide")},onOk(){this.$emit("ok"),this.hide()}}},rc={class:"text-h6"},dc={class:"col-10"};function uc(t,e,s,n,i,d){return f(),p(me,{ref:"dialog",onHide:d.onHide},{default:a(()=>[l(ue,{style:{width:"60vw"}},{default:a(()=>[l(ct,{ref:"form",onSubmit:d.onSubmit},{default:a(()=>[l(I,{class:"row items-center"},{default:a(()=>[g("div",rc,F(s.user.username)+" Password Reset",1),l(pe),O(l(E,{icon:"close",flat:"",round:"",dense:""},null,512),[[R]])]),_:1}),l(I,{class:"row"},{default:a(()=>[e[2]||(e[2]=g("div",{class:"col-2"},"New Password:",-1)),g("div",dc,[l(ge,{outlined:"",dense:"",modelValue:i.password,"onUpdate:modelValue":e[1]||(e[1]=o=>i.password=o),type:i.isPwd?"password":"text",rules:[o=>!!o||"*Required"]},{append:a(()=>[l(K,{name:i.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:e[0]||(e[0]=o=>i.isPwd=!i.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","rules"])])]),_:1}),l(I,{class:"row items-center"},{default:a(()=>[l(E,{label:"Reset",color:"primary",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var cc=Te(oc,[["render",uc]]);const fc=Me({__name:"SSOAccountsTable",props:{user:{}},emits:[...oe.emits],setup(t){const e=[{name:"display",label:"Display Name",field:"display",align:"left",sortable:!0},{name:"provider",label:"Provider",field:"provider",align:"left",sortable:!0},{name:"last_login",label:"Last Login",field:"last_login",align:"left",sortable:!0},{name:"date_joined",label:"Date Joined",field:"date_joined",align:"left",sortable:!0},{name:"action",label:"",field:"action",align:"left",sortable:!0}],s=t,{dialogRef:n,onDialogHide:i}=oe(),d=Ie(),o=Hn(),r=M(!1);function u(c){d.dialog({title:`Disconnect social account: ${c.display}?`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{r.value=!0;try{await Fo(c.provider,c.uid),Ve("Social account disconnected successfully"),o.username===s.user.username&&o.ssoLoginProvider===c.provider&&await o.logout()}finally{r.value=!1,i()}})}return(c,b)=>(f(),p(me,{ref_key:"dialogRef",ref:n,onHide:_(i)},{default:a(()=>[l(ue,{style:{width:"60vw","max-width":"90vw","min-height":"40vh"}},{default:a(()=>[l(De,null,{default:a(()=>[m(" Connected Social Accounts for "+F(c.user.username)+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>b[0]||(b[0]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(et,{dense:"","table-class":{"table-bgcolor":!_(d).dark.isActive,"table-bgcolor-dark":_(d).dark.isActive},style:Re({"max-height":`${_(d).screen.height-24}px`}),class:"tbl-sticky",rows:c.user.social_accounts,columns:e,loading:r.value,pagination:{rowsPerPage:0,sortBy:"display",descending:!0},"row-key":"id","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0]},{body:a(y=>[l(nt,null,{default:a(()=>[g("td",null,F(y.row.display),1),g("td",null,F(y.row.provider),1),g("td",null,F(_(Ql)(y.row.last_login)),1),g("td",null,F(_(Ql)(y.row.date_joined)),1),g("td",null,[l(E,{size:"sm",onClick:w=>u(y.row),label:"Disconnect",color:"negative"},null,8,["onClick"])])]),_:2},1024)]),_:1},8,["table-class","style","rows","loading"])]),_:1})]),_:1},8,["onHide"]))}}),mc=Me({__name:"UserSessionsTable",props:{user:{}},emits:[...oe.emits],setup(t){const e=[{name:"created",label:"Created",field:"created",align:"left",sortable:!0},{name:"expiry",label:"Expires",field:"expiry",align:"left",sortable:!0},{name:"action",label:"",field:"action",align:"left",sortable:!0}],s=t,{dialogRef:n,onDialogHide:i}=oe(),d=Ie(),o=M([]),r=M(!1);function u(y){d.dialog({title:`Disconnect session for ${y.user}?`,message:"This user will be signed out immediately.",cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{r.value=!0;try{await Oo(y.digest),Ve("Login session deleted successfully")}finally{r.value=!1,await b()}})}function c(){d.dialog({title:`Disconnect all sessions for ${s.user.username}?`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{r.value=!0;try{await qo(s.user.id),Ve("Login sessions deleted successfully")}finally{r.value=!1,i()}})}async function b(){o.value=await Ao(s.user.id)}return Le(b),(y,w)=>(f(),p(me,{ref_key:"dialogRef",ref:n,onHide:_(i)},{default:a(()=>[l(ue,{style:{width:"60vw","max-width":"90vw","min-height":"40vh"}},{default:a(()=>[l(De,null,{default:a(()=>[m(" User Sessions for "+F(y.user.username)+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>w[0]||(w[0]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(et,{dense:"","table-class":{"table-bgcolor":!_(d).dark.isActive,"table-bgcolor-dark":_(d).dark.isActive},style:Re({"max-height":`${_(d).screen.height-24}px`}),class:"tbl-sticky",rows:o.value,columns:e,loading:r.value,pagination:{rowsPerPage:0,sortBy:"display",descending:!0},"row-key":"id","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0]},{top:a(()=>[l(pe),l(E,{label:"Remove All Sessions",onClick:c,size:"sm",color:"negative"})]),body:a(k=>[l(nt,null,{default:a(()=>[g("td",null,F(_(Ql)(k.row.created)),1),g("td",null,F(_(Ql)(k.row.expiry)),1),g("td",null,[l(E,{size:"sm",onClick:x=>u(k.row),label:"Disconnect",color:"negative"},null,8,["onClick"])])]),_:2},1024)]),_:1},8,["table-class","style","rows","loading"])]),_:1})]),_:1},8,["onHide"]))}}),pc={name:"AdminManager",components:{Icon:He},mixins:[it],setup(){const t=Rt(),e=te(()=>t.getters.formatDate),s=Ie();function n(d){s.dialog({component:fc,componentProps:{user:d}})}async function i(d){s.dialog({component:mc,componentProps:{user:d}})}return{formatDate:e,showSSOAccounts:n,showSessions:i}},data(){return{users:[],columns:[{name:"is_active",label:"Active",field:"is_active",align:"left"},{name:"sso",label:"",field:"sso",align:"left",sortable:!0},{name:"username",label:"Username",field:"username",align:"left",sortable:!0},{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"email",label:"Email",field:"email",align:"left",sortable:!0},{name:"last_login",label:"Last Login",field:"last_login",align:"left",sortable:!0},{name:"last_login_ip",label:"Last Logon From",field:"last_login_ip",align:"left",sortable:!0}],pagination:{rowsPerPage:0,sortBy:"username",descending:!0}}},methods:{getUsers(){this.$q.loading.show(),this.$axios.get("/accounts/users/").then(t=>{this.users=t.data,this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},deleteUser(t){this.$q.dialog({title:`Delete user ${t.username}?`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(()=>{this.$axios.delete(`/accounts/${t.id}/users/`).then(()=>{this.getUsers(),this.notifySuccess(`User ${t.username} was deleted!`)})})},showEditUserModal(t){this.$q.dialog({component:_s,componentProps:{user:t}}).onOk(()=>{this.getUsers()})},showAddUserModal(){this.$q.dialog({component:_s}).onOk(()=>{this.getUsers()})},toggleEnabled(t){if(t.username===this.logged_in_user)return;let e=t.is_active?"User disabled successfully":"User enabled successfully";const s={id:t.id,is_active:!t.is_active};this.$axios.put(`/accounts/${s.id}/users/`,s).then(()=>{this.notifySuccess(e)})},ResetPassword(t){this.$q.dialog({component:cc,componentProps:{user:t}}).onOk(()=>{this.getUsers()})},reset2FA(t){const e={id:t.id};this.$q.dialog({title:`Reset 2FA for ${t.username}?`,cancel:!0,ok:{label:"Reset",color:"positive"}}).onOk(()=>{this.$axios.put("/accounts/users/reset_totp/",e).then(s=>{this.notifySuccess(s.data,4e3)})})}},computed:{...Fs(Hn,{logged_in_user:t=>t.username})},mounted(){this.getUsers()}},gc={class:"card-header ac jsb"},hc={class:"q-pa-md"},yc={class:"mb-2"},bc={class:"full-width row flex-center q-gutter-sm"},vc={key:0};function wc(t,e,s,n,i,d){const o=qe("Icon");return f(),p(ue,{style:{width:"65vw","max-width":"70vw","min-height":"50vh"}},{default:a(()=>[g("div",gc,[e[3]||(e[3]=g("div",{class:"text-h6"},"Users",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[2]||(e[2]=[m("Close")])),_:1})]),_:1})),[[R]])]),g("div",hc,[g("div",yc,[g("button",{onClick:e[0]||(e[0]=(...r)=>d.showAddUserModal&&d.showAddUserModal(...r)),class:"btn btn-primary btn-sm"},[l(o,{icon:"lucide:plus",class:"icon mr-2",width:"20",height:"20"}),e[4]||(e[4]=m(" Add User "))])]),l(et,{dense:"",rows:i.users,columns:i.columns,pagination:i.pagination,"onUpdate:pagination":e[1]||(e[1]=r=>i.pagination=r),"row-key":"id","binary-state-sort":"","hide-pagination":"","virtual-scroll":""},{"header-cell-is_active":a(r=>[l(Ke,{props:r,"auto-width":""},{default:a(()=>[l(K,{name:"power_settings_new",size:"1.5em"},{default:a(()=>[l(j,null,{default:a(()=>e[5]||(e[5]=[m("Enable User")])),_:1})]),_:1})]),_:2},1032,["props"])]),"header-cell-sso":a(r=>[l(Ke,{props:r,"auto-width":""},null,8,["props"])]),"no-data":a(()=>[g("div",bc,[i.users.length===0?(f(),ce("span",vc,"No Users")):G("",!0)])]),body:a(r=>[l(nt,{props:r,class:"cursor-pointer",onDblclick:u=>d.showEditUserModal(r.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:u=>d.showEditUserModal(r.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[6]||(e[6]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:u=>d.deleteUser(r.row),disable:r.row.username===t.logged_in_user},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[7]||(e[7]=[m("Delete")])),_:1})]),_:2},1032,["onClick","disable"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:u=>d.ResetPassword(r.row),id:"context-reset",disable:r.row.social_accounts.length!==0},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"autorenew"})]),_:1}),l(C,null,{default:a(()=>e[8]||(e[8]=[m("Reset Password")])),_:1})]),_:2},1032,["onClick","disable"])),[[R]]),O((f(),p(B,{clickable:"",onClick:u=>d.reset2FA(r.row),id:"context-reset",disable:r.row.social_accounts.length!==0},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"autorenew"})]),_:1}),l(C,null,{default:a(()=>e[9]||(e[9]=[m("Reset Two-Factor Auth")])),_:1})]),_:2},1032,["onClick","disable"])),[[R]]),l(de),O((f(),p(B,{clickable:"",onClick:u=>n.showSSOAccounts(r.row),id:"context-reset",disable:r.row.social_accounts.length===0},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"groups"})]),_:1}),l(C,null,{default:a(()=>e[10]||(e[10]=[m("Show Connected SSO Accounts")])),_:1})]),_:2},1032,["onClick","disable"])),[[R]]),O((f(),p(B,{clickable:"",onClick:u=>n.showSessions(r.row),id:"context-reset"},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"groups"})]),_:1}),l(C,null,{default:a(()=>e[11]||(e[11]=[m("Show Active Sessions")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[12]||(e[12]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),l(J,null,{default:a(()=>[l(W,{dense:"","onUpdate:modelValue":[u=>d.toggleEnabled(r.row),u=>r.row.is_active=u],modelValue:r.row.is_active,disable:r.row.username===t.logged_in_user},null,8,["onUpdate:modelValue","modelValue","disable"])]),_:2},1024),l(J,null,{default:a(()=>[r.row.social_accounts.length>0?(f(),p(Xt,{key:0,color:"primary",dense:""},{default:a(()=>e[13]||(e[13]=[m("SSO")])),_:1})):G("",!0)]),_:2},1024),l(J,null,{default:a(()=>[m(F(r.row.username),1)]),_:2},1024),l(J,null,{default:a(()=>[m(F(r.row.first_name)+" "+F(r.row.last_name),1)]),_:2},1024),l(J,null,{default:a(()=>[m(F(r.row.email),1)]),_:2},1024),r.row.last_login?(f(),p(J,{key:0},{default:a(()=>[m(F(n.formatDate(r.row.last_login)),1)]),_:2},1024)):(f(),p(J,{key:1},{default:a(()=>e[14]||(e[14]=[m("Never")])),_:1})),l(J,null,{default:a(()=>[m(F(r.row.last_login_ip),1)]),_:2},1024)]),_:2},1032,["props","onDblclick"])]),_:1},8,["rows","columns","pagination"])])]),_:1})}var kc=Te(pc,[["render",wc]]);const Pt=Vi({}),_c=Object.keys(js);var Sc=wl({name:"QExpansionItem",props:{...js,...Ks,...Ln,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:{},headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...zs,"click","afterShow","afterHide"],setup(t,{slots:e,emit:s}){const{proxy:{$q:n}}=kl(),i=In(t,n),d=M(t.modelValue!==null?t.modelValue:t.defaultOpened),o=M(null),r=Ci(),{show:u,hide:c,toggle:b}=Qs({showing:d});let y,w;const k=te(()=>`q-expansion-item q-item-type q-expansion-item--${d.value===!0?"expanded":"collapsed"} q-expansion-item--${t.popup===!0?"popup":"standard"}`),x=te(()=>{if(t.contentInsetLevel===void 0)return null;const v=n.lang.rtl===!0?"Right":"Left";return{["padding"+v]:t.contentInsetLevel*56+"px"}}),h=te(()=>t.disable!==!0&&(t.href!==void 0||t.to!==void 0&&t.to!==null&&t.to!=="")),V=te(()=>{const v={};return _c.forEach(U=>{v[U]=t[U]}),v}),D=te(()=>h.value===!0||t.expandIconToggle!==!0),T=te(()=>t.expandedIcon!==void 0&&d.value===!0?t.expandedIcon:t.expandIcon||n.iconSet.expansionItem[t.denseToggle===!0?"denseIcon":"icon"]),A=te(()=>t.disable!==!0&&(h.value===!0||t.expandIconToggle===!0)),N=te(()=>({expanded:d.value===!0,detailsId:r.value,toggle:b,show:u,hide:c})),S=te(()=>{const v=t.toggleAriaLabel!==void 0?t.toggleAriaLabel:n.lang.label[d.value===!0?"collapse":"expand"](t.label);return{role:"button","aria-expanded":d.value===!0?"true":"false","aria-controls":r.value,"aria-label":v}});be(()=>t.group,v=>{w!==void 0&&w(),v!==void 0&&fe()});function q(v){h.value!==!0&&b(v),s("click",v)}function P(v){v.keyCode===13&&H(v,!0)}function H(v,U){U!==!0&&o.value!==null&&o.value.focus(),b(v),gl(v)}function L(){s("afterShow")}function Z(){s("afterHide")}function fe(){y===void 0&&(y=An()),d.value===!0&&(Pt[t.group]=y);const v=be(d,Ce=>{Ce===!0?Pt[t.group]=y:Pt[t.group]===y&&delete Pt[t.group]}),U=be(()=>Pt[t.group],(Ce,$e)=>{$e===y&&Ce!==void 0&&Ce!==y&&c()});w=()=>{v(),U(),Pt[t.group]===y&&delete Pt[t.group],w=void 0}}function le(){const v={class:[`q-focusable relative-position cursor-pointer${t.denseToggle===!0&&t.switchToggleSide===!0?" items-end":""}`,t.expandIconClass],side:t.switchToggleSide!==!0,avatar:t.switchToggleSide},U=[ye(K,{class:"q-expansion-item__toggle-icon"+(t.expandedIcon===void 0&&d.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:T.value})];return A.value===!0&&(Object.assign(v,{tabindex:0,...S.value,onClick:H,onKeyup:P}),U.unshift(ye("div",{ref:o,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),ye(C,v,()=>U)}function Y(){let v;return e.header!==void 0?v=[].concat(e.header(N.value)):(v=[ye(C,()=>[ye(ve,{lines:t.labelLines},()=>t.label||""),t.caption?ye(ve,{lines:t.captionLines,caption:!0},()=>t.caption):null])],t.icon&&v[t.switchToggleSide===!0?"push":"unshift"](ye(C,{side:t.switchToggleSide===!0,avatar:t.switchToggleSide!==!0},()=>ye(K,{name:t.icon})))),t.disable!==!0&&t.hideExpandIcon!==!0&&v[t.switchToggleSide===!0?"unshift":"push"](le()),v}function X(){const v={ref:"item",style:t.headerStyle,class:t.headerClass,dark:i.value,disable:t.disable,dense:t.dense,insetLevel:t.headerInsetLevel};return D.value===!0&&(v.clickable=!0,v.onClick=q,Object.assign(v,h.value===!0?V.value:S.value)),ye(B,v,Y)}function ne(){return O(ye("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:x.value,id:r.value},Bn(e.default)),[[Ze,d.value]])}function $(){const v=[X(),ye(Zs,{duration:t.duration,onShow:L,onHide:Z},ne)];return t.expandSeparator===!0&&v.push(ye(de,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:i.value}),ye(de,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:i.value})),v}return t.group!==void 0&&fe(),Ws(()=>{w!==void 0&&w()}),()=>ye("div",{class:k.value},[ye("div",{class:"q-expansion-item__container relative-position"},$())])}});const Vc={name:"AgentDownload",mixins:[it],props:["info"]},Cc={key:0,class:"text-subtitle1"},Tc={key:1,class:"text-subtitle1"},xc={class:"q-pa-xs q-gutter-xs"},Ac={class:"q-pa-xs q-gutter-xs"},Oc={key:0,class:"q-pa-xs q-gutter-xs"},qc={key:1,class:"q-pa-xs q-gutter-xs"},$c={class:"q-pa-xs q-gutter-xs"},Rc={key:2,class:"q-pa-xs q-gutter-xs"},Dc={class:"q-pa-xs q-gutter-xs"},Uc={class:"q-pa-xs q-gutter-xs"},Pc={class:"text-italic"};function Ec(t,e,s,n,i,d){return f(),p(ue,{style:{"min-width":"70vw"}},{default:a(()=>[l(I,{class:"row"},{default:a(()=>[l(ze,{align:"left"},{default:a(()=>e[0]||(e[0]=[g("div",{class:"text-h6"},"Manual Installation Instructions",-1)])),_:1}),l(pe),l(ze,{align:"right"},{default:a(()=>[O(l(E,{flat:"",round:"",dense:"",icon:"close"},null,512),[[R]])]),_:1})]),_:1}),l(I,null,{default:a(()=>[s.info.plat==="windows"?(f(),ce("p",Cc," Download the agent then run the following command from an elevated command prompt on the device you want to add. ")):s.info.plat==="darwin"?(f(),ce("p",Tc," Run the following command from a terminal ")):G("",!0),g("p",null,[l(Fi,{outlined:"",color:t.$q.dark.isActive?"white":"black"},{default:a(()=>[g("code",null,F(s.info.data.cmd),1)]),_:1},8,["color"])]),l(Sc,{"switch-toggle-side":"","header-class":"text-primary","expand-separator":"",label:"View optional command line args"},{default:a(()=>[g("div",xc,[l(pt,{class:"text-caption q-mr-xs",color:"grey","text-color":"black"},{default:a(()=>e[1]||(e[1]=[g("code",null,"-log debug",-1)])),_:1}),e[2]||(e[2]=g("span",null,"To enable verbose output during the install",-1))]),g("div",Ac,[l(pt,{class:"text-caption q-mr-xs",color:"grey","text-color":"black"},{default:a(()=>e[3]||(e[3]=[g("code",null,"-silent",-1)])),_:1}),e[4]||(e[4]=g("span",null,"Do not popup any message boxes during install",-1))]),s.info.plat==="windows"?(f(),ce("div",Oc,[l(pt,{class:"text-caption q-mr-xs",color:"grey","text-color":"black"},{default:a(()=>e[5]||(e[5]=[g("code",null,'-local-mesh "C:\\\\<some folder or path>\\\\meshagent.exe"',-1)])),_:1}),e[6]||(e[6]=g("span",null," To skip downloading the Mesh Agent during the install.",-1))])):G("",!0),s.info.plat==="windows"?(f(),ce("div",qc,[l(pt,{class:"text-caption q-mr-xs",color:"grey","text-color":"black"},{default:a(()=>e[7]||(e[7]=[g("code",null,'-meshdir "C:\\Program Files\\Your Company Name\\Mesh Agent"',-1)])),_:1}),e[8]||(e[8]=g("span",null,"Specify full path to the directory containing MeshAgent.exe if using custom agent branding",-1))])):G("",!0),g("div",$c,[l(pt,{class:"text-caption q-mr-xs",color:"grey","text-color":"black"},{default:a(()=>e[9]||(e[9]=[g("code",null,"-nomesh",-1)])),_:1}),e[10]||(e[10]=g("span",null,"Don't install the mesh agent",-1))]),s.info.plat==="windows"?(f(),ce("div",Rc,[l(pt,{class:"text-caption q-mr-xs",color:"grey","text-color":"black"},{default:a(()=>e[11]||(e[11]=[g("code",null,'-cert "C:\\\\<some folder or path>\\\\ca.pem"',-1)])),_:1}),e[12]||(e[12]=g("span",null," To use a domain CA ",-1))])):G("",!0),g("div",Dc,[l(pt,{class:"text-caption q-mr-xs",color:"grey","text-color":"black"},{default:a(()=>e[13]||(e[13]=[g("code",null,'-desc "Desired custom description on agent"',-1)])),_:1}),e[14]||(e[14]=g("span",null," Set agent description field during install ",-1))]),g("div",Uc,[l(pt,{class:"text-caption q-mr-xs",color:"grey","text-color":"black"},{default:a(()=>e[15]||(e[15]=[g("code",null,'-proxy "http://proxyserver:port"',-1)])),_:1}),e[16]||(e[16]=g("span",null,"Use a http proxy",-1))])]),_:1}),e[17]||(e[17]=g("br",null,null,-1)),g("p",Pc," Note: the auth token above will be valid for "+F(s.info.expires)+" hours. ",1),s.info.plat==="windows"?(f(),p(E,{key:2,type:"a",href:s.info.data.url,class:"btn btn-primary",label:"Download Agent"},null,8,["href"])):G("",!0)]),_:1})]),_:1})}var Mc=Te(Vc,[["render",Ec]]);const Nc={name:"InstallAgent",mixins:[it],components:{AgentDownload:Mc},props:{sitepk:Number},data(){return{GOARCH_AMD64:Wl,GOARCH_i386:sa,GOARCH_ARM64:po,GOARCH_ARM32:go,client_options:[],client:null,site:null,agenttype:"server",expires:24,power:!1,rdp:!1,ping:!1,showAgentDownload:!1,info:{},installMethod:"exe",goarch:Wl,agentOS:"windows"}},methods:{getClients(){this.$q.loading.show(),this.$axios.get("/clients/").then(t=>{this.client_options=this.formatClientOptions(t.data),this.sitepk!==void 0&&this.sitepk!==null?this.client_options.forEach(e=>{let s=e.sites.find(n=>n.id===this.sitepk);s!==void 0&&(this.client=e,this.site={value:s.id,label:s.name})}):(this.client=this.client_options[0],this.site=this.sites[0]),this.$q.loading.hide()}).catch(()=>{this.$q.loading.hide()})},addAgent(){const t=ga(),e=this.client.label.replace(/\s/g,"").toLowerCase().replace(/([^a-zA-Z0-9]+)/g,""),s=this.site.label.replace(/\s/g,"").toLowerCase().replace(/([^a-zA-Z0-9]+)/g,""),n=`sonar-${e}-${s}-${this.agenttype}-${this.goarch}.exe`,i={installMethod:this.installMethod,client:this.client.value,site:this.site.value,expires:this.expires,agenttype:this.agenttype,power:this.power?1:0,rdp:this.rdp?1:0,ping:this.ping?1:0,goarch:this.goarch,api:t,fileName:n,plat:this.agentOS};if(this.installMethod==="manual"||this.installMethod==="mac")this.$axios.post("/agents/installer/",i).then(d=>{this.info={expires:this.expires,data:d.data,goarch:this.goarch,plat:this.agentOS},this.showAgentDownload=!0});else if(this.installMethod==="exe")this.$q.loading.show({message:"Generating executable..."}),this.$axios.post("/agents/installer/",i,{responseType:"blob"}).then(d=>{this.$q.loading.hide();const o=new Blob([d.data],{type:"application/vnd.microsoft.portable-executable"});let r=document.createElement("a");r.href=window.URL.createObjectURL(o),r.download=n,r.click(),this.showDLMessage()}).catch(()=>{this.$q.loading.hide()});else if(this.installMethod==="powershell"||this.installMethod==="bash"){this.$q.loading.show();let d=this.installMethod==="powershell"?"ps1":"sh";const o=`sonar-${e}-${s}-${this.agenttype}.${d}`;this.$axios.post("/agents/installer/",i,{responseType:"blob"}).then(({data:r})=>{this.$q.loading.hide();const u=new Blob([r],{type:"text/plain"});let c=document.createElement("a");c.href=window.URL.createObjectURL(u),c.download=o,c.click(),this.installMethod==="powershell"&&this.showDLMessage()}).catch(()=>{this.$q.loading.hide()})}},showDLMessage(){this.$q.dialog({message:`Installer for ${this.client.label}, ${this.site.label} (${this.agenttype}) will now be downloaded.
              You may reuse this installer for ${this.expires} hours before it expires. No command line arguments are needed.`})}},computed:{sites(){return this.client?this.formatSiteOptions(this.client.sites):[]},installButtonText(){let t;switch(this.installMethod){case"exe":t="Download Windows installer (.exe)";break;case"powershell":t="Get Powershell install script";break;case"manual":t="View manual setup instructions";break;case"bash":t="Download Linux install script (.sh)";break;case"mac":t="View macOS install instructions";break}return t}},mounted(){this.getClients()}},Lc={class:"q-gutter-sm p-2"},Ic={class:"q-gutter-sm p-2"},Bc={class:"q-gutter-sm p-2"},Hc={class:"ac flex-col"},Fc={class:"q-gutter-sm p-2"},jc={class:"q-gutter-sm p-2"},Kc={type:"submit",class:"btn btn-primary"};function zc(t,e,s,n,i,d){const o=qe("AgentDownload");return f(),p(ue,{style:{"min-width":"35vw"}},{default:a(()=>[l(I,{class:"card-header ac jsb"},{default:a(()=>[l(ze,{class:"pb-2",align:"left"},{default:a(()=>e[27]||(e[27]=[g("div",{class:"text-h6"},"Add an agent",-1)])),_:1}),l(pe),l(ze,{align:"right"},{default:a(()=>[O(l(E,{flat:"",round:"",dense:"",icon:"close"},null,512),[[R]])]),_:1})]),_:1}),l(I,{class:"p-2"},{default:a(()=>[l(ct,{onSubmit:qt(d.addAgent,["prevent"])},{default:a(()=>[l(I,{class:"q-gutter-sm p-2"},{default:a(()=>[l(Qe,{outlined:"",dense:"","options-dense":"",label:"Client",modelValue:i.client,"onUpdate:modelValue":[e[0]||(e[0]=r=>i.client=r),e[1]||(e[1]=r=>i.site=d.sites[0])],options:i.client_options},null,8,["modelValue","options"])]),_:1}),l(I,{class:"q-gutter-sm p-2"},{default:a(()=>[l(Qe,{dense:"","options-dense":"",outlined:"",label:"Site",modelValue:i.site,"onUpdate:modelValue":e[2]||(e[2]=r=>i.site=r),options:d.sites},null,8,["modelValue","options"])]),_:1}),l(I,{class:"p-2"},{default:a(()=>[g("div",Lc,[l(Xe,{modelValue:i.agentOS,"onUpdate:modelValue":[e[3]||(e[3]=r=>i.agentOS=r),e[4]||(e[4]=r=>{i.installMethod="exe",i.goarch=i.GOARCH_AMD64})],val:"windows",label:"Windows"},null,8,["modelValue"]),l(Xe,{modelValue:i.agentOS,"onUpdate:modelValue":[e[5]||(e[5]=r=>i.agentOS=r),e[6]||(e[6]=r=>{i.installMethod="bash",i.goarch=i.GOARCH_AMD64})],val:"linux",label:"Linux"},null,8,["modelValue"]),l(Xe,{modelValue:i.agentOS,"onUpdate:modelValue":[e[7]||(e[7]=r=>i.agentOS=r),e[8]||(e[8]=r=>{i.installMethod="mac",i.goarch=i.GOARCH_AMD64})],val:"darwin",label:"macOS"},null,8,["modelValue"])])]),_:1}),l(I,{class:"p-2"},{default:a(()=>[g("div",Ic,[l(Xe,{modelValue:i.agenttype,"onUpdate:modelValue":[e[9]||(e[9]=r=>i.agenttype=r),e[10]||(e[10]=r=>i.power=!1)],val:"server",label:"Server"},null,8,["modelValue"]),l(Xe,{modelValue:i.agenttype,"onUpdate:modelValue":e[11]||(e[11]=r=>i.agenttype=r),val:"workstation",label:"Workstation"},null,8,["modelValue"])])]),_:1}),l(I,{class:"p-2"},{default:a(()=>[g("div",Bc,[l(ge,{modelValue:i.expires,"onUpdate:modelValue":e[12]||(e[12]=r=>i.expires=r),modelModifiers:{number:!0},dense:"",type:"number",filled:"",label:"Token expiration (hours)",style:{"max-width":"200px"},"stack-label":""},null,8,["modelValue"])])]),_:1}),O(l(I,null,{default:a(()=>[g("div",Hc,[l(W,{modelValue:i.rdp,"onUpdate:modelValue":e[13]||(e[13]=r=>i.rdp=r),dense:"",label:"Enable Sonar Remote Access"},null,8,["modelValue"]),l(W,{modelValue:i.ping,"onUpdate:modelValue":e[14]||(e[14]=r=>i.ping=r),dense:"",label:"Enable Ping"},{default:a(()=>[l(j,null,{default:a(()=>e[28]||(e[28]=[m(" Enable ICMP echo requests in the local firewall ")])),_:1})]),_:1},8,["modelValue"]),O(l(W,{modelValue:i.power,"onUpdate:modelValue":e[15]||(e[15]=r=>i.power=r),dense:"",label:"Disable sleep/hibernate"},null,8,["modelValue"]),[[Ze,i.agenttype==="workstation"]])])]),_:1},512),[[Ze,i.agentOS==="windows"]]),l(I,{class:"p-2"},{default:a(()=>[e[29]||(e[29]=m(" Arch ")),g("div",Fc,[O(l(Xe,{modelValue:i.goarch,"onUpdate:modelValue":e[16]||(e[16]=r=>i.goarch=r),val:i.GOARCH_AMD64,label:"64 bit"},null,8,["modelValue","val"]),[[Ze,i.agentOS==="windows"||i.agentOS==="linux"]]),O(l(Xe,{modelValue:i.goarch,"onUpdate:modelValue":e[17]||(e[17]=r=>i.goarch=r),val:i.GOARCH_AMD64,label:"Intel 64 bit"},null,8,["modelValue","val"]),[[Ze,i.agentOS==="darwin"]]),O(l(Xe,{modelValue:i.goarch,"onUpdate:modelValue":e[18]||(e[18]=r=>i.goarch=r),val:i.GOARCH_i386,label:"32 bit"},null,8,["modelValue","val"]),[[Ze,i.agentOS!=="darwin"]]),O(l(Xe,{modelValue:i.goarch,"onUpdate:modelValue":e[19]||(e[19]=r=>i.goarch=r),val:i.GOARCH_ARM64,label:"ARM 64 bit"},null,8,["modelValue","val"]),[[Ze,i.agentOS==="linux"]]),O(l(Xe,{modelValue:i.goarch,"onUpdate:modelValue":e[20]||(e[20]=r=>i.goarch=r),val:i.GOARCH_ARM64,label:"Apple Silicon (M-Series)"},null,8,["modelValue","val"]),[[Ze,i.agentOS==="darwin"]]),O(l(Xe,{modelValue:i.goarch,"onUpdate:modelValue":e[21]||(e[21]=r=>i.goarch=r),val:i.GOARCH_ARM32,label:"ARM 32 bit"},null,8,["modelValue","val"]),[[Ze,i.agentOS==="linux"]])])]),_:1}),l(I,{class:"p-2"},{default:a(()=>[e[30]||(e[30]=m(" Installation Method ")),g("div",jc,[O(l(Xe,{modelValue:i.installMethod,"onUpdate:modelValue":e[22]||(e[22]=r=>i.installMethod=r),val:"exe",label:"Dynamically generated exe"},null,8,["modelValue"]),[[Ze,i.agentOS==="windows"]]),O(l(Xe,{modelValue:i.installMethod,"onUpdate:modelValue":e[23]||(e[23]=r=>i.installMethod=r),val:"powershell",label:"Powershell"},null,8,["modelValue"]),[[Ze,i.agentOS==="windows"]]),O(l(Xe,{modelValue:i.installMethod,"onUpdate:modelValue":e[24]||(e[24]=r=>i.installMethod=r),val:"manual",label:"Manual"},null,8,["modelValue"]),[[Ze,i.agentOS==="windows"]])])]),_:1}),l(ze,{class:"top-border pt-2",align:"center"},{default:a(()=>[g("button",Kc,F(d.installButtonText),1)]),_:1})]),_:1},8,["onSubmit"])]),_:1}),l(me,{modelValue:i.showAgentDownload,"onUpdate:modelValue":e[26]||(e[26]=r=>i.showAgentDownload=r)},{default:a(()=>[l(o,{info:i.info,onClose:e[25]||(e[25]=r=>i.showAgentDownload=!1)},null,8,["info"])]),_:1},8,["modelValue"])]),_:1})}var Qc=Te(Nc,[["render",zc]]);const Wc=[{label:"All",value:"all"},{label:"Servers",value:"servers"},{label:"Workstations",value:"workstations"}],Dl=[{label:"Windows",value:"windows"},{label:"Linux",value:"linux"},{label:"macOS",value:"darwin"},{label:"All",value:"all"}],Gc=[{label:"Client",value:"client"},{label:"Site",value:"site"},{label:"Selected Agents",value:"agents"},{label:"All",value:"all"}],Jc=[{label:"Scan",value:"scan"},{label:"Install",value:"install"}],Yc=Me({name:"BulkAction",components:{TacticalDropdown:Fe},emits:[...oe.emits],props:{mode:!String},setup(t){const e=te(()=>L.osType==="windows"?[{label:"CMD",value:"cmd"},{label:"Powershell",value:"powershell"}]:[{label:"Bash",value:"/bin/bash"},{label:"Custom",value:"custom"}]),s=te(()=>t.mode==="command"?Dl.filter(ne=>ne.value!=="all"):t.mode==="patch"?Dl.filter(ne=>ne.value==="windows"):Dl),{dialogRef:n,onDialogHide:i}=oe(),{script:d,plat:o,filterByPlatformOptions:r,defaultTimeout:u,defaultArgs:c,defaultEnvVars:b,syntax:y,link:w,getScriptOptions:k}=qn(),{agents:x,agentOptions:h,getAgentOptions:V}=Kn(),{site:D,siteOptions:T,getSiteOptions:A}=ln(),{client:N,clientOptions:S,getClientOptions:q}=tn(),{customFieldOptions:P}=ho({onMount:!0});function H(){w.value&&Ki(w.value)}const L=mt({mode:t.mode,target:"client",monType:"all",osType:"windows",cmd:"",shell:"cmd",custom_shell:null,custom_field:null,collector_all_output:!1,save_to_agent_note:!1,patchMode:"scan",offlineAgents:!1,client:N,site:D,agents:x,script:d,timeout:u,args:c,env_vars:b,run_as_user:!1}),Z=M(!1),fe=M(!1);be(()=>L.target,()=>{N.value=null,D.value=null,x.value=[]}),o.value=L.osType,be(()=>L.osType,ne=>{L.custom_shell=null,L.run_as_user=!1,ne==="windows"?L.shell="cmd":L.shell="/bin/bash",ne==="all"?o.value=void 0:o.value=ne});async function le(){Z.value=!0;try{const ne=await zi(L);Ve(ne),i()}catch{}Z.value=!1}const Y=()=>{const ne=["script","command"];return L.osType==="windows"&&ne.includes(L.mode)},X=te(()=>t.mode==="command"?"Run Bulk Command":t.mode==="script"?"Run Bulk Script":t.mode==="patch"?"Bulk Patch Management":"");return Le(()=>{V(),A(),q(),t.mode==="script"&&k()}),{state:L,agentOptions:h,clientOptions:S,collector:fe,customFieldOptions:P,siteOptions:T,filterByPlatformOptions:r,loading:Z,shellOptions:e,filteredOsTypeOptions:s,monTypeOptions:Wc,osTypeOptions:Dl,targetOptions:Gc,patchModeOptions:Jc,runAsUserToolTip:yo,envVarsLabel:na,syntax:y,modalTitle:X,submit:le,cmdPlaceholder:$o,supportsRunAsUser:Y,openScriptURL:H,formatScriptSyntax:Ti,dialogRef:n,onDialogHide:i}}}),Xc={class:"card-header ac jsb"},Zc={class:"text-h6"},ef={class:"q-gutter-sm"},tf={class:"card-footer ac je gap-2",align:"right"},lf=["disable","loading"];function nf(t,e,s,n,i,d){const o=qe("tactical-dropdown");return f(),p(me,{ref:"dialogRef",onHide:t.onDialogHide},{default:a(()=>[l(ue,{class:"q-dialog-plugin",style:{"min-width":"50vw"}},{default:a(()=>[g("div",Xc,[g("div",Zc,F(t.modalTitle),1),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[24]||(e[24]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(ct,{onSubmit:qt(t.submit,["prevent"])},{default:a(()=>[l(I,null,{default:a(()=>[e[25]||(e[25]=g("p",null,"Choose Target",-1)),l(St,{modelValue:t.state.target,"onUpdate:modelValue":e[0]||(e[0]=r=>t.state.target=r),options:t.targetOptions,color:"primary",dense:"",inline:"",class:"q-pl-sm"},null,8,["modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[t.state.target==="client"?(f(),p(o,{key:0,rules:[r=>!!r||"*Required"],modelValue:t.state.client,"onUpdate:modelValue":e[1]||(e[1]=r=>t.state.client=r),options:t.clientOptions,label:"Select Client",outlined:"",mapOptions:"",filterable:""},null,8,["rules","modelValue","options"])):t.state.target==="site"?(f(),p(o,{key:1,rules:[r=>!!r||"*Required"],modelValue:t.state.site,"onUpdate:modelValue":e[2]||(e[2]=r=>t.state.site=r),options:t.siteOptions,label:"Select Site",outlined:"",mapOptions:"",filterable:""},null,8,["rules","modelValue","options"])):t.state.target==="agents"?(f(),p(o,{key:2,rules:[r=>!!r||"*Required"],modelValue:t.state.agents,"onUpdate:modelValue":e[3]||(e[3]=r=>t.state.agents=r),options:t.agentOptions,label:"Select Agents",filled:"",multiple:"",mapOptions:"",filterable:""},null,8,["rules","modelValue","options"])):G("",!0)]),_:1}),l(I,null,{default:a(()=>[e[26]||(e[26]=g("p",null,"Agent OS",-1)),l(St,{modelValue:t.state.osType,"onUpdate:modelValue":e[4]||(e[4]=r=>t.state.osType=r),options:t.filteredOsTypeOptions,color:"primary",dense:"",inline:"",class:"q-pl-sm"},null,8,["modelValue","options"])]),_:1}),O(l(I,null,{default:a(()=>[e[27]||(e[27]=g("p",null,"Agent Type",-1)),l(St,{modelValue:t.state.monType,"onUpdate:modelValue":e[5]||(e[5]=r=>t.state.monType=r),options:t.monTypeOptions,color:"primary",dense:"",inline:"",class:"q-pl-sm"},null,8,["modelValue","options"])]),_:1},512),[[Ze,t.state.target!=="agents"]]),t.mode==="script"?(f(),p(I,{key:0,class:"q-pt-none"},{default:a(()=>[l(o,{rules:[r=>!!r||"*Required"],modelValue:t.state.script,"onUpdate:modelValue":e[6]||(e[6]=r=>t.state.script=r),options:t.filterByPlatformOptions,label:"Select Script",outlined:"",mapOptions:"",filterable:""},{after:a(()=>[l(E,{size:"sm",round:"",dense:"",flat:"",icon:"info",onClick:t.openScriptURL},{default:a(()=>[t.syntax?(f(),p(j,{key:0,class:"bg-white text-primary text-body1",innerHTML:t.formatScriptSyntax(t.syntax)},null,8,["innerHTML"])):G("",!0)]),_:1},8,["onClick"])]),_:1},8,["rules","modelValue","options"])]),_:1})):G("",!0),t.mode==="script"?(f(),p(I,{key:1,class:"q-pt-none"},{default:a(()=>[l(o,{modelValue:t.state.args,"onUpdate:modelValue":e[7]||(e[7]=r=>t.state.args=r),label:"Script Arguments (press Enter after typing each argument)",filled:"","use-input":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add"},null,8,["modelValue"])]),_:1})):G("",!0),t.mode==="script"?(f(),p(I,{key:2,class:"q-pt-none"},{default:a(()=>[l(o,{modelValue:t.state.env_vars,"onUpdate:modelValue":e[8]||(e[8]=r=>t.state.env_vars=r),label:t.envVarsLabel,filled:"","use-input":"",multiple:"","hide-dropdown-icon":"","input-debounce":"0","new-value-mode":"add"},null,8,["modelValue","label"])]),_:1})):G("",!0),t.mode==="command"?(f(),p(I,{key:3},{default:a(()=>[e[28]||(e[28]=g("p",null,"Shell",-1)),l(St,{modelValue:t.state.shell,"onUpdate:modelValue":[e[9]||(e[9]=r=>t.state.shell=r),e[10]||(e[10]=r=>t.state.custom_shell=null)],options:t.shellOptions,color:"primary",dense:"",inline:"",class:"q-pl-sm"},null,8,["modelValue","options"])]),_:1})):G("",!0),t.state.shell==="custom"?(f(),p(I,{key:4},{default:a(()=>[l(ge,{modelValue:t.state.custom_shell,"onUpdate:modelValue":e[11]||(e[11]=r=>t.state.custom_shell=r),outlined:"",label:"Custom shell","stack-label":"",placeholder:"/usr/bin/python3",rules:[r=>!!r||"*Required"]},null,8,["modelValue","rules"])]),_:1})):G("",!0),t.mode==="command"?(f(),p(I,{key:5},{default:a(()=>[l(ge,{modelValue:t.state.cmd,"onUpdate:modelValue":e[12]||(e[12]=r=>t.state.cmd=r),outlined:"",label:"Command","stack-label":"",placeholder:t.cmdPlaceholder(t.state.shell),rules:[r=>!!r||"*Required"]},null,8,["modelValue","placeholder","rules"])]),_:1})):G("",!0),t.supportsRunAsUser()?(f(),p(I,{key:6,class:"q-pt-none"},{default:a(()=>[l(W,{modelValue:t.state.run_as_user,"onUpdate:modelValue":e[13]||(e[13]=r=>t.state.run_as_user=r),label:"Run As User"},{default:a(()=>[l(j,null,{default:a(()=>[m(F(t.runAsUserToolTip),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})):G("",!0),t.mode==="script"?(f(),p(I,{key:7,class:"q-pt-none"},{default:a(()=>[g("div",ef,[l(W,{label:"Save results to Custom Field",modelValue:t.collector,"onUpdate:modelValue":[e[14]||(e[14]=r=>t.collector=r),e[15]||(e[15]=r=>{t.state.custom_field=null,t.state.collector_all_output=!1})]},null,8,["modelValue"]),l(W,{modelValue:t.state.save_to_agent_note,"onUpdate:modelValue":e[16]||(e[16]=r=>t.state.save_to_agent_note=r),label:"Save results to Agent Note"},null,8,["modelValue"])])]),_:1})):G("",!0),t.mode==="script"&&t.collector?(f(),p(I,{key:8},{default:a(()=>[l(o,{rules:[r=>!!r||"*Required"],outlined:"",modelValue:t.state.custom_field,"onUpdate:modelValue":e[17]||(e[17]=r=>t.state.custom_field=r),options:t.customFieldOptions,label:"Select custom field",mapOptions:"",filterable:""},null,8,["rules","modelValue","options"]),l(W,{modelValue:t.state.collector_all_output,"onUpdate:modelValue":e[18]||(e[18]=r=>t.state.collector_all_output=r),label:"Save all output"},null,8,["modelValue"])]),_:1})):G("",!0),t.mode==="script"||t.mode==="command"?(f(),p(I,{key:9},{default:a(()=>[l(ge,{modelValue:t.state.timeout,"onUpdate:modelValue":e[19]||(e[19]=r=>t.state.timeout=r),modelModifiers:{number:!0},dense:"",outlined:"",type:"number",style:{"max-width":"150px"},label:"Timeout (seconds)","stack-label":"",rules:[r=>!!r||"*Required",r=>r>=5||"Minimum is 5 seconds"]},null,8,["modelValue","rules"])]),_:1})):G("",!0),t.mode==="patch"?(f(),p(I,{key:10},{default:a(()=>[e[29]||(e[29]=g("p",null,"Action",-1)),l(St,{modelValue:t.state.patchMode,"onUpdate:modelValue":e[20]||(e[20]=r=>t.state.patchMode=r),options:t.patchModeOptions,color:"primary",dense:"",inline:"",class:"q-pl-sm"},null,8,["modelValue","options"])]),_:1})):G("",!0),O(l(I,null,{default:a(()=>[l(W,{modelValue:t.state.offlineAgents,"onUpdate:modelValue":e[21]||(e[21]=r=>t.state.offlineAgents=r),label:"Offline Agents (Run on next checkin)"},{default:a(()=>[l(j,null,{default:a(()=>e[30]||(e[30]=[m("If the agent is offline, a pending action will be created to run on agent checkin")])),_:1})]),_:1},8,["modelValue"])]),_:1},512),[[Ze,!1]]),g("div",tf,[g("button",{type:"button",class:"btn btn-secondary",onClick:e[22]||(e[22]=(...r)=>t.hide&&t.hide(...r))}," Cancel "),g("button",{label:"Run",color:"primary",type:"submit",disable:t.loading,loading:t.loading,class:"btn btn-primary",onClick:e[23]||(e[23]=(...r)=>t.openDocs&&t.openDocs(...r))}," Run ",8,lf)])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var sf=Te(Yc,[["render",nf]]);const af={name:"NewDeployment",components:{TacticalDropdown:Fe},emits:[...oe.emits],setup(){const{dialogRef:t,onDialogHide:e,onDialogOK:s}=oe(),{siteOptions:n}=ln(!0),i=M({site:null,expires:xi(Ai.addToDate(Date.now(),{days:30})),agenttype:"server",power:!1,rdp:!1,ping:!1,goarch:Wl}),d=M(!1);async function o(){d.value=!0;const r={...i.value};r.expires&&(r.expires=Oi(r.expires));try{const u=await Ro(r);Ve(u),s()}catch(u){console.error(u)}d.value=!1}return{state:i,loading:d,siteOptions:n,submit:o,dialogRef:t,onDialogHide:e,GOARCH_AMD64:Wl,GOARCH_i386:sa}}};function of(t,e,s,n,i,d){const o=qe("tactical-dropdown");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{style:{width:"40vw"}},{default:a(()=>[l(De,null,{default:a(()=>[e[10]||(e[10]=m(" Add Deployment ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"})]),_:1})),[[R]])]),_:1}),l(I,null,{default:a(()=>[l(o,{rules:[r=>!!r||"*Required"],outlined:"",label:"Site",modelValue:n.state.site,"onUpdate:modelValue":e[0]||(e[0]=r=>n.state.site=r),options:n.siteOptions,mapOptions:"",filterable:""},null,8,["rules","modelValue","options"])]),_:1}),l(I,null,{default:a(()=>[e[11]||(e[11]=g("div",{class:"q-pl-sm"},"Agent Type",-1)),l(Xe,{modelValue:n.state.agenttype,"onUpdate:modelValue":[e[1]||(e[1]=r=>n.state.agenttype=r),e[2]||(e[2]=r=>t.power=!1)],val:"server",label:"Server"},null,8,["modelValue"]),l(Xe,{modelValue:n.state.agenttype,"onUpdate:modelValue":e[3]||(e[3]=r=>n.state.agenttype=r),val:"workstation",label:"Workstation"},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(ge,{type:"datetime-local",dense:"",label:"Expiry","stack-label":"",filled:"",modelValue:n.state.expires,"onUpdate:modelValue":e[4]||(e[4]=r=>n.state.expires=r)},null,8,["modelValue"])]),_:1}),l(I,{class:"q-gutter-sm"},{default:a(()=>[l(W,{modelValue:n.state.rdp,"onUpdate:modelValue":e[5]||(e[5]=r=>n.state.rdp=r),dense:"",label:"Enable RDP"},null,8,["modelValue"]),l(W,{modelValue:n.state.ping,"onUpdate:modelValue":e[6]||(e[6]=r=>n.state.ping=r),dense:"",label:"Enable Ping"},null,8,["modelValue"]),O(l(W,{modelValue:n.state.power,"onUpdate:modelValue":e[7]||(e[7]=r=>n.state.power=r),dense:"",label:"Disable sleep/hibernate"},null,8,["modelValue"]),[[Ze,n.state.agenttype==="workstation"]])]),_:1}),l(I,null,{default:a(()=>[e[12]||(e[12]=g("div",{class:"q-pl-sm"},"Arch",-1)),l(Xe,{modelValue:n.state.goarch,"onUpdate:modelValue":e[8]||(e[8]=r=>n.state.goarch=r),val:n.GOARCH_AMD64,label:"64 bit"},null,8,["modelValue","val"]),l(Xe,{modelValue:n.state.goarch,"onUpdate:modelValue":e[9]||(e[9]=r=>n.state.goarch=r),val:n.GOARCH_i386,label:"32 bit"},null,8,["modelValue","val"])]),_:1}),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{loading:n.loading,dense:"",flat:"",label:"Create",color:"primary",onClick:n.submit},null,8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["onHide"])}var rf=Te(af,[["render",of]]);const df=[{name:"client",label:"Client",field:"client_name",align:"left",sortable:!0},{name:"site",label:"Site",field:"site_name",align:"left",sortable:!0},{name:"mon_type",label:"Type",field:"mon_type",align:"left",sortable:!0},{name:"goarch",label:"Arch",field:"goarch",align:"left",sortable:!0},{name:"expiry",label:"Expiry",field:"expiry",align:"left",sortable:!0},{name:"created",label:"Created",field:"created",align:"left",sortable:!0},{name:"flags",label:"Flags",field:"install_flags",align:"left"},{name:"link",label:"Download Link",align:"left"}],uf={name:"DeploymentTable",emits:[...oe.emits],setup(){const{dialogRef:t,onDialogHide:e}=oe(),s=Ie(),n=Rt(),i=te(()=>n.getters.formatDate),d=M([]),o=M(!1);async function r(){o.value=!0,d.value=await Do(),o.value=!1}function u(y){s.dialog({title:"Delete deployment?",cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{o.value=!0;try{const w=await Uo(y.id);Ve(w),await r()}catch(w){console.error(w)}o.value=!1})}function c(y){const w=ga();ua(`${w}/clients/${y.uid}/deploy/`).then(()=>{Ve("Link copied to clipboard",1500)})}function b(){s.dialog({component:rf}).onOk(r)}return Le(r),{deployments:d,loading:o,columns:df,getDeployments:r,deleteDeployment:u,showAddDeployment:b,copyLink:c,formatDate:i,dialogRef:t,onDialogHide:e}},components:{Icon:He}},cf={class:"card-header ac jsb"};function ff(t,e,s,n,i,d){const o=qe("Icon");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{style:{"min-width":"70vw",height:"70vh"}},{default:a(()=>[g("div",cf,[e[1]||(e[1]=g("h6",{class:"text-h6"},"Manage Deployments",-1)),O(l(E,{dense:"",flat:"",icon:"close"},null,512),[[R]])]),l(et,{dense:"","table-class":{"table-bgcolor":!t.$q.dark.isActive,"table-bgcolor-dark":t.$q.dark.isActive},class:"audit-mgr-tbl-sticky",style:{"max-height":"65vh"},"binary-state-sort":"","virtual-scroll":"",rows:n.deployments,columns:n.columns,"rows-per-page-options":[0],"row-key":"id",pagination:{rowsPerPage:0,sortBy:"id",descending:!0},"no-data-label":"No Deployments",loading:n.loading},{top:a(()=>[g("button",{class:"btn btn-primary ac",onClick:e[0]||(e[0]=(...r)=>n.showAddDeployment&&n.showAddDeployment(...r))},[l(o,{icon:"lucide:plus",width:"20",height:"20",class:"icon mr-2"}),e[2]||(e[2]=m(" New "))])]),body:a(r=>[l(nt,{props:r,class:"cursor-pointer",onDblclick:u=>n.copyLink(r.row)},{default:a(()=>[l(Ne,{"context-menu":"","auto-close":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[l(B,{clickable:"",onClick:u=>n.deleteDeployment(r.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[3]||(e[3]=[m("Delete")])),_:1})]),_:2},1032,["onClick"]),l(de),l(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[4]||(e[4]=[m("Close")])),_:1})]),_:1})]),_:2},1024)]),_:2},1024),l(J,{key:"client",props:r},{default:a(()=>[m(F(r.row.client_name),1)]),_:2},1032,["props"]),l(J,{key:"site",props:r},{default:a(()=>[m(F(r.row.site_name),1)]),_:2},1032,["props"]),l(J,{key:"mon_type",props:r},{default:a(()=>[m(F(r.row.mon_type),1)]),_:2},1032,["props"]),l(J,{key:"goarch",props:r},{default:a(()=>[m(F(r.row.goarch),1)]),_:2},1032,["props"]),l(J,{key:"expiry",props:r},{default:a(()=>[m(F(n.formatDate(r.row.expiry)),1)]),_:2},1032,["props"]),l(J,{key:"created",props:r},{default:a(()=>[m(F(n.formatDate(r.row.created)),1)]),_:2},1032,["props"]),l(J,{key:"flags",props:r},{default:a(()=>[l(pt,{color:"grey-8",label:"View Flags"}),l(j,{style:{"font-size":"12px"}},{default:a(()=>[m(F(r.row.install_flags),1)]),_:2},1024)]),_:2},1032,["props"]),l(J,{key:"link",props:r},{default:a(()=>[l(E,{flat:"",dense:"",size:"sm",color:"primary",icon:"content_copy",label:"Copy",onClick:u=>n.copyLink(r.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props","onDblclick"])]),_:1},8,["table-class","rows","columns","loading"])]),_:1})]),_:1},8,["onHide"])}var mf=Te(uf,[["render",ff]]);const pf={name:"ServerMaintenance",mixins:[it],data(){return{action:null,prune_tables:[],actions:[{label:"Reload Nats Configuration",value:"reload_nats"},{label:"Remove Orphaned Tasks",value:"rm_orphaned_tasks"},{label:"Prune DB Tables",value:"prune_db"}]}},methods:{clear(){this.prune_tables=[]},submit(){this.$q.loading.show();let t={action:this.action,prune_tables:this.prune_tables};this.$axios.post("core/servermaintenance/",t).then(e=>{this.$q.loading.hide(),this.notifySuccess(e.data)}).catch(()=>{this.$q.loading.hide()})}}},gf={class:"card-header ac jsb"};function hf(t,e,s,n,i,d){return f(),p(ue,{style:{"min-width":"400px"}},{default:a(()=>[g("div",gf,[e[5]||(e[5]=g("div",{class:"text-h6"},"Server Maintenance",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>e[4]||(e[4]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(I,null,{default:a(()=>[l(ct,{onSubmit:qt(d.submit,["prevent"])},{default:a(()=>[l(I,null,{default:a(()=>[l(Qe,{rules:[o=>!!o||"*Required"],outlined:"","options-dense":"",label:"Actions",modelValue:i.action,"onUpdate:modelValue":[e[0]||(e[0]=o=>i.action=o),d.clear],options:i.actions,"emit-value":"","map-options":""},null,8,["rules","modelValue","options","onUpdate:modelValue"])]),_:1}),i.action==="prune_db"?(f(),p(I,{key:0},{default:a(()=>[l(W,{modelValue:i.prune_tables,"onUpdate:modelValue":e[1]||(e[1]=o=>i.prune_tables=o),val:"audit_logs",label:"Audit Log"},{default:a(()=>[l(j,null,{default:a(()=>e[6]||(e[6]=[m("Removes agent check results")])),_:1})]),_:1},8,["modelValue"]),l(W,{modelValue:i.prune_tables,"onUpdate:modelValue":e[2]||(e[2]=o=>i.prune_tables=o),val:"pending_actions",label:"Pending Actions"},{default:a(()=>[l(j,null,{default:a(()=>e[7]||(e[7]=[m("Removes completed pending actions")])),_:1})]),_:1},8,["modelValue"]),l(W,{modelValue:i.prune_tables,"onUpdate:modelValue":e[3]||(e[3]=o=>i.prune_tables=o),val:"alerts",label:"Alerts"},{default:a(()=>[l(j,null,{default:a(()=>e[8]||(e[8]=[m("Removes all alerts")])),_:1})]),_:1},8,["modelValue"])]),_:1})):G("",!0),l(ze,{align:"left"},{default:a(()=>e[9]||(e[9]=[g("button",{class:"btn btn-primary w-full",type:"submit"},"Submit",-1)])),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})}var yf=Te(pf,[["render",hf]]);const Ul="/core/codesign/",bf={name:"CodeSign",setup(){const t=Ie(),e=M({token:""}),s=M(!1),n=M(!1);async function i(){try{const{data:c}=await Ae.get(Ul);e.value=c}catch(c){console.error(c)}}async function d(){try{await Ae.delete(Ul),Ve("Token was deleted!"),n.value=!1,await i()}catch(c){console.error(c)}}function o(){t.dialog({title:"Delete token?",cancel:!0,persistent:!0}).onOk(()=>{d()})}async function r(){s.value=!0;try{const{data:c}=await Ae.post(Ul);s.value=!1,Ve(c)}catch(c){s.value=!1,console.error(c)}}async function u(){t.loading.show();try{const{data:c}=await Ae.patch(Ul,e.value);Ve(c),n.value=!0}catch(c){n.value=!1,console.error(c)}finally{t.loading.hide()}}return Le(()=>{i()}),{settings:e,loading:s,canCodeSign:n,confirmDelete:o,doCodeSign:r,checkToken:u}}},vf={class:"ac col-12"},wf={class:"card-footer ac je"},kf=["disabled"];function _f(t,e,s,n,i,d){return f(),p(ue,{style:{"min-width":"85vh"}},{default:a(()=>[l(I,{class:"card-header ac jsb"},{default:a(()=>[e[3]||(e[3]=g("div",{class:"text-h6"},"Code Signing",-1)),O(l(E,{icon:"close",flat:"",round:"",dense:""},null,512),[[R]])]),_:1}),l(ct,{onSubmit:qt(n.checkToken,["prevent"])},{default:a(()=>[l(I,{class:"row"},{default:a(()=>[e[5]||(e[5]=g("div",{class:"col-12 mb-2 text-lag font-semibold"},"TOKEN",-1)),g("div",vf,[O(g("input",{class:"form-control w-full","onUpdate:modelValue":e[0]||(e[0]=o=>n.settings.token=o),placeholder:"Enter token"},null,512),[[Gs,n.settings.token]]),e[4]||(e[4]=g("button",{type:"submit",class:"btn btn-primary ml-1"},"Check",-1))])]),_:1}),g("div",wf,[g("button",{type:"button",class:"btn btn-danger",onClick:e[1]||(e[1]=(...o)=>n.confirmDelete&&n.confirmDelete(...o))}," Delete Token "),g("button",{type:"button",class:"btn btn-success",onClick:e[2]||(e[2]=(...o)=>n.doCodeSign&&n.doCodeSign(...o)),disabled:!n.canCodeSign},[l(j,{class:"bg-white text-primary text-md"},{default:a(()=>e[6]||(e[6]=[m(" Force all existing agents to be updated to the code-signed version ")])),_:1}),e[7]||(e[7]=m(" Code sign all agents "))],8,kf)])]),_:1},8,["onSubmit"])]),_:1})}var Sf=Te(bf,[["render",_f]]);const Vf={components:{TacticalDropdown:Fe},name:"RolesForm",emits:[...oe.emits],props:{role:Object},setup(t){const{dialogRef:e,onDialogHide:s,onDialogOK:n}=oe(),i=Rt(),d=te(()=>i.state.hosted),{clientOptions:o}=tn(!0),{siteOptions:r}=ln(!0),u=t.role?M(Object.assign({},t.role)):M({name:"",is_superuser:!1,can_list_agents:!1,can_recover_agents:!1,can_use_mesh:!1,can_uninstall_agents:!1,can_update_agents:!1,can_edit_agent:!1,can_manage_procs:!1,can_view_eventlogs:!1,can_send_cmd:!1,can_reboot_agents:!1,can_install_agents:!1,can_run_scripts:!1,can_run_bulk:!1,can_manage_winsvcs:!1,can_list_agent_history:!1,can_send_wol:!1,can_list_software:!1,can_manage_software:!1,can_list_notes:!1,can_manage_notes:!1,can_view_core_settings:!1,can_edit_core_settings:!1,can_view_global_keystore:!1,can_edit_global_keystore:!1,can_do_server_maint:!1,can_code_sign:!1,can_run_urlactions:!1,can_view_customfields:!1,can_manage_customfields:!1,can_list_api_keys:!1,can_manage_api_keys:!1,can_list_checks:!1,can_manage_checks:!1,can_run_checks:!1,can_list_clients:!1,can_manage_clients:!1,can_list_sites:!1,can_manage_sites:!1,can_list_deployments:!1,can_manage_deployments:!1,can_list_automation_policies:!1,can_manage_automation_policies:!1,can_list_autotasks:!1,can_manage_autotasks:!1,can_run_autotasks:!1,can_view_auditlogs:!1,can_view_debuglogs:!1,can_list_pendingactions:!1,can_manage_pendingactions:!1,can_list_scripts:!1,can_manage_scripts:!1,can_list_alerts:!1,can_manage_alerts:!1,can_list_alerttemplates:!1,can_manage_alerttemplates:!1,can_manage_winupdates:!1,can_list_accounts:!1,can_manage_accounts:!1,can_list_roles:!1,can_manage_roles:!1,can_view_clients:[],can_view_sites:[],can_run_server_scripts:!1,can_use_webterm:!1,can_view_reports:!1,can_manage_reports:!1}),c=M(!1);async function b(){c.value=!0;try{const y=t.role?await Po(u.value.id,u.value):await Eo(u.value);Ve(y),n()}catch(y){console.error(y)}c.value=!1}return be(()=>u.value.is_superuser,y=>{Object.keys(u.value).forEach((w,k)=>{typeof u.value[w]=="boolean"&&(u.value[w]=y)})}),{localRole:u,loading:c,clientOptions:o,siteOptions:r,hosted:d,onSubmit:b,dialogRef:e,onDialogHide:s}}},Cf={class:"card-header ac jsb"},Tf={class:"text-h6"},xf={class:"q-gutter-sm"},Af={class:"q-gutter-sm"},Of={class:"q-gutter-sm"},qf={class:"q-gutter-sm"},$f={class:"q-gutter-sm"},Rf={class:"q-gutter-sm"},Df={class:"q-gutter-sm"},Uf={class:"q-gutter-sm"},Pf={class:"q-gutter-sm"},Ef={class:"q-gutter-sm"},Mf={class:"q-gutter-sm"},Nf={class:"q-gutter-sm"},Lf={class:"q-gutter-sm"},If={class:"q-gutter-sm"},Bf={class:"q-gutter-sm"},Hf={class:"card-footer ac je gap-1"},Ff=["disabled"],jf={key:0},Kf={key:1,class:"flex items-center gap-1"};function zf(t,e,s,n,i,d){const o=qe("tactical-dropdown");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{style:{"min-width":"75vw","max-heigth":"75vh"},class:"q-dialog-plugin"},{default:a(()=>[g("div",Cf,[g("div",Tf,F(n.localRole?"Editing Role":"Adding Role"),1),O(l(E,{dense:"",flat:"",icon:"close"},null,512),[[R]])]),l(ct,{ref:"form",onSubmit:n.onSubmit},{default:a(()=>[l(I,{class:"row p-1"},{default:a(()=>[l(ge,{label:"Role Name",class:"col-6",dense:"",outlined:"",modelValue:n.localRole.name,"onUpdate:modelValue":e[0]||(e[0]=r=>n.localRole.name=r),rules:[r=>!!r||"*Required"]},null,8,["modelValue","rules"])]),_:1}),l(I,{class:"scroll",style:{height:"70vh"}},{default:a(()=>[e[68]||(e[68]=g("div",{class:"text-h6 font-semibold ps-2"},"Super User",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",xf,[l(W,{modelValue:n.localRole.is_superuser,"onUpdate:modelValue":e[1]||(e[1]=r=>n.localRole.is_superuser=r),label:"Super User"},null,8,["modelValue"])])]),_:1}),e[69]||(e[69]=g("div",{class:"text-h6 font-semibold ps-2"},"Reporting",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Af,[l(W,{modelValue:n.localRole.can_view_reports,"onUpdate:modelValue":e[2]||(e[2]=r=>n.localRole.can_view_reports=r),label:"Reporting Viewer"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_reports,"onUpdate:modelValue":e[3]||(e[3]=r=>n.localRole.can_manage_reports=r),label:"Reporting Manager"},null,8,["modelValue"])])]),_:1}),e[70]||(e[70]=g("div",{class:"text-h6 font-semibold ps-2"},"Accounts",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Of,[l(W,{modelValue:n.localRole.can_list_accounts,"onUpdate:modelValue":e[4]||(e[4]=r=>n.localRole.can_list_accounts=r),label:"List User Accounts"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_accounts,"onUpdate:modelValue":e[5]||(e[5]=r=>n.localRole.can_manage_accounts=r),label:"Manage User Accounts"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_list_roles,"onUpdate:modelValue":e[6]||(e[6]=r=>n.localRole.can_list_roles=r),label:"List Roles"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_roles,"onUpdate:modelValue":e[7]||(e[7]=r=>n.localRole.can_manage_roles=r),label:"Manage Roles"},null,8,["modelValue"])])]),_:1}),e[71]||(e[71]=g("div",{class:"text-h6 font-semibold ps-2"},"Agents",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",qf,[l(W,{modelValue:n.localRole.can_list_agents,"onUpdate:modelValue":e[8]||(e[8]=r=>n.localRole.can_list_agents=r),label:"List Agents"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_list_agent_history,"onUpdate:modelValue":e[9]||(e[9]=r=>n.localRole.can_list_agent_history=r),label:"List Agent History"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_use_mesh,"onUpdate:modelValue":e[10]||(e[10]=r=>n.localRole.can_use_mesh=r),label:"Use MeshCentral"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_uninstall_agents,"onUpdate:modelValue":e[11]||(e[11]=r=>n.localRole.can_uninstall_agents=r),label:"Uninstall Agents"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_update_agents,"onUpdate:modelValue":e[12]||(e[12]=r=>n.localRole.can_update_agents=r),label:"Update Agents"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_edit_agent,"onUpdate:modelValue":e[13]||(e[13]=r=>n.localRole.can_edit_agent=r),label:"Edit Agents"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_procs,"onUpdate:modelValue":e[14]||(e[14]=r=>n.localRole.can_manage_procs=r),label:"Manage Processes"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_view_eventlogs,"onUpdate:modelValue":e[15]||(e[15]=r=>n.localRole.can_view_eventlogs=r),label:"View Event Logs"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_send_cmd,"onUpdate:modelValue":e[16]||(e[16]=r=>n.localRole.can_send_cmd=r),label:"Send Command"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_reboot_agents,"onUpdate:modelValue":e[17]||(e[17]=r=>n.localRole.can_reboot_agents=r),label:"Shutdown / Reboot Agents"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_send_wol,"onUpdate:modelValue":e[18]||(e[18]=r=>n.localRole.can_send_wol=r),label:"Wake-Up (WoL) Agents"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_install_agents,"onUpdate:modelValue":e[19]||(e[19]=r=>n.localRole.can_install_agents=r),label:"Install Agents"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_run_scripts,"onUpdate:modelValue":e[20]||(e[20]=r=>n.localRole.can_run_scripts=r),label:"Run Script"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_run_bulk,"onUpdate:modelValue":e[21]||(e[21]=r=>n.localRole.can_run_bulk=r),label:"Bulk Actions"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_recover_agents,"onUpdate:modelValue":e[22]||(e[22]=r=>n.localRole.can_recover_agents=r),label:"Recover Agents"},null,8,["modelValue"])])]),_:1}),e[72]||(e[72]=g("div",{class:"text-h6 font-semibold ps-2"},"Core",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",$f,[l(W,{modelValue:n.localRole.can_list_notes,"onUpdate:modelValue":e[23]||(e[23]=r=>n.localRole.can_list_notes=r),label:"List Notes"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_notes,"onUpdate:modelValue":e[24]||(e[24]=r=>n.localRole.can_manage_notes=r),label:"Manage Notes"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_view_core_settings,"onUpdate:modelValue":e[25]||(e[25]=r=>n.localRole.can_view_core_settings=r),label:"View General Settings"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_edit_core_settings,"onUpdate:modelValue":e[26]||(e[26]=r=>n.localRole.can_edit_core_settings=r),label:"Edit General Settings"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_view_global_keystore,"onUpdate:modelValue":e[27]||(e[27]=r=>n.localRole.can_view_global_keystore=r),label:"View Global Key Store"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_edit_global_keystore,"onUpdate:modelValue":e[28]||(e[28]=r=>n.localRole.can_edit_global_keystore=r),label:"Edit Global Key Store"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_do_server_maint,"onUpdate:modelValue":e[29]||(e[29]=r=>n.localRole.can_do_server_maint=r),label:"Do Server Maintenance"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_list_api_keys,"onUpdate:modelValue":e[30]||(e[30]=r=>n.localRole.can_list_api_keys=r),label:"List API Keys"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_api_keys,"onUpdate:modelValue":e[31]||(e[31]=r=>n.localRole.can_manage_api_keys=r),label:"Manage API Keys"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_run_urlactions,"onUpdate:modelValue":e[32]||(e[32]=r=>n.localRole.can_run_urlactions=r),label:"Run URL Actions"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_view_customfields,"onUpdate:modelValue":e[33]||(e[33]=r=>n.localRole.can_view_customfields=r),label:"View Custom Fields"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_customfields,"onUpdate:modelValue":e[34]||(e[34]=r=>n.localRole.can_manage_customfields=r),label:"Edit Custom Fields"},null,8,["modelValue"]),n.hosted?G("",!0):(f(),p(W,{key:0,modelValue:n.localRole.can_use_webterm,"onUpdate:modelValue":e[35]||(e[35]=r=>n.localRole.can_use_webterm=r),label:"Use TRMM Server Web Terminal"},null,8,["modelValue"]))])]),_:1}),e[73]||(e[73]=g("div",{class:"text-h6 font-semibold ps-2"},"Checks",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Rf,[l(W,{modelValue:n.localRole.can_list_checks,"onUpdate:modelValue":e[36]||(e[36]=r=>n.localRole.can_list_checks=r),label:"List Checks"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_checks,"onUpdate:modelValue":e[37]||(e[37]=r=>n.localRole.can_manage_checks=r),label:"Manage Checks"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_run_checks,"onUpdate:modelValue":e[38]||(e[38]=r=>n.localRole.can_run_checks=r),label:"Run Checks"},null,8,["modelValue"])])]),_:1}),e[74]||(e[74]=g("div",{class:"text-h6 font-semibold ps-2"},"Clients",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Df,[l(W,{modelValue:n.localRole.can_list_clients,"onUpdate:modelValue":e[39]||(e[39]=r=>n.localRole.can_list_clients=r),label:"List Clients"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_clients,"onUpdate:modelValue":e[40]||(e[40]=r=>n.localRole.can_manage_clients=r),label:"Manage Clients"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_list_sites,"onUpdate:modelValue":e[41]||(e[41]=r=>n.localRole.can_list_sites=r),label:"List Sites"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_sites,"onUpdate:modelValue":e[42]||(e[42]=r=>n.localRole.can_manage_sites=r),label:"Manage Sites"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_list_deployments,"onUpdate:modelValue":e[43]||(e[43]=r=>n.localRole.can_list_deployments=r),label:"List Deployments"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_deployments,"onUpdate:modelValue":e[44]||(e[44]=r=>n.localRole.can_manage_deployments=r),label:"Manage Deployments"},null,8,["modelValue"])])]),_:1}),l(I,{class:"row p-1"},{default:a(()=>[l(o,{class:"col-6",label:"Allowed Clients",options:n.clientOptions,modelValue:n.localRole.can_view_clients,"onUpdate:modelValue":e[45]||(e[45]=r=>n.localRole.can_view_clients=r),hint:"Empty means all clients are allowed",outlined:"",mapOptions:"",multiple:"",filterable:""},null,8,["options","modelValue"])]),_:1}),l(I,{class:"row p-1"},{default:a(()=>[l(o,{class:"col-6",label:"Allowed Sites",options:n.siteOptions,modelValue:n.localRole.can_view_sites,"onUpdate:modelValue":e[46]||(e[46]=r=>n.localRole.can_view_sites=r),hint:"Empty means all sites are allowed",outlined:"",mapOptions:"",multiple:"",filterable:""},null,8,["options","modelValue"])]),_:1}),e[75]||(e[75]=g("div",{class:"text-h6 font-semibold ps-2"},"Automation Policies",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Uf,[l(W,{modelValue:n.localRole.can_list_automation_policies,"onUpdate:modelValue":e[47]||(e[47]=r=>n.localRole.can_list_automation_policies=r),label:"List Automation Policies"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_automation_policies,"onUpdate:modelValue":e[48]||(e[48]=r=>n.localRole.can_manage_automation_policies=r),label:"Manage Automation Policies"},null,8,["modelValue"])])]),_:1}),e[76]||(e[76]=g("div",{class:"text-h6 font-semibold ps-2"},"Tasks",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Pf,[l(W,{modelValue:n.localRole.can_list_autotasks,"onUpdate:modelValue":e[49]||(e[49]=r=>n.localRole.can_list_autotasks=r),label:"List Tasks"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_autotasks,"onUpdate:modelValue":e[50]||(e[50]=r=>n.localRole.can_manage_autotasks=r),label:"Manage Tasks"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_run_autotasks,"onUpdate:modelValue":e[51]||(e[51]=r=>n.localRole.can_run_autotasks=r),label:"Run Tasks"},null,8,["modelValue"])])]),_:1}),e[77]||(e[77]=g("div",{class:"text-h6 font-semibold ps-2"},"Logs",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Ef,[l(W,{modelValue:n.localRole.can_view_auditlogs,"onUpdate:modelValue":e[52]||(e[52]=r=>n.localRole.can_view_auditlogs=r),label:"View Audit Logs"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_view_debuglogs,"onUpdate:modelValue":e[53]||(e[53]=r=>n.localRole.can_view_debuglogs=r),label:"View Debug Logs"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_list_pendingactions,"onUpdate:modelValue":e[54]||(e[54]=r=>n.localRole.can_list_pendingactions=r),label:"List Pending Actions"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_pendingactions,"onUpdate:modelValue":e[55]||(e[55]=r=>n.localRole.can_manage_pendingactions=r),label:"Manage Pending Actions"},null,8,["modelValue"])])]),_:1}),e[78]||(e[78]=g("div",{class:"text-h6 font-semibold ps-2"},"Scripts",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Mf,[l(W,{modelValue:n.localRole.can_list_scripts,"onUpdate:modelValue":e[56]||(e[56]=r=>n.localRole.can_list_scripts=r),label:"List Scripts"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_scripts,"onUpdate:modelValue":e[57]||(e[57]=r=>n.localRole.can_manage_scripts=r),label:"Manage Scripts"},null,8,["modelValue"]),n.hosted?G("",!0):(f(),p(W,{key:0,modelValue:n.localRole.can_run_server_scripts,"onUpdate:modelValue":e[58]||(e[58]=r=>n.localRole.can_run_server_scripts=r),label:"Run Scripts on TRMM Server"},null,8,["modelValue"]))])]),_:1}),e[79]||(e[79]=g("div",{class:"text-h6 font-semibold ps-2"},"Alerts",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Nf,[l(W,{modelValue:n.localRole.can_list_alerts,"onUpdate:modelValue":e[59]||(e[59]=r=>n.localRole.can_list_alerts=r),label:"List Alerts"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_alerts,"onUpdate:modelValue":e[60]||(e[60]=r=>n.localRole.can_manage_alerts=r),label:"Manage Alerts"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_list_alerttemplates,"onUpdate:modelValue":e[61]||(e[61]=r=>n.localRole.can_list_alerttemplates=r),label:"List Alert Templates"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_alerttemplates,"onUpdate:modelValue":e[62]||(e[62]=r=>n.localRole.can_manage_alerttemplates=r),label:"Manage Alert Templates"},null,8,["modelValue"])])]),_:1}),e[80]||(e[80]=g("div",{class:"text-h6 font-semibold ps-2"},"Windows Services",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Lf,[l(W,{modelValue:n.localRole.can_manage_winsvcs,"onUpdate:modelValue":e[63]||(e[63]=r=>n.localRole.can_manage_winsvcs=r),label:"Manage Windows Services"},null,8,["modelValue"])])]),_:1}),e[81]||(e[81]=g("div",{class:"text-h6 font-semibold ps-2"},"Software",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",If,[l(W,{modelValue:n.localRole.can_list_software,"onUpdate:modelValue":e[64]||(e[64]=r=>n.localRole.can_list_software=r),label:"List Software"},null,8,["modelValue"]),l(W,{modelValue:n.localRole.can_manage_software,"onUpdate:modelValue":e[65]||(e[65]=r=>n.localRole.can_manage_software=r),label:"Manage Software"},null,8,["modelValue"])])]),_:1}),e[82]||(e[82]=g("div",{class:"text-h6 font-semibold ps-2"},"Windows Updates",-1)),l(de),l(I,{class:"row p-1"},{default:a(()=>[g("div",Bf,[l(W,{modelValue:n.localRole.can_manage_winupdates,"onUpdate:modelValue":e[66]||(e[66]=r=>n.localRole.can_manage_winupdates=r),label:"Manage Windows Updates"},null,8,["modelValue"])])]),_:1})]),_:1}),g("div",Hf,[g("button",{class:"btn btn-secondary",type:"button",onClick:e[67]||(e[67]=r=>t.$emit("close"))}," Cancel "),g("button",{class:"btn btn-primary",type:"submit",disabled:n.loading},[n.loading?(f(),ce("span",Kf,e[83]||(e[83]=[g("span",{class:"loader"},null,-1),m(" Saving... ")]))):(f(),ce("span",jf,"Save"))],8,Ff)])]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["onHide"])}var Ss=Te(Vf,[["render",zf]]);const Qf=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"is_superuser",label:"Superuser",field:"is_superuser",align:"left",sortable:!0},{name:"user_count",label:"Assigned Users",field:"user_count",align:"left",sortable:!0}],Wf={name:"PermissionsManager",emits:[...oe.emits],components:{Icon:He},setup(){const t=Ie(),{dialogRef:e,onDialogHide:s}=oe(),n=M([]),i=M(!1);function d(c){t.dialog({component:Ss,componentProps:{role:c}}).onOk(r)}function o(){t.dialog({component:Ss}).onOk(r)}async function r(){i.value=!0,n.value=await Mo(),i.value=!1}async function u(c){t.dialog({title:`Delete role ${c.name}?`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{try{t.loading.show();const b=await No(c.id);Ve(b),await r()}catch(b){console.error(b)}t.loading.hide()})}return Le(r),{roles:n,loading:i,columns:Qf,getRoles:r,deleteRole:u,showAddRoleModal:o,showEditRoleModal:d,dialogRef:e,onDialogHide:s}}},Gf={class:"card-header ac jsb"};function Jf(t,e,s,n,i,d){const o=qe("Icon");return f(),p(me,{ref:"dialogRef",onHide:n.onDialogHide},{default:a(()=>[l(ue,{style:{"min-width":"60vw",height:"75vh"}},{default:a(()=>[g("div",Gf,[e[1]||(e[1]=g("div",{class:"text-h6"},"Manage Roles",-1)),O(l(E,{dense:"",flat:"",icon:"close"},null,512),[[R]])]),l(et,{dense:"","table-class":{"table-bgcolor":!t.$q.dark.isActive,"table-bgcolor-dark":t.$q.dark.isActive},class:"tabs-tbl-sticky",style:{"max-height":"70vh"},"binary-state-sort":"","virtual-scroll":"",rows:n.roles,columns:n.columns,"row-key":"id",pagination:{rowsPerPage:0,sortBy:"name",descending:!1},"no-data-label":"No Roles","rows-per-page-options":[0]},{top:a(()=>[g("button",{class:"btn btn-primary btn-sm",onClick:e[0]||(e[0]=(...r)=>n.showAddRoleModal&&n.showAddRoleModal(...r))},[l(o,{icon:"lucide:plus",class:"icon",width:"20",height:"20"}),e[2]||(e[2]=m(" New Role "))])]),body:a(r=>[l(nt,{props:r,onDblclick:u=>n.showEditRoleModal(r.row),class:"cursor-pointer"},{default:a(()=>[l(Ne,{"context-menu":"","auto-close":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[l(B,{clickable:"",onClick:u=>n.showEditRoleModal(r.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>e[3]||(e[3]=[m("Edit")])),_:1})]),_:2},1032,["onClick"]),l(B,{clickable:"",onClick:u=>n.deleteRole(r.row),disable:r.row.user_count>0},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>e[4]||(e[4]=[m("Delete")])),_:1})]),_:2},1032,["onClick","disable"]),l(de),l(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>e[5]||(e[5]=[m("Close")])),_:1})]),_:1})]),_:2},1024)]),_:2},1024),l(J,{key:"name",props:r},{default:a(()=>[m(F(r.row.name),1)]),_:2},1032,["props"]),l(J,{key:"is_superuser",props:r},{default:a(()=>[r.row.is_superuser?(f(),p(K,{key:0,name:"done",color:"primary",size:"sm"})):G("",!0)]),_:2},1032,["props"]),l(J,{key:"user_count",props:r},{default:a(()=>[m(F(r.row.user_count),1)]),_:2},1032,["props"])]),_:2},1032,["props","onDblclick"])]),_:1},8,["table-class","rows","columns"])]),_:1})]),_:1},8,["onHide"])}var Yf=Te(Wf,[["render",Jf]]);const Xf={class:"card-header ac jsb"},Zf={class:"card-footer je"},em=["disabled"],ka=Me({__name:"ReportDependencyPrompt",props:{dependsOn:{}},emits:[...oe.emits],setup(t){const e=t,{dialogRef:s,onDialogHide:n,onDialogOK:i}=oe(),{agentOptions:d,getAgentOptions:o}=Kn(),{clientOptions:r,getClientOptions:u}=tn(),{siteOptions:c,getSiteOptions:b}=ln(),y=mt({});e.dependsOn.forEach(h=>y[h]=null);const w=M(!1);function k(){let h=!0;return e.dependsOn.forEach(V=>{y[V]||(h=!1)}),h}function x(){k()?i(y):At("All fields must have a value")}return Js(()=>{e.dependsOn.includes("client")&&u(),e.dependsOn.includes("site")&&b(),e.dependsOn.includes("agent")&&o()}),(h,V)=>(f(),p(me,{ref_key:"dialogRef",ref:s,onHide:_(n)},{default:a(()=>[l(ue,{style:{width:"400px"}},{default:a(()=>[g("div",Xf,[V[2]||(V[2]=g("div",{class:"text-h6"},"Select Report Dependencies",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>V[1]||(V[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),(f(!0),ce(at,null,lt(y,(D,T)=>(f(),p(I,{key:T},{default:a(()=>[T==="client"?(f(),p(Fe,{key:0,modelValue:y[T],"onUpdate:modelValue":A=>y[T]=A,label:`${_(zt)(T)}`,options:_(r),outlined:"",mapOptions:"",filterable:""},null,8,["modelValue","onUpdate:modelValue","label","options"])):T==="site"?(f(),p(Fe,{key:1,modelValue:y[T],"onUpdate:modelValue":A=>y[T]=A,label:`${_(zt)(T)}`,options:_(c),outlined:"",mapOptions:"",filterable:""},null,8,["modelValue","onUpdate:modelValue","label","options"])):T==="agent"?(f(),p(Fe,{key:2,modelValue:y[T],"onUpdate:modelValue":A=>y[T]=A,label:`${_(zt)(T)}`,options:_(d),outlined:"",mapOptions:"",filterable:""},null,8,["modelValue","onUpdate:modelValue","label","options"])):(f(),p(ge,{key:3,modelValue:y[T],"onUpdate:modelValue":A=>y[T]=A,label:`${_(zt)(T)}`,outlined:"",dense:""},null,8,["modelValue","onUpdate:modelValue","label"]))]),_:2},1024))),128)),g("div",Zf,[O((f(),ce("button",{class:"btn btn-secondary",onClick:V[0]||(V[0]=(...D)=>_(n)&&_(n)(...D))},V[3]||(V[3]=[m(" Cancel ")]))),[[R]]),g("button",{class:"btn btn-primary",onClick:x,disabled:w.value}," Submit ",8,em)])]),_:1})]),_:1},8,["onHide"]))}}),Ue="/reporting";function tm(){const t=M([]),e=M(!1),s=M(!1),n=M(""),i=M(""),d=M(""),o=M({}),r=M([]);function u(q){e.value=!0,s.value=!1;const P={};q&&(P.dependsOn=q),Ae.get(`${Ue}/templates/`,{params:P}).then(({data:H})=>{t.value=H}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function c(q){e.value=!0,s.value=!1,Ae.delete(`${Ue}/templates/${q}/`).then(()=>{t.value=t.value.filter(P=>P.id!=q),Ve("The report template was successfully removed")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function b(q){e.value=!0,s.value=!1,Ae.post(`${Ue}/templates/`,q).then(({data:P})=>{t.value.push(P),Ve("The report template was added successfully")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function y(q,P,H){e.value=!0,s.value=!1,Ae.put(`${Ue}/templates/${q}/`,P).then(({data:L})=>{const Z=t.value.findIndex(fe=>fe.id===q);t.value[Z]=L,H?.dontNotify||Ve("The report template was edited successfully")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function w(q){e.value=!0,s.value=!1,n.value="",i.value="",Ae.post(`${Ue}/templates/preview/`,q).then(({data:P})=>{q.format==="html"?n.value=P.template:n.value=`<pre>${P.template}</pre>`,i.value=JSON.stringify(P.variables,void 0,4)}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function k(q){e.value=!0,s.value=!1,n.value="",Ae.post(`${Ue}/templates/preview/`,q,{responseType:q.format!=="pdf"?"json":"blob"}).then(({data:P})=>{q.format==="html"?n.value=P:q.format==="pdf"?n.value=URL.createObjectURL(P):n.value=`<pre>${P}</pre>`}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function x(q,P,H){e.value=!0,s.value=!1,Ae.post(`${Ue}/templates/${q}/run/`,P,{responseType:P.format!=="pdf"?"json":"blob"}).then(({data:L})=>{P.format==="html"||H?d.value=L:P.format==="pdf"?d.value=URL.createObjectURL(L):d.value=`<pre>${L}</pre>`}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function h(q,P,H={}){e.value=!0,s.value=!1,d.value="";const L=q.depends_on?.filter(fe=>!H[fe])||[];let Z;P==="plaintext"?Z="csv":Z=P,ps.create({title:"Confirm File Name",prompt:{model:`${q.name}.${Z}`,isValid:fe=>!!fe,type:"text"},cancel:!0,persistent:!0}).onOk(async fe=>{L.length>0?ps.create({component:ka,componentProps:{dependsOn:L}}).onOk(le=>H={...H,...le}).onDismiss(()=>{x(q.id,{format:P,dependencies:H},!0)}):x(q.id,{format:P,dependencies:H},!0),await Ht(e).not.toBeTruthy(),!s.value&&yl(fe,d.value)})}function V(q,P,H,L,Z){const fe=JSON.stringify(L)||"{}",le=H.length>0?JSON.stringify(H):null,Y=le?`format=${P}&dependsOn=${le}&dependencies=${fe}`:`format=${P}`,X=gs.resolve(`/reports/${q}?${Y}`).href;Z===void 0||Z?window.open(X,"_blank"):gs.push(X)}function D(q){e.value=!0,s.value=!1,Ae.post(`${Ue}/templates/${q}/export/`).then(({data:P})=>{yl(`${P.template.name}-export.json`,JSON.stringify(P,null,2))}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function T(q){e.value=!0,s.value=!1,Ae.post(`${Ue}/templates/import/`,q).then(({data:P})=>{const H=t.value.findIndex(L=>L.id===P.id);H!==-1?t.value[H]=P:t.value.push(P),Ve("Report Template was successfully imported.")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function A(){e.value=!0,s.value=!1,Ae.get(`${Ue}/templates/shared/`).then(({data:q})=>{r.value=q}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function N(q){e.value=!0,s.value=!1,Ae.post(`${Ue}/templates/shared/`,q).then(()=>{Ve("Shared templates imported successfully")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function S(q){e.value=!0,s.value=!1,Ae.post(`${Ue}/templates/preview/analysis/`,q).then(({data:P})=>{o.value=P}).catch(()=>s.value=!0).finally(()=>e.value=!1)}return{reportTemplates:t,isLoading:e,isError:s,getReportTemplates:u,addReportTemplate:b,editReportTemplate:y,deleteReportTemplate:c,renderedPreview:n,renderedVariables:i,runReportPreview:k,runReportPreviewDebug:w,reportData:d,runReport:x,openReport:V,exportReport:D,importReport:T,downloadReport:h,getSharedTemplates:A,sharedTemplates:r,importSharedTemplates:N,variableAnalysis:o,getAllowedValues:S}}const ll=tm();async function lm(t,e){const s={};t&&(s.path=t),e&&(s.folders=!0);const{data:n}=await Ae.get(`${Ue}/assets/`,{params:s});return n}async function nm(t){const e={};t&&(e.onlyFolders=!0);const{data:s}=await Ae.get(`${Ue}/assets/all/`,{params:e});return s}async function sm(t,e){const s={path:t,newName:e},{data:n}=await Ae.put(`${Ue}/assets/rename/`,s);return n}async function am(t){const e={path:t},{data:s}=await Ae.post(`${Ue}/assets/newfolder/`,e);return s}async function im(t){const e={paths:t},{data:s}=await Ae.post(`${Ue}/assets/delete/`,e);return s}async function om(t){const e=t?{path:t}:{},{data:s}=await Ae.get(`${Ue}/assets/download/`,{responseType:"blob",params:e});return s}async function rm(t,e=""){t.append("parentPath",e);const{data:s}=await Ae.post(`${Ue}/assets/upload/`,t);return s}function dm(){const t=M([]),e=M(!1),s=M(!1);function n(){Ae.get(`${Ue}/htmltemplates/`).then(({data:r})=>{t.value=r}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function i(r){e.value=!0,Ae.post(`${Ue}/htmltemplates/`,r).then(({data:u})=>{t.value.push(u),Ve("HTML Template was added successfully")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function d(r,u){e.value=!0,Ae.put(`${Ue}/htmltemplates/${r}/`,u).then(({data:c})=>{const b=t.value.findIndex(y=>y.id===r);t.value[b]=c,Ve("HTML Template was edited successfully")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function o(r){e.value=!0,Ae.delete(`${Ue}/htmltemplates/${r}/`).then(()=>{t.value=t.value.filter(u=>u.id!=r),Ve("The HTML template was successfully removed")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}return{reportHTMLTemplates:t,isLoading:e,isError:s,getReportHTMLTemplates:n,addReportHTMLTemplate:i,editReportHTMLTemplate:d,deleteReportHTMLTemplate:o}}const sn=dm();function um(){const t=M([]),e=M(!1),s=M(!1);function n(){Ae.get(`${Ue}/dataqueries/`).then(({data:r})=>{e.value=!0,t.value=r}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function i(r){Ae.post(`${Ue}/dataqueries/`,r).then(({data:u})=>{e.value=!0,t.value.push(u),Ve("Data Query was added successfully")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function d(r,u){Ae.put(`${Ue}/dataqueries/${r}/`,u).then(({data:c})=>{e.value=!0;const b=t.value.findIndex(y=>y.id===r);t.value[b]=c,Ve("Data Query was edited successfully")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}function o(r){Ae.delete(`${Ue}/dataqueries/${r}/`).then(()=>{t.value=t.value.filter(u=>u.id!=r),Ve("The Data Query was successfully removed")}).catch(()=>s.value=!0).finally(()=>e.value=!1)}return{reportDataQueries:t,isLoading:e,isError:s,getReportDataQueries:n,addReportDataQuery:i,editReportDataQuery:d,deleteReportDataQuery:o}}const Gn=um(),Vs=150;var cm=wl({name:"QDrawer",inheritAttrs:!1,props:{...Ks,...Ln,side:{type:String,default:"left",validator:t=>["left","right"].includes(t)},width:{type:Number,default:300},mini:Boolean,miniToOverlay:Boolean,miniWidth:{type:Number,default:57},noMiniAnimation:Boolean,breakpoint:{type:Number,default:1023},showIfAbove:Boolean,behavior:{type:String,validator:t=>["default","desktop","mobile"].includes(t),default:"default"},bordered:Boolean,elevated:Boolean,overlay:Boolean,persistent:Boolean,noSwipeOpen:Boolean,noSwipeClose:Boolean,noSwipeBackdrop:Boolean},emits:[...zs,"onLayout","miniState"],setup(t,{slots:e,emit:s,attrs:n}){const i=kl(),{proxy:{$q:d}}=i,o=In(t,d),{preventBodyScroll:r}=Ui(),{registerTimeout:u,removeTimeout:c}=qi(),b=$i(Di,gn);if(b===gn)return console.error("QDrawer needs to be child of QLayout"),gn;let y,w=null,k;const x=M(t.behavior==="mobile"||t.behavior!=="desktop"&&b.totalWidth.value<=t.breakpoint),h=te(()=>t.mini===!0&&x.value!==!0),V=te(()=>h.value===!0?t.miniWidth:t.width),D=M(t.showIfAbove===!0&&x.value===!1?!0:t.modelValue===!0),T=te(()=>t.persistent!==!0&&(x.value===!0||$e.value===!0));function A(ee,Oe){if(P(),ee!==!1&&b.animate(),tt(0),x.value===!0){const ft=b.instances[$.value];ft!==void 0&&ft.belowBreakpoint===!0&&ft.hide(!1),st(1),b.isContainer.value!==!0&&r(!0)}else st(0),ee!==!1&&kt(!1);u(()=>{ee!==!1&&kt(!0),Oe!==!0&&s("show",ee)},Vs)}function N(ee,Oe){H(),ee!==!1&&b.animate(),st(0),tt(fe.value*V.value),se(),Oe!==!0?u(()=>{s("hide",ee)},Vs):c()}const{show:S,hide:q}=Qs({showing:D,hideOnRouteChange:T,handleShow:A,handleHide:N}),{addToHistory:P,removeFromHistory:H}=Ri(D,q,T),L={belowBreakpoint:x,hide:q},Z=te(()=>t.side==="right"),fe=te(()=>(d.lang.rtl===!0?-1:1)*(Z.value===!0?1:-1)),le=M(0),Y=M(!1),X=M(!1),ne=M(V.value*fe.value),$=te(()=>Z.value===!0?"left":"right"),v=te(()=>D.value===!0&&x.value===!1&&t.overlay===!1?t.miniToOverlay===!0?t.miniWidth:V.value:0),U=te(()=>t.overlay===!0||t.miniToOverlay===!0||b.view.value.indexOf(Z.value?"R":"L")!==-1||d.platform.is.ios===!0&&b.isContainer.value===!0),Ce=te(()=>t.overlay===!1&&D.value===!0&&x.value===!1),$e=te(()=>t.overlay===!0&&D.value===!0&&x.value===!1),je=te(()=>"fullscreen q-drawer__backdrop"+(D.value===!1&&Y.value===!1?" hidden":"")),Q=te(()=>({backgroundColor:`rgba(0,0,0,${le.value*.4})`})),ae=te(()=>Z.value===!0?b.rows.value.top[2]==="r":b.rows.value.top[0]==="l"),z=te(()=>Z.value===!0?b.rows.value.bottom[2]==="r":b.rows.value.bottom[0]==="l"),he=te(()=>{const ee={};return b.header.space===!0&&ae.value===!1&&(U.value===!0?ee.top=`${b.header.offset}px`:b.header.space===!0&&(ee.top=`${b.header.size}px`)),b.footer.space===!0&&z.value===!1&&(U.value===!0?ee.bottom=`${b.footer.offset}px`:b.footer.space===!0&&(ee.bottom=`${b.footer.size}px`)),ee}),ie=te(()=>{const ee={width:`${V.value}px`,transform:`translateX(${ne.value}px)`};return x.value===!0?ee:Object.assign(ee,he.value)}),_e=te(()=>"q-drawer__content fit "+(b.isContainer.value!==!0?"scroll":"overflow-auto")),Pe=te(()=>`q-drawer q-drawer--${t.side}`+(X.value===!0?" q-drawer--mini-animate":"")+(t.bordered===!0?" q-drawer--bordered":"")+(o.value===!0?" q-drawer--dark q-dark":"")+(Y.value===!0?" no-transition":D.value===!0?"":" q-layout--prevent-focus")+(x.value===!0?" fixed q-drawer--on-top q-drawer--mobile q-drawer--top-padding":` q-drawer--${h.value===!0?"mini":"standard"}`+(U.value===!0||Ce.value!==!0?" fixed":"")+(t.overlay===!0||t.miniToOverlay===!0?" q-drawer--on-top":"")+(ae.value===!0?" q-drawer--top-padding":""))),gt=te(()=>{const ee=d.lang.rtl===!0?t.side:$.value;return[[hn,xe,void 0,{[ee]:!0,mouse:!0}]]}),Ye=te(()=>{const ee=d.lang.rtl===!0?$.value:t.side;return[[hn,re,void 0,{[ee]:!0,mouse:!0}]]}),Dt=te(()=>{const ee=d.lang.rtl===!0?$.value:t.side;return[[hn,re,void 0,{[ee]:!0,mouse:!0,mouseAllDir:!0}]]});function ht(){Ut(x,t.behavior==="mobile"||t.behavior!=="desktop"&&b.totalWidth.value<=t.breakpoint)}be(x,ee=>{ee===!0?(y=D.value,D.value===!0&&q(!1)):t.overlay===!1&&t.behavior!=="mobile"&&y!==!1&&(D.value===!0?(tt(0),st(0),se()):S(!1))}),be(()=>t.side,(ee,Oe)=>{b.instances[Oe]===L&&(b.instances[Oe]=void 0,b[Oe].space=!1,b[Oe].offset=0),b.instances[ee]=L,b[ee].size=V.value,b[ee].space=Ce.value,b[ee].offset=v.value}),be(b.totalWidth,()=>{(b.isContainer.value===!0||document.qScrollPrevented!==!0)&&ht()}),be(()=>t.behavior+t.breakpoint,ht),be(b.isContainer,ee=>{D.value===!0&&r(ee!==!0),ee===!0&&ht()}),be(b.scrollbarWidth,()=>{tt(D.value===!0?0:void 0)}),be(v,ee=>{ke("offset",ee)}),be(Ce,ee=>{s("onLayout",ee),ke("space",ee)}),be(Z,()=>{tt()}),be(V,ee=>{tt(),pn(t.miniToOverlay,ee)}),be(()=>t.miniToOverlay,ee=>{pn(ee,V.value)}),be(()=>d.lang.rtl,()=>{tt()}),be(()=>t.mini,()=>{t.noMiniAnimation||t.modelValue===!0&&(yt(),b.animate())}),be(h,ee=>{s("miniState",ee)});function tt(ee){ee===void 0?pl(()=>{ee=D.value===!0?0:V.value,tt(fe.value*ee)}):(b.isContainer.value===!0&&Z.value===!0&&(x.value===!0||Math.abs(ee)===V.value)&&(ee+=fe.value*b.scrollbarWidth.value),ne.value=ee)}function st(ee){le.value=ee}function kt(ee){const Oe=ee===!0?"remove":b.isContainer.value!==!0?"add":"";Oe!==""&&document.body.classList[Oe]("q-body--drawer-toggle")}function yt(){w!==null&&clearTimeout(w),i.proxy&&i.proxy.$el&&i.proxy.$el.classList.add("q-drawer--mini-animate"),X.value=!0,w=setTimeout(()=>{w=null,X.value=!1,i&&i.proxy&&i.proxy.$el&&i.proxy.$el.classList.remove("q-drawer--mini-animate")},150)}function xe(ee){if(D.value!==!1)return;const Oe=V.value,ft=ql(ee.distance.x,0,Oe);if(ee.isFinal===!0){ft>=Math.min(75,Oe)===!0?S():(b.animate(),st(0),tt(fe.value*Oe)),Y.value=!1;return}tt((d.lang.rtl===!0?Z.value!==!0:Z.value)?Math.max(Oe-ft,0):Math.min(0,ft-Oe)),st(ql(ft/Oe,0,1)),ee.isFirst===!0&&(Y.value=!0)}function re(ee){if(D.value!==!0)return;const Oe=V.value,ft=ee.direction===t.side,Ol=(d.lang.rtl===!0?ft!==!0:ft)?ql(ee.distance.x,0,Oe):0;if(ee.isFinal===!0){Math.abs(Ol)<Math.min(75,Oe)===!0?(b.animate(),st(1),tt(0)):q(),Y.value=!1;return}tt(fe.value*Ol),st(ql(1-Ol/Oe,0,1)),ee.isFirst===!0&&(Y.value=!0)}function se(){r(!1),kt(!0)}function ke(ee,Oe){b.update(t.side,ee,Oe)}function Ut(ee,Oe){ee.value!==Oe&&(ee.value=Oe)}function pn(ee,Oe){ke("size",ee===!0?t.miniWidth:Oe)}return b.instances[t.side]=L,pn(t.miniToOverlay,V.value),ke("space",Ce.value),ke("offset",v.value),t.showIfAbove===!0&&t.modelValue!==!0&&D.value===!0&&t["onUpdate:modelValue"]!==void 0&&s("update:modelValue",!0),Le(()=>{s("onLayout",Ce.value),s("miniState",h.value),y=t.showIfAbove===!0;const ee=()=>{(D.value===!0?A:N)(!1,!0)};if(b.totalWidth.value!==0){pl(ee);return}k=be(b.totalWidth,()=>{k(),k=void 0,D.value===!1&&t.showIfAbove===!0&&x.value===!1?S(!1):ee()})}),Ws(()=>{k!==void 0&&k(),w!==null&&(clearTimeout(w),w=null),D.value===!0&&se(),b.instances[t.side]===L&&(b.instances[t.side]=void 0,ke("size",0),ke("offset",0),ke("space",!1))}),()=>{const ee=[];x.value===!0&&(t.noSwipeOpen===!1&&ee.push(O(ye("div",{key:"open",class:`q-drawer__opener fixed-${t.side}`,"aria-hidden":"true"}),gt.value)),ee.push(hs("div",{ref:"backdrop",class:je.value,style:Q.value,"aria-hidden":"true",onClick:q},void 0,"backdrop",t.noSwipeBackdrop!==!0&&D.value===!0,()=>Dt.value)));const Oe=h.value===!0&&e.mini!==void 0,ft=[ye("div",{...n,key:""+Oe,class:[_e.value,n.class]},Oe===!0?e.mini():Bn(e.default))];return t.elevated===!0&&D.value===!0&&ft.push(ye("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),ee.push(hs("aside",{ref:"content",class:Pe.value,style:ie.value},ft,"contentclose",t.noSwipeClose!==!0&&x.value===!0,()=>Ye.value)),ye("div",{class:"q-drawer-container"},ee)}}});const Jn=Symbol.for("yaml.alias"),Dn=Symbol.for("yaml.document"),$t=Symbol.for("yaml.map"),_a=Symbol.for("yaml.pair"),Tt=Symbol.for("yaml.scalar"),nl=Symbol.for("yaml.seq"),wt=Symbol.for("yaml.node.type"),sl=t=>!!t&&typeof t=="object"&&t[wt]===Jn,Sl=t=>!!t&&typeof t=="object"&&t[wt]===Dn,Vl=t=>!!t&&typeof t=="object"&&t[wt]===$t,Je=t=>!!t&&typeof t=="object"&&t[wt]===_a,Ee=t=>!!t&&typeof t=="object"&&t[wt]===Tt,Cl=t=>!!t&&typeof t=="object"&&t[wt]===nl;function We(t){if(t&&typeof t=="object")switch(t[wt]){case $t:case nl:return!0}return!1}function Ge(t){if(t&&typeof t=="object")switch(t[wt]){case Jn:case $t:case Tt:case nl:return!0}return!1}const fm=t=>(Ee(t)||We(t))&&!!t.anchor,Et=Symbol("break visit"),mm=Symbol("skip children"),fl=Symbol("remove node");function It(t,e){const s=pm(e);Sl(t)?Qt(null,t.contents,s,Object.freeze([t]))===fl&&(t.contents=null):Qt(null,t,s,Object.freeze([]))}It.BREAK=Et;It.SKIP=mm;It.REMOVE=fl;function Qt(t,e,s,n){const i=gm(t,e,s,n);if(Ge(i)||Je(i))return hm(t,n,i),Qt(t,i,s,n);if(typeof i!="symbol"){if(We(e)){n=Object.freeze(n.concat(e));for(let d=0;d<e.items.length;++d){const o=Qt(d,e.items[d],s,n);if(typeof o=="number")d=o-1;else{if(o===Et)return Et;o===fl&&(e.items.splice(d,1),d-=1)}}}else if(Je(e)){n=Object.freeze(n.concat(e));const d=Qt("key",e.key,s,n);if(d===Et)return Et;d===fl&&(e.key=null);const o=Qt("value",e.value,s,n);if(o===Et)return Et;o===fl&&(e.value=null)}}return i}function pm(t){return typeof t=="object"&&(t.Collection||t.Node||t.Value)?Object.assign({Alias:t.Node,Map:t.Node,Scalar:t.Node,Seq:t.Node},t.Value&&{Map:t.Value,Scalar:t.Value,Seq:t.Value},t.Collection&&{Map:t.Collection,Seq:t.Collection},t):t}function gm(t,e,s,n){if(typeof s=="function")return s(t,e,n);if(Vl(e))return s.Map?.(t,e,n);if(Cl(e))return s.Seq?.(t,e,n);if(Je(e))return s.Pair?.(t,e,n);if(Ee(e))return s.Scalar?.(t,e,n);if(sl(e))return s.Alias?.(t,e,n)}function hm(t,e,s){const n=e[e.length-1];if(We(n))n.items[t]=s;else if(Je(n))t==="key"?n.key=s:n.value=s;else if(Sl(n))n.contents=s;else{const i=sl(n)?"alias":"scalar";throw new Error(`Cannot replace node with ${i} parent`)}}const ym={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},bm=t=>t.replace(/[!,[\]{}]/g,e=>ym[e]);class rt{constructor(e,s){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},rt.defaultYaml,e),this.tags=Object.assign({},rt.defaultTags,s)}clone(){const e=new rt(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new rt(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:rt.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},rt.defaultTags);break}return e}add(e,s){this.atNextDocument&&(this.yaml={explicit:rt.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},rt.defaultTags),this.atNextDocument=!1);const n=e.trim().split(/[ \t]+/),i=n.shift();switch(i){case"%TAG":{if(n.length!==2&&(s(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;const[d,o]=n;return this.tags[d]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,n.length!==1)return s(0,"%YAML directive should contain exactly one part"),!1;const[d]=n;if(d==="1.1"||d==="1.2")return this.yaml.version=d,!0;{const o=/^\d+\.\d+$/.test(d);return s(6,`Unsupported YAML version ${d}`,o),!1}}default:return s(0,`Unknown directive ${i}`,!0),!1}}tagName(e,s){if(e==="!")return"!";if(e[0]!=="!")return s(`Not a valid tag: ${e}`),null;if(e[1]==="<"){const o=e.slice(2,-1);return o==="!"||o==="!!"?(s(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&s("Verbatim tags must end with a >"),o)}const[,n,i]=e.match(/^(.*!)([^!]*)$/s);i||s(`The ${e} tag has no suffix`);const d=this.tags[n];if(d)try{return d+decodeURIComponent(i)}catch(o){return s(String(o)),null}return n==="!"?e:(s(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[s,n]of Object.entries(this.tags))if(e.startsWith(n))return s+bm(e.substring(n.length));return e[0]==="!"?e:`!<${e}>`}toString(e){const s=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags);let i;if(e&&n.length>0&&Ge(e.contents)){const d={};It(e.contents,(o,r)=>{Ge(r)&&r.tag&&(d[r.tag]=!0)}),i=Object.keys(d)}else i=[];for(const[d,o]of n)d==="!!"&&o==="tag:yaml.org,2002:"||(!e||i.some(r=>r.startsWith(o)))&&s.push(`%TAG ${d} ${o}`);return s.join(`
`)}}rt.defaultYaml={explicit:!1,version:"1.2"};rt.defaultTags={"!!":"tag:yaml.org,2002:"};function Sa(t){if(/[\x00-\x19\s,[\]{}]/.test(t)){const s=`Anchor must not contain whitespace or control characters: ${JSON.stringify(t)}`;throw new Error(s)}return!0}function Va(t){const e=new Set;return It(t,{Value(s,n){n.anchor&&e.add(n.anchor)}}),e}function Ca(t,e){for(let s=1;;++s){const n=`${t}${s}`;if(!e.has(n))return n}}function vm(t,e){const s=[],n=new Map;let i=null;return{onAnchor:d=>{s.push(d),i||(i=Va(t));const o=Ca(e,i);return i.add(o),o},setAnchors:()=>{for(const d of s){const o=n.get(d);if(typeof o=="object"&&o.anchor&&(Ee(o.node)||We(o.node)))o.node.anchor=o.anchor;else{const r=new Error("Failed to resolve repeated object (this should not happen)");throw r.source=d,r}}},sourceObjects:n}}function Wt(t,e,s,n){if(n&&typeof n=="object")if(Array.isArray(n))for(let i=0,d=n.length;i<d;++i){const o=n[i],r=Wt(t,n,String(i),o);r===void 0?delete n[i]:r!==o&&(n[i]=r)}else if(n instanceof Map)for(const i of Array.from(n.keys())){const d=n.get(i),o=Wt(t,n,i,d);o===void 0?n.delete(i):o!==d&&n.set(i,o)}else if(n instanceof Set)for(const i of Array.from(n)){const d=Wt(t,n,i,i);d===void 0?n.delete(i):d!==i&&(n.delete(i),n.add(d))}else for(const[i,d]of Object.entries(n)){const o=Wt(t,n,i,d);o===void 0?delete n[i]:o!==d&&(n[i]=o)}return t.call(e,s,n)}function vt(t,e,s){if(Array.isArray(t))return t.map((n,i)=>vt(n,String(i),s));if(t&&typeof t.toJSON=="function"){if(!s||!fm(t))return t.toJSON(e,s);const n={aliasCount:0,count:1,res:void 0};s.anchors.set(t,n),s.onCreate=d=>{n.res=d,delete s.onCreate};const i=t.toJSON(e,s);return s.onCreate&&s.onCreate(i),i}return typeof t=="bigint"&&!s?.keep?Number(t):t}class Yn{constructor(e){Object.defineProperty(this,wt,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:s,maxAliasCount:n,onAnchor:i,reviver:d}={}){if(!Sl(e))throw new TypeError("A document argument is required");const o={anchors:new Map,doc:e,keep:!0,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof n=="number"?n:100},r=vt(this,"",o);if(typeof i=="function")for(const{count:u,res:c}of o.anchors.values())i(c,u);return typeof d=="function"?Wt(d,{"":r},"",r):r}}class Xn extends Yn{constructor(e){super(Jn),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e){let s;return It(e,{Node:(n,i)=>{if(i===this)return It.BREAK;i.anchor===this.source&&(s=i)}}),s}toJSON(e,s){if(!s)return{source:this.source};const{anchors:n,doc:i,maxAliasCount:d}=s,o=this.resolve(i);if(!o){const u=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(u)}let r=n.get(o);if(r||(vt(o,null,s),r=n.get(o)),!r||r.res===void 0){const u="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(u)}if(d>=0&&(r.count+=1,r.aliasCount===0&&(r.aliasCount=Hl(i,o,n)),r.count*r.aliasCount>d)){const u="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(u)}return r.res}toString(e,s,n){const i=`*${this.source}`;if(e){if(Sa(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const d=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(d)}if(e.implicitKey)return`${i} `}return i}}function Hl(t,e,s){if(sl(e)){const n=e.resolve(t),i=s&&n&&s.get(n);return i?i.count*i.aliasCount:0}else if(We(e)){let n=0;for(const i of e.items){const d=Hl(t,i,s);d>n&&(n=d)}return n}else if(Je(e)){const n=Hl(t,e.key,s),i=Hl(t,e.value,s);return Math.max(n,i)}return 1}const Ta=t=>!t||typeof t!="function"&&typeof t!="object";class we extends Yn{constructor(e){super(Tt),this.value=e}toJSON(e,s){return s?.keep?this.value:vt(this.value,e,s)}toString(){return String(this.value)}}we.BLOCK_FOLDED="BLOCK_FOLDED";we.BLOCK_LITERAL="BLOCK_LITERAL";we.PLAIN="PLAIN";we.QUOTE_DOUBLE="QUOTE_DOUBLE";we.QUOTE_SINGLE="QUOTE_SINGLE";const wm="tag:yaml.org,2002:";function km(t,e,s){if(e){const n=s.filter(d=>d.tag===e),i=n.find(d=>!d.format)??n[0];if(!i)throw new Error(`Tag ${e} not found`);return i}return s.find(n=>n.identify?.(t)&&!n.format)}function bl(t,e,s){if(Sl(t)&&(t=t.contents),Ge(t))return t;if(Je(t)){const y=s.schema[$t].createNode?.(s.schema,null,s);return y.items.push(t),y}(t instanceof String||t instanceof Number||t instanceof Boolean||typeof BigInt<"u"&&t instanceof BigInt)&&(t=t.valueOf());const{aliasDuplicateObjects:n,onAnchor:i,onTagObj:d,schema:o,sourceObjects:r}=s;let u;if(n&&t&&typeof t=="object"){if(u=r.get(t),u)return u.anchor||(u.anchor=i(t)),new Xn(u.anchor);u={anchor:null,node:null},r.set(t,u)}e?.startsWith("!!")&&(e=wm+e.slice(2));let c=km(t,e,o.tags);if(!c){if(t&&typeof t.toJSON=="function"&&(t=t.toJSON()),!t||typeof t!="object"){const y=new we(t);return u&&(u.node=y),y}c=t instanceof Map?o[$t]:Symbol.iterator in Object(t)?o[nl]:o[$t]}d&&(d(c),delete s.onTagObj);const b=c?.createNode?c.createNode(s.schema,t,s):typeof c?.nodeClass?.from=="function"?c.nodeClass.from(s.schema,t,s):new we(t);return e?b.tag=e:c.default||(b.tag=c.tag),u&&(u.node=b),b}function Jl(t,e,s){let n=s;for(let i=e.length-1;i>=0;--i){const d=e[i];if(typeof d=="number"&&Number.isInteger(d)&&d>=0){const o=[];o[d]=n,n=o}else n=new Map([[d,n]])}return bl(n,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:t,sourceObjects:new Map})}const ul=t=>t==null||typeof t=="object"&&!!t[Symbol.iterator]().next().done;class xa extends Yn{constructor(e,s){super(e),Object.defineProperty(this,"schema",{value:s,configurable:!0,enumerable:!1,writable:!0})}clone(e){const s=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(s.schema=e),s.items=s.items.map(n=>Ge(n)||Je(n)?n.clone(e):n),this.range&&(s.range=this.range.slice()),s}addIn(e,s){if(ul(e))this.add(s);else{const[n,...i]=e,d=this.get(n,!0);if(We(d))d.addIn(i,s);else if(d===void 0&&this.schema)this.set(n,Jl(this.schema,i,s));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${i}`)}}deleteIn(e){const[s,...n]=e;if(n.length===0)return this.delete(s);const i=this.get(s,!0);if(We(i))return i.deleteIn(n);throw new Error(`Expected YAML collection at ${s}. Remaining path: ${n}`)}getIn(e,s){const[n,...i]=e,d=this.get(n,!0);return i.length===0?!s&&Ee(d)?d.value:d:We(d)?d.getIn(i,s):void 0}hasAllNullValues(e){return this.items.every(s=>{if(!Je(s))return!1;const n=s.value;return n==null||e&&Ee(n)&&n.value==null&&!n.commentBefore&&!n.comment&&!n.tag})}hasIn(e){const[s,...n]=e;if(n.length===0)return this.has(s);const i=this.get(s,!0);return We(i)?i.hasIn(n):!1}setIn(e,s){const[n,...i]=e;if(i.length===0)this.set(n,s);else{const d=this.get(n,!0);if(We(d))d.setIn(i,s);else if(d===void 0&&this.schema)this.set(n,Jl(this.schema,i,s));else throw new Error(`Expected YAML collection at ${n}. Remaining path: ${i}`)}}}const _m=t=>t.replace(/^(?!$)(?: $)?/gm,"#");function xt(t,e){return/^\n+$/.test(t)?t.substring(1):e?t.replace(/^(?! *$)/gm,e):t}const Nt=(t,e,s)=>t.endsWith(`
`)?xt(s,e):s.includes(`
`)?`
`+xt(s,e):(t.endsWith(" ")?"":" ")+s,Aa="flow",Un="block",Fl="quoted";function an(t,e,s="flow",{indentAtStart:n,lineWidth:i=80,minContentWidth:d=20,onFold:o,onOverflow:r}={}){if(!i||i<0)return t;i<d&&(d=0);const u=Math.max(1+d,1+i-e.length);if(t.length<=u)return t;const c=[],b={};let y=i-e.length;typeof n=="number"&&(n>i-Math.max(2,d)?c.push(0):y=i-n);let w,k,x=!1,h=-1,V=-1,D=-1;s===Un&&(h=Cs(t,h,e.length),h!==-1&&(y=h+u));for(let A;A=t[h+=1];){if(s===Fl&&A==="\\"){switch(V=h,t[h+1]){case"x":h+=3;break;case"u":h+=5;break;case"U":h+=9;break;default:h+=1}D=h}if(A===`
`)s===Un&&(h=Cs(t,h,e.length)),y=h+e.length+u,w=void 0;else{if(A===" "&&k&&k!==" "&&k!==`
`&&k!=="	"){const N=t[h+1];N&&N!==" "&&N!==`
`&&N!=="	"&&(w=h)}if(h>=y)if(w)c.push(w),y=w+u,w=void 0;else if(s===Fl){for(;k===" "||k==="	";)k=A,A=t[h+=1],x=!0;const N=h>D+1?h-2:V-1;if(b[N])return t;c.push(N),b[N]=!0,y=N+u,w=void 0}else x=!0}k=A}if(x&&r&&r(),c.length===0)return t;o&&o();let T=t.slice(0,c[0]);for(let A=0;A<c.length;++A){const N=c[A],S=c[A+1]||t.length;N===0?T=`
${e}${t.slice(0,S)}`:(s===Fl&&b[N]&&(T+=`${t[N]}\\`),T+=`
${e}${t.slice(N+1,S)}`)}return T}function Cs(t,e,s){let n=e,i=e+1,d=t[i];for(;d===" "||d==="	";)if(e<i+s)d=t[++e];else{do d=t[++e];while(d&&d!==`
`);n=e,i=e+1,d=t[i]}return n}const on=(t,e)=>({indentAtStart:e?t.indent.length:t.indentAtStart,lineWidth:t.options.lineWidth,minContentWidth:t.options.minContentWidth}),rn=t=>/^(%|---|\.\.\.)/m.test(t);function Sm(t,e,s){if(!e||e<0)return!1;const n=e-s,i=t.length;if(i<=n)return!1;for(let d=0,o=0;d<i;++d)if(t[d]===`
`){if(d-o>n)return!0;if(o=d+1,i-o<=n)return!1}return!0}function ml(t,e){const s=JSON.stringify(t);if(e.options.doubleQuotedAsJSON)return s;const{implicitKey:n}=e,i=e.options.doubleQuotedMinMultiLineLength,d=e.indent||(rn(t)?"  ":"");let o="",r=0;for(let u=0,c=s[u];c;c=s[++u])if(c===" "&&s[u+1]==="\\"&&s[u+2]==="n"&&(o+=s.slice(r,u)+"\\ ",u+=1,r=u,c="\\"),c==="\\")switch(s[u+1]){case"u":{o+=s.slice(r,u);const b=s.substr(u+2,4);switch(b){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:b.substr(0,2)==="00"?o+="\\x"+b.substr(2):o+=s.substr(u,6)}u+=5,r=u+1}break;case"n":if(n||s[u+2]==='"'||s.length<i)u+=1;else{for(o+=s.slice(r,u)+`

`;s[u+2]==="\\"&&s[u+3]==="n"&&s[u+4]!=='"';)o+=`
`,u+=2;o+=d,s[u+2]===" "&&(o+="\\"),u+=1,r=u+1}break;default:u+=1}return o=r?o+s.slice(r):s,n?o:an(o,d,Fl,on(e,!1))}function Pn(t,e){if(e.options.singleQuote===!1||e.implicitKey&&t.includes(`
`)||/[ \t]\n|\n[ \t]/.test(t))return ml(t,e);const s=e.indent||(rn(t)?"  ":""),n="'"+t.replace(/'/g,"''").replace(/\n+/g,`$&
${s}`)+"'";return e.implicitKey?n:an(n,s,Aa,on(e,!1))}function Gt(t,e){const{singleQuote:s}=e.options;let n;if(s===!1)n=ml;else{const i=t.includes('"'),d=t.includes("'");i&&!d?n=Pn:d&&!i?n=ml:n=s?Pn:ml}return n(t,e)}let En;try{En=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch{En=/\n+(?!\n|$)/g}function jl({comment:t,type:e,value:s},n,i,d){const{blockQuote:o,commentString:r,lineWidth:u}=n.options;if(!o||/\n[\t ]+$/.test(s)||/^\s*$/.test(s))return Gt(s,n);const c=n.indent||(n.forceBlockIndent||rn(s)?"  ":""),b=o==="literal"?!0:o==="folded"||e===we.BLOCK_FOLDED?!1:e===we.BLOCK_LITERAL?!0:!Sm(s,u,c.length);if(!s)return b?`|
`:`>
`;let y,w;for(w=s.length;w>0;--w){const q=s[w-1];if(q!==`
`&&q!=="	"&&q!==" ")break}let k=s.substring(w);const x=k.indexOf(`
`);x===-1?y="-":s===k||x!==k.length-1?(y="+",d&&d()):y="",k&&(s=s.slice(0,-k.length),k[k.length-1]===`
`&&(k=k.slice(0,-1)),k=k.replace(En,`$&${c}`));let h=!1,V,D=-1;for(V=0;V<s.length;++V){const q=s[V];if(q===" ")h=!0;else if(q===`
`)D=V;else break}let T=s.substring(0,D<V?D+1:V);T&&(s=s.substring(T.length),T=T.replace(/\n+/g,`$&${c}`));let N=(b?"|":">")+(h?c?"2":"1":"")+y;if(t&&(N+=" "+r(t.replace(/ ?[\r\n]+/g," ")),i&&i()),b)return s=s.replace(/\n+/g,`$&${c}`),`${N}
${c}${T}${s}${k}`;s=s.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${c}`);const S=an(`${T}${s}${k}`,c,Un,on(n,!0));return`${N}
${c}${S}`}function Vm(t,e,s,n){const{type:i,value:d}=t,{actualString:o,implicitKey:r,indent:u,indentStep:c,inFlow:b}=e;if(r&&d.includes(`
`)||b&&/[[\]{},]/.test(d))return Gt(d,e);if(!d||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(d))return r||b||!d.includes(`
`)?Gt(d,e):jl(t,e,s,n);if(!r&&!b&&i!==we.PLAIN&&d.includes(`
`))return jl(t,e,s,n);if(rn(d)){if(u==="")return e.forceBlockIndent=!0,jl(t,e,s,n);if(r&&u===c)return Gt(d,e)}const y=d.replace(/\n+/g,`$&
${u}`);if(o){const w=h=>h.default&&h.tag!=="tag:yaml.org,2002:str"&&h.test?.test(y),{compat:k,tags:x}=e.doc.schema;if(x.some(w)||k?.some(w))return Gt(d,e)}return r?y:an(y,u,Aa,on(e,!1))}function Zn(t,e,s,n){const{implicitKey:i,inFlow:d}=e,o=typeof t.value=="string"?t:Object.assign({},t,{value:String(t.value)});let{type:r}=t;r!==we.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(r=we.QUOTE_DOUBLE);const u=b=>{switch(b){case we.BLOCK_FOLDED:case we.BLOCK_LITERAL:return i||d?Gt(o.value,e):jl(o,e,s,n);case we.QUOTE_DOUBLE:return ml(o.value,e);case we.QUOTE_SINGLE:return Pn(o.value,e);case we.PLAIN:return Vm(o,e,s,n);default:return null}};let c=u(r);if(c===null){const{defaultKeyType:b,defaultStringType:y}=e.options,w=i&&b||y;if(c=u(w),c===null)throw new Error(`Unsupported default string type ${w}`)}return c}function Oa(t,e){const s=Object.assign({blockQuote:!0,commentString:_m,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},t.schema.toStringOptions,e);let n;switch(s.collectionStyle){case"block":n=!1;break;case"flow":n=!0;break;default:n=null}return{anchors:new Set,doc:t,flowCollectionPadding:s.flowCollectionPadding?" ":"",indent:"",indentStep:typeof s.indent=="number"?" ".repeat(s.indent):"  ",inFlow:n,options:s}}function Cm(t,e){if(e.tag){const i=t.filter(d=>d.tag===e.tag);if(i.length>0)return i.find(d=>d.format===e.format)??i[0]}let s,n;if(Ee(e)){n=e.value;let i=t.filter(d=>d.identify?.(n));if(i.length>1){const d=i.filter(o=>o.test);d.length>0&&(i=d)}s=i.find(d=>d.format===e.format)??i.find(d=>!d.format)}else n=e,s=t.find(i=>i.nodeClass&&n instanceof i.nodeClass);if(!s){const i=n?.constructor?.name??typeof n;throw new Error(`Tag not resolved for ${i} value`)}return s}function Tm(t,e,{anchors:s,doc:n}){if(!n.directives)return"";const i=[],d=(Ee(t)||We(t))&&t.anchor;d&&Sa(d)&&(s.add(d),i.push(`&${d}`));const o=t.tag?t.tag:e.default?null:e.tag;return o&&i.push(n.directives.tagString(o)),i.join(" ")}function el(t,e,s,n){if(Je(t))return t.toString(e,s,n);if(sl(t)){if(e.doc.directives)return t.toString(e);if(e.resolvedAliases?.has(t))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(t):e.resolvedAliases=new Set([t]),t=t.resolve(e.doc)}let i;const d=Ge(t)?t:e.doc.createNode(t,{onTagObj:u=>i=u});i||(i=Cm(e.doc.schema.tags,d));const o=Tm(d,i,e);o.length>0&&(e.indentAtStart=(e.indentAtStart??0)+o.length+1);const r=typeof i.stringify=="function"?i.stringify(d,e,s,n):Ee(d)?Zn(d,e,s,n):d.toString(e,s,n);return o?Ee(d)||r[0]==="{"||r[0]==="["?`${o} ${r}`:`${o}
${e.indent}${r}`:r}function xm({key:t,value:e},s,n,i){const{allNullValues:d,doc:o,indent:r,indentStep:u,options:{commentString:c,indentSeq:b,simpleKeys:y}}=s;let w=Ge(t)&&t.comment||null;if(y){if(w)throw new Error("With simple keys, key nodes cannot have comments");if(We(t)||!Ge(t)&&typeof t=="object"){const P="With simple keys, collection cannot be used as a key value";throw new Error(P)}}let k=!y&&(!t||w&&e==null&&!s.inFlow||We(t)||(Ee(t)?t.type===we.BLOCK_FOLDED||t.type===we.BLOCK_LITERAL:typeof t=="object"));s=Object.assign({},s,{allNullValues:!1,implicitKey:!k&&(y||!d),indent:r+u});let x=!1,h=!1,V=el(t,s,()=>x=!0,()=>h=!0);if(!k&&!s.inFlow&&V.length>1024){if(y)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");k=!0}if(s.inFlow){if(d||e==null)return x&&n&&n(),V===""?"?":k?`? ${V}`:V}else if(d&&!y||e==null&&k)return V=`? ${V}`,w&&!x?V+=Nt(V,s.indent,c(w)):h&&i&&i(),V;x&&(w=null),k?(w&&(V+=Nt(V,s.indent,c(w))),V=`? ${V}
${r}:`):(V=`${V}:`,w&&(V+=Nt(V,s.indent,c(w))));let D,T,A;Ge(e)?(D=!!e.spaceBefore,T=e.commentBefore,A=e.comment):(D=!1,T=null,A=null,e&&typeof e=="object"&&(e=o.createNode(e))),s.implicitKey=!1,!k&&!w&&Ee(e)&&(s.indentAtStart=V.length+1),h=!1,!b&&u.length>=2&&!s.inFlow&&!k&&Cl(e)&&!e.flow&&!e.tag&&!e.anchor&&(s.indent=s.indent.substring(2));let N=!1;const S=el(e,s,()=>N=!0,()=>h=!0);let q=" ";if(w||D||T){if(q=D?`
`:"",T){const P=c(T);q+=`
${xt(P,s.indent)}`}S===""&&!s.inFlow?q===`
`&&(q=`

`):q+=`
${s.indent}`}else if(!k&&We(e)){const P=S[0],H=S.indexOf(`
`),L=H!==-1,Z=s.inFlow??e.flow??e.items.length===0;if(L||!Z){let fe=!1;if(L&&(P==="&"||P==="!")){let le=S.indexOf(" ");P==="&"&&le!==-1&&le<H&&S[le+1]==="!"&&(le=S.indexOf(" ",le+1)),(le===-1||H<le)&&(fe=!0)}fe||(q=`
${s.indent}`)}}else(S===""||S[0]===`
`)&&(q="");return V+=q+S,s.inFlow?N&&n&&n():A&&!N?V+=Nt(V,s.indent,c(A)):h&&i&&i(),V}function qa(t,e){(t==="debug"||t==="warn")&&(typeof process<"u"&&process.emitWarning?process.emitWarning(e):console.warn(e))}const Pl="<<",Ot={identify:t=>t===Pl||typeof t=="symbol"&&t.description===Pl,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new we(Symbol(Pl)),{addToJSMap:$a}),stringify:()=>Pl},Am=(t,e)=>(Ot.identify(e)||Ee(e)&&(!e.type||e.type===we.PLAIN)&&Ot.identify(e.value))&&t?.doc.schema.tags.some(s=>s.tag===Ot.tag&&s.default);function $a(t,e,s){if(s=t&&sl(s)?s.resolve(t.doc):s,Cl(s))for(const n of s.items)bn(t,e,n);else if(Array.isArray(s))for(const n of s)bn(t,e,n);else bn(t,e,s)}function bn(t,e,s){const n=t&&sl(s)?s.resolve(t.doc):s;if(!Vl(n))throw new Error("Merge sources must be maps or map aliases");const i=n.toJSON(null,t,Map);for(const[d,o]of i)e instanceof Map?e.has(d)||e.set(d,o):e instanceof Set?e.add(d):Object.prototype.hasOwnProperty.call(e,d)||Object.defineProperty(e,d,{value:o,writable:!0,enumerable:!0,configurable:!0});return e}function Ra(t,e,{key:s,value:n}){if(Ge(s)&&s.addToJSMap)s.addToJSMap(t,e,n);else if(Am(t,s))$a(t,e,n);else{const i=vt(s,"",t);if(e instanceof Map)e.set(i,vt(n,i,t));else if(e instanceof Set)e.add(i);else{const d=Om(s,i,t),o=vt(n,d,t);d in e?Object.defineProperty(e,d,{value:o,writable:!0,enumerable:!0,configurable:!0}):e[d]=o}}return e}function Om(t,e,s){if(e===null)return"";if(typeof e!="object")return String(e);if(Ge(t)&&s?.doc){const n=Oa(s.doc,{});n.anchors=new Set;for(const d of s.anchors.keys())n.anchors.add(d.anchor);n.inFlow=!0,n.inStringifyKey=!0;const i=t.toString(n);if(!s.mapKeyWarned){let d=JSON.stringify(i);d.length>40&&(d=d.substring(0,36)+'..."'),qa(s.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${d}. Set mapAsMap: true to use object keys.`),s.mapKeyWarned=!0}return i}return JSON.stringify(e)}function es(t,e,s){const n=bl(t,void 0,s),i=bl(e,void 0,s);return new ut(n,i)}class ut{constructor(e,s=null){Object.defineProperty(this,wt,{value:_a}),this.key=e,this.value=s}clone(e){let{key:s,value:n}=this;return Ge(s)&&(s=s.clone(e)),Ge(n)&&(n=n.clone(e)),new ut(s,n)}toJSON(e,s){const n=s?.mapAsMap?new Map:{};return Ra(s,n,this)}toString(e,s,n){return e?.doc?xm(this,e,s,n):JSON.stringify(this)}}function Da(t,e,s){return(e.inFlow??t.flow?$m:qm)(t,e,s)}function qm({comment:t,items:e},s,{blockItemPrefix:n,flowChars:i,itemIndent:d,onChompKeep:o,onComment:r}){const{indent:u,options:{commentString:c}}=s,b=Object.assign({},s,{indent:d,type:null});let y=!1;const w=[];for(let x=0;x<e.length;++x){const h=e[x];let V=null;if(Ge(h))!y&&h.spaceBefore&&w.push(""),Yl(s,w,h.commentBefore,y),h.comment&&(V=h.comment);else if(Je(h)){const T=Ge(h.key)?h.key:null;T&&(!y&&T.spaceBefore&&w.push(""),Yl(s,w,T.commentBefore,y))}y=!1;let D=el(h,b,()=>V=null,()=>y=!0);V&&(D+=Nt(D,d,c(V))),y&&V&&(y=!1),w.push(n+D)}let k;if(w.length===0)k=i.start+i.end;else{k=w[0];for(let x=1;x<w.length;++x){const h=w[x];k+=h?`
${u}${h}`:`
`}}return t?(k+=`
`+xt(c(t),u),r&&r()):y&&o&&o(),k}function $m({items:t},e,{flowChars:s,itemIndent:n}){const{indent:i,indentStep:d,flowCollectionPadding:o,options:{commentString:r}}=e;n+=d;const u=Object.assign({},e,{indent:n,inFlow:!0,type:null});let c=!1,b=0;const y=[];for(let x=0;x<t.length;++x){const h=t[x];let V=null;if(Ge(h))h.spaceBefore&&y.push(""),Yl(e,y,h.commentBefore,!1),h.comment&&(V=h.comment);else if(Je(h)){const T=Ge(h.key)?h.key:null;T&&(T.spaceBefore&&y.push(""),Yl(e,y,T.commentBefore,!1),T.comment&&(c=!0));const A=Ge(h.value)?h.value:null;A?(A.comment&&(V=A.comment),A.commentBefore&&(c=!0)):h.value==null&&T?.comment&&(V=T.comment)}V&&(c=!0);let D=el(h,u,()=>V=null);x<t.length-1&&(D+=","),V&&(D+=Nt(D,n,r(V))),!c&&(y.length>b||D.includes(`
`))&&(c=!0),y.push(D),b=y.length}const{start:w,end:k}=s;if(y.length===0)return w+k;if(!c){const x=y.reduce((h,V)=>h+V.length+2,2);c=e.options.lineWidth>0&&x>e.options.lineWidth}if(c){let x=w;for(const h of y)x+=h?`
${d}${i}${h}`:`
`;return`${x}
${i}${k}`}else return`${w}${o}${y.join(" ")}${o}${k}`}function Yl({indent:t,options:{commentString:e}},s,n,i){if(n&&i&&(n=n.replace(/^\n+/,"")),n){const d=xt(e(n),t);s.push(d.trimStart())}}function Lt(t,e){const s=Ee(e)?e.value:e;for(const n of t)if(Je(n)&&(n.key===e||n.key===s||Ee(n.key)&&n.key.value===s))return n}class bt extends xa{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super($t,e),this.items=[]}static from(e,s,n){const{keepUndefined:i,replacer:d}=n,o=new this(e),r=(u,c)=>{if(typeof d=="function")c=d.call(s,u,c);else if(Array.isArray(d)&&!d.includes(u))return;(c!==void 0||i)&&o.items.push(es(u,c,n))};if(s instanceof Map)for(const[u,c]of s)r(u,c);else if(s&&typeof s=="object")for(const u of Object.keys(s))r(u,s[u]);return typeof e.sortMapEntries=="function"&&o.items.sort(e.sortMapEntries),o}add(e,s){let n;Je(e)?n=e:!e||typeof e!="object"||!("key"in e)?n=new ut(e,e?.value):n=new ut(e.key,e.value);const i=Lt(this.items,n.key),d=this.schema?.sortMapEntries;if(i){if(!s)throw new Error(`Key ${n.key} already set`);Ee(i.value)&&Ta(n.value)?i.value.value=n.value:i.value=n.value}else if(d){const o=this.items.findIndex(r=>d(n,r)<0);o===-1?this.items.push(n):this.items.splice(o,0,n)}else this.items.push(n)}delete(e){const s=Lt(this.items,e);return s?this.items.splice(this.items.indexOf(s),1).length>0:!1}get(e,s){const i=Lt(this.items,e)?.value;return(!s&&Ee(i)?i.value:i)??void 0}has(e){return!!Lt(this.items,e)}set(e,s){this.add(new ut(e,s),!0)}toJSON(e,s,n){const i=n?new n:s?.mapAsMap?new Map:{};s?.onCreate&&s.onCreate(i);for(const d of this.items)Ra(s,i,d);return i}toString(e,s,n){if(!e)return JSON.stringify(this);for(const i of this.items)if(!Je(i))throw new Error(`Map items must all be pairs; found ${JSON.stringify(i)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),Da(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:n,onComment:s})}}const al={collection:"map",default:!0,nodeClass:bt,tag:"tag:yaml.org,2002:map",resolve(t,e){return Vl(t)||e("Expected a mapping for this tag"),t},createNode:(t,e,s)=>bt.from(t,e,s)};class Bt extends xa{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(nl,e),this.items=[]}add(e){this.items.push(e)}delete(e){const s=El(e);return typeof s!="number"?!1:this.items.splice(s,1).length>0}get(e,s){const n=El(e);if(typeof n!="number")return;const i=this.items[n];return!s&&Ee(i)?i.value:i}has(e){const s=El(e);return typeof s=="number"&&s<this.items.length}set(e,s){const n=El(e);if(typeof n!="number")throw new Error(`Expected a valid index, not ${e}.`);const i=this.items[n];Ee(i)&&Ta(s)?i.value=s:this.items[n]=s}toJSON(e,s){const n=[];s?.onCreate&&s.onCreate(n);let i=0;for(const d of this.items)n.push(vt(d,String(i++),s));return n}toString(e,s,n){return e?Da(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:n,onComment:s}):JSON.stringify(this)}static from(e,s,n){const{replacer:i}=n,d=new this(e);if(s&&Symbol.iterator in Object(s)){let o=0;for(let r of s){if(typeof i=="function"){const u=s instanceof Set?r:String(o++);r=i.call(s,u,r)}d.items.push(bl(r,void 0,n))}}return d}}function El(t){let e=Ee(t)?t.value:t;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}const il={collection:"seq",default:!0,nodeClass:Bt,tag:"tag:yaml.org,2002:seq",resolve(t,e){return Cl(t)||e("Expected a sequence for this tag"),t},createNode:(t,e,s)=>Bt.from(t,e,s)},dn={identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify(t,e,s,n){return e=Object.assign({actualString:!0},e),Zn(t,e,s,n)}},un={identify:t=>t==null,createNode:()=>new we(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new we(null),stringify:({source:t},e)=>typeof t=="string"&&un.test.test(t)?t:e.options.nullStr},ts={identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:t=>new we(t[0]==="t"||t[0]==="T"),stringify({source:t,value:e},s){if(t&&ts.test.test(t)){const n=t[0]==="t"||t[0]==="T";if(e===n)return t}return e?s.options.trueStr:s.options.falseStr}};function Vt({format:t,minFractionDigits:e,tag:s,value:n}){if(typeof n=="bigint")return String(n);const i=typeof n=="number"?n:Number(n);if(!isFinite(i))return isNaN(i)?".nan":i<0?"-.inf":".inf";let d=JSON.stringify(n);if(!t&&e&&(!s||s==="tag:yaml.org,2002:float")&&/^\d/.test(d)){let o=d.indexOf(".");o<0&&(o=d.length,d+=".");let r=e-(d.length-o-1);for(;r-- >0;)d+="0"}return d}const Ua={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Vt},Pa={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t),stringify(t){const e=Number(t.value);return isFinite(e)?e.toExponential():Vt(t)}},Ea={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(t){const e=new we(parseFloat(t)),s=t.indexOf(".");return s!==-1&&t[t.length-1]==="0"&&(e.minFractionDigits=t.length-s-1),e},stringify:Vt},cn=t=>typeof t=="bigint"||Number.isInteger(t),ls=(t,e,s,{intAsBigInt:n})=>n?BigInt(t):parseInt(t.substring(e),s);function Ma(t,e,s){const{value:n}=t;return cn(n)&&n>=0?s+n.toString(e):Vt(t)}const Na={identify:t=>cn(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(t,e,s)=>ls(t,2,8,s),stringify:t=>Ma(t,8,"0o")},La={identify:cn,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(t,e,s)=>ls(t,0,10,s),stringify:Vt},Ia={identify:t=>cn(t)&&t>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(t,e,s)=>ls(t,2,16,s),stringify:t=>Ma(t,16,"0x")},Rm=[al,il,dn,un,ts,Na,La,Ia,Ua,Pa,Ea];function Ts(t){return typeof t=="bigint"||Number.isInteger(t)}const Ml=({value:t})=>JSON.stringify(t),Dm=[{identify:t=>typeof t=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:t=>t,stringify:Ml},{identify:t=>t==null,createNode:()=>new we(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Ml},{identify:t=>typeof t=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true|false$/,resolve:t=>t==="true",stringify:Ml},{identify:Ts,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(t,e,{intAsBigInt:s})=>s?BigInt(t):parseInt(t,10),stringify:({value:t})=>Ts(t)?t.toString():JSON.stringify(t)},{identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:t=>parseFloat(t),stringify:Ml}],Um={default:!0,tag:"",test:/^/,resolve(t,e){return e(`Unresolved plain scalar ${JSON.stringify(t)}`),t}},Pm=[al,il].concat(Dm,Um),ns={identify:t=>t instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(t,e){if(typeof Buffer=="function")return Buffer.from(t,"base64");if(typeof atob=="function"){const s=atob(t.replace(/[\n\r]/g,"")),n=new Uint8Array(s.length);for(let i=0;i<s.length;++i)n[i]=s.charCodeAt(i);return n}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),t},stringify({comment:t,type:e,value:s},n,i,d){const o=s;let r;if(typeof Buffer=="function")r=o instanceof Buffer?o.toString("base64"):Buffer.from(o.buffer).toString("base64");else if(typeof btoa=="function"){let u="";for(let c=0;c<o.length;++c)u+=String.fromCharCode(o[c]);r=btoa(u)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e||(e=we.BLOCK_LITERAL),e!==we.QUOTE_DOUBLE){const u=Math.max(n.options.lineWidth-n.indent.length,n.options.minContentWidth),c=Math.ceil(r.length/u),b=new Array(c);for(let y=0,w=0;y<c;++y,w+=u)b[y]=r.substr(w,u);r=b.join(e===we.BLOCK_LITERAL?`
`:" ")}return Zn({comment:t,type:e,value:r},n,i,d)}};function Ba(t,e){if(Cl(t))for(let s=0;s<t.items.length;++s){let n=t.items[s];if(!Je(n)){if(Vl(n)){n.items.length>1&&e("Each pair must have its own sequence indicator");const i=n.items[0]||new ut(new we(null));if(n.commentBefore&&(i.key.commentBefore=i.key.commentBefore?`${n.commentBefore}
${i.key.commentBefore}`:n.commentBefore),n.comment){const d=i.value??i.key;d.comment=d.comment?`${n.comment}
${d.comment}`:n.comment}n=i}t.items[s]=Je(n)?n:new ut(n)}}else e("Expected a sequence for this tag");return t}function Ha(t,e,s){const{replacer:n}=s,i=new Bt(t);i.tag="tag:yaml.org,2002:pairs";let d=0;if(e&&Symbol.iterator in Object(e))for(let o of e){typeof n=="function"&&(o=n.call(e,String(d++),o));let r,u;if(Array.isArray(o))if(o.length===2)r=o[0],u=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){const c=Object.keys(o);if(c.length===1)r=c[0],u=o[r];else throw new TypeError(`Expected tuple with one key, not ${c.length} keys`)}else r=o;i.items.push(es(r,u,s))}return i}const ss={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Ba,createNode:Ha};class Jt extends Bt{constructor(){super(),this.add=bt.prototype.add.bind(this),this.delete=bt.prototype.delete.bind(this),this.get=bt.prototype.get.bind(this),this.has=bt.prototype.has.bind(this),this.set=bt.prototype.set.bind(this),this.tag=Jt.tag}toJSON(e,s){if(!s)return super.toJSON(e);const n=new Map;s?.onCreate&&s.onCreate(n);for(const i of this.items){let d,o;if(Je(i)?(d=vt(i.key,"",s),o=vt(i.value,d,s)):d=vt(i,"",s),n.has(d))throw new Error("Ordered maps must not include duplicate keys");n.set(d,o)}return n}static from(e,s,n){const i=Ha(e,s,n),d=new this;return d.items=i.items,d}}Jt.tag="tag:yaml.org,2002:omap";const as={collection:"seq",identify:t=>t instanceof Map,nodeClass:Jt,default:!1,tag:"tag:yaml.org,2002:omap",resolve(t,e){const s=Ba(t,e),n=[];for(const{key:i}of s.items)Ee(i)&&(n.includes(i.value)?e(`Ordered maps must not include duplicate keys: ${i.value}`):n.push(i.value));return Object.assign(new Jt,s)},createNode:(t,e,s)=>Jt.from(t,e,s)};function Fa({value:t,source:e},s){return e&&(t?ja:Ka).test.test(e)?e:t?s.options.trueStr:s.options.falseStr}const ja={identify:t=>t===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new we(!0),stringify:Fa},Ka={identify:t=>t===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new we(!1),stringify:Fa},Em={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:t=>t.slice(-3).toLowerCase()==="nan"?NaN:t[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:Vt},Mm={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:t=>parseFloat(t.replace(/_/g,"")),stringify(t){const e=Number(t.value);return isFinite(e)?e.toExponential():Vt(t)}},Nm={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(t){const e=new we(parseFloat(t.replace(/_/g,""))),s=t.indexOf(".");if(s!==-1){const n=t.substring(s+1).replace(/_/g,"");n[n.length-1]==="0"&&(e.minFractionDigits=n.length)}return e},stringify:Vt},Tl=t=>typeof t=="bigint"||Number.isInteger(t);function fn(t,e,s,{intAsBigInt:n}){const i=t[0];if((i==="-"||i==="+")&&(e+=1),t=t.substring(e).replace(/_/g,""),n){switch(s){case 2:t=`0b${t}`;break;case 8:t=`0o${t}`;break;case 16:t=`0x${t}`;break}const o=BigInt(t);return i==="-"?BigInt(-1)*o:o}const d=parseInt(t,s);return i==="-"?-1*d:d}function is(t,e,s){const{value:n}=t;if(Tl(n)){const i=n.toString(e);return n<0?"-"+s+i.substr(1):s+i}return Vt(t)}const Lm={identify:Tl,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(t,e,s)=>fn(t,2,2,s),stringify:t=>is(t,2,"0b")},Im={identify:Tl,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(t,e,s)=>fn(t,1,8,s),stringify:t=>is(t,8,"0")},Bm={identify:Tl,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(t,e,s)=>fn(t,0,10,s),stringify:Vt},Hm={identify:Tl,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(t,e,s)=>fn(t,2,16,s),stringify:t=>is(t,16,"0x")};class Yt extends bt{constructor(e){super(e),this.tag=Yt.tag}add(e){let s;Je(e)?s=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?s=new ut(e.key,null):s=new ut(e,null),Lt(this.items,s.key)||this.items.push(s)}get(e,s){const n=Lt(this.items,e);return!s&&Je(n)?Ee(n.key)?n.key.value:n.key:n}set(e,s){if(typeof s!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof s}`);const n=Lt(this.items,e);n&&!s?this.items.splice(this.items.indexOf(n),1):!n&&s&&this.items.push(new ut(e))}toJSON(e,s){return super.toJSON(e,s,Set)}toString(e,s,n){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),s,n);throw new Error("Set items must all have null values")}static from(e,s,n){const{replacer:i}=n,d=new this(e);if(s&&Symbol.iterator in Object(s))for(let o of s)typeof i=="function"&&(o=i.call(s,o,o)),d.items.push(es(o,null,n));return d}}Yt.tag="tag:yaml.org,2002:set";const os={collection:"map",identify:t=>t instanceof Set,nodeClass:Yt,default:!1,tag:"tag:yaml.org,2002:set",createNode:(t,e,s)=>Yt.from(t,e,s),resolve(t,e){if(Vl(t)){if(t.hasAllNullValues(!0))return Object.assign(new Yt,t);e("Set items must all have null values")}else e("Expected a mapping for this tag");return t}};function rs(t,e){const s=t[0],n=s==="-"||s==="+"?t.substring(1):t,i=o=>e?BigInt(o):Number(o),d=n.replace(/_/g,"").split(":").reduce((o,r)=>o*i(60)+i(r),i(0));return s==="-"?i(-1)*d:d}function za(t){let{value:e}=t,s=o=>o;if(typeof e=="bigint")s=o=>BigInt(o);else if(isNaN(e)||!isFinite(e))return Vt(t);let n="";e<0&&(n="-",e*=s(-1));const i=s(60),d=[e%i];return e<60?d.unshift(0):(e=(e-d[0])/i,d.unshift(e%i),e>=60&&(e=(e-d[0])/i,d.unshift(e))),n+d.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const Qa={identify:t=>typeof t=="bigint"||Number.isInteger(t),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(t,e,{intAsBigInt:s})=>rs(t,s),stringify:za},Wa={identify:t=>typeof t=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:t=>rs(t,!1),stringify:za},mn={identify:t=>t instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(t){const e=t.match(mn.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,s,n,i,d,o,r]=e.map(Number),u=e[7]?Number((e[7]+"00").substr(1,3)):0;let c=Date.UTC(s,n-1,i,d||0,o||0,r||0,u);const b=e[8];if(b&&b!=="Z"){let y=rs(b,!1);Math.abs(y)<30&&(y*=60),c-=6e4*y}return new Date(c)},stringify:({value:t})=>t.toISOString().replace(/((T00:00)?:00)?\.000Z$/,"")},xs=[al,il,dn,un,ja,Ka,Lm,Im,Bm,Hm,Em,Mm,Nm,ns,Ot,as,ss,os,Qa,Wa,mn],As=new Map([["core",Rm],["failsafe",[al,il,dn]],["json",Pm],["yaml11",xs],["yaml-1.1",xs]]),Os={binary:ns,bool:ts,float:Ea,floatExp:Pa,floatNaN:Ua,floatTime:Wa,int:La,intHex:Ia,intOct:Na,intTime:Qa,map:al,merge:Ot,null:un,omap:as,pairs:ss,seq:il,set:os,timestamp:mn},Fm={"tag:yaml.org,2002:binary":ns,"tag:yaml.org,2002:merge":Ot,"tag:yaml.org,2002:omap":as,"tag:yaml.org,2002:pairs":ss,"tag:yaml.org,2002:set":os,"tag:yaml.org,2002:timestamp":mn};function vn(t,e,s){const n=As.get(e);if(n&&!t)return s&&!n.includes(Ot)?n.concat(Ot):n.slice();let i=n;if(!i)if(Array.isArray(t))i=[];else{const d=Array.from(As.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${d} or define customTags array`)}if(Array.isArray(t))for(const d of t)i=i.concat(d);else typeof t=="function"&&(i=t(i.slice()));return s&&(i=i.concat(Ot)),i.reduce((d,o)=>{const r=typeof o=="string"?Os[o]:o;if(!r){const u=JSON.stringify(o),c=Object.keys(Os).map(b=>JSON.stringify(b)).join(", ");throw new Error(`Unknown custom tag ${u}; use one of ${c}`)}return d.includes(r)||d.push(r),d},[])}const jm=(t,e)=>t.key<e.key?-1:t.key>e.key?1:0;class ds{constructor({compat:e,customTags:s,merge:n,resolveKnownTags:i,schema:d,sortMapEntries:o,toStringDefaults:r}){this.compat=Array.isArray(e)?vn(e,"compat"):e?vn(null,e):null,this.name=typeof d=="string"&&d||"core",this.knownTags=i?Fm:{},this.tags=vn(s,this.name,n),this.toStringOptions=r??null,Object.defineProperty(this,$t,{value:al}),Object.defineProperty(this,Tt,{value:dn}),Object.defineProperty(this,nl,{value:il}),this.sortMapEntries=typeof o=="function"?o:o===!0?jm:null}clone(){const e=Object.create(ds.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}function Km(t,e){const s=[];let n=e.directives===!0;if(e.directives!==!1&&t.directives){const u=t.directives.toString(t);u?(s.push(u),n=!0):t.directives.docStart&&(n=!0)}n&&s.push("---");const i=Oa(t,e),{commentString:d}=i.options;if(t.commentBefore){s.length!==1&&s.unshift("");const u=d(t.commentBefore);s.unshift(xt(u,""))}let o=!1,r=null;if(t.contents){if(Ge(t.contents)){if(t.contents.spaceBefore&&n&&s.push(""),t.contents.commentBefore){const b=d(t.contents.commentBefore);s.push(xt(b,""))}i.forceBlockIndent=!!t.comment,r=t.contents.comment}const u=r?void 0:()=>o=!0;let c=el(t.contents,i,()=>r=null,u);r&&(c+=Nt(c,"",d(r))),(c[0]==="|"||c[0]===">")&&s[s.length-1]==="---"?s[s.length-1]=`--- ${c}`:s.push(c)}else s.push(el(t.contents,i));if(t.directives?.docEnd)if(t.comment){const u=d(t.comment);u.includes(`
`)?(s.push("..."),s.push(xt(u,""))):s.push(`... ${u}`)}else s.push("...");else{let u=t.comment;u&&o&&(u=u.replace(/^\n+/,"")),u&&((!o||r)&&s[s.length-1]!==""&&s.push(""),s.push(xt(d(u),"")))}return s.join(`
`)+`
`}class xl{constructor(e,s,n){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,wt,{value:Dn});let i=null;typeof s=="function"||Array.isArray(s)?i=s:n===void 0&&s&&(n=s,s=void 0);const d=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},n);this.options=d;let{version:o}=d;n?._directives?(this.directives=n._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new rt({version:o}),this.setSchema(o,n),this.contents=e===void 0?null:this.createNode(e,i,n)}clone(){const e=Object.create(xl.prototype,{[wt]:{value:Dn}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=Ge(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){jt(this.contents)&&this.contents.add(e)}addIn(e,s){jt(this.contents)&&this.contents.addIn(e,s)}createAlias(e,s){if(!e.anchor){const n=Va(this);e.anchor=!s||n.has(s)?Ca(s||"a",n):s}return new Xn(e.anchor)}createNode(e,s,n){let i;if(typeof s=="function")e=s.call({"":e},"",e),i=s;else if(Array.isArray(s)){const V=T=>typeof T=="number"||T instanceof String||T instanceof Number,D=s.filter(V).map(String);D.length>0&&(s=s.concat(D)),i=s}else n===void 0&&s&&(n=s,s=void 0);const{aliasDuplicateObjects:d,anchorPrefix:o,flow:r,keepUndefined:u,onTagObj:c,tag:b}=n??{},{onAnchor:y,setAnchors:w,sourceObjects:k}=vm(this,o||"a"),x={aliasDuplicateObjects:d??!0,keepUndefined:u??!1,onAnchor:y,onTagObj:c,replacer:i,schema:this.schema,sourceObjects:k},h=bl(e,b,x);return r&&We(h)&&(h.flow=!0),w(),h}createPair(e,s,n={}){const i=this.createNode(e,null,n),d=this.createNode(s,null,n);return new ut(i,d)}delete(e){return jt(this.contents)?this.contents.delete(e):!1}deleteIn(e){return ul(e)?this.contents==null?!1:(this.contents=null,!0):jt(this.contents)?this.contents.deleteIn(e):!1}get(e,s){return We(this.contents)?this.contents.get(e,s):void 0}getIn(e,s){return ul(e)?!s&&Ee(this.contents)?this.contents.value:this.contents:We(this.contents)?this.contents.getIn(e,s):void 0}has(e){return We(this.contents)?this.contents.has(e):!1}hasIn(e){return ul(e)?this.contents!==void 0:We(this.contents)?this.contents.hasIn(e):!1}set(e,s){this.contents==null?this.contents=Jl(this.schema,[e],s):jt(this.contents)&&this.contents.set(e,s)}setIn(e,s){ul(e)?this.contents=s:this.contents==null?this.contents=Jl(this.schema,Array.from(e),s):jt(this.contents)&&this.contents.setIn(e,s)}setSchema(e,s={}){typeof e=="number"&&(e=String(e));let n;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new rt({version:"1.1"}),n={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new rt({version:e}),n={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,n=null;break;default:{const i=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${i}`)}}if(s.schema instanceof Object)this.schema=s.schema;else if(n)this.schema=new ds(Object.assign(n,s));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:s,mapAsMap:n,maxAliasCount:i,onAnchor:d,reviver:o}={}){const r={anchors:new Map,doc:this,keep:!e,mapAsMap:n===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},u=vt(this.contents,s??"",r);if(typeof d=="function")for(const{count:c,res:b}of r.anchors.values())d(b,c);return typeof o=="function"?Wt(o,{"":u},"",u):u}toJSON(e,s){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:s})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const s=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${s}`)}return Km(this,e)}}function jt(t){if(We(t))return!0;throw new Error("Expected a YAML collection as document contents")}class Ga extends Error{constructor(e,s,n,i){super(),this.name=e,this.code=n,this.message=i,this.pos=s}}class cl extends Ga{constructor(e,s,n){super("YAMLParseError",e,s,n)}}class zm extends Ga{constructor(e,s,n){super("YAMLWarning",e,s,n)}}const qs=(t,e)=>s=>{if(s.pos[0]===-1)return;s.linePos=s.pos.map(r=>e.linePos(r));const{line:n,col:i}=s.linePos[0];s.message+=` at line ${n}, column ${i}`;let d=i-1,o=t.substring(e.lineStarts[n-1],e.lineStarts[n]).replace(/[\n\r]+$/,"");if(d>=60&&o.length>80){const r=Math.min(d-39,o.length-79);o="\u2026"+o.substring(r),d-=r-1}if(o.length>80&&(o=o.substring(0,79)+"\u2026"),n>1&&/^ *$/.test(o.substring(0,d))){let r=t.substring(e.lineStarts[n-2],e.lineStarts[n-1]);r.length>80&&(r=r.substring(0,79)+`\u2026
`),o=r+o}if(/[^ ]/.test(o)){let r=1;const u=s.linePos[1];u&&u.line===n&&u.col>i&&(r=Math.max(1,Math.min(u.col-i,80-d)));const c=" ".repeat(d)+"^".repeat(r);s.message+=`:

${o}
${c}
`}};function tl(t,{flow:e,indicator:s,next:n,offset:i,onError:d,parentIndent:o,startOnNewline:r}){let u=!1,c=r,b=r,y="",w="",k=!1,x=!1,h=null,V=null,D=null,T=null,A=null,N=null,S=null;for(const H of t)switch(x&&(H.type!=="space"&&H.type!=="newline"&&H.type!=="comma"&&d(H.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),x=!1),h&&(c&&H.type!=="comment"&&H.type!=="newline"&&d(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),h=null),H.type){case"space":!e&&(s!=="doc-start"||n?.type!=="flow-collection")&&H.source.includes("	")&&(h=H),b=!0;break;case"comment":{b||d(H,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const L=H.source.substring(1)||" ";y?y+=w+L:y=L,w="",c=!1;break}case"newline":c?y?y+=H.source:u=!0:w+=H.source,c=!0,k=!0,(V||D)&&(T=H),b=!0;break;case"anchor":V&&d(H,"MULTIPLE_ANCHORS","A node can have at most one anchor"),H.source.endsWith(":")&&d(H.offset+H.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),V=H,S===null&&(S=H.offset),c=!1,b=!1,x=!0;break;case"tag":{D&&d(H,"MULTIPLE_TAGS","A node can have at most one tag"),D=H,S===null&&(S=H.offset),c=!1,b=!1,x=!0;break}case s:(V||D)&&d(H,"BAD_PROP_ORDER",`Anchors and tags must be after the ${H.source} indicator`),N&&d(H,"UNEXPECTED_TOKEN",`Unexpected ${H.source} in ${e??"collection"}`),N=H,c=s==="seq-item-ind"||s==="explicit-key-ind",b=!1;break;case"comma":if(e){A&&d(H,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),A=H,c=!1,b=!1;break}default:d(H,"UNEXPECTED_TOKEN",`Unexpected ${H.type} token`),c=!1,b=!1}const q=t[t.length-1],P=q?q.offset+q.source.length:i;return x&&n&&n.type!=="space"&&n.type!=="newline"&&n.type!=="comma"&&(n.type!=="scalar"||n.source!=="")&&d(n.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),h&&(c&&h.indent<=o||n?.type==="block-map"||n?.type==="block-seq")&&d(h,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:A,found:N,spaceBefore:u,comment:y,hasNewline:k,anchor:V,tag:D,newlineAfterProp:T,end:P,start:S??P}}function vl(t){if(!t)return null;switch(t.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(t.source.includes(`
`))return!0;if(t.end){for(const e of t.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(const e of t.items){for(const s of e.start)if(s.type==="newline")return!0;if(e.sep){for(const s of e.sep)if(s.type==="newline")return!0}if(vl(e.key)||vl(e.value))return!0}return!1;default:return!0}}function Mn(t,e,s){if(e?.type==="flow-collection"){const n=e.end[0];n.indent===t&&(n.source==="]"||n.source==="}")&&vl(e)&&s(n,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Ja(t,e,s){const{uniqueKeys:n}=t.options;if(n===!1)return!1;const i=typeof n=="function"?n:(d,o)=>d===o||Ee(d)&&Ee(o)&&d.value===o.value;return e.some(d=>i(d.key,s))}const $s="All mapping items must start at the same column";function Qm({composeNode:t,composeEmptyNode:e},s,n,i,d){const o=d?.nodeClass??bt,r=new o(s.schema);s.atRoot&&(s.atRoot=!1);let u=n.offset,c=null;for(const b of n.items){const{start:y,key:w,sep:k,value:x}=b,h=tl(y,{indicator:"explicit-key-ind",next:w??k?.[0],offset:u,onError:i,parentIndent:n.indent,startOnNewline:!0}),V=!h.found;if(V){if(w&&(w.type==="block-seq"?i(u,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in w&&w.indent!==n.indent&&i(u,"BAD_INDENT",$s)),!h.anchor&&!h.tag&&!k){c=h.end,h.comment&&(r.comment?r.comment+=`
`+h.comment:r.comment=h.comment);continue}(h.newlineAfterProp||vl(w))&&i(w??y[y.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else h.found?.indent!==n.indent&&i(u,"BAD_INDENT",$s);s.atKey=!0;const D=h.end,T=w?t(s,w,h,i):e(s,D,y,null,h,i);s.schema.compat&&Mn(n.indent,w,i),s.atKey=!1,Ja(s,r.items,T)&&i(D,"DUPLICATE_KEY","Map keys must be unique");const A=tl(k??[],{indicator:"map-value-ind",next:x,offset:T.range[2],onError:i,parentIndent:n.indent,startOnNewline:!w||w.type==="block-scalar"});if(u=A.end,A.found){V&&(x?.type==="block-map"&&!A.hasNewline&&i(u,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),s.options.strict&&h.start<A.found.offset-1024&&i(T.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const N=x?t(s,x,A,i):e(s,u,k,null,A,i);s.schema.compat&&Mn(n.indent,x,i),u=N.range[2];const S=new ut(T,N);s.options.keepSourceTokens&&(S.srcToken=b),r.items.push(S)}else{V&&i(T.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),A.comment&&(T.comment?T.comment+=`
`+A.comment:T.comment=A.comment);const N=new ut(T);s.options.keepSourceTokens&&(N.srcToken=b),r.items.push(N)}}return c&&c<u&&i(c,"IMPOSSIBLE","Map comment with trailing content"),r.range=[n.offset,u,c??u],r}function Wm({composeNode:t,composeEmptyNode:e},s,n,i,d){const o=d?.nodeClass??Bt,r=new o(s.schema);s.atRoot&&(s.atRoot=!1),s.atKey&&(s.atKey=!1);let u=n.offset,c=null;for(const{start:b,value:y}of n.items){const w=tl(b,{indicator:"seq-item-ind",next:y,offset:u,onError:i,parentIndent:n.indent,startOnNewline:!0});if(!w.found)if(w.anchor||w.tag||y)y&&y.type==="block-seq"?i(w.end,"BAD_INDENT","All sequence items must start at the same column"):i(u,"MISSING_CHAR","Sequence item without - indicator");else{c=w.end,w.comment&&(r.comment=w.comment);continue}const k=y?t(s,y,w,i):e(s,w.end,b,null,w,i);s.schema.compat&&Mn(n.indent,y,i),u=k.range[2],r.items.push(k)}return r.range=[n.offset,u,c??u],r}function Al(t,e,s,n){let i="";if(t){let d=!1,o="";for(const r of t){const{source:u,type:c}=r;switch(c){case"space":d=!0;break;case"comment":{s&&!d&&n(r,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const b=u.substring(1)||" ";i?i+=o+b:i=b,o="";break}case"newline":i&&(o+=u),d=!0;break;default:n(r,"UNEXPECTED_TOKEN",`Unexpected ${c} at node end`)}e+=u.length}}return{comment:i,offset:e}}const wn="Block collections are not allowed within flow collections",kn=t=>t&&(t.type==="block-map"||t.type==="block-seq");function Gm({composeNode:t,composeEmptyNode:e},s,n,i,d){const o=n.start.source==="{",r=o?"flow map":"flow sequence",u=d?.nodeClass??(o?bt:Bt),c=new u(s.schema);c.flow=!0;const b=s.atRoot;b&&(s.atRoot=!1),s.atKey&&(s.atKey=!1);let y=n.offset+n.start.source.length;for(let V=0;V<n.items.length;++V){const D=n.items[V],{start:T,key:A,sep:N,value:S}=D,q=tl(T,{flow:r,indicator:"explicit-key-ind",next:A??N?.[0],offset:y,onError:i,parentIndent:n.indent,startOnNewline:!1});if(!q.found){if(!q.anchor&&!q.tag&&!N&&!S){V===0&&q.comma?i(q.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${r}`):V<n.items.length-1&&i(q.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${r}`),q.comment&&(c.comment?c.comment+=`
`+q.comment:c.comment=q.comment),y=q.end;continue}!o&&s.options.strict&&vl(A)&&i(A,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(V===0)q.comma&&i(q.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${r}`);else if(q.comma||i(q.start,"MISSING_CHAR",`Missing , between ${r} items`),q.comment){let P="";e:for(const H of T)switch(H.type){case"comma":case"space":break;case"comment":P=H.source.substring(1);break e;default:break e}if(P){let H=c.items[c.items.length-1];Je(H)&&(H=H.value??H.key),H.comment?H.comment+=`
`+P:H.comment=P,q.comment=q.comment.substring(P.length+1)}}if(!o&&!N&&!q.found){const P=S?t(s,S,q,i):e(s,q.end,N,null,q,i);c.items.push(P),y=P.range[2],kn(S)&&i(P.range,"BLOCK_IN_FLOW",wn)}else{s.atKey=!0;const P=q.end,H=A?t(s,A,q,i):e(s,P,T,null,q,i);kn(A)&&i(H.range,"BLOCK_IN_FLOW",wn),s.atKey=!1;const L=tl(N??[],{flow:r,indicator:"map-value-ind",next:S,offset:H.range[2],onError:i,parentIndent:n.indent,startOnNewline:!1});if(L.found){if(!o&&!q.found&&s.options.strict){if(N)for(const le of N){if(le===L.found)break;if(le.type==="newline"){i(le,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}q.start<L.found.offset-1024&&i(L.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else S&&("source"in S&&S.source&&S.source[0]===":"?i(S,"MISSING_CHAR",`Missing space after : in ${r}`):i(L.start,"MISSING_CHAR",`Missing , or : between ${r} items`));const Z=S?t(s,S,L,i):L.found?e(s,L.end,N,null,L,i):null;Z?kn(S)&&i(Z.range,"BLOCK_IN_FLOW",wn):L.comment&&(H.comment?H.comment+=`
`+L.comment:H.comment=L.comment);const fe=new ut(H,Z);if(s.options.keepSourceTokens&&(fe.srcToken=D),o){const le=c;Ja(s,le.items,H)&&i(P,"DUPLICATE_KEY","Map keys must be unique"),le.items.push(fe)}else{const le=new bt(s.schema);le.flow=!0,le.items.push(fe);const Y=(Z??H).range;le.range=[H.range[0],Y[1],Y[2]],c.items.push(le)}y=Z?Z.range[2]:L.end}}const w=o?"}":"]",[k,...x]=n.end;let h=y;if(k&&k.source===w)h=k.offset+k.source.length;else{const V=r[0].toUpperCase()+r.substring(1),D=b?`${V} must end with a ${w}`:`${V} in block collection must be sufficiently indented and end with a ${w}`;i(y,b?"MISSING_CHAR":"BAD_INDENT",D),k&&k.source.length!==1&&x.unshift(k)}if(x.length>0){const V=Al(x,h,s.options.strict,i);V.comment&&(c.comment?c.comment+=`
`+V.comment:c.comment=V.comment),c.range=[n.offset,h,V.offset]}else c.range=[n.offset,h,h];return c}function _n(t,e,s,n,i,d){const o=s.type==="block-map"?Qm(t,e,s,n,d):s.type==="block-seq"?Wm(t,e,s,n,d):Gm(t,e,s,n,d),r=o.constructor;return i==="!"||i===r.tagName?(o.tag=r.tagName,o):(i&&(o.tag=i),o)}function Jm(t,e,s,n,i){const d=n.tag,o=d?e.directives.tagName(d.source,w=>i(d,"TAG_RESOLVE_FAILED",w)):null;if(s.type==="block-seq"){const{anchor:w,newlineAfterProp:k}=n,x=w&&d?w.offset>d.offset?w:d:w??d;x&&(!k||k.offset<x.offset)&&i(x,"MISSING_CHAR","Missing newline after block sequence props")}const r=s.type==="block-map"?"map":s.type==="block-seq"?"seq":s.start.source==="{"?"map":"seq";if(!d||!o||o==="!"||o===bt.tagName&&r==="map"||o===Bt.tagName&&r==="seq")return _n(t,e,s,i,o);let u=e.schema.tags.find(w=>w.tag===o&&w.collection===r);if(!u){const w=e.schema.knownTags[o];if(w&&w.collection===r)e.schema.tags.push(Object.assign({},w,{default:!1})),u=w;else return w?.collection?i(d,"BAD_COLLECTION_TYPE",`${w.tag} used for ${r} collection, but expects ${w.collection}`,!0):i(d,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),_n(t,e,s,i,o)}const c=_n(t,e,s,i,o,u),b=u.resolve?.(c,w=>i(d,"TAG_RESOLVE_FAILED",w),e.options)??c,y=Ge(b)?b:new we(b);return y.range=c.range,y.tag=o,u?.format&&(y.format=u.format),y}function Ym(t,e,s){const n=e.offset,i=Xm(e,t.options.strict,s);if(!i)return{value:"",type:null,comment:"",range:[n,n,n]};const d=i.mode===">"?we.BLOCK_FOLDED:we.BLOCK_LITERAL,o=e.source?Zm(e.source):[];let r=o.length;for(let h=o.length-1;h>=0;--h){const V=o[h][1];if(V===""||V==="\r")r=h;else break}if(r===0){const h=i.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"";let V=n+i.length;return e.source&&(V+=e.source.length),{value:h,type:d,comment:i.comment,range:[n,V,V]}}let u=e.indent+i.indent,c=e.offset+i.length,b=0;for(let h=0;h<r;++h){const[V,D]=o[h];if(D===""||D==="\r")i.indent===0&&V.length>u&&(u=V.length);else{if(V.length<u){const T="Block scalars with more-indented leading empty lines must use an explicit indentation indicator";s(c+V.length,"MISSING_CHAR",T)}i.indent===0&&(u=V.length),b=h,u===0&&!t.atRoot&&s(c,"BAD_INDENT","Block scalar values in collections must be indented");break}c+=V.length+D.length+1}for(let h=o.length-1;h>=r;--h)o[h][0].length>u&&(r=h+1);let y="",w="",k=!1;for(let h=0;h<b;++h)y+=o[h][0].slice(u)+`
`;for(let h=b;h<r;++h){let[V,D]=o[h];c+=V.length+D.length+1;const T=D[D.length-1]==="\r";if(T&&(D=D.slice(0,-1)),D&&V.length<u){const N=`Block scalar lines must not be less indented than their ${i.indent?"explicit indentation indicator":"first line"}`;s(c-D.length-(T?2:1),"BAD_INDENT",N),V=""}d===we.BLOCK_LITERAL?(y+=w+V.slice(u)+D,w=`
`):V.length>u||D[0]==="	"?(w===" "?w=`
`:!k&&w===`
`&&(w=`

`),y+=w+V.slice(u)+D,w=`
`,k=!0):D===""?w===`
`?y+=`
`:w=`
`:(y+=w+D,w=" ",k=!1)}switch(i.chomp){case"-":break;case"+":for(let h=r;h<o.length;++h)y+=`
`+o[h][0].slice(u);y[y.length-1]!==`
`&&(y+=`
`);break;default:y+=`
`}const x=n+i.length+e.source.length;return{value:y,type:d,comment:i.comment,range:[n,x,x]}}function Xm({offset:t,props:e},s,n){if(e[0].type!=="block-scalar-header")return n(e[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:i}=e[0],d=i[0];let o=0,r="",u=-1;for(let w=1;w<i.length;++w){const k=i[w];if(!r&&(k==="-"||k==="+"))r=k;else{const x=Number(k);!o&&x?o=x:u===-1&&(u=t+w)}}u!==-1&&n(u,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${i}`);let c=!1,b="",y=i.length;for(let w=1;w<e.length;++w){const k=e[w];switch(k.type){case"space":c=!0;case"newline":y+=k.source.length;break;case"comment":s&&!c&&n(k,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),y+=k.source.length,b=k.source.substring(1);break;case"error":n(k,"UNEXPECTED_TOKEN",k.message),y+=k.source.length;break;default:{const x=`Unexpected token in block scalar header: ${k.type}`;n(k,"UNEXPECTED_TOKEN",x);const h=k.source;h&&typeof h=="string"&&(y+=h.length)}}}return{mode:d,indent:o,chomp:r,comment:b,length:y}}function Zm(t){const e=t.split(/\n( *)/),s=e[0],n=s.match(/^( *)/),d=[n?.[1]?[n[1],s.slice(n[1].length)]:["",s]];for(let o=1;o<e.length;o+=2)d.push([e[o],e[o+1]]);return d}function ep(t,e,s){const{offset:n,type:i,source:d,end:o}=t;let r,u;const c=(w,k,x)=>s(n+w,k,x);switch(i){case"scalar":r=we.PLAIN,u=tp(d,c);break;case"single-quoted-scalar":r=we.QUOTE_SINGLE,u=lp(d,c);break;case"double-quoted-scalar":r=we.QUOTE_DOUBLE,u=np(d,c);break;default:return s(t,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${i}`),{value:"",type:null,comment:"",range:[n,n+d.length,n+d.length]}}const b=n+d.length,y=Al(o,b,e,s);return{value:u,type:r,comment:y.comment,range:[n,b,y.offset]}}function tp(t,e){let s="";switch(t[0]){case"	":s="a tab character";break;case",":s="flow indicator character ,";break;case"%":s="directive indicator character %";break;case"|":case">":{s=`block scalar indicator ${t[0]}`;break}case"@":case"`":{s=`reserved character ${t[0]}`;break}}return s&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${s}`),Ya(t)}function lp(t,e){return(t[t.length-1]!=="'"||t.length===1)&&e(t.length,"MISSING_CHAR","Missing closing 'quote"),Ya(t.slice(1,-1)).replace(/''/g,"'")}function Ya(t){let e,s;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),s=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch{e=/(.*?)[ \t]*\r?\n/sy,s=/[ \t]*(.*?)[ \t]*\r?\n/sy}let n=e.exec(t);if(!n)return t;let i=n[1],d=" ",o=e.lastIndex;for(s.lastIndex=o;n=s.exec(t);)n[1]===""?d===`
`?i+=d:d=`
`:(i+=d+n[1],d=" "),o=s.lastIndex;const r=/[ \t]*(.*)/sy;return r.lastIndex=o,n=r.exec(t),i+d+(n?.[1]??"")}function np(t,e){let s="";for(let n=1;n<t.length-1;++n){const i=t[n];if(!(i==="\r"&&t[n+1]===`
`))if(i===`
`){const{fold:d,offset:o}=sp(t,n);s+=d,n=o}else if(i==="\\"){let d=t[++n];const o=ap[d];if(o)s+=o;else if(d===`
`)for(d=t[n+1];d===" "||d==="	";)d=t[++n+1];else if(d==="\r"&&t[n+1]===`
`)for(d=t[++n+1];d===" "||d==="	";)d=t[++n+1];else if(d==="x"||d==="u"||d==="U"){const r={x:2,u:4,U:8}[d];s+=ip(t,n+1,r,e),n+=r}else{const r=t.substr(n-1,2);e(n-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${r}`),s+=r}}else if(i===" "||i==="	"){const d=n;let o=t[n+1];for(;o===" "||o==="	";)o=t[++n+1];o!==`
`&&!(o==="\r"&&t[n+2]===`
`)&&(s+=n>d?t.slice(d,n+1):i)}else s+=i}return(t[t.length-1]!=='"'||t.length===1)&&e(t.length,"MISSING_CHAR",'Missing closing "quote'),s}function sp(t,e){let s="",n=t[e+1];for(;(n===" "||n==="	"||n===`
`||n==="\r")&&!(n==="\r"&&t[e+2]!==`
`);)n===`
`&&(s+=`
`),e+=1,n=t[e+1];return s||(s=" "),{fold:s,offset:e}}const ap={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"\x85",_:"\xA0",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function ip(t,e,s,n){const i=t.substr(e,s),o=i.length===s&&/^[0-9a-fA-F]+$/.test(i)?parseInt(i,16):NaN;if(isNaN(o)){const r=t.substr(e-2,s+2);return n(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${r}`),r}return String.fromCodePoint(o)}function Xa(t,e,s,n){const{value:i,type:d,comment:o,range:r}=e.type==="block-scalar"?Ym(t,e,n):ep(e,t.options.strict,n),u=s?t.directives.tagName(s.source,y=>n(s,"TAG_RESOLVE_FAILED",y)):null;let c;t.options.stringKeys&&t.atKey?c=t.schema[Tt]:u?c=op(t.schema,i,u,s,n):e.type==="scalar"?c=rp(t,i,e,n):c=t.schema[Tt];let b;try{const y=c.resolve(i,w=>n(s??e,"TAG_RESOLVE_FAILED",w),t.options);b=Ee(y)?y:new we(y)}catch(y){const w=y instanceof Error?y.message:String(y);n(s??e,"TAG_RESOLVE_FAILED",w),b=new we(i)}return b.range=r,b.source=i,d&&(b.type=d),u&&(b.tag=u),c.format&&(b.format=c.format),o&&(b.comment=o),b}function op(t,e,s,n,i){if(s==="!")return t[Tt];const d=[];for(const r of t.tags)if(!r.collection&&r.tag===s)if(r.default&&r.test)d.push(r);else return r;for(const r of d)if(r.test?.test(e))return r;const o=t.knownTags[s];return o&&!o.collection?(t.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(i(n,"TAG_RESOLVE_FAILED",`Unresolved tag: ${s}`,s!=="tag:yaml.org,2002:str"),t[Tt])}function rp({atKey:t,directives:e,schema:s},n,i,d){const o=s.tags.find(r=>(r.default===!0||t&&r.default==="key")&&r.test?.test(n))||s[Tt];if(s.compat){const r=s.compat.find(u=>u.default&&u.test?.test(n))??s[Tt];if(o.tag!==r.tag){const u=e.tagString(o.tag),c=e.tagString(r.tag),b=`Value may be parsed as either ${u} or ${c}`;d(i,"TAG_RESOLVE_FAILED",b,!0)}}return o}function dp(t,e,s){if(e){s===null&&(s=e.length);for(let n=s-1;n>=0;--n){let i=e[n];switch(i.type){case"space":case"comment":case"newline":t-=i.source.length;continue}for(i=e[++n];i?.type==="space";)t+=i.source.length,i=e[++n];break}}return t}const up={composeNode:Za,composeEmptyNode:us};function Za(t,e,s,n){const i=t.atKey,{spaceBefore:d,comment:o,anchor:r,tag:u}=s;let c,b=!0;switch(e.type){case"alias":c=cp(t,e,n),(r||u)&&n(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":c=Xa(t,e,u,n),r&&(c.anchor=r.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":c=Jm(up,t,e,s,n),r&&(c.anchor=r.source.substring(1));break;default:{const y=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;n(e,"UNEXPECTED_TOKEN",y),c=us(t,e.offset,void 0,null,s,n),b=!1}}return r&&c.anchor===""&&n(r,"BAD_ALIAS","Anchor cannot be an empty string"),i&&t.options.stringKeys&&(!Ee(c)||typeof c.value!="string"||c.tag&&c.tag!=="tag:yaml.org,2002:str")&&n(u??e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),d&&(c.spaceBefore=!0),o&&(e.type==="scalar"&&e.source===""?c.comment=o:c.commentBefore=o),t.options.keepSourceTokens&&b&&(c.srcToken=e),c}function us(t,e,s,n,{spaceBefore:i,comment:d,anchor:o,tag:r,end:u},c){const b={type:"scalar",offset:dp(e,s,n),indent:-1,source:""},y=Xa(t,b,r,c);return o&&(y.anchor=o.source.substring(1),y.anchor===""&&c(o,"BAD_ALIAS","Anchor cannot be an empty string")),i&&(y.spaceBefore=!0),d&&(y.comment=d,y.range[2]=u),y}function cp({options:t},{offset:e,source:s,end:n},i){const d=new Xn(s.substring(1));d.source===""&&i(e,"BAD_ALIAS","Alias cannot be an empty string"),d.source.endsWith(":")&&i(e+s.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const o=e+s.length,r=Al(n,o,t.strict,i);return d.range=[e,o,r.offset],r.comment&&(d.comment=r.comment),d}function fp(t,e,{offset:s,start:n,value:i,end:d},o){const r=Object.assign({_directives:e},t),u=new xl(void 0,r),c={atKey:!1,atRoot:!0,directives:u.directives,options:u.options,schema:u.schema},b=tl(n,{indicator:"doc-start",next:i??d?.[0],offset:s,onError:o,parentIndent:0,startOnNewline:!0});b.found&&(u.directives.docStart=!0,i&&(i.type==="block-map"||i.type==="block-seq")&&!b.hasNewline&&o(b.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),u.contents=i?Za(c,i,b,o):us(c,b.end,n,null,b,o);const y=u.contents.range[2],w=Al(d,y,!1,o);return w.comment&&(u.comment=w.comment),u.range=[s,y,w.offset],u}function dl(t){if(typeof t=="number")return[t,t+1];if(Array.isArray(t))return t.length===2?t:[t[0],t[1]];const{offset:e,source:s}=t;return[e,e+(typeof s=="string"?s.length:1)]}function Rs(t){let e="",s=!1,n=!1;for(let i=0;i<t.length;++i){const d=t[i];switch(d[0]){case"#":e+=(e===""?"":n?`

`:`
`)+(d.substring(1)||" "),s=!0,n=!1;break;case"%":t[i+1]?.[0]!=="#"&&(i+=1),s=!1;break;default:s||(n=!0),s=!1}}return{comment:e,afterEmptyLine:n}}class mp{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(s,n,i,d)=>{const o=dl(s);d?this.warnings.push(new zm(o,n,i)):this.errors.push(new cl(o,n,i))},this.directives=new rt({version:e.version||"1.2"}),this.options=e}decorate(e,s){const{comment:n,afterEmptyLine:i}=Rs(this.prelude);if(n){const d=e.contents;if(s)e.comment=e.comment?`${e.comment}
${n}`:n;else if(i||e.directives.docStart||!d)e.commentBefore=n;else if(We(d)&&!d.flow&&d.items.length>0){let o=d.items[0];Je(o)&&(o=o.key);const r=o.commentBefore;o.commentBefore=r?`${n}
${r}`:n}else{const o=d.commentBefore;d.commentBefore=o?`${n}
${o}`:n}}s?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Rs(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,s=!1,n=-1){for(const i of e)yield*this.next(i);yield*this.end(s,n)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(s,n,i)=>{const d=dl(e);d[0]+=s,this.onError(d,"BAD_DIRECTIVE",n,i)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const s=fp(this.options,this.directives,e,this.onError);this.atDirectives&&!s.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(s,!1),this.doc&&(yield this.doc),this.doc=s,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const s=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,n=new cl(dl(e),"UNEXPECTED_TOKEN",s);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){const n="Unexpected doc-end without preceding document";this.errors.push(new cl(dl(e),"UNEXPECTED_TOKEN",n));break}this.doc.directives.docEnd=!0;const s=Al(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),s.comment){const n=this.doc.comment;this.doc.comment=n?`${n}
${s.comment}`:s.comment}this.doc.range[2]=s.offset;break}default:this.errors.push(new cl(dl(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,s=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const n=Object.assign({_directives:this.directives},this.options),i=new xl(void 0,n);this.atDirectives&&this.onError(s,"MISSING_CHAR","Missing directives-end indicator line"),i.range=[0,s,s],this.decorate(i,!1),yield i}}}const ei="\uFEFF",ti="",li="",Nn="";function pp(t){switch(t){case ei:return"byte-order-mark";case ti:return"doc-mode";case li:return"flow-error-end";case Nn:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(t[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}function _t(t){switch(t){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}const Ds=new Set("0123456789ABCDEFabcdef"),gp=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),Nl=new Set(",[]{}"),hp=new Set(` ,[]{}
\r	`),Sn=t=>!t||hp.has(t);class yp{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,s=!1){if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!s;let n=this.next??"stream";for(;n&&(s||this.hasChars(1));)n=yield*this.parseNext(n)}atLineEnd(){let e=this.pos,s=this.buffer[e];for(;s===" "||s==="	";)s=this.buffer[++e];return!s||s==="#"||s===`
`?!0:s==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let s=this.buffer[e];if(this.indentNext>0){let n=0;for(;s===" ";)s=this.buffer[++n+e];if(s==="\r"){const i=this.buffer[n+e+1];if(i===`
`||!i&&!this.atEnd)return e+n+1}return s===`
`||n>=this.indentNext||!s&&!this.atEnd?e+n:-1}if(s==="-"||s==="."){const n=this.buffer.substr(e,3);if((n==="---"||n==="...")&&_t(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===ei&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let s=e.length,n=e.indexOf("#");for(;n!==-1;){const d=e[n-1];if(d===" "||d==="	"){s=n-1;break}else n=e.indexOf("#",n+1)}for(;;){const d=e[s-1];if(d===" "||d==="	")s-=1;else break}const i=(yield*this.pushCount(s))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-i),this.pushNewline(),"stream"}if(this.atLineEnd()){const s=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-s),yield*this.pushNewline(),"stream"}return yield ti,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const s=this.peek(3);if((s==="---"||s==="...")&&_t(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,s==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!_t(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,s]=this.peek(2);if(!s&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&_t(s)){const n=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=n,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(e===null)return this.setNext("doc");let s=yield*this.pushIndicators();switch(e[s]){case"#":yield*this.pushCount(e.length-s);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(Sn),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return s+=yield*this.parseBlockScalarHeader(),s+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-s),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,s,n=-1;do e=yield*this.pushNewline(),e>0?(s=yield*this.pushSpaces(!1),this.indentValue=n=s):s=0,s+=yield*this.pushSpaces(!0);while(e+s>0);const i=this.getLine();if(i===null)return this.setNext("flow");if((n!==-1&&n<this.indentNext&&i[0]!=="#"||n===0&&(i.startsWith("---")||i.startsWith("..."))&&_t(i[3]))&&!(n===this.indentNext-1&&this.flowLevel===1&&(i[0]==="]"||i[0]==="}")))return this.flowLevel=0,yield li,yield*this.parseLineStart();let d=0;for(;i[d]===",";)d+=yield*this.pushCount(1),d+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(d+=yield*this.pushIndicators(),i[d]){case void 0:return"flow";case"#":return yield*this.pushCount(i.length-d),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(Sn),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const o=this.charAt(1);if(this.flowKey||_t(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let s=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;s!==-1&&this.buffer[s+1]==="'";)s=this.buffer.indexOf("'",s+2);else for(;s!==-1;){let d=0;for(;this.buffer[s-1-d]==="\\";)d+=1;if(d%2===0)break;s=this.buffer.indexOf('"',s+1)}const n=this.buffer.substring(0,s);let i=n.indexOf(`
`,this.pos);if(i!==-1){for(;i!==-1;){const d=this.continueScalar(i+1);if(d===-1)break;i=n.indexOf(`
`,d)}i!==-1&&(s=i-(n[i-1]==="\r"?2:1))}if(s===-1){if(!this.atEnd)return this.setNext("quoted-scalar");s=this.buffer.length}return yield*this.pushToIndex(s+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const s=this.buffer[++e];if(s==="+")this.blockScalarKeep=!0;else if(s>"0"&&s<="9")this.blockScalarIndent=Number(s)-1;else if(s!=="-")break}return yield*this.pushUntil(s=>_t(s)||s==="#")}*parseBlockScalar(){let e=this.pos-1,s=0,n;e:for(let d=this.pos;n=this.buffer[d];++d)switch(n){case" ":s+=1;break;case`
`:e=d,s=0;break;case"\r":{const o=this.buffer[d+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!n&&!this.atEnd)return this.setNext("block-scalar");if(s>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=s:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{const d=this.continueScalar(e+1);if(d===-1)break;e=this.buffer.indexOf(`
`,d)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let i=e+1;for(n=this.buffer[i];n===" ";)n=this.buffer[++i];if(n==="	"){for(;n==="	"||n===" "||n==="\r"||n===`
`;)n=this.buffer[++i];e=i-1}else if(!this.blockScalarKeep)do{let d=e-1,o=this.buffer[d];o==="\r"&&(o=this.buffer[--d]);const r=d;for(;o===" ";)o=this.buffer[--d];if(o===`
`&&d>=this.pos&&d+1+s>r)e=d;else break}while(!0);return yield Nn,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let s=this.pos-1,n=this.pos-1,i;for(;i=this.buffer[++n];)if(i===":"){const d=this.buffer[n+1];if(_t(d)||e&&Nl.has(d))break;s=n}else if(_t(i)){let d=this.buffer[n+1];if(i==="\r"&&(d===`
`?(n+=1,i=`
`,d=this.buffer[n+1]):s=n),d==="#"||e&&Nl.has(d))break;if(i===`
`){const o=this.continueScalar(n+1);if(o===-1)break;n=Math.max(n,o-2)}}else{if(e&&Nl.has(i))break;s=n}return!i&&!this.atEnd?this.setNext("plain-scalar"):(yield Nn,yield*this.pushToIndex(s+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,s){const n=this.buffer.slice(this.pos,e);return n?(yield n,this.pos+=n.length,n.length):(s&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(Sn))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,s=this.charAt(1);if(_t(s)||e&&Nl.has(s))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,s=this.buffer[e];for(;!_t(s)&&s!==">";)s=this.buffer[++e];return yield*this.pushToIndex(s===">"?e+1:e,!1)}else{let e=this.pos+1,s=this.buffer[e];for(;s;)if(gp.has(s))s=this.buffer[++e];else if(s==="%"&&Ds.has(this.buffer[e+1])&&Ds.has(this.buffer[e+2]))s=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let s=this.pos-1,n;do n=this.buffer[++s];while(n===" "||e&&n==="	");const i=s-this.pos;return i>0&&(yield this.buffer.substr(this.pos,i),this.pos=s),i}*pushUntil(e){let s=this.pos,n=this.buffer[s];for(;!e(n);)n=this.buffer[++s];return yield*this.pushToIndex(s,!1)}}class bp{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let s=0,n=this.lineStarts.length;for(;s<n;){const d=s+n>>1;this.lineStarts[d]<e?s=d+1:n=d}if(this.lineStarts[s]===e)return{line:s+1,col:1};if(s===0)return{line:0,col:e};const i=this.lineStarts[s-1];return{line:s,col:e-i+1}}}}function Mt(t,e){for(let s=0;s<t.length;++s)if(t[s].type===e)return!0;return!1}function Us(t){for(let e=0;e<t.length;++e)switch(t[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function ni(t){switch(t?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function Ll(t){switch(t.type){case"document":return t.start;case"block-map":{const e=t.items[t.items.length-1];return e.sep??e.start}case"block-seq":return t.items[t.items.length-1].start;default:return[]}}function Kt(t){if(t.length===0)return[];let e=t.length;e:for(;--e>=0;)switch(t[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;t[++e]?.type==="space";);return t.splice(e,t.length)}function Ps(t){if(t.start.type==="flow-seq-start")for(const e of t.items)e.sep&&!e.value&&!Mt(e.start,"explicit-key-ind")&&!Mt(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,ni(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}class vp{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new yp,this.onNewLine=e}*parse(e,s=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(const n of this.lexer.lex(e,s))yield*this.next(n);s||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}const s=pp(e);if(s)if(s==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=s,yield*this.step(),s){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const n=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:n,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){const s=e??this.stack.pop();if(s)if(this.stack.length===0)yield s;else{const n=this.peek(1);switch(s.type==="block-scalar"?s.indent="indent"in n?n.indent:0:s.type==="flow-collection"&&n.type==="document"&&(s.indent=0),s.type==="flow-collection"&&Ps(s),n.type){case"document":n.value=s;break;case"block-scalar":n.props.push(s);break;case"block-map":{const i=n.items[n.items.length-1];if(i.value){n.items.push({start:[],key:s,sep:[]}),this.onKeyLine=!0;return}else if(i.sep)i.value=s;else{Object.assign(i,{key:s,sep:[]}),this.onKeyLine=!i.explicitKey;return}break}case"block-seq":{const i=n.items[n.items.length-1];i.value?n.items.push({start:[],value:s}):i.value=s;break}case"flow-collection":{const i=n.items[n.items.length-1];!i||i.value?n.items.push({start:[],key:s,sep:[]}):i.sep?i.value=s:Object.assign(i,{key:s,sep:[]});return}default:yield*this.pop(),yield*this.pop(s)}if((n.type==="document"||n.type==="block-map"||n.type==="block-seq")&&(s.type==="block-map"||s.type==="block-seq")){const i=s.items[s.items.length-1];i&&!i.sep&&!i.value&&i.start.length>0&&Us(i.start)===-1&&(s.indent===0||i.start.every(d=>d.type!=="comment"||d.indent<s.indent))&&(n.type==="document"?n.end=i.start:n.items.push({start:i.start}),s.items.splice(-1,1))}}else{const n="Tried to pop an empty stack";yield{type:"error",offset:this.offset,source:"",message:n}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{Us(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}const s=this.startBlockValue(e);s?this.stack.push(s):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){const s=Ll(this.peek(2)),n=Kt(s);let i;e.end?(i=e.end,i.push(this.sourceToken),delete e.end):i=[this.sourceToken];const d={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:n,key:e,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=d}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let s=this.source.indexOf(`
`)+1;for(;s!==0;)this.onNewLine(this.offset+s),s=this.source.indexOf(`
`,s)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){const s=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,s.value){const n="end"in s.value?s.value.end:void 0;(Array.isArray(n)?n[n.length-1]:void 0)?.type==="comment"?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else s.sep?s.sep.push(this.sourceToken):s.start.push(this.sourceToken);return;case"space":case"comment":if(s.value)e.items.push({start:[this.sourceToken]});else if(s.sep)s.sep.push(this.sourceToken);else{if(this.atIndentedComment(s.start,e.indent)){const i=e.items[e.items.length-2]?.value?.end;if(Array.isArray(i)){Array.prototype.push.apply(i,s.start),i.push(this.sourceToken),e.items.pop();return}}s.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent,i=n&&(s.sep||s.explicitKey)&&this.type!=="seq-item-ind";let d=[];if(i&&s.sep&&!s.value){const o=[];for(let r=0;r<s.sep.length;++r){const u=s.sep[r];switch(u.type){case"newline":o.push(r);break;case"space":break;case"comment":u.indent>e.indent&&(o.length=0);break;default:o.length=0}}o.length>=2&&(d=s.sep.splice(o[1]))}switch(this.type){case"anchor":case"tag":i||s.value?(d.push(this.sourceToken),e.items.push({start:d}),this.onKeyLine=!0):s.sep?s.sep.push(this.sourceToken):s.start.push(this.sourceToken);return;case"explicit-key-ind":!s.sep&&!s.explicitKey?(s.start.push(this.sourceToken),s.explicitKey=!0):i||s.value?(d.push(this.sourceToken),e.items.push({start:d,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(s.explicitKey)if(s.sep)if(s.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Mt(s.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:d,key:null,sep:[this.sourceToken]}]});else if(ni(s.key)&&!Mt(s.sep,"newline")){const o=Kt(s.start),r=s.key,u=s.sep;u.push(this.sourceToken),delete s.key,delete s.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:r,sep:u}]})}else d.length>0?s.sep=s.sep.concat(d,this.sourceToken):s.sep.push(this.sourceToken);else if(Mt(s.start,"newline"))Object.assign(s,{key:null,sep:[this.sourceToken]});else{const o=Kt(s.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]})}else s.sep?s.value||i?e.items.push({start:d,key:null,sep:[this.sourceToken]}):Mt(s.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):s.sep.push(this.sourceToken):Object.assign(s,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const o=this.flowScalar(this.type);i||s.value?(e.items.push({start:d,key:o,sep:[]}),this.onKeyLine=!0):s.sep?this.stack.push(o):(Object.assign(s,{key:o,sep:[]}),this.onKeyLine=!0);return}default:{const o=this.startBlockValue(e);if(o){n&&o.type!=="block-seq"&&e.items.push({start:d}),this.stack.push(o);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){const s=e.items[e.items.length-1];switch(this.type){case"newline":if(s.value){const n="end"in s.value?s.value.end:void 0;(Array.isArray(n)?n[n.length-1]:void 0)?.type==="comment"?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else s.start.push(this.sourceToken);return;case"space":case"comment":if(s.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(s.start,e.indent)){const i=e.items[e.items.length-2]?.value?.end;if(Array.isArray(i)){Array.prototype.push.apply(i,s.start),i.push(this.sourceToken),e.items.pop();return}}s.start.push(this.sourceToken)}return;case"anchor":case"tag":if(s.value||this.indent<=e.indent)break;s.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;s.value||Mt(s.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):s.start.push(this.sourceToken);return}if(this.indent>e.indent){const n=this.startBlockValue(e);if(n){this.stack.push(n);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){const s=e.items[e.items.length-1];if(this.type==="flow-error-end"){let n;do yield*this.pop(),n=this.peek(1);while(n&&n.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!s||s.sep?e.items.push({start:[this.sourceToken]}):s.start.push(this.sourceToken);return;case"map-value-ind":!s||s.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):s.sep?s.sep.push(this.sourceToken):Object.assign(s,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!s||s.value?e.items.push({start:[this.sourceToken]}):s.sep?s.sep.push(this.sourceToken):s.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const i=this.flowScalar(this.type);!s||s.value?e.items.push({start:[],key:i,sep:[]}):s.sep?this.stack.push(i):Object.assign(s,{key:i,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}const n=this.startBlockValue(e);n?this.stack.push(n):(yield*this.pop(),yield*this.step())}else{const n=this.peek(2);if(n.type==="block-map"&&(this.type==="map-value-ind"&&n.indent===e.indent||this.type==="newline"&&!n.items[n.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&n.type!=="flow-collection"){const i=Ll(n),d=Kt(i);Ps(e);const o=e.end.splice(1,e.end.length);o.push(this.sourceToken);const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:d,key:e,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let s=this.source.indexOf(`
`)+1;for(;s!==0;)this.onNewLine(this.offset+s),s=this.source.indexOf(`
`,s)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const s=Ll(e),n=Kt(s);return n.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const s=Ll(e),n=Kt(s);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:n,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,s){return this.type!=="comment"||this.indent<=s?!1:e.every(n=>n.type==="newline"||n.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}}function wp(t){const e=t.prettyErrors!==!1;return{lineCounter:t.lineCounter||e&&new bp||null,prettyErrors:e}}function si(t,e={}){const{lineCounter:s,prettyErrors:n}=wp(e),i=new vp(s?.addNewLine),d=new mp(e);let o=null;for(const r of d.compose(i.parse(t),!0,t.length))if(!o)o=r;else if(o.options.logLevel!=="silent"){o.errors.push(new cl(r.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return n&&s&&(o.errors.forEach(qs(t,s)),o.warnings.forEach(qs(t,s))),o}function Es(t,e,s){let n;typeof e=="function"?n=e:s===void 0&&e&&typeof e=="object"&&(s=e);const i=si(t,s);if(!i)return null;if(i.warnings.forEach(d=>qa(i.options.logLevel,d)),i.errors.length>0){if(i.options.logLevel!=="silent")throw i.errors[0];i.errors=[]}return i.toJS(Object.assign({reviver:n},s))}function kp(t,e,s){let n=null;if(typeof e=="function"||Array.isArray(e)?n=e:s===void 0&&e&&(s=e),typeof s=="string"&&(s=s.length),typeof s=="number"){const i=Math.round(s);s=i<1?void 0:i>8?{indent:8}:{indent:i}}if(t===void 0){const{keepUndefined:i}=s??e??{};if(!i)return}return Sl(t)&&!n?t.toString(s):new xl(t,n,s).toString(s)}const Xl=Me({__name:"ReportDataQueryForm",props:{dataQuery:{},editInTemplate:{type:Boolean}},emits:[...oe.emits],setup(t){const e=Ie(),s=t,{dialogRef:n,onDialogHide:i,onDialogOK:d}=oe(),o=s.dataQuery?mt(Fn({},s.dataQuery)):mt({id:0,name:"",json_query:{}}),r=M(JSON.stringify(o.json_query,null,4)),{isLoading:u,isError:c,addReportDataQuery:b,editReportDataQuery:y}=Gn;async function w(){try{o.json_query=JSON.parse(r.value)}catch(D){At(`There was an error parsing the json: ${D}`);return}!s.editInTemplate&&(s.dataQuery?y(o.id,o):b(o),await Ht(u).not.toBeTruthy(),c.value)||d(o)}const k=M(null);let x;async function h(){const D=await Ae.get("/reporting/queryschema/");var T=Bl.parse("model://new"),A=ot.createModel(r.value,"json",T);Io.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:[{uri:"schema://model-schema",fileMatch:[T.toString()],schema:D.data}]});const N=e.dark.isActive?"vs-dark":"vs-light";x=ot.create(k.value,{model:A,theme:N}),x.onDidChangeModelContent(()=>{r.value=x.getValue()})}function V(){x.getModel()?.dispose(),x.dispose()}return(D,T)=>(f(),p(me,{ref_key:"dialogRef",ref:n,maximized:"",onHide:_(i),onShow:h,onBeforeHide:V},{default:a(()=>[l(ue,null,{default:a(()=>[l(De,null,{default:a(()=>[m(F(s.dataQuery?"Edit Data Query":"New Data Query")+" ",1),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>T[1]||(T[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(Qn,null,{default:a(()=>[l(ge,{modelValue:_(o).name,"onUpdate:modelValue":T[0]||(T[0]=A=>_(o).name=A),label:"Data Query Name",filled:"",dense:"",style:{width:"400px"}},null,8,["modelValue"]),l(pe)]),_:1}),g("div",{ref_key:"queryEditor",ref:k,style:Re({height:`${_(e).screen.height-126}px`})},null,4),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{loading:_(u),dense:"",flat:"",label:"Save",color:"primary",onClick:w},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),Ms=Me({__name:"DataQuerySelect",props:{dataSources:{}},emits:[...oe.emits],setup(t){const e=t,{dialogRef:s,onDialogHide:n,onDialogOK:i}=oe(),{reportDataQueries:d,getReportDataQueries:o}=Gn,r=M(null),u=M(!1),c=te(()=>e.dataSources===void 0?d.value.map(y=>y.name):Object.keys(e.dataSources));function b(){if(r.value===null)At("Select a query from the dropdown");else{let y;e.dataSources===void 0?y=d.value.find(w=>w.name===r.value):y={id:0,name:r.value,json_query:e.dataSources[r.value]},i(y)}}return Le(()=>{e.dataSources===void 0&&o()}),(y,w)=>(f(),p(me,{ref_key:"dialogRef",ref:s,onHide:_(n)},{default:a(()=>[l(ue,{style:{width:"400px"}},{default:a(()=>[l(De,null,{default:a(()=>[w[2]||(w[2]=m(" Data Query Select ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>w[1]||(w[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(I,null,{default:a(()=>[l(Fe,{modelValue:r.value,"onUpdate:modelValue":w[0]||(w[0]=k=>r.value=k),options:c.value,label:"Data Queries",outlined:""},null,8,["modelValue","options"])]),_:1}),l(ze,null,{default:a(()=>[l(pe),O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{loading:u.value,onClick:b,dense:"",flat:"",label:"Select",color:"primary"},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),_p={key:0},Sp=Me({__name:"ReportAssetSelect",props:{templateType:{}},emits:[...oe.emits],setup(t){const e=t,{dialogRef:s,onDialogHide:n,onDialogOK:i}=oe(),d=M([]),o=M("link"),r=M(""),u=M(""),c=M(""),b=M(""),y=M(null);function w(x,h){return e.templateType==="markdown"?`![${h}](${x})`:`<img src="${x}" alt="${h}">`}be([r,u,c],([x,h,V])=>{if(o.value==="link")b.value=w(h,x);else if(o.value==="asset"&&V){const D=y.value?.getNodeByKey(V);b.value=w(`asset://${D.id}`,D.name)}}),be(o,()=>{b.value="",r.value="",u.value="",c.value=""});async function k(){d.value=await nm()}return Le(k),(x,h)=>(f(),p(me,{ref_key:"dialogRef",ref:s,onHide:_(n)},{default:a(()=>[l(ue,{style:{width:"400px"}},{default:a(()=>[l(De,null,{default:a(()=>[h[9]||(h[9]=m(" Report Asset Select ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>h[8]||(h[8]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(I,{class:"q-gutter-sm"},{default:a(()=>[l(Xe,{dense:"",modelValue:o.value,"onUpdate:modelValue":h[0]||(h[0]=V=>o.value=V),val:"link",label:"Link"},null,8,["modelValue"]),l(Xe,{dense:"",modelValue:o.value,"onUpdate:modelValue":h[1]||(h[1]=V=>o.value=V),val:"asset",label:"Report Asset"},null,8,["modelValue"])]),_:1}),o.value==="link"?(f(),p(I,{key:0},{default:a(()=>[l(ge,{modelValue:r.value,"onUpdate:modelValue":h[2]||(h[2]=V=>r.value=V),label:"Text",dense:"",outlined:"",class:"q-pb-sm"},null,8,["modelValue"]),l(ge,{modelValue:u.value,"onUpdate:modelValue":h[3]||(h[3]=V=>u.value=V),label:"Url",dense:"",outlined:"",class:"q-pb-sm"},null,8,["modelValue"]),l(ge,{modelValue:b.value,"onUpdate:modelValue":h[4]||(h[4]=V=>b.value=V),label:"Output",readonly:"",dense:""},null,8,["modelValue"])]),_:1})):G("",!0),o.value==="asset"?(f(),p(I,{key:1,style:{"max-height":"50vh"},class:"scroll"},{default:a(()=>[d.value.length===0?(f(),ce("div",_p," No Report Assets found. Go to Reports -> Generate Reports and use the Report Assets button to upload ")):(f(),p(nn,{key:1,ref_key:"qtree",ref:y,nodes:d.value,selected:c.value,"onUpdate:selected":h[5]||(h[5]=V=>c.value=V),"node-key":"path","label-key":"name",dense:"","default-expand-all":""},null,8,["nodes","selected"]))]),_:1})):G("",!0),o.value==="asset"?(f(),p(I,{key:2},{default:a(()=>[l(ge,{modelValue:b.value,"onUpdate:modelValue":h[6]||(h[6]=V=>b.value=V),label:"Selected",readonly:"",dense:"",class:"q-pb-sm"},null,8,["modelValue"])]),_:1})):G("",!0),l(ze,null,{default:a(()=>[l(pe),O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{onClick:h[7]||(h[7]=V=>_(i)(b.value)),dense:"",flat:"",label:"Select",color:"primary"})]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),Ns=`<table>
  <thead>
    <tr>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
    </tr>
  </tbody>
</table>`,Vp=Me({__name:"ReportTableMaker",emits:[...oe.emits],setup(t){const{variableAnalysis:e}=ll,{dialogRef:s,onDialogHide:n,onDialogOK:i}=oe(),d=[{value:"blank",label:"Blank"},{value:"variables",label:"From Variables"}],o=M("blank"),r=M(""),u=M(Ns);be(r,k=>{let x=[];for(let h in e.value)e.value[h]!=="Object"&&h.startsWith(k+"[0]")&&x.push(h.replace(k+"[0].",""));y(x)}),be(o,k=>{k==="blank"&&(u.value=Ns)});const c=te(()=>{let k=[];for(let x in e.value)e.value[x].toLowerCase().startsWith("array")&&k.push(x);return k});function b(k){let x=k.split("__");return x.length>1&&(x=x.slice(-2)),x.join("_").split("_").map(V=>zt(V)).join(" ")}function y(k){let x="",h="";k.forEach(V=>{x+=`	<th>${b(V)}</th>
`,h+=`	<td>{{ item.${V} }}</td>
`}),x||(x="	<th>Column Name</th>"),h||(h="	<td>{{ item }}</td>"),u.value=`<table>
  <thead>
    <tr>
${x}
    </tr>
  </thead>
  <tbody>
    {% for item in ${r.value} %}
    <tr>
${h}
    </tr>
    {% endfor %}
  </tbody>
</table>
`}function w(){i(u.value)}return(k,x)=>(f(),p(me,{ref_key:"dialogRef",ref:s,onHide:_(n)},{default:a(()=>[l(ue,{style:{width:"80vw"}},{default:a(()=>[l(De,null,{default:a(()=>[x[4]||(x[4]=m(" Insert Table ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>x[3]||(x[3]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(I,null,{default:a(()=>[l(St,{modelValue:o.value,"onUpdate:modelValue":x[0]||(x[0]=h=>o.value=h),options:d,dense:"",inline:""},null,8,["modelValue"])]),_:1}),o.value==="variables"?(f(),p(I,{key:0},{default:a(()=>[l(Qe,{modelValue:r.value,"onUpdate:modelValue":x[1]||(x[1]=h=>r.value=h),options:c.value,outlined:"",dense:"",label:"Data Source"},null,8,["modelValue","options"])]),_:1})):G("",!0),l(I,{style:{"max-height":"60vh"},class:"scroll"},{default:a(()=>[l(ge,{modelValue:u.value,"onUpdate:modelValue":x[2]||(x[2]=h=>u.value=h),filled:"",type:"textarea",autogrow:""},null,8,["modelValue"])]),_:1}),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{dense:"",flat:"",label:"Insert",color:"primary",onClick:w})]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),Cp={class:"no-wrap q-pa-md"},Tp=Me({__name:"EditorToolbar",props:{editor:{},variablesEditor:{},templateType:{}},setup(t){const e=t,s=Ie(),n=Pi(e.editor),i=M(!1),d=M(""),o=M("");Le(()=>{n.onDidChangeCursorSelection(ne=>{i.value=rl.spansMultipleLines(ne.selection)})});function r(ne){e.templateType==="markdown"?Y("#",ne.length):X(`<h${ne.length}>`,`</h${ne.length}>`),n.focus()}function u(){e.templateType==="markdown"?X("**","**"):X("<b>","</b>"),n.focus()}function c(){e.templateType==="markdown"?X("*","*"):X("<i>","</i>"),n.focus()}function b(){e.templateType==="markdown"?Y("1."):le(`<ol>
	<li></li>
	<li></li>
</ol>`,!0),n.focus()}function y(){e.templateType==="markdown"?Y("*"):le(`<ul>
	<li></li>
	<li></li>
</ul>`,!0),n.focus()}function w(){e.templateType==="markdown"?Y(">"):X("<blockquote>","</blockquote>",!0),n.focus()}function k(){e.templateType==="markdown"?i.value?X("```\n","\n```",!0):X("`","`"):X("<code>","</code>"),n.focus()}function x(){let ne=Es(e.variablesEditor.getValue())||{};return!("data_sources"in ne)||!ne.data_sources?null:ne.data_sources}function h(ne,$=!0){let v=Es(e.variablesEditor.getValue())||{};(!("data_sources"in v)||!v.data_sources)&&(v.data_sources={});const U=$?Ei(ne.name):ne.name;v.data_sources[U]=ne.json_query,e.variablesEditor?.setValue(kp(v))}function V(){s.dialog({component:Xl}).onOk(ne=>{h(ne)})}function D(){s.dialog({component:Ms}).onOk(ne=>{h(ne),Ve(`${ne.name} was saved successfully in template`)})}function T(){const ne=x();if(!ne){Qi("No data sources exist in template variables");return}s.dialog({component:Ms,componentProps:{dataSources:ne}}).onOk($=>{s.dialog({component:Xl,componentProps:{dataQuery:$,editInTemplate:!0}}).onOk(v=>{h(v,!1),Ve(`${v.name} was saved successfully in template`)})})}function A(){e.templateType==="markdown"?le(`[${o.value}](${d.value})`):le(`<a href="${d.value}">${o.value}</a>`),n.focus()}function N(){s.dialog({component:Sp,componentProps:{templateType:e.templateType}}).onOk(ne=>{le(ne)}).onDismiss(()=>n.focus())}function S(){n.trigger("toolbar","redo",null),n.focus()}function q(){n.trigger("toolbar","undo",null),n.focus()}function P(){e.templateType==="markdown"?le("---",!0):le("<hr />",!0),n.focus()}function H(){s.dialog({component:Vp}).onOk(ne=>{le(ne,!0),n.focus()}),n.focus()}function L(ne){if(e.templateType==="markdown"){const $=ne.slice(0,1).toUpperCase();X(`~~${$}~~
`,`
~~/${$}~~`,!0)}else X(`<${ne}>`,`</${ne}>`,!0);n.focus()}function Z(ne,$){X(`{% ${ne} %}`,`{% ${$} %}`,!0),n.focus()}function fe(){X("{{","}}"),n.focus()}function le(ne,$=!1){const v=n.getModel(),U=n.getSelections();if(!v||!U)return;let Ce=[];for(let $e of U){const je=$e.getEndPosition();let Q=$?rl.fromPositions({lineNumber:je.lineNumber,column:v.getLineMaxColumn(je.lineNumber)}):$e;const ae=$?`
${ne}
`:ne;Ce.push({text:ae,range:Q,forceMoveMarkers:!0})}v.pushEditOperations(U,Ce,()=>U)}function Y(ne,$=1){const v=n.getModel(),U=n.getSelections();if(!v||!U)return;let Ce=[],$e=[];for(let je of U){const Q=je.getStartPosition(),ae=je.getEndPosition();let z=rl.fromPositions({lineNumber:Q.lineNumber,column:0},{lineNumber:ae.lineNumber,column:v.getLineMaxColumn(ae.lineNumber)}),he=[];$e.push(z);for(let ie=Q.lineNumber;ie<=ae.lineNumber;ie++){let _e=v?.getLineContent(ie).trimStart();const Pe=new RegExp(`^\\${ne}{${$}}\\s`),gt=new RegExp(`^\\${ne}+\\s`);_e.match(Pe)?_e=_e.replace(ne.repeat($),"").trimStart():_e=`${ne.repeat($)} ${_e?.replace(gt,"").trimStart()}`,he.push(_e)}Ce.push({text:he.join(`
`),range:z,forceMoveMarkers:!0})}v.pushEditOperations(U,Ce,()=>$e)}function X(ne,$,v=!1){const U=n.getModel(),Ce=n.getSelections();if(!U||!Ce)return;let $e=[];for(let je of Ce){const Q=je.getStartPosition(),ae=je.getEndPosition();let z=v?rl.fromPositions({lineNumber:Q.lineNumber,column:0},{lineNumber:ae.lineNumber,column:U.getLineMaxColumn(ae.lineNumber)}):je;const he=`${ne}${U.getValueInRange(z)}${$}`;$e.push({text:he,range:z,forceMoveMarkers:!0})}U.pushEditOperations(Ce,$e,je=>je.map(Q=>rl.fromRange(Q.range,Bo.LTR)))}return(ne,$)=>(f(),p(De,null,{default:a(()=>[l(Zt,{label:"Formatting",flat:"",dense:"","auto-close":"",ripple:!1,onHide:$[6]||($[6]=v=>_(n).focus())},{default:a(()=>[l(Se,{dense:""},{default:a(()=>[l(B,{clickable:"",onClick:$[0]||($[0]=v=>r("#"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[21]||($[21]=[m("Heading 1")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[1]||($[1]=v=>r("##"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[22]||($[22]=[m("Heading 2")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[2]||($[2]=v=>r("###"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[23]||($[23]=[m("Heading 3")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[3]||($[3]=v=>r("####"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[24]||($[24]=[m("Heading 4")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[4]||($[4]=v=>r("#####"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[25]||($[25]=[m("Heading 5")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[5]||($[5]=v=>r("######"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[26]||($[26]=[m("Heading 6")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(Zt,{label:"Section",flat:"",dense:"","auto-close":"",ripple:!1,onHide:$[14]||($[14]=v=>_(n).focus())},{default:a(()=>[l(Se,{dense:""},{default:a(()=>[l(B,{clickable:"",onClick:$[7]||($[7]=v=>L("section"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[27]||($[27]=[m("Section")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[8]||($[8]=v=>L("chapter"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[28]||($[28]=[m("Chapter")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[9]||($[9]=v=>L("header"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[29]||($[29]=[m("Header")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[10]||($[10]=v=>L("footer"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[30]||($[30]=[m("Footer")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[11]||($[11]=v=>L("nav"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[31]||($[31]=[m("Nav")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[12]||($[12]=v=>L("div"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[32]||($[32]=[m("Div")])),_:1})]),_:1})]),_:1}),l(B,{clickable:"",onClick:$[13]||($[13]=v=>L("article"))},{default:a(()=>[l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>$[33]||($[33]=[m("Article")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"format_bold",onClick:u},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[34]||($[34]=[m("Bold")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"format_italic",onClick:c},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[35]||($[35]=[m("Italic")])),_:1})]),_:1}),l(de,{vertical:"",inset:""}),l(E,{flat:"",dense:"",ripple:!1,icon:"format_list_numbered",onClick:b},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[36]||($[36]=[m("Numbered List")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"format_list_bulleted",onClick:y},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[37]||($[37]=[m("Bullet List")])),_:1})]),_:1}),l(de,{vertical:"",inset:""}),l(E,{flat:"",dense:"",ripple:!1,icon:"format_quote",onClick:w},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[38]||($[38]=[m("Block Quote")])),_:1})]),_:1}),l(de,{vertical:"",inset:""}),l(E,{flat:"",dense:"",ripple:!1,icon:"undo",onClick:q},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[39]||($[39]=[m("Undo")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"redo",onClick:S},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[40]||($[40]=[m("Redo")])),_:1})]),_:1}),l(de,{vertical:"",inset:""}),l(E,{flat:"",dense:"",ripple:!1,icon:"code",onClick:k},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[41]||($[41]=[m("Code Block")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"link"},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[42]||($[42]=[m("Link")])),_:1}),l(Ne,null,{default:a(()=>[g("div",Cp,[$[43]||($[43]=g("div",{class:"text-subtitle1"},"Create Link",-1)),l(ge,{modelValue:o.value,"onUpdate:modelValue":$[15]||($[15]=v=>o.value=v),label:"Text",type:"text"},null,8,["modelValue"]),l(ge,{modelValue:d.value,"onUpdate:modelValue":$[16]||($[16]=v=>d.value=v),label:"Url",type:"text"},null,8,["modelValue"]),O(l(E,{color:"primary",label:"Insert Link",class:"full-width q-mt-sm",flat:"",dense:"",onClick:A},null,512),[[R]])])]),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"image",onClick:N},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[44]||($[44]=[m("Image")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"horizontal_rule",onClick:P},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[45]||($[45]=[m("Horizontal Rule")])),_:1})]),_:1}),l(de,{vertical:"",inset:""}),l(E,{flat:"",dense:"",ripple:!1,label:"{% %}","no-caps":"",onClick:$[17]||($[17]=v=>Z("block [name]","endblock"))},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[46]||($[46]=[m("Jinja {% %} block")])),_:1})]),_:1}),l(E,{"no-caps":"",flat:"",dense:"",ripple:!1,label:"{{ }}",onClick:$[18]||($[18]=v=>fe())},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[47]||($[47]=[m("Jinja template data")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,label:"{% for ","no-caps":"",onClick:$[19]||($[19]=v=>Z("for item in items","endfor"))},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[48]||($[48]=[m("Jinja for loop")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,label:"{% if","no-caps":"",onClick:$[20]||($[20]=v=>Z("if [condition]","endif"))},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[49]||($[49]=[m("Jinja if condition")])),_:1})]),_:1}),l(de,{vertical:"",inset:""}),l(E,{flat:"",dense:"",ripple:!1,icon:"mdi-database-plus-outline",onClick:V},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[50]||($[50]=[m("Add Data Query")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"mdi-database-arrow-down",onClick:D},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[51]||($[51]=[m("Insert Saved Data Query")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"mdi-database-edit",onClick:T},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[52]||($[52]=[m("Edit Data Query")])),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,icon:"mdi-table-large-plus",onClick:H},{default:a(()=>[l(j,{delay:500},{default:a(()=>$[53]||($[53]=[m("Table")])),_:1})]),_:1}),zl(ne.$slots,"buttons")]),_:3}))}}),xp=["srcdoc","src"],Ap={class:"q-pa-xs"},Op={key:1,style:{height:"0px"}},qp=Me({__name:"ReportTemplatePreview",props:{previewFormat:{},source:{},debug:{type:Boolean},variables:{}},setup(t){const e=t,s=Ie(),n=M(s.screen.height-82),i=M(e.debug?n.value/2:n.value-8),d=M(e.debug?50:0);if(e.debug){let o,r;Le(()=>{const u=s.dark.isActive?"vs-dark":"vs-light";o=ot.create(document.getElementById("templateDiv"),{automaticLayout:!0,value:e.source||"",theme:u,language:"html",minimap:{enabled:!1},readOnly:!0}),r=ot.create(document.getElementById("variablesDiv"),{automaticLayout:!0,value:e.variables||"",language:"json",theme:u,minimap:{enabled:!1},readOnly:!0})}),Mi(()=>{o?.dispose(),r?.dispose()})}return(o,r)=>(f(),p(hl,{modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=u=>i.value=u),horizontal:"","emit-immediately":"",unit:"px",limits:[0,n.value-8],style:Re({"min-height":`${n.value}px`,height:`${n.value}px`})},{before:a(()=>[g("iframe",{srcdoc:o.previewFormat!=="pdf"?o.source:void 0,src:o.previewFormat==="pdf"?o.source:void 0,style:Re({"min-width":"100%","background-color":"white",height:`${i.value-6}px`})},null,12,xp)]),after:a(()=>[o.debug?(f(),p(hl,{key:0,modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=u=>d.value=u)},{before:a(()=>[g("div",Ap,F(o.previewFormat==="plaintext"?"Text":"HTML"),1),g("div",{id:"templateDiv",style:Re({height:`${n.value-i.value-33}px`})},null,4)]),after:a(()=>[r[2]||(r[2]=g("div",{class:"q-pa-xs"},"Variables",-1)),g("div",{id:"variablesDiv",style:Re({height:`${n.value-i.value-33}px`})},null,4)]),_:1},8,["modelValue"])):(f(),ce("div",Op))]),_:1},8,["modelValue","limits","style"]))}}),$p={class:"card-header ac jsb"},Rp=`<html>
    <head>
        <style>
            {{ css }}
        </style>
    </head>
    <body>
        {% block content %}{% endblock %}
    </body>
</html>
`,Kl=Me({__name:"ReportHTMLTemplateForm",props:{template:{},cloneTemplate:{}},emits:[...oe.emits],setup(t){const e=Ie(),s=t,{dialogRef:n,onDialogHide:i,onDialogOK:d}=oe(),o=s.template?mt(Fn({},s.template)):mt({id:0,name:s.cloneTemplate?`Copy of ${s.cloneTemplate.name}`:"",html:s.cloneTemplate?s.cloneTemplate.html:Rp}),{isLoading:r,isError:u,addReportHTMLTemplate:c,editReportHTMLTemplate:b}=sn;async function y(){s.template?b(o.id,o):c(o),await Ht(r).not.toBeTruthy(),!u.value&&d()}const w=M(null);let k;const x=e.dark.isActive?"vs-dark":"vs-light";function h(){k=ot.create(w.value,{language:"html",value:o.html,theme:x}),k.onDidChangeModelContent(()=>{o.html=k.getValue()})}function V(){k.dispose()}return(D,T)=>(f(),p(me,{ref_key:"dialogRef",ref:n,maximized:"",onHide:_(i),onShow:h,onBeforeHide:V},{default:a(()=>[l(ue,null,{default:a(()=>[g("div",$p,[T[2]||(T[2]=g("div",{class:"text-h6"},"New Base Template",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>T[1]||(T[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(Qn,null,{default:a(()=>[l(ge,{modelValue:_(o).name,"onUpdate:modelValue":T[0]||(T[0]=A=>_(o).name=A),label:"HTML Template Name",filled:"",dense:"",style:{width:"400px"}},null,8,["modelValue"]),l(pe)]),_:1}),g("div",{ref_key:"htmlEditor",ref:w,style:Re({height:`${_(e).screen.height-126}px`})},null,4),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{loading:_(r),dense:"",flat:"",label:"Save",color:"primary",onClick:y},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),Dp={key:0,class:"float-right"},Up=["onClick"],Pp={key:0,class:"float-right"},Ep={style:{"font-size":"smaller"}},Mp=["onClick"],Np=Me({__name:"VariablesSelector",props:{variables:{},template:{},dependsOn:{},base_template:{},dependencies:{}},setup(t){const e=t,{getAllowedValues:s,variableAnalysis:n,isLoading:i}=ll,{reportHTMLTemplates:d}=sn,o=M(!1),r=M(!1),u=M([]),c=M([]),b=M([]),y=M("");function w(V,D=!1,T=!1){let A="";T?A="{% block "+V+" %}{% endblock %}":D?A="{% for item in "+V+" %}{% endfor %}":A="{{ "+V+" }}",ua(A).then(()=>{T?r.value=!0:o.value=!0,setTimeout(()=>{T?r.value=!1:o.value=!1},2e3)})}async function k(){if(c.value=[],e.dependsOn)for(let V=0;V<e.dependsOn.length;V++){let D=e.dependsOn[V];if((D==="client"||D==="site"||D==="agent")&&!e.dependencies?.[D])return}s({variables:e.variables,dependencies:e?.dependencies}),await Ht(i).not.toBeTruthy();for(let V in n.value)n.value[V].includes("0 Results")&&c.value.push(`Data Query: ${V} returned no results`),n.value[V].toLowerCase().substring(0,5)==="array"&&(n.value[V]="Array")}Ni(()=>e.variables,()=>{k()},{debounce:5e3});function x(V,D){b.value=[],V?.forEach(T=>{!D?.[T]&&b.value.push(`Missing value for dependency: ${T} . Open Preview to set values`)})}be([()=>e.dependencies,()=>e.dependsOn],([V,D])=>{x(D,V)});function h(V,D){if(u.value=[],D){const T=d.value.find(S=>S.id===D);let A=/\{% block ([A-Za-z0-9_ ]+) %\}/g,N;if(T)for(;N=A.exec(T?.html);){const S=N[0],q=N[1];u.value.push({block:q,warning:!V.includes(S)})}}}return be([()=>e.base_template,()=>e.template],([V,D])=>{h(D,V)}),Le(()=>{k(),x(e.dependsOn,e.dependencies),h(e.template,e.base_template)}),(V,D)=>(f(),p(Se,{dense:""},{default:a(()=>[l(ve,{header:""},{default:a(()=>[D[1]||(D[1]=m("Base Template Blocks ")),r.value?(f(),ce("span",Dp,"Copied!")):G("",!0)]),_:1}),(f(!0),ce(at,null,lt(u.value,T=>(f(),p(B,{key:T,"inset-level":T.warning?0:1},{default:a(()=>[T.warning?(f(),p(C,{key:0,avatar:""},{default:a(()=>[l(K,{name:"warning",color:"warning"},{default:a(()=>[l(j,null,{default:a(()=>D[2]||(D[2]=[m("Block not found in template. Click on the block to copy and paste into template")])),_:1})]),_:1})]),_:1})):G("",!0),l(C,null,{default:a(()=>[g("span",{class:"cursor-pointer",style:{"text-decoration-line":"underline","font-size":"smaller"},onClick:A=>w(T.block,!1,!0)},F(T.block),9,Up)]),_:2},1024)]),_:2},1032,["inset-level"]))),128)),l(de),l(ve,{header:""},{default:a(()=>[D[3]||(D[3]=m(" Variables ")),o.value?(f(),ce("span",Pp,"Copied!")):G("",!0)]),_:1}),(f(!0),ce(at,null,lt([...b.value,...c.value],T=>(f(),p(B,{key:T},{default:a(()=>[l(C,{avatar:""},{default:a(()=>[l(K,{name:"warning",color:"warning"})]),_:1}),l(C,null,{default:a(()=>[g("span",Ep,F(T),1)]),_:2},1024)]),_:2},1024))),128)),[...b.value,...c.value].length>0?(f(),p(de,{key:0})):G("",!0),(f(!0),ce(at,null,lt(_(n),(T,A)=>(f(),p(B,{key:A,onMouseover:N=>y.value=A.toString(),onMouseleave:D[0]||(D[0]=N=>y.value="")},{default:a(()=>[l(C,{avatar:""},{default:a(()=>[l(pt,{color:"primary",label:T},null,8,["label"])]),_:2},1024),l(ve,{lines:1},{default:a(()=>[g("span",{class:"cursor-pointer",style:{"text-decoration-line":"underline","font-size":"smaller"},onClick:N=>w(A.toString(),T.toLowerCase()==="array")},F(A),9,Mp),l(j,{delay:500},{default:a(()=>[m(F(A),1)]),_:2},1024)]),_:2},1024),T.toLowerCase().substring(0,5)==="array"&&y.value===A.toString()?(f(),p(C,{key:0,side:""},{default:a(()=>[l(pt,{class:"cursor-pointer",label:"for loop",onClick:N=>w(A.toString(),!0)},null,8,["onClick"])]),_:2},1024)):G("",!0)]),_:2},1032,["onMouseover"]))),128))]),_:1}))}}),Lp={class:"card-header ac jsb"},Ip={key:0},Bp={class:"q-px-sm"},Hp={class:"q-pt-sm"},Fp={key:2,class:"q-pl-xs text-subtitle"},jp={key:1,class:"q-pl-sm"},Vn=Me({__name:"ReportTemplateForm",props:{templateType:{},reportTemplate:{},cloneTemplate:{}},emits:[...oe.emits],setup(t){const e=t,{dialogRef:s,onDialogHide:n,onDialogOK:i}=oe(),d=Ie(),o=e.reportTemplate?mt(Fn({},e.reportTemplate)):mt({id:0,name:e.cloneTemplate?`Copy of ${e.cloneTemplate.name}`:"",template_md:e.cloneTemplate?e.cloneTemplate.template_md:"",template_css:e.cloneTemplate?e.cloneTemplate.template_css:"",template_html:e.cloneTemplate?e.cloneTemplate.template_html:void 0,type:e.templateType,template_variables:e.cloneTemplate?e.cloneTemplate.template_variables:"",depends_on:e.cloneTemplate?e.cloneTemplate?.depends_on:[]}),r=M(!1);be(o,()=>{r.value=!0},{deep:!0});function u(){r.value?d.dialog({title:"You have unsaved changes",message:"Would you like to close?",cancel:!0,persistent:!0}).onOk(()=>{s.value?.hide()}):s.value?.hide()}const c=M(!0),b=M(!0),y=M(35),w=M(e.templateType==="html"||e.templateType==="markdown"?"html":"plaintext"),k=[{label:e.templateType==="html"||e.templateType==="markdown"?"HTML":"Text",value:e.templateType==="html"||e.templateType==="markdown"?"html":"plaintext"},{label:"PDF",value:"pdf"}],x=M({});be(()=>o.depends_on,(re,se)=>{re&&se&&se.filter(Ut=>re.indexOf(Ut)==-1).forEach(Ut=>delete x.value[Ut])});const h=["client","site","agent"];o.depends_on?.forEach(re=>h.includes(re)?null:h.push(re));const V=M(h);function D(re,se){re.length>0&&(h.includes(re)||h.push(re),se(re,"add-unique"))}function T(re,se){se(()=>{if(re==="")V.value=h;else{const ke=re.toLowerCase();V.value=h.filter(Ut=>Ut.toLowerCase().indexOf(ke)>-1)}})}const{isLoading:A,isError:N,renderedPreview:S,renderedVariables:q,addReportTemplate:P,editReportTemplate:H,runReportPreview:L,runReportPreviewDebug:Z,getAllowedValues:fe}=ll,{reportHTMLTemplates:le,getReportHTMLTemplates:Y}=sn,X=M(e.templateType==="markdown"?"markdown":e.templateType==="html"?"html":"plaintext");Js(()=>{Y(),o.depends_on?.length===0&&fe({variables:o.template_variables,dependencies:x.value})});const ne=te(()=>le.value.map(re=>({label:re.name,value:re.id}))),$=M(!1);be($,re=>{re&&(e.templateType==="html"||e.templateType==="markdown"?w.value="html":w.value="plaintext")});function v(){d.dialog({component:Kl}).onOk(()=>Y)}function U(){Dt();let re=[];if(o.depends_on&&o.depends_on.length>0&&(re=o.depends_on.filter(se=>!x.value[se])),re.length>0)d.dialog({component:ka,componentProps:{dependsOn:re}}).onOk(se=>{x.value={...x.value,...se}}).onDismiss(()=>{const se={...o,format:w.value,dependencies:x.value,debug:$.value};$.value?Z(se):L(se)});else{const se={...o,format:w.value,dependencies:x.value,debug:$.value};$.value?Z(se):L(se)}}be(X,re=>{re==="preview"?U():re===e.templateType?$e.value?.setModel(je):re==="css"&&(y.value=3,$e.value?.setModel(ae))}),be(w,()=>{X.value==="preview"&&U()});const Ce=M(null),$e=ys();let je;const Q=Bl.parse(`editor://${e.templateType}`);let ae;const z=Bl.parse("editor://css"),he=M(null),ie=ys();let _e;const Pe=Bl.parse("editor://variables");function gt(){$e.value?.dispose(),ie.value?.dispose(),je?.dispose(),ae?.dispose(),_e?.dispose(),n()}function Ye(){je=ot.createModel(o.template_md,e.templateType,Q),ae=ot.createModel(o.template_css,"css",z);const re=d.dark.isActive?"vs-dark":"vs-light";$e.value=ot.create(Ce.value,{automaticLayout:!0,model:je,theme:re,minimap:{enabled:!1},quickSuggestions:!1}),$e.value?.onDidChangeModelContent(()=>{const se=$e.value?.getModel();se&&(se?.uri===z?o.template_css=se.getValue():o.template_md=se.getValue(),st.value&&yt())}),_e=ot.createModel(o.template_variables,"yaml",Pe),ie.value=ot.create(he.value,{automaticLayout:!0,model:_e,theme:re,minimap:{enabled:!1}}),ie.value?.onDidChangeModelContent(()=>{const se=ie.value?.getModel();se&&(o.template_variables=se.getValue(),st.value&&yt())})}function Dt(){const re=/([^:\s'"]+:\s*)([^'"]*[{}][^'"\n]*)/,se=ie.value?.getValue();se&&re.test(se)&&(o.template_variables=se.split(`
`).map(ke=>ke.replace(re,"$1'$2'")).join(`
`),ie.value?.setValue(o.template_variables))}const ht=M(!0);function tt(re=!1){let se=!0;o.template_md||(re||At("Template Text is required"),se=!1),o.name||(re||At("Template Name is required"),ht.value=!1,se=!1);const ke=si(o.template_variables,{prettyErrors:!0});return ke.errors.length>0&&(re||At("Error in variables: "+ke.errors[0].message,5e3),se=!1),ht.value=!0,se}const st=M(!!e.reportTemplate),kt=M(!1),yt=Li(()=>{A.value=!0,tt(!0)&&(Dt(),H(o.id,o,{dontNotify:!0}),r.value=!1,kt.value=!0,Ii(()=>kt.value=!1,5e3)),A.value=!1},2e3);async function xe(){if(tt()){if(Dt(),e.reportTemplate?H(o.id,o):P(o),await Ht(A).not.toBeTruthy(),N.value)return;i()}}return(re,se)=>(f(),p(me,{ref_key:"dialogRef",ref:s,maximized:"",onHide:_(n),onShow:Ye,onBeforeHide:gt},{default:a(()=>[l(ue,null,{default:a(()=>[g("div",Lp,[se[15]||(se[15]=g("div",{class:"text-h6"},"New Report Template",-1)),l(E,{dense:"",flat:"",icon:"close",onClick:u},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>se[14]||(se[14]=[m("Close")])),_:1})]),_:1})]),l(Qn,null,{default:a(()=>[l(ge,{modelValue:_(o).name,"onUpdate:modelValue":se[0]||(se[0]=ke=>_(o).name=ke),label:"Report Name",class:"q-pr-sm",filled:"",dense:"",style:{width:"425px"},error:!ht.value,"hide-bottom-space":""},null,8,["modelValue","error"]),l(Qe,{modelValue:_(o).template_html,"onUpdate:modelValue":se[1]||(se[1]=ke=>_(o).template_html=ke),style:{width:"250px"},class:"q-pr-sm",options:ne.value,label:"Base Templates","map-options":"","emit-value":"",dense:"",filled:"",clearable:""},null,8,["modelValue","options"]),l(Qe,{modelValue:_(o).depends_on,"onUpdate:modelValue":se[2]||(se[2]=ke=>_(o).depends_on=ke),style:{width:"250px"},class:"q-pr-sm",options:V.value,label:"Template Dependencies",multiple:"",dense:"",filled:"","use-input":"","input-debounce":"0",onNewValue:D,onFilter:T},{selected:a(()=>[_(o).depends_on&&_(o).depends_on?.length>0?(f(),ce("span",Ip,F(_(o).depends_on?.length)+" Selected",1)):G("",!0)]),_:1},8,["modelValue","options"]),l(St,{modelValue:w.value,"onUpdate:modelValue":se[3]||(se[3]=ke=>w.value=ke),options:k,dense:"",color:"primary",disable:$.value},null,8,["modelValue","disable"]),l(Be,{modelValue:$.value,"onUpdate:modelValue":se[4]||(se[4]=ke=>$.value=ke),dense:"",label:"Debug",class:"q-pl-sm"},null,8,["modelValue"]),l(pe),l(_l,{modelValue:X.value,"onUpdate:modelValue":se[5]||(se[5]=ke=>X.value=ke),dense:"",shrink:""},{default:a(()=>[re.templateType==="markdown"?(f(),p(dt,{key:0,name:"markdown",label:"Markdown",ripple:!1})):re.templateType==="html"?(f(),p(dt,{key:1,name:"html",label:"Html",ripple:!1})):(f(),p(dt,{key:2,name:"plaintext",label:"Plain Text",ripple:!1})),re.templateType!=="plaintext"?(f(),p(dt,{key:3,name:"css",label:"CSS",ripple:!1})):G("",!0),l(dt,{name:"preview",label:"Preview",ripple:!1})]),_:1},8,["modelValue"])]),_:1}),O(g("div",Bp,[l(jo,{view:"lHh lpR lFf",style:Re({height:`${_(d).screen.height-132}px`}),container:""},{default:a(()=>[l(cm,{modelValue:c.value,"onUpdate:modelValue":se[8]||(se[8]=ke=>c.value=ke),mini:b.value,side:"left",bordered:"",width:500,"mini-width":40},{mini:a(()=>[g("div",Hp,[l(E,{class:"",icon:"chevron_right",color:"dark",onClick:se[7]||(se[7]=ke=>b.value=!1),dense:"",round:""})])]),default:a(()=>[l(E,{icon:"chevron_left",color:"dark",class:"absolute",style:{top:"15px",right:"-17px"},onClick:se[6]||(se[6]=ke=>b.value=!0),dense:"",round:""}),l(Np,{variables:_(o).template_variables,template:_(o).template_md,dependencies:x.value,dependsOn:_(o).depends_on,base_template:_(o).template_html},null,8,["variables","template","dependencies","dependsOn","base_template"])]),_:1},8,["modelValue","mini"]),l(Ko,null,{default:a(()=>[l(hl,{modelValue:y.value,"onUpdate:modelValue":se[12]||(se[12]=ke=>y.value=ke),"emit-immediately":"",reverse:"",limits:[3,45]},{before:a(()=>[X.value!=="preview"&&X.value!=="css"&&$e.value&&ie.value?(f(),p(Tp,{key:0,editor:$e.value,variablesEditor:ie.value,templateType:re.templateType},{buttons:a(()=>[l(E,{flat:"",dense:"",ripple:!1,label:"vars","no-caps":"",onClick:se[9]||(se[9]=ke=>y.value>3?y.value=3:y.value=35)},{default:a(()=>[l(j,{delay:500},{default:a(()=>[m(F(y.value>=3?"Hide variables":"Show variables"),1)]),_:1})]),_:1}),l(E,{flat:"",dense:"",ripple:!1,label:"base","no-caps":"",onClick:v},{default:a(()=>[l(j,{delay:500},{default:a(()=>se[16]||(se[16]=[m("Add Base Template")])),_:1})]),_:1})]),_:1},8,["editor","variablesEditor","templateType"])):G("",!0),g("div",{ref_key:"editorDiv",ref:Ce,style:Re({height:`${_(d).screen.height-168}px`})},null,4)]),after:a(()=>[l(De,null,{default:a(()=>[y.value>6?(f(),p(E,{key:0,round:"",dense:"",flat:"",icon:"chevron_right",onClick:se[10]||(se[10]=ke=>y.value=3)})):(f(),p(E,{key:1,round:"",dense:"",flat:"",icon:"chevron_left",onClick:se[11]||(se[11]=ke=>y.value=35)})),y.value>8?(f(),ce("div",Fp," Variables ")):G("",!0)]),_:1}),O(g("div",{ref_key:"variablesDiv",ref:he,style:Re({height:`${_(d).screen.height-168}px`})},null,4),[[Ze,y.value>8]])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["style"])],512),[[Ze,X.value!=="preview"]]),X.value=="preview"&&!_(A)?(f(),p(qp,{key:0,previewFormat:w.value,source:_(S),debug:$.value,variables:_(q)},null,8,["previewFormat","source","debug","variables"])):G("",!0),X.value=="preview"?(f(),p(en,{key:1,showing:_(A),label:"Generating Report...","label-class":"text-teal","label-style":"font-size: 1.1em"},null,8,["showing"])):G("",!0),X.value!=="preview"?(f(),p(ze,{key:2},{default:a(()=>[re.reportTemplate?(f(),p(Be,{key:0,modelValue:st.value,"onUpdate:modelValue":se[13]||(se[13]=ke=>st.value=ke),label:"Auto-save",dense:""},null,8,["modelValue"])):G("",!0),kt.value?(f(),ce("span",jp,"Template Saved!")):G("",!0),l(pe),l(E,{dense:"",flat:"",label:"Cancel",onClick:u}),re.reportTemplate?(f(),p(E,{key:2,loading:_(A),dense:"",flat:"",label:"Apply",color:"primary",onClick:_(yt)},null,8,["loading","onClick"])):G("",!0),l(E,{loading:_(A),dense:"",flat:"",label:"Save",color:"primary",onClick:xe},null,8,["loading"])]),_:1})):G("",!0)]),_:1})]),_:1},8,["onHide"]))}});function Kp(){function t(i,d,o="0",r){return{id:An(),label:i,path:d,type:"file",icon:"description",asset_id:r,size:`${o}b`}}function e(i,d,o="folder",r="yellow-9"){return{id:An(),label:i,path:d,type:"folder",icon:o,iconColor:r,selectable:!0,lazy:!0}}function s(i,d="/"){const o=i.split(d).pop();return o||""}function n(i,d="/"){const o=i.split(d);return o.pop(),o.join(d)}return{createFolderNode:e,createFileNode:t,getFile:s,getPath:n}}const zp=Me({__name:"FileBrowser",props:{nodes:{},loading:{type:Boolean,default:!1},separator:{default:"unix"},height:{default:"200px"}},emits:["lazy-load"],setup(t,{expose:e,emit:s}){const n=s,i=t;e({getNodeByKey:A=>o.value?.getNodeByKey(A),reloadTable:h});const d=i.separator==="unix"?"/":"\\",o=M(null),r=M(null),u=M(d),c=M([]),b=M(25),y=Bi(i,"nodes"),w=M([]),k=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"type",label:"Type",field:"type",align:"left",sortable:!0},{name:"size",label:"Size",field:"size",align:"left",sortable:!0}];function x(A){A.type!="file"&&(u.value=A.id,V(A.id))}function h(A=u.value){w.value=[],c.value=[];const N=o.value?.getNodeByKey(A);bs(N.children)&&(w.value=T(N))}function V(A){o.value?.isExpanded(A)||o.value?.setExpanded(A,!0),h(A)}function D({node:A,key:N,done:S,fail:q}){n("lazy-load",{isDone:L=>{S(L),h(N)},isFail:()=>{q()},path:A.path})}function T(A){return bs(A.children)?A.children.map(N=>({id:N.id,name:N.label,path:N.path,type:N.type,size:N.size})):[]}return Le(()=>{u.value=y.value[0].id,o.value?.setExpanded(u.value,!0)}),(A,N)=>(f(),ce("div",null,[l(hl,{modelValue:b.value,"onUpdate:modelValue":N[2]||(N[2]=S=>b.value=S),style:Re({height:A.height})},{before:a(()=>[l(nn,{ref_key:"folderTree",ref:o,selected:u.value,"onUpdate:selected":[N[0]||(N[0]=S=>u.value=S),V],"node-key":"id",filter:"filter","no-selection-unset":"","selected-color":"primary","filter-method":S=>S.type==="folder",nodes:y.value,onLazyLoad:D},null,8,["selected","filter-method","nodes"])]),after:a(()=>[l(et,{ref_key:"tableRef",ref:r,selected:c.value,"onUpdate:selected":N[1]||(N[1]=S=>c.value=S),rows:w.value,columns:k,loading:A.loading,dense:"","no-data-label":"Folder is Empty","binary-state-sort":"","virtual-scroll":"",selection:"multiple","row-key":"id",pagination:{sortBy:"type",descending:!0},"rows-per-page-options":[0],"table-class":{"table-bgcolor":!A.$q.dark.isActive,"table-bgcolor-dark":A.$q.dark.isActive},style:Re({"max-height":A.height}),class:"tbl-sticky"},{top:a(()=>[zl(A.$slots,"action-bar",Tn(xn({selectedTreeNode:o.value?.getNodeByKey(u.value),selectedTableNodes:c.value})))]),body:a(S=>[l(nt,{class:"cursor-pointer",onDblclick:qt(q=>x(S.row),["prevent"])},{default:a(()=>[zl(A.$slots,"table-menu",Tn(xn({item:S.row,selectedTreeNode:o.value?.getNodeByKey(u.value)}))),l(J,null,{default:a(()=>[l(W,{modelValue:S.selected,"onUpdate:modelValue":q=>S.selected=q,dense:""},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(J,null,{default:a(()=>[l(K,{class:"q-mr-sm",color:S.row.type==="folder"?"yellow-9":"primary",size:"sm",name:S.row.type==="folder"?"folder":"description"},null,8,["color","name"]),m(F(S.row.name),1)]),_:2},1024),l(J,null,{default:a(()=>[m(F(S.row.type),1)]),_:2},1024),l(J,null,{default:a(()=>[m(F(S.row.size),1)]),_:2},1024)]),_:2},1032,["onDblclick"])]),_:3},8,["selected","rows","loading","table-class","style"])]),_:3},8,["modelValue","style"])]))}}),Qp={class:"q-pa-md column items-start q-gutter-y-md"},Wp={class:"ellipsis relative-position"},Gp=Me({__name:"AssetFileUpload",props:{parentPath:{}},emits:[...oe.emits],setup(t){const e=t,{dialogRef:s,onDialogOK:n,onDialogHide:i}=oe(),d=M([]),o=M(!1);async function r(){o.value=!0;let u=new FormData;d.value.forEach(c=>{u.append(c.name,c)});try{const c=await rm(u,e.parentPath);Ve("Files uploaded successfully"),n({files:d.value,response:c})}finally{o.value=!1}}return(u,c)=>(f(),p(me,{ref_key:"dialogRef",ref:s,onHide:_(i)},{default:a(()=>[l(ue,null,{default:a(()=>[l(De,null,{default:a(()=>[c[2]||(c[2]=m(" File Upload ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>c[1]||(c[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),g("div",Qp,[l(Wn,{modelValue:d.value,"onUpdate:modelValue":c[0]||(c[0]=b=>d.value=b),label:"Select files",outlined:"",multiple:"",clearable:!o.value,style:{width:"400px"}},{file:a(({file:b})=>[l(Xt,{class:"full-width q-my-xs",square:""},{default:a(()=>[l(Hi,null,{default:a(()=>[l(K,{name:"insert_drive_file"})]),_:1}),g("div",Wp,F(b.name),1),l(j,null,{default:a(()=>[m(F(b.name),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue","clearable"])]),l(ze,{align:"right"},{default:a(()=>[O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{color:"primary",label:"Upload",dense:"",flat:"",loading:o.value,onClick:r},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),Jp=Me({__name:"ReportAssets",emits:[...oe.emits],setup(t){const e=Ie(),{dialogRef:s,onDialogHide:n}=oe(),{createFileNode:i,createFolderNode:d,getFile:o}=Kp(),r=M([d("Assets","/","storage","primary")]),u=M(null),c=M(!1);async function b({path:T,isDone:A,isFail:N}){try{const S=await lm(T);A(D(S))}catch{N()}}function y(T){e.dialog({component:Gp,componentProps:{parentPath:T.path}}).onOk(({files:A,response:N})=>{A.forEach(S=>{const q=N[S.name].filename,P=N[S.name].id,H=o(q),L=i(H,q,S.size.toString(),P);T.children?.push(L)}),u.value?.reloadTable()})}function w(T){e.dialog({title:"Enter a folder name",prompt:{model:"",isValid:A=>A.length>0,type:"text"},cancel:!0,persistent:!0}).onOk(async A=>{c.value=!0;const N=A,S=`${T.path}/${N}`;try{const q=await am(S),P=d(o(q),q);T.children?.push(P),u.value?.reloadTable(),c.value=!1}catch{c.value=!1}})}function k(T){e.dialog({title:`Enter a new ${T.type} name`,prompt:{model:T.name,isValid:A=>A.length>0,type:"text"},cancel:!0,persistent:!0}).onOk(async A=>{c.value=!0;const N=T.path,S=A;try{const q=await sm(N,S),P=u.value?.getNodeByKey(T.id);if(P===void 0){console.error("Node key not found");return}P.label=o(q),P.path=q,P.type==="folder"&&P.children&&V(P.children,N,q),u.value?.reloadTable(),c.value=!1}catch{c.value=!1}})}async function x(T){c.value=!0;try{const A=await om(T.path);A.type==="application/zip"?yl(`${T.name}.zip`,A):yl(T.name,A),c.value=!1}catch{c.value=!1}}function h(T,A){e.dialog({title:"Are you sure?",message:`You are about to delete ${T.length>1?T.length+" assets":"an asset"}. This action isn't reversible`,cancel:!0,persistent:!0}).onOk(async()=>{try{const N=T.map(S=>S.path);await im(N),A.children=A.children?.filter(S=>!N.includes(S.path)),u.value?.reloadTable(),c.value=!1}catch{c.value=!1}})}function V(T,A,N){T.forEach(S=>{S.path=S.path.replace(A,N),S.children&&V(S.children,A,N)})}function D(T){let A=[];return T.forEach(N=>{let S=N.type==="folder"?d(N.name,N.path):i(N.name,N.path,N.size,N.asset_id);if(N.children){const q=D(N.children);S.children&&(S.children=q)}A.push(S)}),A}return(T,A)=>(f(),p(me,{ref_key:"dialogRef",ref:s,maximized:"",onHide:_(n)},{default:a(()=>[l(ue,null,{default:a(()=>[l(De,null,{default:a(()=>[A[1]||(A[1]=m(" Report Assets ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>A[0]||(A[0]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(zp,{ref_key:"fileBrowser",ref:u,nodes:r.value,height:`${_(e).screen.height-32}px`,loading:c.value,onLazyLoad:b},{"action-bar":a(({selectedTreeNode:N,selectedTableNodes:S})=>[l(E,{class:"q-ml-sm",icon:"add",label:"Upload","no-caps":"",dense:"",flat:"",onClick:q=>y(N)},null,8,["onClick"]),l(E,{class:"q-ml-sm",label:"New Folder","no-caps":"",dense:"",flat:"",onClick:q=>w(N)},null,8,["onClick"]),l(Zt,{disable:S.length===0,class:"q-ml-sm",flat:"",outline:"",dense:"","no-caps":"",label:"Bulk Actions"},{default:a(()=>[l(Se,null,{default:a(()=>[O((f(),p(B,{clickable:"",dense:"",onClick:q=>h(S,N)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>A[2]||(A[2]=[m("Delete")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[R]])]),_:2},1024)]),_:2},1032,["disable"])]),"table-menu":a(({item:N,selectedTreeNode:S})=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:q=>k(N)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>A[3]||(A[3]=[m("Rename")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:q=>x(N)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"cloud_download"})]),_:1}),l(C,null,{default:a(()=>A[4]||(A[4]=[m("Download")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:q=>h([N],S)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>A[5]||(A[5]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>A[6]||(A[6]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024)]),_:1},8,["nodes","height","loading"])]),_:1})]),_:1},8,["onHide"]))}}),Yp={class:"card-header ac jsb"},Xp=Me({__name:"ReportHTMLTemplateTable",emits:[...oe.emits],setup(t){const e=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0}],{dialogRef:s,onDialogHide:n}=oe(),i=Ie(),{reportHTMLTemplates:d,isLoading:o,getReportHTMLTemplates:r,deleteReportHTMLTemplate:u}=sn,c=M("");function b(){i.dialog({component:Kl})}function y(x){i.dialog({component:Kl,componentProps:{template:x}})}function w(x){i.dialog({title:`Delete HTML Template: ${x.name}?`,message:"If this template is in use you will need to change it in every report template",cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(()=>{u(x.id)})}async function k(x){i.dialog({component:Kl,componentProps:{cloneTemplate:x}})}return Le(r),(x,h)=>(f(),p(me,{ref_key:"dialogRef",ref:s,maximized:"",onHide:_(n)},{default:a(()=>[l(ue,null,{default:a(()=>[g("div",Yp,[h[2]||(h[2]=g("div",{class:"text-h6"},"Base Templates",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>h[1]||(h[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(et,{dense:"","table-class":{"table-bgcolor":!_(i).dark.isActive,"table-bgcolor-dark":_(i).dark.isActive},style:Re({"max-height":`${_(i).screen.height-24}px`}),class:"tbl-sticky",rows:_(d),columns:e,loading:_(o),pagination:{rowsPerPage:0,sortBy:"favorite",descending:!0},filter:c.value,"row-key":"id","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0]},{top:a(()=>[g("button",{class:"btn btn-primary ac",onClick:b},[l(_(He),{icon:"lucide:plus",class:"mr-2"}),h[3]||(h[3]=m(" New "))]),l(pe),l(ge,{modelValue:c.value,"onUpdate:modelValue":h[0]||(h[0]=V=>c.value=V),style:{width:"300px"},label:"Search",class:"w-full",dense:"",outlined:"",clearable:""},null,8,["modelValue"])]),body:a(V=>[l(nt,{props:V,class:"cursor-pointer",onDblclick:D=>y(V.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:D=>y(V.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>h[4]||(h[4]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:D=>k(V.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"content_copy"})]),_:1}),l(C,null,{default:a(()=>h[5]||(h[5]=[m("Clone")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:D=>w(V.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>h[6]||(h[6]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>h[7]||(h[7]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),g("td",null,F(V.row.name),1)]),_:2},1032,["props","onDblclick"])]),_:1},8,["table-class","style","rows","loading","filter"])]),_:1})]),_:1},8,["onHide"]))}}),Zp=Me({__name:"ReportDataQueryTable",emits:[...oe.emits],setup(t){const e=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0}],{dialogRef:s,onDialogHide:n}=oe(),i=Ie(),{reportDataQueries:d,isLoading:o,getReportDataQueries:r,deleteReportDataQuery:u}=Gn,c=M("");function b(){i.dialog({component:Xl})}function y(x){i.dialog({component:Xl,componentProps:{dataQuery:x}})}function w(x){i.dialog({title:`Delete Data Query: ${x.name}?`,message:"If this query is in use you will need to change it in every report template",cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(()=>{u(x.id)})}async function k(x){console.log(x)}return Le(r),(x,h)=>(f(),p(me,{ref_key:"dialogRef",ref:s,maximized:"",onHide:_(n)},{default:a(()=>[l(ue,null,{default:a(()=>[l(De,null,{default:a(()=>[l(E,{class:"q-mr-sm",dense:"",flat:"",push:"",icon:"refresh",onClick:_(r)},null,8,["onClick"]),h[2]||(h[2]=m("Data Queries ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>h[1]||(h[1]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(et,{dense:"","table-class":{"table-bgcolor":!_(i).dark.isActive,"table-bgcolor-dark":_(i).dark.isActive},style:Re({"max-height":`${_(i).screen.height-24}px`}),class:"tbl-sticky",rows:_(d),columns:e,loading:_(o),pagination:{rowsPerPage:0,sortBy:"favorite",descending:!0},filter:c.value,"row-key":"id","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0]},{top:a(()=>[l(E,{class:"q-ml-sm",icon:"add",label:"New","no-caps":"",dense:"",flat:"",onClick:b}),l(pe),l(ge,{modelValue:c.value,"onUpdate:modelValue":h[0]||(h[0]=V=>c.value=V),style:{width:"300px"},label:"Search",dense:"",outlined:"",clearable:"",class:"q-pr-md q-pb-xs"},{prepend:a(()=>[l(K,{name:"search",color:"primary"})]),_:1},8,["modelValue"])]),body:a(V=>[l(nt,{props:V,class:"cursor-pointer",onDblclick:D=>y(V.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{clickable:"",onClick:D=>k(V.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"content_copy"})]),_:1}),l(C,null,{default:a(()=>h[3]||(h[3]=[m("Clone")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:D=>y(V.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"edit"})]),_:1}),l(C,null,{default:a(()=>h[4]||(h[4]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",onClick:D=>w(V.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(K,{name:"delete"})]),_:1}),l(C,null,{default:a(()=>h[5]||(h[5]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{clickable:""},{default:a(()=>[l(C,null,{default:a(()=>h[6]||(h[6]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:2},1024)]),_:2},1024),g("td",null,F(V.row.name),1)]),_:2},1032,["props","onDblclick"])]),_:1},8,["table-class","style","rows","loading","filter"])]),_:1})]),_:1},8,["onHide"]))}}),eg=Me({__name:"ReportTemplateImport",emits:[...oe.emits],setup(t){const{isLoading:e,isError:s,importReport:n}=ll,{dialogRef:i,onDialogHide:d,onDialogOK:o}=oe(),r=M(null),u=M(!1);async function c(){if(r.value){if(n({overwrite:u.value,template:await r.value.text()}),await Ht(e).not.toBeTruthy(),s.value)return;o()}else At("File is required")}return(b,y)=>(f(),p(me,{ref_key:"dialogRef",ref:i,onHide:_(d)},{default:a(()=>[l(ue,null,{default:a(()=>[l(De,null,{default:a(()=>[y[3]||(y[3]=m(" Import Report Template ")),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>y[2]||(y[2]=[m("Close")])),_:1})]),_:1})),[[R]])]),_:1}),l(I,null,{default:a(()=>[l(Wn,{modelValue:r.value,"onUpdate:modelValue":y[0]||(y[0]=w=>r.value=w),dense:"",filled:"",label:"Import File",style:{width:"400px"},accept:".json",hint:"Only accepts exported report template json files"},null,8,["modelValue"])]),_:1}),l(I,null,{default:a(()=>[l(W,{modelValue:u.value,"onUpdate:modelValue":y[1]||(y[1]=w=>u.value=w),label:"Overwrite if name exists"},null,8,["modelValue"])]),_:1}),l(ze,null,{default:a(()=>[l(pe),O(l(E,{dense:"",flat:"",label:"Cancel"},null,512),[[R]]),l(E,{loading:_(e),dense:"",flat:"",label:"Import",color:"primary",onClick:c},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}}),tg={class:"card-header ac jsb"},lg=["disable"],ng=Me({__name:"SharedTemplatesImport",emits:[...oe.emits],setup(t){const e=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"url",label:"Download Url",field:"url",align:"left",sortable:!0,format:x=>Is(x,90)}],{dialogRef:s,onDialogHide:n}=oe(),i=Ie(),{isLoading:d,isError:o,sharedTemplates:r,importSharedTemplates:u,getSharedTemplates:c}=ll,b=M(""),y=M([]),w=M(!1);async function k(){u({templates:y.value,overwrite:w.value}),await Ht(d).not.toBeTruthy(),!o.value&&(y.value=[])}return Le(c),(x,h)=>(f(),p(me,{ref_key:"dialogRef",ref:s,maximized:"",onHide:_(n)},{default:a(()=>[l(ue,null,{default:a(()=>[g("div",tg,[h[4]||(h[4]=g("div",{class:"text-h6"},"Shared Templates",-1)),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>h[3]||(h[3]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(et,{dense:"","table-class":{"table-bgcolor":!_(i).dark.isActive,"table-bgcolor-dark":_(i).dark.isActive},style:Re({"max-height":`${_(i).screen.height-32}px`}),class:"tbl-sticky",rows:_(r),columns:e,loading:_(d),pagination:{rowsPerPage:0,sortBy:"name",descending:!1},filter:b.value,selection:"multiple",selected:y.value,"onUpdate:selected":h[2]||(h[2]=V=>y.value=V),"row-key":"name","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0]},{top:a(()=>[g("button",{disable:y.value.length===0||_(d),class:"btn btn-primary",onClick:k},[l(_(He),{icon:"lucide:import",class:"icon mr-2 mt-0.5",width:"18",height:"18"}),h[5]||(h[5]=m(" Import "))],8,lg),l(W,{class:"q-ml-sm",dense:"",label:"Overwrite if name conflicts",modelValue:w.value,"onUpdate:modelValue":h[0]||(h[0]=V=>w.value=V)},null,8,["modelValue"]),l(pe),l(ge,{modelValue:b.value,"onUpdate:modelValue":h[1]||(h[1]=V=>b.value=V),style:{width:"300px"},label:"Search",dense:"",outlined:"",clearable:"",class:"q-pr-md q-pb-xs"},{prepend:a(()=>[l(K,{name:"search",color:"primary"})]),_:1},8,["modelValue"])]),_:1},8,["table-class","style","rows","loading","filter","selected"])]),_:1})]),_:1},8,["onHide"]))}}),sg={class:"card-header ac jsb"},ag={class:"q-pr-md q-pb-xs",style:{width:"300px"}},ig={class:"input-group"},og=Me({__name:"ReportsManager",emits:[...oe.emits],setup(t){const e=[{name:"name",label:"Name",field:"name",align:"left",sortable:!0},{name:"type",label:"Template Type",field:"type",align:"left",sortable:!0},{name:"depends_on",label:"Template Dependencies",field:"depends_on",align:"left",sortable:!0}],{dialogRef:s,onDialogHide:n}=oe(),i=Ie(),{reportTemplates:d,isLoading:o,getReportTemplates:r,deleteReportTemplate:u,openReport:c,exportReport:b,downloadReport:y}=ll;Le(r);const w=M("");function k(q){i.dialog({component:Vn,componentProps:{templateType:q}})}function x(q){i.dialog({component:Vn,componentProps:{reportTemplate:q,templateType:q.type}})}function h(){i.dialog({component:Jp})}function V(){i.dialog({component:Zp})}function D(){i.dialog({component:Xp})}function T(q){i.dialog({title:`Delete template: ${q.name}?`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(()=>{u(q.id)})}async function A(q){i.dialog({component:Vn,componentProps:{cloneTemplate:q,templateType:q.type}})}function N(){i.dialog({component:eg})}function S(){i.dialog({component:ng}).onDismiss(()=>r())}return(q,P)=>(f(),p(me,{ref_key:"dialogRef",ref:s,maximized:"",onHide:_(n)},{default:a(()=>[l(ue,null,{default:a(()=>[g("div",sg,[P[6]||(P[6]=g("div",{class:"text-h6"},"Reports Manager",-1)),l(pe),O((f(),p(E,{dense:"",flat:"",icon:"close"},{default:a(()=>[l(j,{class:"bg-white text-primary"},{default:a(()=>P[5]||(P[5]=[m("Close")])),_:1})]),_:1})),[[R]])]),l(et,{dense:"","table-class":{"table-bgcolor":!_(i).dark.isActive,"table-bgcolor-dark":_(i).dark.isActive},style:Re({"max-height":`${_(i).screen.height-32}px`}),class:"tbl-sticky",rows:_(d),columns:e,loading:_(o),pagination:{rowsPerPage:0,sortBy:"name",descending:!1},filter:w.value,"row-key":"id","binary-state-sort":"","virtual-scroll":"","rows-per-page-options":[0]},{top:a(()=>[l(Zt,{class:"btn btn-primary btn-sm",icon:"add",label:"Template","no-caps":"",dense:"",flat:""},{default:a(()=>[l(Se,{dense:""},{default:a(()=>[O((f(),p(B,{class:"headers-item",clickable:"",onClick:P[0]||(P[0]=H=>k("markdown"))},{default:a(()=>[l(C,{avatar:""},{default:a(()=>[l(_(He),{icon:"lucide:file-code",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>P[7]||(P[7]=[m("Markdown Template")])),_:1})]),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",class:"headers-item",onClick:P[1]||(P[1]=H=>k("html"))},{default:a(()=>[l(C,{avatar:""},{default:a(()=>[l(_(He),{icon:"lucide:code-xml",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>P[8]||(P[8]=[m("HTML Template")])),_:1})]),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",class:"headers-item",onClick:P[2]||(P[2]=H=>k("plaintext"))},{default:a(()=>[l(C,{avatar:""},{default:a(()=>[l(_(He),{icon:"lucide:type",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>P[9]||(P[9]=[m("Plain Text Template")])),_:1})]),_:1})]),_:1})),[[R]]),l(de),O((f(),p(B,{class:"headers-item",clickable:"",onClick:N},{default:a(()=>[l(C,{avatar:""},{default:a(()=>[l(_(He),{icon:"lucide:arrow-up-from-line",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>[l(ve,null,{default:a(()=>P[10]||(P[10]=[m("Import Report Template")])),_:1})]),_:1})]),_:1})),[[R]])]),_:1})]),_:1}),g("button",{class:"btn btn-none-primary ac gap-2",onClick:D},[l(_(He),{icon:"lucide:file",class:"icon",width:"20",height:"20"}),P[11]||(P[11]=m(" Base Templates "))]),g("button",{class:"btn btn-none-primary ac gap-2",onClick:h},[l(_(He),{icon:"lucide:folder",class:"icon",width:"20",height:"20"}),P[12]||(P[12]=m(" Base Report Assets "))]),g("button",{class:"btn btn-none-primary ac gap-2",onClick:V},[l(_(He),{icon:"lucide:database",class:"icon",width:"20",height:"20"}),P[13]||(P[13]=m(" Data Queries "))]),g("button",{class:"btn btn-none-primary ac gap-2",onClick:S},[l(_(He),{icon:"lucide:share-2",class:"icon",width:"20",height:"20"}),P[14]||(P[14]=m(" Shared Templates "))]),P[16]||(P[16]=g("div",{style:{"flex-grow":"1"}},null,-1)),g("div",ag,[g("div",ig,[O(g("input",{id:"searchInput","onUpdate:modelValue":P[3]||(P[3]=H=>w.value=H),type:"text",class:"form-control w-full",placeholder:"Search"},null,512),[[Gs,w.value]]),w.value?(f(),ce("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:P[4]||(P[4]=H=>w.value="")},P[15]||(P[15]=[g("i",{class:"fa fa-times"},null,-1)]))):G("",!0)])])]),body:a(H=>[l(nt,{props:H,class:"cursor-pointer",onDblclick:L=>x(H.row)},{default:a(()=>[l(Ne,{"context-menu":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"200px"}},{default:a(()=>[O((f(),p(B,{class:"acc-item",clickable:"",onClick:L=>x(H.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(_(He),{icon:"lucide:pencil",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>P[17]||(P[17]=[m("Edit")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{class:"acc-item",clickable:"",onClick:L=>A(H.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(_(He),{icon:"lucide:copy",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>P[18]||(P[18]=[m("Clone")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{class:"acc-item",clickable:"",onClick:L=>_(y)(H.row,"pdf",{})},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(_(He),{icon:"lucide:download",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>P[19]||(P[19]=[m("Download PDF")])),_:1})]),_:2},1032,["onClick"])),[[R]]),O((f(),p(B,{class:"acc-item",clickable:"",onClick:L=>_(y)(H.row,H.row.type!=="plaintext"?"html":"plaintext",{})},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(_(He),{icon:"lucide:download",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>[m("Download "+F(H.row.type!=="plaintext"?"HTML":"Text"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{class:"acc-item",clickable:"",onClick:L=>_(b)(H.row.id)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(_(He),{icon:"lucide:folder-input",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>P[20]||(P[20]=[m("Export")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de),O((f(),p(B,{class:"acc-item",clickable:"",onClick:L=>T(H.row)},{default:a(()=>[l(C,{side:""},{default:a(()=>[l(_(He),{icon:"lucide:trash",class:"icon",width:"20",height:"20"})]),_:1}),l(C,null,{default:a(()=>P[21]||(P[21]=[m("Delete")])),_:1})]),_:2},1032,["onClick"])),[[R]]),l(de)]),_:2},1024)]),_:2},1024),g("td",null,F(H.row.name),1),g("td",null,F(H.row.type),1),g("td",null,F(H.row.depends_on.length>0?H.row.depends_on:""),1)]),_:2},1032,["props","onDblclick"])]),_:1},8,["table-class","style","rows","loading","filter"])]),_:1})]),_:1},8,["onHide"]))}}),rg={name:"FileBar",mixins:[it],components:{UpdateAgents:Vr,EditCoreSettings:Ho,InstallAgent:Qc,AdminManager:kc,ServerMaintenance:yf,CodeSign:Sf,Icon:He},data(){return{showServerMaintenance:!1,showUpdateAgentsModal:!1,showEditCoreSettingsModal:!1,showAdminManager:!1,showInstallAgent:!1,showCodeSign:!1}},computed:{hosted(){return this.$store.state.hosted},isDev(){return console.log(!1),!1},sidebarOpen:{get(){return this.$store.state.sidebarOpen},set(t){this.$store.commit("setSidebarOpen",t)}}},methods:{clearCache(){this.$axios.get("/core/clearcache/").then(t=>this.notifySuccess(t.data))},bulkRecoverAgents(){this.$q.dialog({title:"Bulk Recover All Agents?",message:"This will restart the Sonar and Mesh Agent services on all agents",cancel:!0}).onOk(()=>{this.$axios.get("/agents/bulkrecovery/").then(t=>this.notifySuccess(t.data))})},showAutomationManager(){this.$q.dialog({component:Gu})},showAlertsManager(){this.$q.dialog({component:Fd})},showClientsManager(){this.$q.dialog({component:wr}).onDismiss(()=>this.$store.dispatch("refreshDashboard",!0))},showAddClientModal(){this.$q.dialog({component:Rn}).onOk(()=>this.$store.dispatch("loadTree"))},showAddSiteModal(){this.$q.dialog({component:Gl}).onOk(()=>this.$store.dispatch("loadTree"))},showPermissionsManager(){this.$q.dialog({component:Yf})},showAuditManager(){this.$q.dialog({component:$n,componentProps:{vuecomponent:bo,noCard:!0,componentProps:{modal:!0},dialogProps:{maximized:!0,["transition-show"]:"slide-up",["transition-hide"]:"slide-down"}}})},showScriptManager(){this.$q.dialog({component:nd})},showBulkAction(t){this.$q.dialog({component:sf,componentProps:{mode:t}})},showDebugLog(){this.$q.dialog({component:$n,componentProps:{vuecomponent:vo,noCard:!0,componentProps:{modal:!0},dialogProps:{maximized:!0,["transition-show"]:"slide-up",["transition-hide"]:"slide-down"}}})},showPendingActions(){this.$q.dialog({component:wo})},showDeployments(){this.$q.dialog({component:mf})},showReportsManager(){this.$q.dialog({component:og})}}},dg={class:""},ug={class:"q-pa-md q-gutter-sm"},cg={class:"q-pa-md q-gutter-sm"},fg={class:"q-pa-md q-gutter-sm"};function mg(t,e,s,n,i,d){const o=qe("Icon"),r=qe("EditCoreSettings"),u=qe("InstallAgent"),c=qe("UpdateAgents"),b=qe("AdminManager"),y=qe("ServerMaintenance"),w=qe("CodeSign");return f(),ce("div",dg,[l(De,{class:"header-bar no-shadow"},{default:a(()=>[l(ji,{flat:""},{default:a(()=>[g("button",{onClick:e[0]||(e[0]=k=>d.sidebarOpen=!d.sidebarOpen),class:"header-bar-btn"},[l(o,{icon:"lucide:menu",width:"24",height:"24",class:"icon"})]),l(E,{class:"header-bar-btn",size:"md",dense:"","no-caps":"",flat:"",label:"Actions"},{default:a(()=>[l(Ne,null,{default:a(()=>[l(Se,{dense:"",style:{"min-width":"100px"}},{default:a(()=>[l(B,{clickable:"",class:"acc-item headers-item"},{default:a(()=>[l(C,null,{default:a(()=>e[21]||(e[21]=[m("Add")])),_:1}),l(C,{side:""},{default:a(()=>[l(K,{name:"keyboard_arrow_right"})]),_:1}),l(Ne,{anchor:"top right",self:"top left"},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"100px"}},{default:a(()=>[O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showAddClientModal},{default:a(()=>[l(C,null,{default:a(()=>e[22]||(e[22]=[m("Client")])),_:1})]),_:1},8,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showAddSiteModal},{default:a(()=>[l(C,null,{default:a(()=>e[23]||(e[23]=[m("Site")])),_:1})]),_:1},8,["onClick"])),[[R]])]),_:1})]),_:1})]),_:1}),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showAuditManager},{default:a(()=>[l(C,null,{default:a(()=>e[24]||(e[24]=[m("Audit Log")])),_:1})]),_:1},8,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showDebugLog},{default:a(()=>[l(C,null,{default:a(()=>e[25]||(e[25]=[m("Debug Log")])),_:1})]),_:1},8,["onClick"])),[[R]])]),_:1})]),_:1})]),_:1}),l(E,{class:"header-bar-btn",size:"md",dense:"","no-caps":"",flat:"",label:"Agents"},{default:a(()=>[l(Ne,{"auto-close":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"100px"}},{default:a(()=>[O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:e[1]||(e[1]=k=>i.showInstallAgent=!0)},{default:a(()=>[l(C,null,{default:a(()=>e[26]||(e[26]=[m("Install Agent")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showDeployments},{default:a(()=>[l(C,null,{default:a(()=>e[27]||(e[27]=[m("Manage Deployments")])),_:1})]),_:1},8,["onClick"])),[[R]]),O((f(),p(B,{class:"acc-item headers-item",clickable:"",onClick:e[2]||(e[2]=k=>i.showUpdateAgentsModal=!0)},{default:a(()=>[l(C,null,{default:a(()=>e[28]||(e[28]=[m("Update Agents")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showPendingActions},{default:a(()=>[l(C,null,{default:a(()=>e[29]||(e[29]=[m("Pending Actions")])),_:1})]),_:1},8,["onClick"])),[[R]])]),_:1})]),_:1})]),_:1}),l(E,{class:"header-bar-btn",size:"md",dense:"","no-caps":"",flat:"",label:"Policies"},{default:a(()=>[l(Ne,{"auto-close":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"100px"}},{default:a(()=>[O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showScriptManager},{default:a(()=>[l(C,null,{default:a(()=>e[30]||(e[30]=[m("Manage Policies")])),_:1})]),_:1},8,["onClick"])),[[R]])]),_:1})]),_:1})]),_:1}),l(E,{class:"header-bar-btn",size:"md",dense:"","no-caps":"",flat:"",label:"Reports"},{default:a(()=>[l(Ne,{"auto-close":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"100px"}},{default:a(()=>[O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showReportsManager},{default:a(()=>[l(C,null,{default:a(()=>e[31]||(e[31]=[m("Generate Reports")])),_:1})]),_:1},8,["onClick"])),[[R]])]),_:1})]),_:1})]),_:1}),l(E,{class:"header-bar-btn",size:"md",dense:"","no-caps":"",flat:"",label:"Tools"},{default:a(()=>[l(Ne,{"auto-close":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"100px"}},{default:a(()=>[O((f(),p(B,{class:"acc-item headers-item",clickable:"",onClick:e[3]||(e[3]=k=>d.showBulkAction("command"))},{default:a(()=>[l(C,null,{default:a(()=>e[32]||(e[32]=[m("Bulk Command")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:e[4]||(e[4]=k=>d.showBulkAction("script"))},{default:a(()=>[l(C,null,{default:a(()=>e[33]||(e[33]=[m("Bulk Script")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:e[5]||(e[5]=k=>d.showBulkAction("patch"))},{default:a(()=>[l(C,null,{default:a(()=>e[34]||(e[34]=[m("Bulk Patch Management")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{class:"acc-item headers-item",clickable:"",onClick:e[6]||(e[6]=k=>i.showServerMaintenance=!0)},{default:a(()=>[l(C,null,{default:a(()=>e[35]||(e[35]=[m("Server Maintenance")])),_:1})]),_:1})),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.bulkRecoverAgents},{default:a(()=>[l(C,null,{default:a(()=>e[36]||(e[36]=[m("Recover All Agents")])),_:1})]),_:1},8,["onClick"])),[[R]])]),_:1})]),_:1})]),_:1}),l(E,{class:"header-bar-btn",size:"md",dense:"","no-caps":"",flat:"",label:"Sonar Management"},{default:a(()=>[l(Ne,{"auto-close":""},{default:a(()=>[l(Se,{dense:"",style:{"min-width":"100px"}},{default:a(()=>[O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showClientsManager},{default:a(()=>[l(C,null,{default:a(()=>e[37]||(e[37]=[m("Clients Management")])),_:1})]),_:1},8,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showAutomationManager},{default:a(()=>[l(C,null,{default:a(()=>e[38]||(e[38]=[m("Automation Management")])),_:1})]),_:1},8,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showAlertsManager},{default:a(()=>[l(C,null,{default:a(()=>e[39]||(e[39]=[m("Alerts Management")])),_:1})]),_:1},8,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:d.showPermissionsManager},{default:a(()=>[l(C,null,{default:a(()=>e[40]||(e[40]=[m("Permissions Management")])),_:1})]),_:1},8,["onClick"])),[[R]]),O((f(),p(B,{clickable:"",class:"acc-item headers-item",onClick:e[7]||(e[7]=k=>i.showAdminManager=!0)},{default:a(()=>[l(C,null,{default:a(()=>e[41]||(e[41]=[m("Users Management")])),_:1})]),_:1})),[[R]]),d.isDev?O((f(),p(B,{key:0,clickable:"",class:"acc-item headers-item",onClick:e[8]||(e[8]=k=>i.showCodeSign=!0)},{default:a(()=>[l(C,null,{default:a(()=>e[42]||(e[42]=[m("Code Signing (devm)")])),_:1})]),_:1})),[[R]]):G("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(pe),l(me,{modelValue:i.showEditCoreSettingsModal,"onUpdate:modelValue":e[10]||(e[10]=k=>i.showEditCoreSettingsModal=k)},{default:a(()=>[l(r,{onClose:e[9]||(e[9]=k=>i.showEditCoreSettingsModal=!1)})]),_:1},8,["modelValue"]),g("div",ug,[l(me,{modelValue:i.showInstallAgent,"onUpdate:modelValue":e[12]||(e[12]=k=>i.showInstallAgent=k)},{default:a(()=>[l(u,{onClose:e[11]||(e[11]=k=>i.showInstallAgent=!1)})]),_:1},8,["modelValue"])]),g("div",cg,[l(me,{modelValue:i.showUpdateAgentsModal,"onUpdate:modelValue":e[14]||(e[14]=k=>i.showUpdateAgentsModal=k),maximized:"","transition-show":"slide-up","transition-hide":"slide-down"},{default:a(()=>[l(c,{onClose:e[13]||(e[13]=k=>i.showUpdateAgentsModal=!1)})]),_:1},8,["modelValue"])]),g("div",fg,[l(me,{modelValue:i.showAdminManager,"onUpdate:modelValue":e[16]||(e[16]=k=>i.showAdminManager=k)},{default:a(()=>[l(b,{onClose:e[15]||(e[15]=k=>i.showAdminManager=!1)})]),_:1},8,["modelValue"])]),l(me,{modelValue:i.showServerMaintenance,"onUpdate:modelValue":e[18]||(e[18]=k=>i.showServerMaintenance=k)},{default:a(()=>[l(y,{onClose:e[17]||(e[17]=k=>t.showMaintenance=!1)})]),_:1},8,["modelValue"]),l(me,{modelValue:i.showCodeSign,"onUpdate:modelValue":e[20]||(e[20]=k=>i.showCodeSign=k)},{default:a(()=>[l(w,{onClose:e[19]||(e[19]=k=>i.showCodeSign=!1)})]),_:1},8,["modelValue"])]),_:1})])}var Dg=Te(rg,[["render",mg]]);export{Du as A,Rn as C,ha as D,Dg as F,Qc as I,nn as Q,Gl as S};
