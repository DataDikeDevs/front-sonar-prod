import{M as k,N as y,b as S,O as A,n as f,Q as x,a as _}from"./3829acca.js";import{_ as B,M as Q,e as r,r as m,x as R,h as s,g as D,i as d,j as T,a9 as q,D as I,b as N,bL as z,o as L,p as V,Q as v}from"./7e207d24.js";import{u as $,s as U}from"./363547e5.js";import{u as j}from"./e96a218e.js";const E={name:"TakeControl",setup(){Q(()=>{w(),C(),g()});const a=j(),o=N(),h=r(()=>o.state.dash_positive_color),t=r(()=>o.state.dash_negative_color),u=r(()=>o.state.dash_warning_color),{params:n}=z(),c=m(""),l=m(null),p=r(()=>{switch(l.value){case"online":return h.value;case"offline":return u.value;default:return t.value}}),w=()=>{o.dispatch("getDashInfo",!1)};async function g(){a.loading.show();try{const e=await k(n.agent_id);c.value=e.control,l.value=e.status,$({title:`${e.hostname} - ${e.client} - ${e.site} | Take Control`})}catch(e){console.error(e)}a.loading.hide()}async function C(){const{dark_mode:e,loading_bar_color:i}=await y();a.dark.set(e),a.loadingBar.setDefaults({color:i})}async function M(){c.value="",a.loading.show({message:"Attempting to repair Mesh Agent"});try{const e=await A(n.agent_id);await g(),setTimeout(()=>{f(e)},500)}catch(e){console.error(e)}a.loading.hide()}async function b(){a.loading.show({message:"Restarting Mesh Agent"});const e={sv_action:"restart"};try{await U(n.agent_id,"mesh agent",e),setTimeout(()=>{f("Mesh agent service was restarted")},500)}catch(i){console.error(i)}a.loading.hide()}return{control:c,status:l,statusColor:p,dash_negative_color:t,repairMeshCentral:M,restartMeshService:b}}},O={class:"text-caption"},F=["src"];function G(a,o,h,t,u,n){return L(),R("div",null,[s(S,null,{default:D(()=>[d("span",O,[o[0]||(o[0]=V(" Sonar Agent Status: ")),s(x,{color:t.statusColor,label:t.status},null,8,["color","label"])]),s(_),s(v,{class:"q-mr-md",color:"primary",size:"sm",label:"Restart Connection",icon:"refresh",onClick:t.restartMeshService},null,8,["onClick"]),s(v,{color:t.dash_negative_color,size:"sm",label:"Recover Connection",icon:"fas fa-first-aid",onClick:t.repairMeshCentral},null,8,["color","onClick"]),s(_)]),_:1}),d("div",{class:"q-video",style:I({height:`${a.$q.screen.height-26}px`})},[T(d("iframe",{src:t.control,allow:"clipboard-read; clipboard-write",allowfullscreen:"",frameborder:"0"},null,8,F),[[q,t.control]])],4)])}var W=B(E,[["render",G]]);export{W as default};
