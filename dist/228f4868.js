import{bB as J,cj as X,z as H,_ as z,A as D,o as r,x as R,h as l,g as t,p as n,t as f,C as M,i as m,f as c,n as I,q as U,k as P,J as W,dM as Y,j as y,d4 as Z,F as ee,B as te,bR as le,bO as ie,E as ae,bM as L,v as ne,R as $}from"./7e207d24.js";import{Q as _,a as u,b as T}from"./c0fd0898.js";import{a as p,b as B}from"./48c23d68.js";import{Q,C as V}from"./c2746639.js";import{F as se,I as oe,S as E,C as re,D as de,A as ue,Q as ce}from"./75fe3d73.js";import{q as fe,m as he,p as me,o as ge,a as be}from"./3829acca.js";import{Q as _e}from"./11ec1272.js";import{m as G}from"./1a2e572b.js";import{g as x,b as pe,a as w,Q as we}from"./f0595305.js";import{A as ve,E as ye,a as ke,_ as Ae,P as Ce}from"./33631941.js";import{b as xe}from"./8b740bdb.js";import{I as K}from"./3b66e605.js";import{q as Te,t as Se}from"./aad6f44a.js";import"./e96a218e.js";import"./99821dad.js";import"./fa5db05f.js";import"./3320b391.js";import"./d613a77f.js";import"./443638d3.js";import"./2fb128e4.js";import"./36cdb1ed.js";import"./5addef8f.js";const Ve={name:"AgentTable",components:{AgentActionMenu:ve,Icon:K},props:["agents","columns","search","visibleColumns"],inject:["refreshDashboard"],mixins:[G],data(){return{pagination:{rowsPerPage:0,sortBy:"hostname",descending:!1},dashboard_overdue_text:"Show a dashboard alert when agent is overdue",email_overdue_text:"Send an email alert when agent is overdue",sms_overdue_text:"Send a SMS alert when agent is overdue"}},methods:{filterTable(i,e,g,S){const d=["version","operating_system","public_ip","cpu_model","graphics","local_ips","make_model","physical_disks","custom_fields","serial_number"],o=[...g,...d.map(v=>({field:v}))],C=e?e.toLowerCase():"";let h=!1,a=null,b=!1,O=!1,s=!1,k=!1,N="";return C.trim().split(" ").forEach(v=>{if(v.includes("is:")){h=!0;let A=v.split(":")[1];A==="patchespending"&&(O=!0),A==="actionspending"?s=!0:A==="checksfailing"?b=!0:A==="rebootneeded"?k=!0:(A==="online"||A==="offline"||A==="expired"||A==="overdue")&&(a=A)}else N=v+""}),i.filter(v=>{if(h){if(b&&!v.checks.has_failing_checks||O&&!v.has_patches_pending||s&&v.pending_actions_count===0||k&&!v.needs_reboot||a==="online"&&v.status!=="online")return!1;if(a==="offline"&&v.status!=="offline")return!1;if(a==="overdue"&&v.status!=="overdue")return!1;if(a==="expired"){let A=new Date,F=new Date(v.last_seen);if(J.getDateDiff(A,F,"days")<30)return!1}}return o.some(A=>{let F=S(A,v);Array.isArray(F)&&(F=F.map(j=>j.value?j.value:j));const q=F+"";return(q==="undefined"||q==="null"?"":q.toLowerCase()).indexOf(N)!==-1})})},rowDoubleClicked(i,e){this.$store.commit("setActiveRow",i),this.$q.loading.show(),setTimeout(()=>{switch(this.$q.loading.hide(),this.agentDblClickAction){case"editagent":this.showEditAgent(i);break;case"takecontrol":me(i);break;case"remotebg":he(i,e);break;case"urlaction":fe({agent_id:i,action:this.agentUrlAction});break}},500)},showPendingActionsModal(i){this.$q.dialog({component:xe,componentProps:{agent:i}})},agentRowSelected(i,e){this.$store.commit("setActiveRow",i),this.$store.commit("setAgentPlatform",e)},overdueAlert(i,e,g){let S="";i==="email"?S="overdue_email_alert":i==="text"?S="overdue_text_alert":i==="dashboard"&&(S="overdue_dashboard_alert");const d=g?"disabled":"enabled",o={[S]:!g},C=g?this.dash_info_color:this.dash_positive_color;this.$axios.put(`/agents/${e.agent_id}/`,o).then(()=>{this.$q.notify({color:C,textColor:"black",icon:"fas fa-check-circle",message:`${X(i)} alerts will now be ${d} when ${e.hostname} is overdue.`,timeout:5e3})})},agentClass(i){return i==="offline"?"agent-offline":i==="overdue"?"agent-overdue":"agent-normal"},rowSelectedClass(i){return i===this.selectedRow?this.$q.dark.isActive?"highlight-dark":"highlight":""},showEditAgent(i){this.$q.dialog({component:ye,componentProps:{agent_id:i}}).onOk(()=>{this.refreshDashboard(),this.$store.commit("setRefreshSummaryTab",!0)})}},computed:{...H(["tableHeight","dash_info_color","dash_positive_color","dash_negative_color","dash_warning_color"]),agentDblClickAction(){return this.$store.state.agentDblClickAction},agentUrlAction(){return this.$store.state.agentUrlAction},selectedRow(){return this.$store.state.selectedRow},agentTableLoading(){return this.$store.state.agentTableLoading},formatDate(){return this.$store.getters.formatDate}}},Pe={class:"px-4"},Me={class:"bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-md"},Re={key:0,class:"text-italic"},Ie={key:1};function De(i,e,g,S,d,o){const C=D("Icon"),h=D("AgentActionMenu");return r(),R("div",Pe,[l(we,{dense:"","table-class":{"table-bgcolor":!i.$q.dark.isActive,"table-bgcolor-dark":i.$q.dark.isActive},class:"agents-tbl-sticky overflow-hidden","table-style":{"max-height":i.tableHeight},rows:g.agents,filter:g.search,"filter-method":o.filterTable,columns:g.columns,"visible-columns":g.visibleColumns,"row-key":"id","binary-state-sort":"",pagination:d.pagination,"onUpdate:pagination":e[0]||(e[0]=a=>d.pagination=a),"rows-per-page-options":[0],"no-data-label":"No Agents",loading:o.agentTableLoading},{"header-cell-plat":t(a=>[l(x,{"auto-width":"",props:a},{default:t(()=>e[1]||(e[1]=[n("OS")])),_:2},1032,["props"])]),"header-cell-mon-type":t(a=>[l(x,{"auto-width":"",props:a},{default:t(()=>e[2]||(e[2]=[n("Type")])),_:2},1032,["props"])]),"header-cell-checks-status":t(a=>[l(x,{props:a},{default:t(()=>e[3]||(e[3]=[n(" Cheks ")])),_:2},1032,["props"])]),"header-cell-patchespending":t(a=>[l(x,{"auto-width":"",props:a},{default:t(()=>e[4]||(e[4]=[n(" Patches Pending ")])),_:2},1032,["props"])]),"header-cell-pendingactions":t(a=>[l(x,{"auto-width":"",props:a},{default:t(()=>e[5]||(e[5]=[n(" Pending Actions ")])),_:2},1032,["props"])]),"header-cell-agentstatus":t(a=>[l(x,{"auto-width":"",props:a},{default:t(()=>e[6]||(e[6]=[n(" Agent Status ")])),_:2},1032,["props"])]),"header-cell-needs_reboot":t(a=>[l(x,{"auto-width":"",props:a},{default:t(()=>e[7]||(e[7]=[n(" Reboot ")])),_:2},1032,["props"])]),"header-cell-last_seen":t(a=>[l(x,{props:a},{default:t(()=>e[8]||(e[8]=[n("Last Response")])),_:2},1032,["props"])]),"header-cell-boot_time":t(a=>[l(x,{props:a},{default:t(()=>e[9]||(e[9]=[n("Boot Time")])),_:2},1032,["props"])]),"header-cell-smsalert":t(a=>[l(x,{"auto-width":"",props:a},{default:t(()=>[l(C,{icon:"lucide:smartphone",class:"text-gray",style:{"font-size":"1.5em"}}),l(p,null,{default:t(()=>[n(f(d.sms_overdue_text),1)]),_:1})]),_:2},1032,["props"])]),"header-cell-emailalert":t(a=>[l(x,{"auto-width":"",props:a},{default:t(()=>[l(C,{icon:"lucide:mail",class:"text-gray",style:{"font-size":"1.5em"}}),l(p,null,{default:t(()=>[n(f(d.email_overdue_text),1)]),_:1})]),_:2},1032,["props"])]),"header-cell-dashboardalert":t(a=>[l(x,{"auto-width":"",props:a},{default:t(()=>[l(C,{icon:"lucide:bell",class:"text-gray",style:{"font-size":"1.5em"}}),l(p,null,{default:t(()=>[n(f(d.dashboard_overdue_text),1)]),_:1})]),_:2},1032,["props"])]),body:t(a=>[l(pe,{onContextmenu:b=>o.agentRowSelected(a.row.agent_id,a.row.plat),props:a,class:M(o.rowSelectedClass(a.row.agent_id)),onClick:b=>o.agentRowSelected(a.row.agent_id,a.row.plat),onDblclick:b=>o.rowDoubleClicked(a.row.agent_id,a.row.plat)},{default:t(()=>[l(B,{"context-menu":""},{default:t(()=>[l(h,{agent:a.row},null,8,["agent"])]),_:2},1024),l(w,{key:"plat",props:a},{default:t(()=>[l(p,null,{default:t(()=>[n(f(a.row.plat==="windows"?"Microsoft Windows":a.row.plat==="linux"?"Linux":a.row.plat==="darwin"?"macOS":""),1)]),_:2},1024),m("span",Me,f(a.row.plat==="windows"?"Microsoft Windows":a.row.plat==="linux"?"Linux":a.row.plat==="darwin"?"macOS":""),1)]),_:2},1032,["props"]),l(w,{key:"mon-type",props:a},{default:t(()=>[a.row.monitoring_type==="server"?(r(),c(p,{key:0},{default:t(()=>e[10]||(e[10]=[n("Server")])),_:1})):(r(),c(p,{key:1},{default:t(()=>e[11]||(e[11]=[n("Workstation")])),_:1})),a.row.monitoring_type==="server"?(r(),c(C,{key:2,icon:"lucide:server",class:"text-primary",style:{"font-size":"1.2em"}})):(r(),c(C,{key:3,icon:"lucide:monitor",class:"text-primary",style:{"font-size":"1.2em"}}))]),_:2},1032,["props"]),l(w,{key:"checks-status",props:a},{default:t(()=>[a.row.maintenance_mode?(r(),c(I,{key:0,name:"construction",size:"1.2em",color:i.dash_positive_color},{default:t(()=>[l(p,null,{default:t(()=>e[12]||(e[12]=[n("Maintenance Mode Enabled")])),_:1})]),_:1},8,["color"])):a.row.checks.failing>0?(r(),c(I,{key:1,name:"fas fa-check-double",size:"1.2em",color:i.dash_negative_color},{default:t(()=>[l(p,null,{default:t(()=>e[13]||(e[13]=[n("Checks failing")])),_:1})]),_:1},8,["color"])):a.row.checks.warning>0?(r(),c(I,{key:2,name:"fas fa-check-double",size:"1.2em",color:i.dash_warning_color},{default:t(()=>[l(p,null,{default:t(()=>e[14]||(e[14]=[n("Checks warning")])),_:1})]),_:1},8,["color"])):a.row.checks.info>0?(r(),c(I,{key:3,name:"fas fa-check-double",size:"1.2em",color:i.dash_info_color},{default:t(()=>[l(p,null,{default:t(()=>e[15]||(e[15]=[n("Checks info")])),_:1})]),_:1},8,["color"])):(r(),c(I,{key:4,name:"fas fa-check-double",size:"1.2em",color:i.dash_positive_color},{default:t(()=>[l(p,null,{default:t(()=>e[16]||(e[16]=[n("Checks passing")])),_:1})]),_:1},8,["color"]))]),_:2},1032,["props"]),l(w,{key:"client_name",props:a},{default:t(()=>[n(f(a.row.client_name),1)]),_:2},1032,["props"]),l(w,{key:"site_name",props:a},{default:t(()=>[n(f(a.row.site_name),1)]),_:2},1032,["props"]),l(w,{key:"hostname",props:a},{default:t(()=>[n(f(a.row.hostname),1)]),_:2},1032,["props"]),l(w,{key:"description",props:a},{default:t(()=>[n(f(a.row.description),1)]),_:2},1032,["props"]),l(w,{key:"user",props:a},{default:t(()=>[a.row.italic?(r(),R("span",Re,f(a.row.logged_username),1)):(r(),R("span",Ie,f(a.row.logged_username),1))]),_:2},1032,["props"]),l(w,{props:a,key:"patchespending"},{default:t(()=>[a.row.has_patches_pending?(r(),c(I,{key:0,name:"verified_user",size:"1.5em",color:"primary"},{default:t(()=>[l(p,null,{default:t(()=>e[17]||(e[17]=[n("Patches Pending")])),_:1})]),_:1})):U("",!0)]),_:2},1032,["props"]),l(w,{props:a,key:"pendingactions"},{default:t(()=>[a.row.pending_actions_count>0?(r(),c(I,{key:0,onClick:b=>o.showPendingActionsModal(a.row),name:"far fa-clock",size:"1.4em",color:i.dash_warning_color,class:"cursor-pointer"},{default:t(()=>[l(p,null,{default:t(()=>[n("Pending Action Count: "+f(a.row.pending_actions_count),1)]),_:2},1024)]),_:2},1032,["onClick","color"])):U("",!0)]),_:2},1032,["props"]),l(w,{key:"needsreboot"},{default:t(()=>[a.row.needs_reboot?(r(),c(I,{key:0,name:"fas fa-power-off",color:"primary"},{default:t(()=>[l(p,null,{default:t(()=>e[18]||(e[18]=[n("Reboot required")])),_:1})]),_:1})):U("",!0)]),_:2},1024),l(w,{key:"agentstatus"},{default:t(()=>[l(p,null,{default:t(()=>[n(f(a.row.status==="overdue"?"Agent overdue":a.row.status==="offline"?"Agent offline":"Agent online"),1)]),_:2},1024),l(C,{style:{width:"20px",height:"20px"},icon:"lucide:signal",class:M(["text-[1.2em]",{"text-red-500":a.row.status==="overdue","text-yellow-500":a.row.status==="offline","text-green-500":a.row.status==="online"}])},null,8,["class"])]),_:2},1024),l(w,{key:"last_seen",props:a},{default:t(()=>[n(f(o.formatDate(a.row.last_seen)),1)]),_:2},1032,["props"]),l(w,{key:"boot_time",props:a},{default:t(()=>[n(f(i.bootTime(a.row.boot_time)),1)]),_:2},1032,["props"]),l(w,{key:"smsalert",props:a},{default:t(()=>[a.row.alert_template&&a.row.alert_template.always_text!==null?(r(),c(P,{key:0,modelValue:a.row.alert_template.always_text,"onUpdate:modelValue":b=>a.row.alert_template.always_text=b,disable:"",dense:""},{default:t(()=>[l(p,null,{default:t(()=>[n(" Setting is overridden by alert template: "+f(a.row.alert_template.name),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):(r(),c(P,{key:1,dense:"","onUpdate:modelValue":[b=>o.overdueAlert("text",a.row,a.row.overdue_text_alert),b=>a.row.overdue_text_alert=b],modelValue:a.row.overdue_text_alert},{default:t(()=>[l(p,null,{default:t(()=>[n(f(d.sms_overdue_text),1)]),_:1})]),_:2},1032,["onUpdate:modelValue","modelValue"]))]),_:2},1032,["props"]),l(w,{key:"emailalert",props:a},{default:t(()=>[a.row.alert_template&&a.row.alert_template.always_email!==null?(r(),c(P,{key:0,modelValue:a.row.alert_template.always_email,"onUpdate:modelValue":b=>a.row.alert_template.always_email=b,disable:"",dense:""},{default:t(()=>[l(p,null,{default:t(()=>[n(" Setting is overridden by alert template: "+f(a.row.alert_template.name),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):(r(),c(P,{key:1,dense:"","onUpdate:modelValue":[b=>o.overdueAlert("email",a.row,a.row.overdue_email_alert),b=>a.row.overdue_email_alert=b],modelValue:a.row.overdue_email_alert},{default:t(()=>[l(p,null,{default:t(()=>[n(f(d.email_overdue_text),1)]),_:1})]),_:2},1032,["onUpdate:modelValue","modelValue"]))]),_:2},1032,["props"]),l(w,{key:"dashboardalert",props:a},{default:t(()=>[a.row.alert_template&&a.row.alert_template.always_alert!==null?(r(),c(P,{key:0,modelValue:a.row.alert_template.always_alert,"onUpdate:modelValue":b=>a.row.alert_template.always_alert=b,disable:"",dense:""},{default:t(()=>[l(p,null,{default:t(()=>[n(" Setting is overridden by alert template: "+f(a.row.alert_template.name),1)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])):(r(),c(P,{key:1,dense:"","onUpdate:modelValue":[b=>o.overdueAlert("dashboard",a.row,a.row.overdue_dashboard_alert),b=>a.row.overdue_dashboard_alert=b],modelValue:a.row.overdue_dashboard_alert},{default:t(()=>[l(p,null,{default:t(()=>[n(f(d.dashboard_overdue_text),1)]),_:1})]),_:2},1032,["onUpdate:modelValue","modelValue"]))]),_:2},1032,["props"])]),_:2},1032,["onContextmenu","props","class","onClick","onDblclick"])]),_:1},8,["table-class","table-style","rows","filter","filter-method","columns","visible-columns","pagination","loading"])])}var Ue=z(Ve,[["render",De]]);const Fe={},Le={fill:"currentcolor",viewBox:"0 0 24 24",id:"home",xmlns:"http://www.w3.org/2000/svg",class:"icon line"};function Oe(i,e){return r(),R("svg",Le,e[0]||(e[0]=[W('<g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><polyline id="primary" points="21 12 12 3 3 12" style="fill:none;stroke:currentcolor;stroke-linecap:round;stroke-linejoin:round;stroke-width:1.5;"></polyline><path id="primary-2" data-name="primary" d="M19,10V20.3a.77.77,0,0,1-.83.7H14.3V14.1H9.7V21H5.83A.77.77,0,0,1,5,20.3V10" style="fill:none;stroke:currentcolor;stroke-linecap:round;stroke-linejoin:round;stroke-width:1.5;"></path></g>',3)]))}var qe=z(Fe,[["render",Oe]]);const $e={},Qe={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-building-icon lucide-building"};function Be(i,e){return r(),R("svg",Qe,e[0]||(e[0]=[W('<rect width="16" height="20" x="4" y="2" rx="2" ry="2"></rect><path d="M9 22v-4h6v4"></path><path d="M8 6h.01"></path><path d="M16 6h.01"></path><path d="M12 6h.01"></path><path d="M12 10h.01"></path><path d="M12 14h.01"></path><path d="M16 10h.01"></path><path d="M16 14h.01"></path><path d="M8 10h.01"></path><path d="M8 14h.01"></path>',11)]))}var ze=z($e,[["render",Be]]);const Ne={name:"DashboardView",components:{FileBar:se,AgentTable:Ue,SubTableTabs:ke,InstallAgent:oe,IntegrationsContextMenu:Ae,HomeLogo:qe,BusinessIcon:ze,Icon:K},provide(){return{refreshDashboard:(i,e)=>{e&&this.$store.commit("destroySubTable"),this.$store.dispatch("refreshDashboard",i)}}},mixins:[G],data(){return{showInstallAgentModal:!1,sitePk:null,innerModel:(this.$q.screen.height-82)/2,search:this.$route.query.search?this.$route.query.search:"",filterTextLength:0,filterAvailability:"all",filterPatchesPending:!1,filterActionsPending:!1,filterChecksFailing:!1,filterRebootNeeded:!1,urlActions:[],columns:[{name:"plat",label:"",field:"plat",sortable:!0,align:"left"},{name:"mon-type",label:"",field:"monitoring_type",sortable:!0,align:"left"},{name:"checks-status",align:"left",field:"checks",sortable:!0,sort:(i,e)=>parseInt(e.failing)-parseInt(i.failing)||parseInt(e.warning)-parseInt(i.warning)||parseInt(e.info)-parseInt(i.info)},{name:"client_name",label:"Client",field:"client_name",sortable:!0,align:"left"},{name:"site_name",label:"Tenant",field:"site_name",sortable:!0,align:"left"},{name:"hostname",label:"Hostname",field:"hostname",sortable:!0,align:"left"},{name:"description",label:"Description",field:"description",sortable:!0,align:"left"},{name:"user",label:"User",field:"logged_username",sortable:!0,align:"left"},{name:"italic",field:"italic"},{name:"patchespending",field:"has_patches_pending",align:"left",sortable:!0},{name:"pendingactions",field:"pending_actions_count",align:"left",sortable:!0},{name:"needs_reboot",field:"needs_reboot",align:"left",sortable:!0},{name:"agentstatus",field:"status",align:"left",sortable:!0},{name:"last_seen",label:"Last Response",field:"last_seen",sortable:!0,align:"left"},{name:"boot_time",label:"Boot Time",field:"boot_time",sortable:!0,align:"left"},{name:"smsalert",align:"left"},{name:"emailalert",align:"left"},{name:"dashboardalert",align:"left"}],visibleColumns:["plat","mon-type","checks-status","client_name","site_name","hostname","description","user","patchespending","pendingactions","agentstatus","needs_reboot","last_seen","boot_time","smsalert","emailalert","dashboardalert"]}},watch:{search(i){i===""?this.clearFilter():i.length<this.filterTextLength&&this.clearFilter()},selectedTree(){this.clearSearchWhenSwitching&&this.clearFilter()},tab(i,e){e!==void 0&&this.$store.dispatch("loadAgents")}},methods:{getCustomIcon(){return"BusinessIcon"},goHome(){this.$router.push("/home")},getTree(){this.$store.dispatch("loadTree")},clearTreeSelected(){this.clearSearchWhenSwitching&&this.clearFilter(),this.$store.dispatch("refreshDashboard",!0)},showPolicyAdd(i){this.$q.dialog({component:Ce,componentProps:{type:i.children?"client":"site",object:i.children?i.client:i.site}}).onOk(()=>this.$store.dispatch("loadTree"))},showAddSiteModal(i){this.$q.dialog({component:E,componentProps:{client:i.id}}).onOk(()=>this.$store.dispatch("loadTree"))},showEditModal(i){i.children?(i.id,i.label):(i.id,i.label,i.client),this.$q.dialog({component:i.children?re:E,componentProps:i.children?{client:i.client}:{site:i.site}}).onOk(()=>this.$store.dispatch("loadTree"))},showDeleteModal(i){i.children&&i.client.agent_count>0||!i.children&&i.site.agent_count>0?this.$q.dialog({component:de,componentProps:{object:i.children?i.client:i.site,type:i.children?"client":"site"}}).onOk(this.clearTreeSelected):this.$q.dialog({title:"Are you sure?",message:`Delete ${i.children?"client":"site"}: ${i.label}.`,cancel:!0,ok:{label:"Delete",color:"negative"}}).onOk(async()=>{this.$q.loading.show();try{const e=i.children?await Te(i.id):await Se(i.id);this.notifySuccess(e),this.clearTreeSelected()}catch(e){console.error(e)}this.$q.loading.hide()})},showInstallAgent(i){this.sitePk=i.id,this.showInstallAgentModal=!0},closeInstallAgent(){this.showInstallAgentModal=!1,this.sitePk=null},showAlertTemplateAdd(i){this.$q.dialog({component:ue,componentProps:{type:i.children?"client":"site",object:i.children?i.client:i.site}}).onOk(()=>this.$store.dispatch("refreshDashboard"))},runChecks(i){const e=i.children?"client":"site";this.$axios.post(`/checks/${e}/${i.id}/csbulkrun/`).then(g=>{this.notifySuccess(g.data)}).catch(g=>{console.error(g)})},showToggleMaintenance(i){let e={id:i.id,type:i.raw.split("|")[0],action:i.color!=="green"};this.$axios.post("/agents/maintenance/bulk/",e).then(g=>{this.notifySuccess(g.data),this.$store.dispatch("refreshDashboard"),this.$store.commit("setRefreshSummaryTab",!0)}).catch(g=>{console.error(g)})},clearFilter(){this.filterTextLength=0,this.filterPatchesPending=!1,this.filterRebootNeeded=!1,this.filterChecksFailing=!1,this.filterActionsPending=!1,this.filterAvailability="all",this.search=""},applyFilter(){if(this.filterAvailability==="all"&&(this.search.includes("is:online")||this.search.includes("is:offline")||this.search.includes("is:expired")||this.search.includes("is:overdue"))&&this.clearFilter(),!this.isFilteringTable)return;let i="";this.filterPatchesPending&&(i+="is:patchespending "),this.filterActionsPending&&(i+="is:actionspending "),this.filterChecksFailing&&(i+="is:checksfailing "),this.filterRebootNeeded&&(i+="is:rebootneeded "),this.filterAvailability!=="all"&&(this.filterAvailability==="online"?i+="is:online ":this.filterAvailability==="offline"?i+="is:offline ":this.filterAvailability==="offline_30days"?i+="is:expired ":this.filterAvailability==="overdue"&&(i+="is:overdue ")),this.search=i,this.filterTextLength=i.length-1},getURLActions(){this.$axios.get("/core/urlaction/").then(i=>{this.urlActions=i.data.filter(e=>e.action_type==="web").sort((e,g)=>e.name.localeCompare(g.name)),this.urlActions.length===0&&this.notifyWarning("No URL Actions configured. Go to Settings > Global Settings > URL Actions")})},runURLAction(i,e,g){const S={[g]:i,action:e};this.$axios.patch("/core/urlaction/run/",S).then(d=>{ge(d.data)})}},computed:{...H(["tree","agents","treeReady","clearSearchWhenSwitching"]),isSysadmin(){return this.$route.path==="/sysadmin"},sidebarOpen:{get(){return this.$store.state.sidebarOpen},set(i){this.$store.commit("setSidebarOpen",i)}},clientsTree(){return this.tree},clientTreeSplitter:{get(){return this.$store.state.clientTreeSplitter},set(i){this.$store.dispatch("setClientTreeSplitter",i)}},tab:{get(){return this.$store.state.defaultAgentTblTab},set(i){this.$store.commit("SET_DEFAULT_AGENT_TBL_TAB",i),this.$store.commit("destroySubTable")}},selectedTree:{get(){return this.$store.state.selectedTree},set(i){this.$store.commit("setSelectedTree",i),this.$store.commit("destroySubTable")}},allClientsActive(){return this.selectedTree===""},filteredAgents(){return this.tab==="mixed"?this.agents:this.agents.filter(i=>i.monitoring_type===this.tab)},isFilteringTable(){return this.filterPatchesPending||this.filterActionsPending||this.filterChecksFailing||this.filterRebootNeeded||this.filterAvailability!=="all"}},mounted(){setTimeout(()=>{this.getTree(),this.$store.dispatch("loadAgents")},100)}},je={class:"flex flex-nowrap pr-4"},Ee={key:0,class:"ac p-3",style:{height:"30vh"}},He={key:1,class:"scroll",style:{height:"85vh",overflow:"initial"}},We={class:"cursor-pointer home-nav ac"},Ge={class:"ac"},Ke={class:"ac js semibold rounded-md allclients-item"},Je={class:"ac"},Xe={style:{height:"48px"},class:"row clients-nav p-3 items-center allclients-item"},Ye={class:"main-content-column",style:{height:"85vh","overflow-y":"auto",display:"flex",width:"100%","flex-direction":"column"}},Ze={class:"row px-2 items-center",style:{"padding-top":"12px"}},et={class:"ac py-3 px-2"},tt={class:"search-container"},lt={class:"card-footer ac je gap-2"},it={class:"mb-4",style:{}},at={class:"px-4 py-2",style:{"min-height":"520px"}};function nt(i,e,g,S,d,o){const C=D("FileBar"),h=D("Icon"),a=D("AgentTable"),b=D("SubTableTabs"),O=D("InstallAgent");return r(),c(_e,null,{default:t(()=>[l(C),m("div",je,[m("div",{class:M(["sidebar scroll sidebar-transition",{"sidebar-open":o.sidebarOpen,"sidebar-closed":!o.sidebarOpen}])},[i.treeReady?(r(),R("div",He,[l(Q,{class:"p-2.5"},{default:t(()=>[y((r(),c(_,{clickable:"",active:!1,to:{path:"/"},class:"clients-nav mb-2"},{default:t(()=>[m("div",We,[m("div",Ge,[l(h,{icon:"lucide:house",width:"20",height:"20",class:"svg home-svg"})]),e[20]||(e[20]=n(" Home "))])]),_:1})),[[$]]),y((r(),c(_,{class:"clients-nav mb-2",clickable:"",active:o.isSysadmin,hover:""},{default:t(()=>[m("div",{class:M(["ac js semibold",o.isSysadmin?"active":""])},[m("div",{class:M(["ac",{"active-icon":o.isSysadmin}])},[l(h,{icon:"lucide:monitor-cog",class:"svg home-svg",width:"24",height:"24"})],2),e[21]||(e[21]=n(" Sysadmin "))],2)]),_:1},8,["active"])),[[$]]),y((r(),c(_,{class:"clients-nav",clickable:"",onClick:o.clearTreeSelected,hover:""},{default:t(()=>[m("div",Ke,[m("div",Je,[l(h,{class:"home-svg",icon:"lucide:monitor",width:"24",height:"24"})]),e[22]||(e[22]=n(" All Clients "))])]),_:1},8,["onClick"])),[[$]]),i.treeReady&&o.clientsTree.length?(r(),c(ce,{key:0,ref:"tree",nodes:o.clientsTree,"node-key":"raw","no-nodes-label":"No Clients","selected-color":"primary",selected:o.selectedTree,"onUpdate:selected":[e[0]||(e[0]=s=>o.selectedTree=s),e[1]||(e[1]=s=>i.$store.dispatch("refreshDashboard"))],hoverable:"false"},{"default-header":t(s=>[m("div",Xe,[(r(),c(Z(o.getCustomIcon(s.node.icon)),{class:"q-mr-sm",style:{width:"20px",height:"20px"}})),m("div",null,[n(f(s.node.label)+" ",1),l(p,{delay:600},{default:t(()=>[n(" ID: "+f(s.node.id),1),e[23]||(e[23]=m("br",null,null,-1)),n(" Agent Count: "+f(s.node.children?s.node.client.agent_count:s.node.site.agent_count),1)]),_:2},1024),l(B,{"context-menu":""},{default:t(()=>[l(Q,{dense:"",style:{"min-width":"200px"}},{default:t(()=>[y((r(),c(_,{class:"acc-item headers-item",clickable:"",onClick:k=>o.showEditModal(s.node)},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:edit",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>e[24]||(e[24]=[n("Edit")])),_:1})]),_:2},1032,["onClick"])),[[V]]),y((r(),c(_,{clickable:"",onClick:k=>o.showDeleteModal(s.node)},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:trash",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>e[25]||(e[25]=[n("Delete")])),_:1})]),_:2},1032,["onClick"])),[[V]]),s.node.children?y((r(),c(_,{key:0,class:"acc-item headers-item",clickable:"",onClick:k=>o.showAddSiteModal(s.node)},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:plus-circle",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>e[26]||(e[26]=[n("Add Tenant")])),_:1})]),_:2},1032,["onClick"])),[[V]]):U("",!0),y((r(),c(_,{class:"acc-item headers-item",clickable:"",onClick:k=>o.showToggleMaintenance(s.node)},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:hard-hat",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>[n(f(s.node.color==="green"?"Disable Maintenance Mode":"Enable Maintenance Mode"),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[V]]),s.node.children===void 0?y((r(),c(_,{key:1,class:"acc-item headers-item",clickable:"",onClick:k=>o.showInstallAgent(s.node)},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:cloud-download",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>e[27]||(e[27]=[n("Install Agent")])),_:1})]),_:2},1032,["onClick"])),[[V]]):U("",!0),y((r(),c(_,{clickable:"",class:"acc-item headers-item",onClick:k=>o.showPolicyAdd(s.node)},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:shield",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>e[28]||(e[28]=[n("Assign Automation Policy")])),_:1})]),_:2},1032,["onClick"])),[[V]]),y((r(),c(_,{class:"acc-item headers-item",clickable:"",onClick:k=>o.showAlertTemplateAdd(s.node)},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:alert-triangle",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>e[29]||(e[29]=[n("Assign Alert Template")])),_:1})]),_:2},1032,["onClick"])),[[V]]),y((r(),c(_,{class:"acc-item headers-item",clickable:"",onClick:o.getURLActions},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:external-link",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>e[30]||(e[30]=[n("Run URL Action")])),_:1}),l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:chevron-right",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(B,{"auto-close":"",anchor:"top end",self:"top start"},{default:t(()=>[l(Q,null,{default:t(()=>[(r(!0),R(ee,null,te(d.urlActions,k=>y((r(),c(_,{key:k.id,dense:"",clickable:"",class:"acc-item headers-item",onClick:N=>o.runURLAction(s.node.id,k.id,s.node.children?"client":"site")},{default:t(()=>[n(f(k.name),1)]),_:2},1032,["onClick"])),[[V]])),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[$]]),y((r(),c(_,{clickable:"",class:"acc-item headers-item",x:"",onClick:k=>o.runChecks(s.node)},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:check",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>e[31]||(e[31]=[n("Run Checks")])),_:1})]),_:2},1032,["onClick"])),[[V]]),s.node.children&&i.$integrations?.clientMenuIntegrations?.length>0||!s.node.children&&i.$integrations?.siteMenuIntegrations.length>0?(r(),c(_,{key:2,clickable:""},{default:t(()=>[l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:bar-chart-2",width:"20",height:"20",class:"acc-item-icon"})]),_:1}),l(u,null,{default:t(()=>e[32]||(e[32]=[n("Reporting")])),_:1}),l(u,{side:""},{default:t(()=>[l(h,{icon:"lucide:check",width:"20",height:"20",class:"acc-item-icon"})]),_:1})]),_:1})):U("",!0)]),_:2},1024)]),_:2},1024)])])]),_:1},8,["nodes","selected"])):U("",!0)]),_:1})])):(r(),R("div",Ee,[l(Y,{size:"25px",color:"primary"})]))],2),m("div",Ye,[m("div",Ze,[m("div",et,[m("div",{class:M(["agent-type-header px-3 py-2 cursor-pointer",{"active-type-header":o.tab==="mixed"}]),onClick:e[2]||(e[2]=s=>o.tab="mixed")},[l(h,{icon:"lucide:align-justify",width:"20",height:"20",class:"mr-2"}),e[33]||(e[33]=n(" All "))],2),m("div",{class:M(["agent-type-header px-3 py-2 cursor-pointer",{"active-type-header":o.tab==="server"}]),onClick:e[3]||(e[3]=s=>o.tab="server")},[l(h,{icon:"lucide:server",width:"20",height:"20",class:"mr-2"}),e[34]||(e[34]=n(" Servers "))],2),m("div",{class:M(["agent-type-header px-3 py-2 cursor-pointer",{"active-type-header":o.tab==="workstation"}]),onClick:e[4]||(e[4]=s=>o.tab="workstation")},[l(h,{icon:"lucide:monitor",width:"20",height:"20",class:"mr-2"}),e[35]||(e[35]=n(" Workstations "))],2)]),l(be),m("div",tt,[l(h,{icon:"lucide:search",width:"20",height:"20",class:"search-icon"}),y(m("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>d.search=s),type:"text",class:"form-control search-form",onInput:e[6]||(e[6]=(...s)=>i.onSearchInput&&i.onSearchInput(...s)),onKeydown:e[7]||(e[7]=ie(ae(()=>{},["prevent"]),["enter"])),style:{"padding-left":"35px","padding-right":"90px",height:"36px",width:"100%","border-radius":"4px"}},null,544),[[le,d.search]])]),m("button",{class:M(["btn btn-none-primary btn-md",{"btn-primary":o.isFilteringTable}])},[l(h,{icon:"lucide:funnel",width:"20",height:"20"}),l(B,{class:""},{default:t(()=>[l(Q,{class:"",dense:""},{default:t(()=>[l(T,{header:""},{default:t(()=>e[36]||(e[36]=[n("Filter Agent Table")])),_:1}),l(_,null,{default:t(()=>[l(u,{side:""},{default:t(()=>[l(P,{modelValue:d.filterChecksFailing,"onUpdate:modelValue":e[8]||(e[8]=s=>d.filterChecksFailing=s)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(T,null,{default:t(()=>e[37]||(e[37]=[n("Checks Failing")])),_:1})]),_:1})]),_:1}),l(_,null,{default:t(()=>[l(u,{side:""},{default:t(()=>[l(P,{modelValue:d.filterPatchesPending,"onUpdate:modelValue":e[9]||(e[9]=s=>d.filterPatchesPending=s)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(T,null,{default:t(()=>e[38]||(e[38]=[n("Patches Pending")])),_:1})]),_:1})]),_:1}),l(_,null,{default:t(()=>[l(u,{side:""},{default:t(()=>[l(P,{modelValue:d.filterActionsPending,"onUpdate:modelValue":e[10]||(e[10]=s=>d.filterActionsPending=s)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(T,null,{default:t(()=>e[39]||(e[39]=[n("Actions Pending")])),_:1})]),_:1})]),_:1}),l(_,null,{default:t(()=>[l(u,{side:""},{default:t(()=>[l(P,{modelValue:d.filterRebootNeeded,"onUpdate:modelValue":e[11]||(e[11]=s=>d.filterRebootNeeded=s)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(T,null,{default:t(()=>e[40]||(e[40]=[n("Reboot Needed")])),_:1})]),_:1})]),_:1}),l(T,{header:""},{default:t(()=>e[41]||(e[41]=[n("Availability")])),_:1}),l(_,null,{default:t(()=>[l(u,{side:""},{default:t(()=>[l(L,{val:"all",modelValue:d.filterAvailability,"onUpdate:modelValue":e[12]||(e[12]=s=>d.filterAvailability=s)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(T,null,{default:t(()=>e[42]||(e[42]=[n("Show All Agents")])),_:1})]),_:1})]),_:1}),l(_,null,{default:t(()=>[l(u,{side:""},{default:t(()=>[l(L,{val:"online",modelValue:d.filterAvailability,"onUpdate:modelValue":e[13]||(e[13]=s=>d.filterAvailability=s)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(T,null,{default:t(()=>e[43]||(e[43]=[n("Show Online Only")])),_:1})]),_:1})]),_:1}),l(_,null,{default:t(()=>[l(u,{side:""},{default:t(()=>[l(L,{val:"offline",modelValue:d.filterAvailability,"onUpdate:modelValue":e[14]||(e[14]=s=>d.filterAvailability=s)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(T,null,{default:t(()=>e[44]||(e[44]=[n("Show Offline Only")])),_:1})]),_:1})]),_:1}),l(_,null,{default:t(()=>[l(u,{side:""},{default:t(()=>[l(L,{val:"overdue",modelValue:d.filterAvailability,"onUpdate:modelValue":e[15]||(e[15]=s=>d.filterAvailability=s)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(T,null,{default:t(()=>e[45]||(e[45]=[n("Show Overdue Only")])),_:1})]),_:1})]),_:1}),l(_,null,{default:t(()=>[l(u,{side:""},{default:t(()=>[l(L,{val:"offline_30days",modelValue:d.filterAvailability,"onUpdate:modelValue":e[16]||(e[16]=s=>d.filterAvailability=s)},null,8,["modelValue"])]),_:1}),l(u,null,{default:t(()=>[l(T,null,{default:t(()=>e[46]||(e[46]=[n("Show Offline for over 30 days")])),_:1})]),_:1})]),_:1})]),_:1}),m("div",lt,[y((r(),R("button",{onClick:e[17]||(e[17]=(...s)=>o.applyFilter&&o.applyFilter(...s)),class:"btn btn-primary"},e[47]||(e[47]=[n(" Apply ")]))),[[V]]),m("button",{onClick:e[18]||(e[18]=(...s)=>o.clearFilter&&o.clearFilter(...s)),class:"btn btn-secondary"}," Clear ")])]),_:1})],2)]),m("div",it,[l(a,{agents:o.filteredAgents,columns:d.columns,search:d.search,visibleColumns:d.visibleColumns},null,8,["agents","columns","search","visibleColumns"])]),m("div",at,[l(b)])])]),l(ne,{modelValue:d.showInstallAgentModal,"onUpdate:modelValue":e[19]||(e[19]=s=>d.showInstallAgentModal=s),onHide:o.closeInstallAgent},{default:t(()=>[l(O,{onClose:o.closeInstallAgent,sitepk:parseInt(d.sitePk)},null,8,["onClose","sitepk"])]),_:1},8,["modelValue","onHide"])]),_:1})}var Mt=z(Ne,[["render",nt]]);export{Mt as default};
